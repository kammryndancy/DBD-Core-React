0010 REM "<ZZENTR> System data types input module
0035 REM "5.7 - 03/30/11 - 18.265277 - crg - SSP# 245601
0037 REM "245601-Modify ZZENTR to not allow entry of invalid years in dates  
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETESC 9300; SETERR 0900
1000 ENTER X0$,X{ALL},X1$,X2$,X3$,X0,X1,X2,X3,X4,X4$,X5$,X6$,L0$,L1$,L2$,L3$,ERR=*NEXT
1010 REM "Setup for terminal size
1015 IF MID(L0$,1,6)="AW2PIE" THEN T_LINES=16,T_CHARS=20 ELSE T_LINES=24,T_CHARS=79
1050 C0$=X0$(2),X0$=X0$(1,1),S=X2,A7$="-"; IF POS("+"=C0$)>0 OR POS("-"=C0$)>0 THEN C1$=C0$(1,1)
1060 IF X0$<>"X" THEN IF POS("S"=C0$)>0 THEN IF X3$(43,2)<="99" THEN GOTO 9900
1065 C2=POS(">"=C0$),C2$=" "; IF C2=0 THEN C2=POS("<"=C0$),C2$="~"; IF C2=0 THEN C2=POS("^"=C0$),C2$=" "
1070 IF C2=0 THEN C2$=""
1080 IF POS("*"=X3$(154,6))>0 THEN CALL "ZZENTF",X3$,X0,X1,X4; IF X3$(338,2)="  " AND X4<>0 THEN EXIT 
1100 SETERR 1110; IF L3$>"" THEN R0=NUM(L3$(1,2),ERR=1101),R2=1; IF L3$(3,1)<>"V" THEN R2=0
1105 R1=NUM(L3$(4),ERR=1106)
1110 SETERR 9000
1115 IF R0>0 THEN IF ABS(X4)=2 THEN GOSUB 8030
1210 P0=POS("P"=C0$); IF POS("F"=C0$)=0 THEN X9$=X6$
1220 IF X0$<>"N" THEN DIM S$(X3+10),Z$(X3,"0"),B$(X3,X3$(84,1)) ELSE DIM S$(20),Z$(20,"0")
1302 IF X3$(338,2)<>"  " THEN X5$=""; GOTO 1400
1305 IF X3$(29,1)=" " AND POS("{"=X5$)<>1 THEN GOTO 1400 ELSE IF X5$>"" THEN X$=X5$(1,2),X5$=X5$(3) ELSE PRINT @(0,T_LINES-1),'CL',; X3$(29,1)=""; GOTO 1400
1315 Q9=1; IF X$="{1" THEN Q9=0
1317 IF X3$(29,1)=X$(2,1) THEN GOTO 1400
1320 IF POS("1"=X3$(154,6))>0 THEN CALL "ZZPROM",ERR=1380,X$,X3$,0,"","","",T_LINES-1
1330 X3$(29,1)=X$(2)
1415 IF X5$>"" THEN IF X5$(1,1)="!" THEN CALL "ZZPROM",X5$(2),X3$,0,"","","",T_LINES-2; GOTO 1475
1420 IF X5$>"" THEN X=39-INT(LEN(X5$)/2); IF X<0 THEN X=0; IF LEN(X5$)>T_CHARS THEN X5$=X5$(1,T_CHARS)
1425 IF T_CHARS<79 THEN X=0
1430 IF X5$>"" THEN PRINT @(X,T_LINES-2),X5$,
1475 IF POS(X0$(1,1)="NK")=0 THEN X8$=X1$(X2,X3); IF POS(" "<>X8$)=0 THEN X8$=""
1480 ON POS(X0$(1,1)="YSRZDPANTEBVK")-1 GOTO 1500,1500,1500,1500,3200,2200,2400,2800,3000,3200,1500,3500,2800
1510 IF POS(X0$="YB")>0 THEN C0$=C0$+"UR",X6$=X3$(214,1)+X3$(208,1),Q=NUM(X1$(X2,X3),ERR=1511),L=1+5*SGN(POS("V"=C0$)),X8$=X3$(214-Q*6,L); IF X0$="B" AND X1$(X2,X3)=" " THEN X1$(X2,X3)="0"
1610 J9$=X6$
1620 Q$=""; CALL "ZZINPT","",X3$,S,X0$+C0$,Q$,X2$,X0,X1,X4,X3,X8$,X7$,J9$,L0$,L1$,L2$,L3$,X6$,"",""; IF X4=5 AND X0$<>"X" THEN GOTO 8000 ELSE IF X4=.1 THEN EXIT 65
1622 IF Q$="" AND POS("X"=C0$)>0 THEN X4=-X4
1625 IF X0$="X" THEN X1$(X2,1)=Q$; GOTO 8000
1628 IF Q$="" AND POS("R"=C0$)>0 THEN IF X0$<>"B" THEN Q$=X1$(X2,X3); IF X0$="Y" AND POS(Q$=X3$(208,1)+X3$(214,1))=0 THEN Q$=X3$(214,1)
1630 IF Q$="" THEN IF C2=0 THEN GOTO 1750 ELSE GOTO 3400
1710 IF X0$(1,1)="Z" THEN Q$=STR(NUM(Q$):Z$(1,X3)) ELSE IF X0$(1,1)="R" THEN Q$=S$(1,X3-LEN(Q$))+Q$ ELSE IF POS("Z"=C0$)>0 AND POS(" "<>Q$)>0 AND POS("E"=Q$)=0 THEN Q$=STR(NUM(Q$,ERR=1711):Z$(1,X3))
1711 IF POS("#"=C0$)>0 THEN Q=NUM(Q$,ERR=1620)
1712 IF X3>LEN(Q$) THEN Q$=Q$+S$(1,X3-LEN(Q$))
1715 IF POS("R"=C0$)>0 THEN IF POS(Q$=X6$,X3)=0 THEN PRINT 'RB',; GOTO 1620
1740 IF X0$<>"B" THEN X1$(X2,X3)=Q$ ELSE X1$(X2,X3)=STR(POS(Q$=X6$)-1:"0")
1745 IF C2>0 THEN GOTO 3400
1750 IF P0=0 THEN IF ABS(X4)<8 THEN IF X0$<>"B" THEN PRINT (D0)'SF',@(X0,X1),X1$(X2,X3), ELSE CALL "ZZDISP","B"+C0$,X1$(X2,1),"",X3$,"","",X0,X1,X2$
1755 IF P0>0 THEN PRINT @(X0,X1),'SF',S$(1,X3),'SF',
1790 GOTO 8000
2205 L=X3,L9=ASC(X3$(311,1))-100,Q$=FNS$(X3$(280,30)); IF POS("O"=C0$)>0 AND X3$(311,1)>CHR(100) THEN Q$=Q$(1,L9),L9=10 ELSE L9=ASC(X3$(310,1))-100
2210 X7$=X3$(312,L9)+Q$; IF POS(" "<>X1$(X2,L))=0 THEN DIM X8$(L,X3$(83,1)) ELSE X8$=X1$(X2,L)
2220 Q$=X8$; CALL "ZZDISP","PX"+C0$,Q$,"",X3$,X8$,"",0,0,""; Q$=X1$(X2,L9)
2260 CALL "ZZINPT","",X3$,0,X0$,Q$,X2$,X0,X1,X4,L9,X8$,X7$,"",L0$,L1$,L2$,L3$,"","",""; IF X4=5 THEN GOTO 8000
2265 IF Q$="" THEN IF POS("X"=C0$)>0 THEN X4=-X4
2270 IF Q$>"" THEN X1$(X2,X3)=Q$
2275 X$=X0$+C0$
2278 P=POS("X"=X$); IF P>0 THEN X$(P,1)=""; GOTO 2278
2280 IF ABS(X4)<6 THEN CALL "ZZDISP",X$,X1$(X2,X3),"",X3$,"","",X0,X1,""; Q$=""
2290 GOTO 8000
2415 IF X2$="" THEN X2$=X3$(9,3)+"ZZP"
2420 IF POS(X4$=X2$(7),12)=0 THEN GOTO 1600
2425 DIM M$(40,X3$(83,1)),Z$(40,"0"),S$(40)
2440 A0=X2,A2$="",X7$="",X8$="",M$(1,1)=A7$,Z$(1,1)="1",A1$=X2$(POS(X4$=X2$(7),12)+9,9),A9$=""
2445 FOR X=3 TO POS(" "=A1$(2)+" ") STEP 2; Q=1+POS("E"=A1$(X-1,1))
2450 IF POS(A1$(X-1,1)="zades")=0 THEN A=ASC(ATH("0"+A1$(X,1)))*Q,A2$=A2$+M$(1,A+1),X7$=X7$+Z$(1,A),A0=A0+A
2452 Q=POS(A1$(X-1,1)="ZEAS123456789"),Q$="ZZSSSSSSSSSSS"; IF Q>0 THEN DIM Q$(A,Q$(Q,1)); A9$=A9$+A7$+Q$
2455 NEXT X
2458 CALL "ZZDISP","A",X1$(X2,X3),X4$,X3$,X8$,"",X0,X1,X2$
2460 A2$=A2$(2),A9$=A9$(2),X7$(1,1)="0"; IF X1$(X2,X3)=S$(1,X3) THEN X8$=A2$
2560 CALL "ZZINPT","",X3$,0,X0$+C0$,W$,X2$,X0,X1,X4,A0-X2,X8$,X7$+A2$,X4$+"",L0$,L1$,L2$,L3$,X6$,A9$,""
2561 REM PRINT @(0,0),'CE',"X3$=",X3$," X0$=",X0$," C0$=",C0$," W$=",W$," X2$=",X2$," X0=",X0," X1=",X1," X4=",X4," A0-X2=",A0-X2," X8$=",X8$," X7$+A2$=",X7$+A2$," X4$=",X4$," L0$=",L0$," L1$=",L1$," L2$=",L2$," L3$=",L3$," X6$=",X6$," A9$=",A9$," X1$=",X1$," X2=",X2,; INPUT *,
2562 IF X3$(333,2)="  " OR X4=5 THEN GOTO 2565 ELSE IF POS(X4$="A/RP/OO/P",3)=0 THEN GOTO 2565 ELSE IF MID(W$,1,2)=X3$(333,2) THEN GOTO 2565 ELSE IF MID(L0$,1,3)="ZZX" AND (W$>"" OR INT(X4)=7 OR X1$(X2,2)<>X3$(333,2)) THEN GOTO 2563 ELSE IF POS(" "<>W$)=0 AND (X1$(X2,2)="  " OR X1$(X2,2)=X3$(333,2)) AND INT(X4)<>3 THEN GOTO 2565
2563 REM "IF L0$(1,8)="FM2ODM00" OR L0$(1,8)="FS2DAA00" THEN GOTO 02565, THIS LINE ALLOWED ENTRY OF ORDER NUMBER IN UNAUTHORIZED DIV
2564 W$="",H$="Division access denied!  You are only authorized for division "+X3$(333,2); CALL "ZZPROM",".4",X3$,0,H$,"","",0; GOTO 2560
2565 IF X4=5 THEN GOTO 8000
2575 IF W$<>"" THEN GOTO 2581 ELSE IF C2>0 THEN GOTO 3400 ELSE IF X1$(X2,X3)=S$(1,X3) THEN PRINT @(X0,X1),S$(1,LEN(X8$)), ELSE PRINT @(X0,X1),X8$,
2580 IF POS("X"=C0$)>0 THEN X4=-X4; GOTO 8000 ELSE GOTO 8000
2582 IF W$=" " THEN PRINT @(X0,X1),S$(1,LEN(X8$)), ELSE IF X4<>6 THEN GOSUB 2700
2585 X1$(X2,X3)=W$
2590 IF C2>0 THEN GOTO 3400 ELSE IF P0=0 AND ABS(X4)<6 THEN CALL "ZZDISP","A",W$,X4$,X3$,Q2$,Q3$,X0,X1,X2$
2690 GOTO 8000
2695 EXITTO 2560
2705 T$=W$,W$=""; DIM Z$(20,"0")
2710 FOR X=3 TO POS(" "=A1$(2)+" ") STEP 2; Q$="",Q=1+SGN(POS(A1$(X-1,1)="Ee")),A=ASC(ATH("0"+A1$(X,1)))*Q; IF POS(A1$(X-1,1)="Zz123456789")>0 THEN DIM Q$(A,"0") ELSE DIM Q$(A)
2712 IF A1$(X-1,1)="d" THEN Q$=X3$(331,2); GOTO 2738
2715 IF POS(A1$(X-1,1)="zaes")>0 THEN GOTO 2738 ELSE B=0,B=NUM(A1$(X-1,1),ERR=2716)
2720 IF LEN(T$)>=A THEN Q$=T$(1,A),T$=T$(A+1) ELSE IF T$>"" THEN Q$=T$,T$=""
2724 IF POS("E"=Q$)>0 OR POS(" "=FNS$(Q$))>0 THEN GOTO 2726
2725 Z=0; IF A1$(X-1,1)<>"S" AND Q$<>"" THEN IF B=0 THEN Q$=STR(NUM(Q$,ERR=2726):Z$(1,A)),Z=1; GOTO 2735 ELSE Q$=STR(NUM(Q$,ERR=2726):Z$(1,B),ERR=2726),Z=1; GOTO 2735
2730 IF LEN(Q$)<A THEN Q$=Q$+S$(1,A-LEN(Q$))
2735 IF Q>1 THEN GOSUB 8800
2738 W$=W$+Q$
2740 NEXT X
2742 T$=A1$(1,1); IF T$="?" THEN IF Z=1 THEN T$="0" ELSE T$=" "
2745 IF LEN(W$)<X3 THEN DIM T$(X3-LEN(W$),T$); W$=W$+T$
2750 RETURN 
2805 P0=FPT(X2)*1000,X2=INT(X2); IF X0$<>"K" THEN X8=X[X2] ELSE X8=UPK(X1$(X2+1,6)),P1=INT(X3/100); GOSUB 2950; P2=INT((X3-P1*100)/10),X8=X8/10^P2,P3=ASC(X1$(X2,1))-ASC("B"),X8=X8*P3; IF X1$(X2,6)=S$(1,6) THEN X8=0 ELSE IF POS("~"<>X1$(X2,6))=0 THEN X8=0
2810 X8$=STR(X8:X4$),X7$=X4$,D=X8; IF D=0 THEN X8$=X4$
2815 IF POS("M"=C0$)>0 THEN Q$=X8$; CALL "ZZDISP","NX",Q$,"",X3$,X8$,"",0,0,X2$; Q$=X7$; CALL "ZZDISP","NX",Q$,"",X3$,X7$,"",0,0,X2$
2860 CALL "ZZINPT","",X3$,0,"N"+C0$,Q$,X2$,X0,X1,X4,X3,X8$,X7$,X4$,L0$,L1$,L2$,L3$,X6$,"",""; IF X4=5 THEN GOTO 8000 ELSE IF POS("#"=Q$)>0 THEN Q$=""
2865 IF Q$="" AND POS("X"=C0$)>0 THEN X4=-X4
2880 IF Q$>"" THEN X8=NUM(Q$,ERR=2881) ELSE X8=X8+0
2885 IF C2>0 THEN IF Q$="" THEN GOTO 3400
2890 IF POS("M"=C0$)=0 THEN PRINT (D0,ERR=2860)@(X0,X1),X8:X4$, ELSE CALL "ZZDISP","N",STR(X8:X4$),"",X3$,"","",X0,X1,X2$
2895 IF X0$<>"K" THEN X[X2]=X8; GOTO 8000
2905 N=X8; IF POS("-"=C0$)>0 THEN N9=10^12/2,N=-N ELSE N9=0
2915 IF P2>0 THEN N=N*10^P2
2925 Q$=FNZ$(N9+N),X1$(X2,7)=Q$
2930 X1$(X2,7)=Q$
2945 GOTO 8000
2955 IF POS("-"=C0$)>0 THEN N9=10^12/2,X8=N9-X8
2980 RETURN 
3010 CALL "ZZENTT",X3$,X4$,L0$,L1$,L2$,X0$,C0$,X1$,X0,X1,X2,X3,X4
3095 X3=X; GOTO 8000
3205 DIM A[2]; X7$="00101000"; IF X3$(48,1)="3" THEN X7$="00001010"
3210 Q1$=""; FOR X=0 TO 2; A[X]=NUM(X3$(80+X,1)),Q1$=Q1$+X3$(56+X,1)+X3$(56+X,1)+X3$(59,1); NEXT X; IF X3$(48,1)="3" THEN A[1]=A[1]+2,A[2]=A[2]+2
3212 Q1$=Q1$(1,8); IF X3$(48,1)<>"3" THEN Q1$=Q1$+Q1$(7,2) ELSE Q1$=Q1$(1,2)+Q1$
3215 Q2$=X3$(70,1)+X3$(70,1)+X3$(71,1)+X3$(71,1)+X3$(72,1); IF X3$(48,1)<>"3" THEN Q2$=Q2$+X3$(72,1),Q2$=Q2$+Q2$(5,2) ELSE Q2$=Q2$(1,2)+Q2$
3220 IF X1$(X2,X3)=S$(1,6) THEN Q$=Q2$ ELSE Q$=X1$(X2,X3)
3223 SETERR 3226
3225 CALL "ZZDISP","EX",Q$,"",X3$,X8$,"",0,0,""; Q$=""
3226 SETERR 9000
3230 CALL "ZZINPT","",X3$,0,X0$+C0$,Q$,X2$,X0,X1,X4,8,X8$,X7$+Q1$,"",L0$,L1$,L2$,L3$,X6$,"",""; IF X4=5 THEN GOTO 8000 ELSE IF X4=6 AND Q$>"" THEN GOTO 3268
3235 IF Q$="" THEN IF POS("X"=C0$)>0 THEN X4=-X4; GOTO 3275 ELSE GOTO 3275
3240 IF Q$="" OR X3$(48,1)="3" AND LEN(Q$)=4 THEN GOTO 3275
3245 IF Q$=" " THEN X1$(X2,X3)=""; GOTO 3270 ELSE IF LEN(Q$)<8 THEN GOSUB 3300 ELSE IF LEN(Q$)<8 THEN Q$=Q$+S$(1,8-LEN(Q$))
3250 IF LEN(Q$)<8 THEN GOTO 3200 ELSE IF Q$(A[1],2)<"01" OR Q$(A[1],2)>"12" OR Q$(A[2],2)<"01" OR Q$(A[2],2)>"31" THEN GOTO 3200
3251 IF NUL(Q$(A[0],4)) THEN GOTO 3200 ! 245601
3255 IF POS(Q$(A[1],2)="09040611",2)>0 THEN IF Q$(3,2)>"30" THEN GOTO 3200
3261 IF Q$(A[0]+2,2)="  " THEN Q$(A[0],4)="19"+Q$(A[0],2)
3262 IF Q$(A[0],4)<"1600" OR Q$(A[0],4)>"2479" THEN GOTO 3200
3263 IF Q$(A[1],2)="02" THEN YEAR=NUM(Q$(A[0],4)),FEB_DAYS=28; IF MOD(YEAR,4)=0 AND (MOD(YEAR,100)<>0 OR MOD(YEAR,400)=0) THEN FEB_DAYS=29 END_IF ; IF NUM(Q$(A[2],2))>FEB_DAYS THEN GOTO 3200
3264 REM "If FEBUARY THE 28 days UNLESS year is evenly divisible by 4, and it is not evenly divisable by 100, but every 400 years that is ok.
3265 Q$=FNE$(Q$(A[0],4))+Q$(A[1],2)+Q$(A[2],2)
3268 X1$(X2,X3)=Q$
3275 IF C2>0 THEN GOTO 3400 ELSE IF ABS(X4)<6 THEN CALL "ZZDISP","E",X1$(X2,X3),"",X3$,"","",X0,X1,""
3290 GOTO 8000
3310 IF LEN(Q$)=6 THEN Q$=Q$(1,4)+X8$(7) ELSE IF LEN(Q$)=3 THEN Q$=Q$(1,2)+"0"+Q$(3)+X8$(7)
3320 IF LEN(Q$)=8 THEN IF Q$(5,1)="Y" THEN Q9$=DAY,DAY$=DTE(0:"%Dz-%Ms-%Y %Hz:%mz:%sz"),YEAR$=DAY$(8,4),Q$(5,4)=YEAR$,Q9$=""
3325 IF LEN(Q$)=2 AND POS("1"=C0$)>0 THEN Q$=""; EXITTO 3275
3340 RETURN 
3405 Q=X3; IF X0$="K" THEN Q=7,K0$=STR(X3:"000") ELSE K0$=X4$
3410 Q$=X1$(X2,Q)
3415 IF ABS(X4)=7 THEN DIM Q$(Q,C2$); X4=1,X1$(X2,Q)=Q$
3430 IF P0=0 THEN IF ABS(X4)<5 THEN CALL "ZZDISP",X0$+C0$,Q$,K0$,X3$,"","",X0,X1,X2$
3490 GOTO 8000
3505 CALL "ZZENTV",X3$,X4$,L0$,L1$,L2$,X0$,C0$,X1$,X0,X1,X2,X3,X4
3590 GOTO 8000
8005 IF R0=0 THEN GOTO 8050 ELSE IF ABS(X4)<>1 AND ABS(X4)<>2 THEN GOTO 8050
8010 R=1; IF ABS(X4)=2 THEN R=-1
8012 X7$=""
8015 R9=R9+R,Q$="",W$=""; IF R2=1 THEN X1=X1+R+R*R1 ELSE X0=X0+R*(R1+(LEN(X4$)*POS("N"=X0$(1,1))+X3*POS("N"<>X0$(1,1))))
8020 IF X0$(1,1)="N" THEN X2=X2+R ELSE X2=X2+X3*R
8025 IF R9>=0 AND R9<=R0 THEN GOTO 1400 ELSE GOTO 8050
8030 R9=R0-1; IF R2=1 THEN X1=X1+(R0-1)*(1+R1) ELSE X0=X0+(R0-1)*(X3+R1)
8035 IF X0$(1,1)="N" THEN X2=X2+R0-1 ELSE X2=X2+(R0-1)*X3
8040 RETURN 
8080 X0$=X0$+C0$
8085 PRINT 'SF',; IF X5$>"" THEN PRINT @(0,T_LINES-2),'CL',
8220 GOTO 9900
8810 I$=""; FOR X=1 TO LEN(Q$) STEP 2; I$=I$+CHR(32+NUM(Q$(X,2))); NEXT X; Q$=I$,I$=""; RETURN 
8992 DEF FNZ$(Z)=CHR(ASC("B")+SGN(Z))+PCK(ABS(Z),6)
9010 E0=ERR,E1=TCB(5)
9020 IF POS(STR(E0:"000")="064066065069",3)>0 THEN GOTO 9200
9040 CALL "ZZERRM",E0$,"ZZENTR",E1$,X3$,E0,E1,E2,E3,0
9050 ON E2 GOTO 9060,9100,9900,9070
9190 EXIT ERR
9210 IF E0=65 AND POS("@"=C0$)>0 THEN EXIT ELSE EXIT E0
9350 RETURN 
9810 DEF FNP$(Z0$)="("+Z0$(1,3)+") "+Z0$(4,3)+"-"+Z0$(7,4)+" Ext: "+Z0$(11,4)
9825 DEF FNX$(Z0$)=Z0$(1,POS(S$=Z0$+S$)-1)
9830 DEF FNS(Z0$)=LEN(FNX$(Z0$))
9835 DEF FNE$(Z0$)=CHR(NUM(Z0$(1,3))-190+65)+Z0$(4,1)
9840 DEF FNS$(Z0$)=Z0$(1,POS(S$=Z0$+S$)-1)
9910 IF X4=5 AND X0$(1,1)<>"X" THEN EXIT 69 ELSE IF X4=-6 THEN X4=6
9920 EXIT 
9999 END 
56002 REM "245601-Modify ZZENTR to not allow entry of invalid years in dates  

0010 REM "Alternate sort lookup for 067 <ZP2EKD>
0035 REM "4.1 - 11/04/97 - 15.56 - tma - SSP# 080858
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0075 REM "S0=STARTING POSITION OF TEXT DISPLAY, S1=LINE, S2=NUMBER OF LINES ALLOWED, S3=WIDTH OF FIELD, F0=FILE SLOT NUMBER, K9$=HIGH ORDER KEY PART,K0=MAX LENGTH OF ENTERED KEY
0080 GOTO 0100
0090 BEGIN ; OPEN (1)"ZPA500"; OPEN (2)"ZP4500"; F0=1,F1=2,S0=4,S1=12,S2=9,K0=10,K9$="BFD ",K$="",T0=62,K1=6,W0=78
0092 S0=1
0095 OPEN (13)"ZZPARM"; READ (13,KEY=FID(0)+"      ")X3$; GOTO 0101
0100 ENTER X3$,V1$,S0,S1,S2,K0,F0,K9$,K$,T0,T1,W0,F1,S9$
0120 D1=340,T=10,C9=ASC("z")-ASC("Z")
0125 K2$=K9$
0130 P0=10; REM " WIDTH OF KEY TO DISPLAY
0200 REM "
0220 DIM S$(90),Z9$(10,$00$),F1$(500)
0625 K9=LEN(K9$)
0630 IF W0=0 THEN GOTO 0695
0655 G0$="B",S3=W0; IF V1$>"" THEN G0$="!A"+G0$
0660 CALL "ZZGRPH",X3$,G0$,X{ALL},"",S0,S1,0,0,0,S2,W0,0,0,0
0670 FOR X=S1+1 TO S1+S2-2
0675 PRINT @(S0+1,X),S$(1,W0-2),
0677 NEXT X
0680 G$=STR(S1:"000")+"D"+STR(S2-2:"00"),G$="@"+STR(S0+P0+3:"000")+G$+"@"+STR(S0+P0+31:"000")+G$
0685 CALL "ZZGRPH",X3$,G$,X{ALL},"",0,0,0,0,0,0,0,0,0,0
0690 A0$=$1B$+"B"+X3$(79,1),A1$=$1B$+"E"+X3$(79,1)
0695 PRINT 'SF',
0990 CLOSE (14); OPEN (14)FID(0)
1020 REM 
1025 D2$=ATH(X3$(D1,14*9)),A0$=$1B$+"B"+X3$(79,1),A1$=$1B$+"E"+X3$(79,1)
1030 S=X0,D0=NUM(X3$(60,3)); GOSUB 8700
1100 REM "POSITION
1220 IF K$>"" THEN K$=FNS$(K$); K0$=K$; GOSUB 5900
1240 GOSUB 6000
1990 L9=1
2000 REM "ENTRY
2015 L9=LEN(K0$); PRINT @(T0,T1),K0$,S$(1,K0-LEN(K0$)),@(T0+L9,T1),
2020 GOSUB 8200; IF C0=-1 THEN GOTO 2100
2060 IF C0=2 THEN IF K0$="" THEN PRINT 'RB',; GOTO 2010 ELSE K0$=K0$(1,LEN(K0$)-1); GOSUB 5900; GOTO 2010
2065 IF C0=1 THEN K$=K5$; GOTO 9900
2070 IF C0=8 THEN GOSUB 6400; GOTO 2000
2075 IF C0=9 THEN GOSUB 6300; GOTO 2000
2080 IF C0=4 THEN GOTO 9900
2090 GOTO 2000
2110 IF LEN(K0$)=K0 THEN PRINT 'RB',; GOTO 2020
2115 IF Q$>="a" AND Q$<="z" THEN Q$=CHR(ASC(Q$)-C9)
2120 K0$=K0$+Q$
2125 REM PRINT @(T0,T1),K0$,
2130 GOSUB 5900
2140 GOTO 2010
5900 REM "LOOK FOR START KEY
5902 K2$=K0$; IF K1$="" THEN GOTO 6000 ELSE K2$=K6$(LEN(K6$)-K6+1,K6)
5905 READ (F0,KEY=K9$+K0$,DOM=5906)
5910 Q$=K1$(LEN(K1$)-K0+1,K0)
5935 REM "PAST THE LAST ONE?
5940 IF K0$>Q$(1,LEN(K0$)) THEN GOTO 5990
5945 IF K0$<K1$(1,LEN(K0$)) THEN GOTO 5990
5950 IF K0$>=K1$(1,LEN(K0$)) THEN GOTO 5980
5960 E$=K9$+K1$(1,K0); CALL "ZZKEYP",ERR=5965,0+F0,E$
5965 IF E$>"" THEN IF E$(1,K9)=K9$ THEN IF E$(K9+1,LEN(K0$))>=K0$ THEN GOTO 5990
5985 GOSUB 6200; RETURN 
5990 K2$=K9$+K0$; GOTO 6000
6000 REM "DISPLAY SCREEN STARTING WITH K0$
6005 IF K1$>"" THEN K3$=K1$(1,K0)
6010 E9=0,K5$=""; EXTRACT (F0,KEY=K2$,DOM=6011); K$=K2$
6020 FOR X=0 TO (INT((S2-3)/3)+1)*2 STEP 2
6030 K$=KEY(F0,END=6110)
6035 READ (F0,END=6110); IF K$(1,K9)<>K9$ THEN GOTO 6110
6040 Q$=K$(K9+1,K0); GOSUB 6600
6042 IF X=0 THEN K1$="",K6$=""
6045 REM IF X=0 THEN IF Q$=K3$ THEN EXITTO 6150 ELSE LET K1$="",K6$=""
6048 K1$=K1$+Q$,K6$=K6$+K$,K6=LEN(K$)
6050 PRINT @(2+S0,1+X+S1),S$(1,P0),@(2+S0,1+X+S1),Q$(1,P0),
6090 GOTO 6140
6110 IF X=0 THEN X=S2-3; GOTO 6140
6115 E9=1,F1$(1)=""; GOSUB 6620
6120 Q$=S$(1,K0); GOTO 6050
6140 NEXT X
6180 IF K0$>"" THEN GOSUB 6200
6190 RETURN 
6200 REM "HIGHLIGHT CLOSEST
6205 IF K0$="" THEN ON LEN(K5$) GOTO 6290,6215
6208 IF POS(K0$=K1$,K0)=0 THEN IF K0$>"" THEN K0$=K0$(1,LEN(K0$)-1); PRINT 'RB',; GOTO 6290
6210 Q=POS(K0$<=K1$,K0); IF K5$>"" THEN IF Q=0 OR Q=(K5-1)*K0+1 THEN GOTO 6250
6212 Q=INT(Q/K0)
6215 IF K5$>"" THEN X0=S0+2,X1=S1-1+K5*2; IF X3$(238,1)="1" THEN PRINT @(X0-1,X1)," ",@(X0+P0,1)," ", ELSE PRINT @(X0,X1),A1$,K5$(1,P0),
6230 IF K0$="" THEN GOTO 6290 ELSE K5=Q+1,K5$=K1$((K5-1)*K0+1,K0),X1=S1-1+K5*2,X0=S0+2
6240 IF X3$(238,1)="1" THEN PRINT @(X0+P0,X1),A1$,@(X0-1,X1),A0$, ELSE PRINT @(X0,X1),A0$,K5$(1,P0),A1$,
6290 IF K0$="" THEN K5$="",K5=0
6295 RETURN 
6300 REM "NEXT ENTRY DOWN ON SCREEN
6330 IF K5<LEN(K1$)/K0 THEN K0$=K1$(K5*K0+1,K0),Q=K5; IF C0=9 THEN GOSUB 6215; GOTO 6390 ELSE GOSUB 6200; GOTO 6390
6335 IF E9=1 THEN GOTO 6495 ELSE IF E9=0 THEN READ (F0,KEY=K6$(LEN(K6$)-K6+1,K6),DOM=6336)
6340 K5=0,Q$=KEY(F0,END=6360); IF Q$(1,K9)<>K9$ THEN E9=1 ELSE K$=Q$,K2$=K$,K0$=K2$(K9+1,K0); GOSUB 6000; GOSUB 6200
6390 GOTO 6490
6400 REM "PRIOR ENTRY 
6410 IF K5>1 THEN K0$=K1$((K5-2)*K0+1,K0); GOSUB 6200; GOTO 6490
6420 E$=K6$(1,K6)
6423 READ (F0+0,KEY=K2$,DOM=6424)
6425 E$=KEP(F0+0,ERR=6490); IF E$(1,LEN(K9$))<>K9$ THEN GOTO 6490
6430 K0$=E$(K9+1,K0),K2$=E$,K5$=""; GOSUB 6000
6440 GOSUB 6200
6490 K0$=FNS$(K0$)
6495 RETURN 
6600 REM "OTHER DATA
6605 IF F1=0 THEN RETURN 
6610 F1$(1)=""; FIND (F1,KEY=K$(1,4)+K$(25,6),DOM=6690)F1$(1)
6620 PRINT @(S0+P0+5,S1+X+1),F1$(11,25),@(S0+P0+33),F1$(391,15),
6623 CALL "ZZDISP","AX",F1$(129,9),"ZIP",X3$,J0$,"",0,0,X4$
6624 CALL "ZZDISP","POX",F1$(200,14),"",X3$,J1$,"",0,0,X4$
6625 PRINT @(S0+P0+5,S1+X+2),F1$(51,25),@(S0+P0+33),F1$(127,2)+"   "+J0$+"   "+J1$,
6690 RETURN 
7000 REM "RE-DISPLAY SCREEN TEXT
7010 IF V1$="" THEN GOTO 7090
7020 CALL "ZZVRDY",X3$,"",V1$,S0,S1,S2,S3
7090 RETURN 
8000 REM "GET NEXT CHARACTER
8010 READ (1,END=8095)A$
8020 PRINT A$,
8090 GOTO 8010
8095 RETURN 
8210 CLOSE (D0); OPEN (D0)FID(0)
8220 Q9$="",C0=-1
8230 IF M0=0 THEN READ RECORD (D0,SIZ=1,TIM=T,ERR=8235)Q$ ELSE CALL "ZZDEMO",X1$,1,D0,Q$,M0
8232 Q9$=Q9$+Q$; IF LEN(Q9$)>6 THEN GOTO 8235 ELSE P=POS(Q9$=D2$,6); IF P=0 THEN GOTO 8260 ELSE P=POS(Q9$+Z9$(1,6-LEN(Q9$))=D2$,6); IF P=0 THEN GOTO 8230
8235 IF LEN(Q9$)>6 THEN PRINT 'RB',; RETURN ELSE P=POS(Q9$+Z9$(1,6-LEN(Q9$))=D2$,6); IF P=0 THEN GOTO 8230 ELSE C0=INT(P/6)+1,X3=C0; RETURN 
8260 RETURN 
8710 T0$=FNS$(X3$(169,3)),D0$="",D0$=FID(D0,ERR=8711)
8715 CLOSE (D0); IF LEN(T0$)=2 THEN OPEN (D0)T0$ ELSE CALL "ZZDEMO",X3$,0,D0,Q$,M0
8740 RETURN 
8915 DEF FNS$(X$)=X$(1,POS(S$=X$+S$)-1)
9910 IF C0=4 THEN K$=""; PRINT @(T0,T1),S$(1,K0), ELSE K=POS(K$=K1$,K0); IF K>0 THEN K=INT(K/K0),K$=K6$((K5-1)*K6+1,K6)
9920 IF V1$>"" THEN GOSUB 7000
9940 EXIT 
9999 END 

0010 REM "Update telemarketing from Customers <ZP2UT9> SPECIALTY (67)
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 02/10/97 - 16.98 - kmc
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="ZP2UT9",X1$="Update Telemarketing from Customers"
0120 DIM Z0$(80,"-"),C1$(40),C2$(40),C3$(40),C4$(40),C5$(40),S0$(30),B$(439)
0121 DIM S$(20)
0125 V8$="0204111499"
0130 K0=10,K1=1
0135 C9=-1,V9=-2
0140 M0$="-###.00"
0145 IF Q1$="" THEN GOSUB 8950 ELSE IF Q1$<>"" AND POS(" "<>Q1$)=0 OR Q1$="INV ENTRY" THEN Q1$="",Q7=1
0200 REM "
0230 IF Q1$<>"" THEN X2=-1; PRINT @(0,6),'CE',
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15]
0320 IOLIST B$,B[0]
0330 IOLIST C$,C9
0331 IOLIST C1$
0332 IOLIST C2$
0333 IOLIST C3$
0334 IOLIST C4$
0335 IOLIST C5$
0350 IOLIST E$
0360 IOLIST A5$
0390 IOLIST I$
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O ZP0...  02O AR1... 03O ZP4... 04O ZPA... 05O FMP...  06O ARG... 07O ZP1...  08O ZPE...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM "
0700 REM "Get date"
0720 D0$=X3$(15,6)
0820 GOSUB 6000
0900 REM 
0910 CALL "ZZDISP","AX","XXXXXXXXX","ARG",X3$,J$,"",0,0,X4$
0920 J3=22+LEN(J$),J2=47-J3
1000 REM "
1005 IF Z=8 THEN GOTO 7900 ELSE IF A1$>"" AND Z<>9 THEN A1$=A1$(1,4)
1010 Y8=1; CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 DIM C$(45),C[1],D$(44),D[1],E$(44),E[1],F$(42),F[1]
1035 DIM A$(374),A[1],N$(1),G$(46)
1045 A$(1,LEN(A1$))=A1$; IF A1$="" THEN A$(1,LEN(K9$))=K9$
1060 PRINT (0,ERR=1070)'CF',; GOSUB 6450; GOTO 1100
1070 GOSUB 6000; GOSUB 6450
1075 ESCAPE 
1100 REM "KEY SEQ
1110 X0=-1,C0=0,X1=0,C9=0,Z9=0
1120 SETERR 9000; C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN GOTO 9900
1140 ON X0 GOTO 1200,1500
1200 REM "List type
1202 IF Q1$>"" THEN A$(1,4)=Q1$(1,4); PRINT @(16,3),A$(1,4); GOTO 1220
1205 X$="This is the list code that all customers will be added to"
1206 IF LEN(A1$)>0 THEN A$(1,4)=A1$(1,4); PRINT @(16,3),A$(1,4),; GOTO 1220
1210 CALL "ZZENTR","SZXUX",A{ALL},A$,X4$,X3$,16,3,1,4,C0,"","{1"+X$,K9$,"ZP2MEA00","ZP0","ZP2MAA",""; IF C0=6 THEN GOSUB 6400; C0=1
1212 IF INT(ABS(C0))=3 THEN C0=-ABS(C0); READ (Z[1],KEY=A$(1,4),DOM=1213)
1215 IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1210,6800,9800
1220 FIND (Z[1],KEY=A$(1,4),DOM=1210)IOL=0330
1222 V1$=C$(1,4)
1223 IF C9=0 THEN N9$=C$(45,6) ELSE N9$=STR(C9:"000000")
1224 GOSUB 7500
1225 PRINT @(25,3),C$(5,40),@(16,5),N9$,
1240 GOTO 1120
1500 REM " Enter T/M category set:
1505 DIM D9$(3)
1510 CALL "ZZENTR","SZX",A{ALL},D9$,X4$,X3$,45,10,1,2,C0,"","{1"+X$,"","ZP2MEA00","","",""; IF C0=6 THEN GOSUB 6400; C0=1
1520 IF ABS(C0)=4 THEN GOTO 9900
1523 IF D9$(1,2)="  " THEN PRINT @(49,10),'CL',; GOTO 1900
1525 FIND (Z[5],KEY="eT"+D9$(1,2),DOM=1510)S$
1530 PRINT @(49,10),S$(5,30),
1900 REM 
1910 CALL "ZZPROM",".Y",X3$,S3,"Proceed?","","",0
1920 ON S3 GOTO 2000,1000
2000 REM "PROCESS CUSTOMER MASTERFILE
2005 EXTRACT (Z[1],KEY=A$(1,4),DOM=1000)IOL=0330
2050 DIM A[15]
2099 READ (Z[2],KEY="",DOM=2103)
2100 REM "NEXT CUSTOMER
2110 K$=KEY(Z[2],END=4000)
2115 DIM A$(410),A[15]
2120 EXTRACT (Z[2],KEY=K$,END=4000)IOL=0310
2121 C=C+1
2122 REM "Display progress every 2%
2123 IF T<100 THEN GOSUB 8150 ELSE IF MOD(C,INT(T*.02))=0 THEN GOSUB 8150
2125 IF D9$(1,2)<>"  " THEN IF S$(35,1)="Y" AND POS(A$(220,3)=S$(36),9)=0 THEN READ (Z[2]); GOTO 2100 ELSE IF S$(35,1)<>"Y" AND POS(A$(220,3)=S$(36),9)<>0 THEN READ (Z[2]); GOTO 2100
2135 IF A$(401,10)<>S$(1,10) THEN GOSUB 3000; READ (Z[2]); GOTO 2100
2140 DIM B$(439),B[1]
2160 B$(11,40)=A$(11,35)
2165 B$(51,163)=A$(56,163)
2200 REM "DATE SETUP = ACCT OPENED
2210 B$(214,6)=A$(229,6)
2250 REM "SOURCE
2260 B$(220,3)="TCM"
2300 REM "CATEGORY
2310 B$(223,3)=A$(220,9)
2350 REM "SIC CODE
2360 B$(226,5)=A$(262,5)
2400 REM "SELECTION CODES
2410 B$(231,33)=""
2450 REM "CUST CODE
2460 B$(363,10)=A$(1,10)
2500 REM "SALESPERSON
2520 B$(359,4)=A$(278,4)
2530 REM "Update Long City name
2535 B$(391,28)=A$(116,16)
2600 REM 
2610 U0$=B$(11,20); CALL "YUCASE",X3$,U0$,U1$; IF A$(155,10)=U1$(1,10) THEN B$(419,20)=U1$ ELSE IF POS(" "<>A$(155,10))<>0 THEN B$(419,20)=A$(155,10)
2620 REM IF POS(" "<>A$(155,10))<>0 THEN LET B$(419,20)=A$(155,10) ELSE LET U0$=B$(11,20); CALL "YUCASE",X3$,U0$,U1$; LET B$(419,20)=U1$
2800 REM 
2810 B$(1,4)=C$(1,4); GOSUB 7500
2820 WRITE (Z[3],KEY=B$(1,10),DOM=2810)IOL=0320
2830 WRITE (Z[4],KEY=B$(1,4)+B$(419,20)+B$(5,6))
2835 WRITE (Z[8],KEY=B$(203,7)+B$(200,3)+B$(1,10))
2850 PRINT @(0,14),@(15),"Customer: ",A$(1,10)," added as ",B$(1,10)
2860 IF D9$(3,1)<>"Y" THEN A$(401,10)=B$(1,10)
2870 WRITE (Z[2],KEY=K$)IOL=0310; IF RT_PARM$<>"" THEN CUST$=K$; CALL "RT2WOC",ERR=2871,X3$,X4$,CUST$,"AR1...","U",K$
2950 GOTO 2100
3000 REM "Process records with existing telemarketing records
3005 DIM B$(439),B[1]
3010 EXTRACT (Z[3],KEY=A$(401,10),DOM=3011)IOL=0320; GOTO 3015
3011 REM "Couldn't find record, set up new one
3012 EXITTO 2140
3015 IF LEN(B$)<439 THEN B$=B$+" "; GOTO 3015
3018 B0$=B$(1,4)+B$(419,20)+B$(5,6),B1$=B$(203,7)+B$(200,3)+B$(1,10)
3020 B$(200,14)=A$(205,14),B$(138,10)=A$(143,10),B$(11,40)=A$(11,35),B$(51,60)=A$(56,60),B$(391,28)=A$(116,16),B$(127,2)=A$(132,2),B$(129,9)=A$(134,9),B$(160,40)=A$(165,40),B$(223,3)=A$(220,9)
3030 REM LET U0$=B$(11,20); CALL "YUCASE",X3$,U0$,U1$; LET B$(419,20)=U1$
3050 WRITE (Z[3],KEY=A$(401,10))IOL=0320
3065 REMOVE (Z[4],KEY=B0$,DOM=3066)
3070 WRITE (Z[4],KEY=B$(1,4)+B$(419,20)+B$(5,6))
3075 REMOVE (Z[8],KEY=B1$,DOM=3076)
3080 WRITE (Z[8],KEY=B$(203,7)+B$(200,3)+B$(1,10))
3095 RETURN 
3495 RETURN 
4000 REM "Transfer Category records
4002 C=T; GOSUB 8150
4005 REM "Transfer ARG records to ZP1
4007 READ (Z[6],KEY="",DOM=4008)
4010 READ (Z[6],END=4100)C0$
4015 C1=C1+1; GOSUB 8160
4020 FIND (Z[7],KEY=C0$(1,3),DOM=4021); GOTO 4010
4025 DIM C1$(43); C1$(1,3)=C0$(1,3),C1$(4,40)=C0$(10,30)
4030 WRITE (Z[7],KEY=C1$(1,3))C1$
4035 T3=T3+1; REM "To correct for adding to ZP1, where we will examine this one later.
4045 GOTO 4010
4100 REM "Transfer ZP1 records to ARG
4105 READ (Z[7],KEY="",DOM=4106)
4110 READ (Z[7],END=5000)C1$
4113 C1=C1+1; GOSUB 8160
4115 FIND (Z[6],KEY=C1$(1,3)+"000000",DOM=4116); GOTO 4110
4120 DIM C0$(39); C0$(1,9)=C1$(1,3)+"000000",C0$(10,30)=C1$(4,40)
4125 WRITE (Z[6],KEY=C0$(1,9))C0$
4130 GOTO 4110
5000 REM "EOJ <- FOR WMZ SAKE
5005 WRITE (Z[1],KEY=C$(1,4))IOL=0330
5006 C=T,C1=T3; GOSUB 8150
5010 CALL "ZZPROM","4",X3$,0,"End of process!","","",0
5050 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT 'SB',
6055 PRINT @(0,4),Z0$,
6060 PRINT @(5,3),"List code:",@(1,5),"Starting code:"
6080 PRINT @(17,10),"Transfer T/M category set:",
6090 GOSUB 8100
6190 RETURN 
6210 CALL "AR2MAJ",X3$,X4$,A$,A{ALL},1,B$,E$,P2$,C1$,C2$,C3$,C4$,C5$,P0$,A5$
6350 REM "Sales Tax Rate 3.0.6
6360 PRINT @(36,14),B[0]+B[2]+B[3]:"##.00%",@(43,14),B$(11,25),
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 RETURN 
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6460 CALL "ZZDISP","A",A$(1+K9,10),"A/R",X3$,"","",18,3+V0,X4$
6490 RETURN 
6500 REM "DELETE
6505 IF X3$(188,8)="DEFAULTS" THEN REMOVE (Z[13],KEY="DFLT"+X0$,DOM=9900); GOTO 9900
6510 REMOVE (Z[1],KEY=A1$,DOM=6511)
6520 REMOVE (Z[4],KEY=A2$,DOM=6521)
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6690 RETURN 
6700 REM "ADD ENTRY
6702 IF X3$(188,8)="DEFAULTS" THEN WRITE (Z[13],KEY="DFLT"+X0$)IOL=0310; GOTO 9900
6705 IF Z9=0 THEN GOTO 6790
6710 WRITE (Z[1],KEY=A1$)IOL=0310
6720 IF A2$=A$(155+K9,10)+A$(1+K9,10) THEN GOTO 6726
6724 REMOVE (Z[4],KEY=A2$,DOM=6725)
6728 WRITE (Z[4],KEY=A$(155+K9,10)+A$(1+K9,10))
6730 REMOVE (Z[8],KEY=A3$,DOM=6731)
6735 WRITE (Z[8],KEY=A$(278+K9,4)+A$(1+K9,10))
6790 GOTO 1630
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6820 A$(1,LEN(A1$))=A1$
6825 IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 1140
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7500 REM "AUTO ASSIGN CODE
7515 IF C9=0 THEN GOTO 7550
7520 C9=C9+1; IF C9>999999 THEN C9=1
7540 B$(5,6)=STR(C9:"000000"),N9$=B$(5,6)
7545 GOTO 7580
7550 REM "alpha add, work from right to left, at each step N5 is the number to add to that column, if N5 is zero (no carry), then we are done
7555 N5=1,N5$=C$(45,6)
7556 REM "If all Z's, then roll over to next set of numbers.
7557 IF POS("Z"<>N5$)=0 THEN DIM N5$(LEN(N5$)); N5$(LEN(N5$),1)="0"; GOTO 7578
7560 FOR I=LEN(N5$) TO 1 STEP -1
7564 IF N5$(I,1)=" " THEN GOTO 7575
7565 N5$(I,1)=CHR(ASC(N5$(I,1))+N5)
7569 REM "Now check to see if overflow occured,( out of ranges 0-9, or A-Z). If yes then set N5 to carry and adjust to proper value, else exit, we're done
7570 IF N5$(I,1)>"Z" AND (N5$(I,1)<"0" OR N5$(I,1)>"9") THEN N5$(I,1)="0",N5=1 ELSE IF N5$(I,1)>"9" AND (N5$(I,1)<"A" OR N5$(I,1)>"Z") THEN N5$(I,1)="A",N5=0; EXITTO 7578 ELSE N5=0; EXITTO 7578
7575 NEXT I
7578 B$(5,6)=N5$,C$(45,6)=N5$,N9$=N5$
7590 RETURN 
8000 REM "Check for sales tax & category & salesperson
8010 FIND (Z[5],KEY=A$(220+K9,9),DOM=8011); GOTO 8015
8011 X0=4,C0=0,X$="Customer must have a valid category code"; EXITTO 2040
8020 FIND (Z[2],KEY=A$(235+K9,10),DOM=8021); GOTO 8040
8030 X0=6,C0=0,X$="Customer must have a valid sales tax code"; EXITTO 2040
8040 IF A$(278,20)<>S0$(1,20) THEN GOTO 8070
8060 X0=14,C0=0,X$="Customer must have a valid salesperson code"; EXITTO 2040
8090 RETURN 
8100 REM "Get approx total number of records T, by div'ing #sectors @512 per, by the record size we are expecting.
8110 CALL "ZZINFO",Z[2],T9,X3$,T,T0,K,B,D,S0,S1,F$
8115 PRINT @(0,7),"There are "+STR(T)+" customer records to process"
8120 CALL "ZZINFO",Z[6],T9,X3$,T1,T0,K,B,D,S0,S1,F$
8125 CALL "ZZINFO",Z[7],T9,X3$,T2,T0,K,B,D,S0,S1,F$
8130 T3=T1+T2
8135 PRINT @(0,8),"There are "+STR(T3)+" category records to process"
8145 RETURN 
8150 REM "Display horiz. bar graph given total #, T and current #, C
8154 PRINT @(0,19),"Phase 1",
8155 CALL "ZZBARG",X3$,"HG",19,10,50,T0,T,C
8160 PRINT @(0,20),"Phase 2",
8165 CALL "ZZBARG",X3$,"HG",20,10,50,T4,T3,C1
8195 RETURN 
8950 REM "Program flow logic
8960 DIM U0$(6); U0$(1)=FID(0); U0$=U0$+"PF"
8970 CLOSE (14); OPEN (14)"ZZPARM"; FIND (14,KEY=U0$,DOM=8990)U0$,U1$
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9)
8981 IF LEN(Q1$)=11 THEN Q0$=Q1$(11,1),Q1$=Q1$(1,10)
8990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9725 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9730 RUN U1$(1,6)
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$+O9$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 

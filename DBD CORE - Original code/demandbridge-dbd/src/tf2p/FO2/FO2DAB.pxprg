0010 REM "<FO2DAB> Order Requisition Maintenance - II
0015 REM "Prog Type: IL-3.0A
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 07/14/98 - 16.35 - dmm - SSP# 094880
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0120 DIM H$(100),H[30],S0$(100)
0140 M0$="-#####,##0",M1$="##,##0",M3$="##,##0",M4$="-#####,###"
0150 REM "Set O to length of A/R code + 2
0155 CALL "ZZDISP","AX","XXXXXXXXXX","A/R",X3$,O$,"",0,0,X4$
0157 O=LEN(O$)+2
0280 IF D9$="*" THEN GOTO 6525
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0310 IOLIST A,B$,B[0],B[1],B[2]
0320 IOLIST B$,B[0],B[1],B[2]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18],D[19],D[20],D[21],D[22],D[23],D[24],D[25],D[26],D[27],D[28],D[29],D[30],D[31]
0350 IOLIST E0$
0370 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15],H[16],H[17],H[18],H[19],H[20],H[21],H[22],H[23],H[24],H[25],H[26],H[27],H[28],H[29],H[30]
0390 IOLIST I$,I1$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10]
0430 GOSUB 6800
0440 DIM I[10]
0500 REM "SET-UP
0505 A1=13,A2=1
0510 A3=INT((22-A1)/A2),A4=1,Y9=2,K8=LEN(A1$),Y$=""
0520 DIM X[2],Y[6],T[3]
0525 IF A0=0 THEN U1=7,U2=U1,A9$=""; GOSUB 5200; GOTO 0800
0530 IF A0=0 THEN GOTO 0800
0540 GOSUB 5100
0550 L=1; GOTO 6425
0560 X[0]=1
0590 GOTO 1125
0800 REM "NEW ENTRY
0810 Y$=""
0830 X[0]=1; GOTO 1125
1000 REM 
1015 DIM V7$(10); V7$(4,1)="1"
1045 B$(1,LEN(B1$))=A1$; IF A1$="" THEN B$(1,LEN(K9$))=K9$
1100 REM "SELECT LINE
1110 GOTO 7000
1125 A6=0,A4=X[0]
1129 IF A4=0 THEN GOTO 7000
1130 A4=X[0],Y=(A4-1)*Y9+1; IF Y>LEN(Y$) THEN Y=-1,A4=LEN(Y$)/Y9+1,X[0]=A4
1132 PRINT @(1,10),A4:"##0",
1135 IF Y<0 THEN GOTO 1200
1140 A5=DEC(Y$(Y,Y9))
1150 READ (F,IND=A5)IOL=0310
1160 GOSUB 6200
1165 REM "TO AVOID DISPLAY; GOTO 1400 HERE!!!
1170 IF POS(BIN(A4,Y9)=L0$,Y9)>0 THEN GOTO 1400
1175 GOSUB 7300; GOTO 1400
1200 REM "NEW LINE
1210 IF A9<=0 THEN GOSUB 5200 ELSE GOSUB 5200
1220 Y$=Y$+BIN(A9,Y9),A6=1,A5=A9,A=-1,A9=-1,C6=1
1280 GOSUB 6800; GOSUB 6200
1290 GOTO 1400
1310 C0=-C0
1400 REM "MAINTAIN ENTRY
1490 GOTO 2000
1500 REM "OPTIONS (DISPLAY)
1510 A1$=K9$
1520 IF C0=1 THEN GOTO 1125 ELSE GOTO 7000
1580 GOTO 2000
1600 REM "
1800 REM "PRIOR LINE
1810 IF X[0]>1 THEN X[0]=X[0]-1
1820 GOTO 1125
1900 REM "Finished with line
1950 REM "
1955 IF T<>0 OR U=1 THEN GOSUB 6700
1965 IF C0=3.2 THEN X[0]=X[0]-2
1968 IF A7=1 THEN GOSUB 5700
1970 IF C6=1 THEN C0=0,C6=0
1974 REM "ADDED AND U=0 7/16/87 PER CSI
1975 IF C0=4 AND U=0 THEN GOTO 7000 ELSE X[0]=X[0]+1; GOTO 1125
2000 REM "DATA SEQ
2010 C0=0,D9=1,X0=-1,X1=1,T=0,U=0,Q$="?"; IF Y<0 OR A7=1 THEN T=-1,X0=0
2020 X$="",C0=ABS(C0); IF C0=2 AND X0=0 THEN X0=999; GOTO 2040 ELSE IF C0=2 THEN X0=X0-1 ELSE X0=X0+1; IF C0=2 AND X0=0 THEN X[0]=X[0]-1; GOTO 1100
2025 IF C0>3 OR X0<0 THEN X0=999
2030 IF X0>0 THEN IF T=0 THEN T=-1; GOSUB 7200
2040 ON X0 GOTO 2050,2100,2200,2250,2300,2350,2400,2450,2500,2550,1900
2050 REM "STATUS
2055 C0=0,Q$="?",X$="MDNPLEIA"
2060 C1=1
2062 IF C1>1 THEN GOTO 5800
2070 IF T=0 THEN T=-1; GOSUB 7200
2090 GOTO 2020
2104 X$="Line type: C=Customer inventory",J0$="C"
2105 IF POS(" "<>G$(11,10))>0 THEN X$=X$+", X=Alternate customer inventory",J0$=J0$+"X"
2106 IF G$(75,1)="Y" THEN X$=X$+", I=Inventory",J0$=J0$+"I"
2109 J7$=B$(1,1)
2110 CALL "ZZENTR","SUX",B{ALL},B$,X4$,X3$,6,10,1,1,C0,"","{M"+X$,"","FO2DAB02","","",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2110,2111
2112 IF C0>=0 THEN IF POS(B$(1,1)=J0$)=0 THEN GOTO 2110
2115 IF Y<0 THEN IF U=0 AND C0<0 AND (ABS(C0)=2 OR ABS(C0)=4 OR INT(ABS(C0))=3) THEN C7=1; GOTO 5400
2117 IF B$(1,1)="I" AND G$(75,1)<>"Y" THEN GOTO 2110
2118 IF B$(1,1)=" " THEN GOTO 2110
2119 IF J7$<>B$(1,1) THEN B$(2)="",B[0]=0; GOSUB 6200
2120 IF B$(1,1)="C" THEN B$(2,10)=A$(1,10)
2140 GOTO 2020
2200 REM "Item code
2205 IF B$(1,1)="M" THEN GOTO 2020
2206 J1$=""; IF POS(B$(1,1)="XCI")>0 THEN J1$="IC0"
2207 IF B$(1,1)="C" OR B$(1,1)="I" THEN J0$=B$(2,10),X$="Use the F1 key to LOOKUP the available item codes"
2208 IF B$(1,1)="X" THEN J0$=G$(11,10),B$(2,10)=G$(11,10),X$="Use the F1 key to LOOKUP the available item codes"
2210 CALL "ZZENTR","AXU",B{ALL},B$,X4$,X3$,9,10,12,10,C0,"ICE","{3"+X$,J0$,"FO2DAB06",J1$,"",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2210,2211
2215 IF ABS(C0)=2 THEN GOTO 2020
2217 T4=0; REM "T4=0 means found IC0 record, =1 means didn't find it
2218 T5=0; REM "T5=0 means found FM1 record, =1 means didn't have FM1 record
2219 IF B$(1,1)="I" THEN GOTO 2224
2220 FIND (Z[7],KEY=B$(2,20),DOM=2210); FIND (Z[4],KEY=B$(2,20),DOM=2210)IOL=0340; GOSUB 7600; GOTO 2225
2224 T5=1
2225 FIND (Z[7],KEY=B$(2,20),DOM=2210)IOL=0370; GOTO 2227
2226 T4=1
2229 IF T4=1 AND T5=1 THEN GOTO 2210
2230 IF T5=1 AND T4=0 THEN GOSUB 7650
2232 IF B$(1,1)="C" OR B$(1,1)="X" THEN IF D$(311,6)<>"      " THEN GOSUB 7550; ON S0 GOTO 2233,2209
2239 IF ABS(C0)<2 THEN X0=X0+3
2240 GOTO 2020
2255 GOTO 2020
2260 CALL "ZZENTR","SU",B{ALL},B$,X4$,X3$,20,11,22,9,C0,"","{3"+X$,"","FO2DAB08","","",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2260,2261
2290 GOTO 2020
2305 GOTO 2020
2310 CALL "ZZENTR","SU",B{ALL},B$,X4$,X3$,39,11,31,9,C0,"","{3"+X$,"","FO2DAB10","","",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2310,2311
2340 GOTO 2020
2355 IF B$(1,1)<>"M" THEN GOTO 2020
2360 CALL "ZZENTR","S",B{ALL},B$,X4$,X3$,20,10,40,40,C0,"","{3"+X$,"","FO2DAB12","","",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2360,2361
2390 GOTO 2020
2400 REM "Unit of Measeure
2405 IF B$(1,1)="M" THEN GOTO 2020
2409 GOSUB 7700; X$="{3"+X$
2410 CALL "ZZENTR","SU",B{ALL},B$,X4$,X3$,61,10,80,4,C0,"",X$,"","FO2DAB14","","",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2410,2411
2412 J$=B$(80,4); GOSUB 7750
2413 T6=1; REM "T6=0 means found a u/m match, =1 means no match found
2415 IF T5=0 THEN IF POS(B$(80,4)=D$(238,16)+D$(100,4),4)<>0 THEN T6=0; GOTO 2425
2420 IF T4=0 THEN IF B$(80,4)=H$(120,4) THEN T6=0; GOTO 2425
2425 IF T6=1 THEN GOTO 2410
2440 GOTO 2020
2450 REM "Quantity
2455 IF B$(1,1)="M" THEN GOTO 2020 ELSE J2=B[1]; IF B$(80,4)="M   " THEN J2=1
2458 GOSUB 7700
2459 IF I[0]>0 THEN X$="Average usage is: "+STR(I[0]/J2:M1$)+" "+B$(80,4)+" per month"
2460 CALL "ZZENTR","N",B{ALL},B$,X4$,X3$,68,10,0,801,C0,M0$,"{3"+X$,"","FO2DAB16","","","  H"; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2460,2461
2464 IF ABS(C0)=2 THEN GOTO 2490
2465 J$=B$(80,4),J0=B[1]; GOSUB 7750
2466 REM "IF B[0]=0 THEN CALL "ZZPROM",".X0CS2DAB",X3$,Z,"|WARNING - QUANTITY ORDERED IS 0!","","",V; ON Z GOTO 02460,02471
2467 IF J1<100 OR B[0]>=J1*.1 THEN GOTO 2475
2469 J2$="Are you sure you don't mean "+FNR$(STR(B[0]*J1:M4$))+"?"
2470 CALL "ZZPROM",".X0CS2DAB",X3$,Z,J2$,"","",V; ON Z GOTO 2460,2471
2475 Q=B[0]; IF B$(80,4)<>"M   " THEN Q=B[0]*B[1]
2480 IF B[0]>0 THEN IF I9>0 THEN IF Q>I9 THEN CALL "ZZPROM",".4",X3$,0,"You may only requisition up to a total qty of: "+STR(INT(I9/J2):M0$)+" "+B$(80,4),"","",0; GOTO 2450
2483 IF POS(B$(1,1)="CX")<>0 THEN IF D[31]>0 THEN IF B[0]*B[1]>D[31] THEN CALL "ZZPROM",".Y",X3$,Z,"Amount over req maximum from form master, delete line?","","",0; IF Z=0 THEN Q$="D"; GOTO 5400; REM "SSP131690
2485 IF P0$(240,1)="Y" THEN IF POS(B$(1,1)="CX")<>0 THEN J2$=A$(1,10)+B$(12,10)+"C"+A$(11,4); CALL "FS2DAH",X3$,J2$,B[0]*B[1],Z; IF Z=0 THEN Q$="D"; GOTO 5400; REM "WO94880
2490 GOTO 2020
2505 GOTO 2020
2510 CALL "ZZENTR","N&",B{ALL},B$,X4$,X3$,60,11,1,501,C0,M1$,"{3"+X$,"","FO2DAB18","","",""; IF ABS(C0)>4 THEN GOSUB 6500; ON C0 GOTO 2510,2511
2540 GOTO 2020
2550 REM "Ship from Code
2555 IF B$(1,1)="M" THEN GOTO 2020
2557 REM "IF POS(" "<>B$(84,4))=0 THEN CALL "CS2MCC",X3$,X4$,B$(2,20),X$; LET B$(84,4)=X$; PRINT @(15,11),X$,; LET F9=1; GOTO 02565
2558 REM "LET X$="PRESS <F5> TO SEE AVAILABILITY BY WAREHOUSE"
2560 CALL "ZZENTR","SZFU",B{ALL},B$,X4$,X3$,15,11,84,4,C0,"","{3"+X$,"D","FO2DAB20","13FM0D","",""; IF ABS(C0)>4 THEN IF ABS(C0)=14 THEN GOSUB 6500; GOTO 2560 ELSE GOSUB 6500; ON C0 GOTO 2560,2561
2561 IF POS(" "<>B$(84,4))=0 THEN DIM F0$(402); GOSUB 8000; GOTO 2590
2565 DIM F0$(402); FIND (Z[6],KEY="D"+S0$(1,10)+B$(84,4),DOM=2560)F0$
2570 GOSUB 8000
2575 IF F9=1 THEN F9=0; GOTO 2558; REM "We were defaulting the warehouse, so now go back for entry of whse
2590 GOTO 2020
4900 REM "END OF LINES
4910 Y[4]=-1; WRITE (F,IND=0)IOL=0290
4920 CALL "ZZEXPF",X3$,X4$,"X"+STR(F),"",G9; IF G9>0 THEN GOTO 7000
4925 EXTRACT (F,IND=0)IOL=0290
4930 Z=NUM(FIN(F,"MAXREC")); Y[3]=Z-1
4935 Y[4]=-2; WRITE (F,IND=0)IOL=0290
4940 GOTO 5230
4980 GOTO 7000
5000 REM "LINE LINE Z0 TO LINE Z1
5010 Y=(Z0-1)*Y9+1; IF Y>LEN(Y$) OR Y<1 THEN GOTO 5090 ELSE Z9=DEC(Y$(Y,Y9))
5012 Y=(Z1-1)*Y9+1; IF Y>LEN(Y$) OR Y<1 THEN Z8=-1 ELSE Z8=DEC(Y$(Y,Y9))
5015 READ (F,IND=Z9)IOL=0310
5020 IF Z1>LEN(Y$)/Y9 THEN Z8=-1
5030 IF A<>Z8 THEN A=Z8; WRITE (F,IND=Z9)IOL=0310
5095 RETURN 
5100 REM "BUILD INDEX STRING
5105 Y$="",Y=A0
5120 IF Y<=0 THEN GOTO 5195 ELSE Q$=BIN(Y,Y9); IF POS(Q$=Y$,Y9)=0 THEN Y$=Y$+Q$ ELSE GOTO 5195
5130 READ (F,IND=Y,END=5131)Y; GOTO 5120
5140 IF Y$>"" THEN Y$=Y$(1,LEN(Y$)-Y9)
5195 RETURN 
5200 REM "GET NEXT INDEX TO FILE IN A9
5205 IF A9$>"" THEN A9=DEC(A9$(1,Y9)),A9$=A9$(Y9+1); GOTO 5290
5210 EXTRACT (F,IND=0,ERR=5295)IOL=0290
5215 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5210
5220 Y[4]=-2; WRITE (F,IND=0)IOL=0290
5230 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1; GOTO 5260
5255 A9=Y[1]; READ (F,IND=A9)Y[1]
5260 IF Y[0]<Y[3] THEN Y[0]=Y[0]+1,Y[4]=-1 ELSE Y[2]=Y[2]-1; GOTO 4900
5270 IF U1>0 THEN U1=U1-1,A9$=A9$+BIN(A9,Y9); IF U1>0 THEN GOTO 5230
5280 WRITE (F,IND=0)IOL=0290
5285 IF A0=0 THEN A0=A9
5290 RETURN 
5295 IF ERR<>0 THEN GOTO 9000 ELSE RETRY 
5300 REM "REMOVE INDEX Z
5302 IF POS(BIN(Z,Y9)=A9$,Y9)>0 THEN ESCAPE 
5305 IF U2>0 THEN A9$=BIN(Z,Y9)+A9$; GOTO 5360
5310 EXTRACT (F,IND=0)IOL=0290
5315 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5310 ELSE Y[4]=-2
5320 WRITE (F,IND=0)IOL=0290
5330 WRITE (F,IND=Z)Y[1]
5340 Y[1]=Z,Y[4]=-1,Y[0]=Y[0]-1
5350 WRITE (F,IND=0)IOL=0290
5360 Q0$=BIN(Z,Y9),Q=POS(Q0$=Y$,Y9); IF Q=0 THEN GOTO 5390
5365 Y$=Y$(1,Q-1)+Y$(Q+Y9)
5390 RETURN 
5395 ON ERR GOTO 5310,5311,9000
5400 REM "DELETE CURRENT LINE
5405 Z0=A4-1,Z1=A4+1,A5=DEC(Y$((A4-1)*Y9+1,Y9))
5410 IF Q$="D" THEN READ (F,IND=A5)IOL=0310; T=-1; GOSUB 7200
5415 GOSUB 5000; Z=A5
5420 GOSUB 5300
5430 GOSUB 6800
5435 IF ABS(C0)=3.2 THEN C0=2 ELSE IF ABS(C0)=3.1 THEN C0=4
5485 IF C7=1 THEN C7=0,C0=ABS(C0); IF C0=2 THEN X[0]=X[0]-1; D9=0; GOTO 1120 ELSE GOTO 7000
5490 IF Q$="D" THEN GOSUB 5700; GOTO 6100 ELSE GOTO 1125
5495 X[0]=999,D9=0; GOTO 1120
5500 REM "INSERT CURRENT LINE
5510 GOSUB 5200
5515 Y$=Y$(1,Y-1)+BIN(A9,Y9)+Y$(Y),A5=A9,A9=-1
5520 GOSUB 6800
5530 A6=1,X[0]=A4,A7=1
5540 WRITE (Z[2],IND=A5)IOL=0310; Q$="I"; GOSUB 6000; A4=X[0]
5590 GOTO 1160
5600 REM "TACK ON LINE TO END
5610 Z7=A8; IF Z7=0 THEN GOTO 5635
5620 READ (F,IND=Z7)IOL=0310
5625 A=Y[A5],Z8=0
5630 WRITE (F,IND=Z7)IOL=0310
5635 Z8=0
5690 RETURN 
5700 REM "DISPLAY AFTER DELETE/INSERT
5705 IF A7=1 THEN GOSUB 7300; A7=0; GOTO 5750
5710 IF L0$>"" THEN Z=DEC(L0$(1,Y9)); GOSUB 6000
5750 RETURN 
5800 REM "LINE CONTROL
5810 IF T<>0 THEN T=1; GOSUB 7200; T=0
5820 IF C0=2 THEN GOTO 1100
5880 ON POS(Q$="?DNPLEIA") GOTO 2060,2020,5400,1900,1800,6400,7000,5500,5495
5900 REM "Reset reserved links as avail
5910 Z=DEC(A9$(1,Y9)); GOSUB 5310
5915 A9$=A9$(Y9+1); IF A9$>"" THEN GOTO 5910 ELSE RETURN 
6000 REM "DISPLAY PAGE @ LINE Z
6002 IF Z<=0 THEN Z=1
6005 Y0=(Z-1)*Y9+1,L9=0,L1=Z,L0$="",L2=0,L2$=""
6010 PRINT @(0,A1),'CE',
6020 IF Y0>LEN(Y$) THEN Z=Z-1,A4=Z,L0$=""; GOTO 7320 ELSE IF Y0<1 THEN GOTO 6090
6022 IF Q$="I" AND A4=L1 THEN GOTO 6040
6025 READ (F,IND=DEC(Y$(Y0,Y9)))IOL=0310
6030 GOSUB 6600; GOSUB 6300
6040 L2$=L2$+CHR(1)+CHR(L9+A1)+CHR(3)+STR(L1:"##0")
6080 L0$=L0$+BIN(L1,Y9),L9=L9+A2,L1=L1+1,Y0=Y0+Y9
6085 IF Y0>LEN(Y$) THEN L2=1 ELSE IF L9<A3 THEN GOTO 6022
6090 READ (F,IND=A5)IOL=0310
6095 RETURN 
6100 REM "SELECT LINE ROUTINE
6105 IF Y$="" THEN GOTO 7000 ELSE L1=DEC(L0$(1,Y9)),L2=DEC(L0$(LEN(L0$)-Y9+1,Y9)),X8=A4-L1
6106 C1$="004018012014001"
6110 CALL "ZZSLCT",X3$,"CX",C1$,"",L2$,"{X","",X8,X9,A4; A4=A4+L1,X[0]=A4,X0=A4,Y=(A4-1)*Y9+1; IF X9=-5 THEN Q$="D"; GOSUB 6170; ON S3 GOTO 6111,6110 ELSE IF X9=-4 THEN Q$="I" ELSE IF X9=-3 THEN X9=0 ELSE IF X9=-6 THEN X9=0
6111 IF X9=-4 THEN GOTO 6110
6112 IF X9<0 THEN ON -X9 GOTO 6115,6113,7000,6113,5500,5400,6120
6115 IF X9=0 THEN IF A4>=0 AND A4<=L2 THEN X0=A4; GOTO 7100
6120 IF X9<0 THEN A4=L1 ELSE Y=(A4-1)*Y9+1; IF A4>LEN(Y$)/Y9 THEN GOTO 7000
6130 X0=A4
6150 IF X9=1 AND L1=1 THEN X8=0; GOTO 6110 ELSE IF X9=1 THEN Z=DEC(L0$(1,Y9))-1 ELSE Z=LEN(L0$)-Y9+1,Z=DEC(L0$(Z,Y9))+1
6155 Z=INT(Z/A3)*A3; IF Z=0 THEN Z=1
6160 GOSUB 6000
6165 X8=A4-L1+1; GOTO 6105
6170 X$="",X8=A4-L1; CALL "ZZPROM","L2",X3$,0,X$,"","",0; X$=X$+" ( #"+STR(A4)+" )"
6175 CALL "ZZPROM","Y",X3$,S3,X$,"","",0
6180 RETURN 
6200 REM "PRINT ONE ENTRY
6205 PRINT @(1,10),A4:"##0",
6210 GOSUB 6600
6220 PRINT @(6,10),B$(1,1),
6224 REM CALL "ZZDISP","A   ",B$(2,10),"A/R",X3$,"","",14,8,X4$
6225 GOSUB 7800
6228 PRINT @(9,10),B$(12,10),@(20,10),B$(40,40),@(61,10),B$(80,4),
6232 PRINT @(68,10),B[0]:M0$,
6234 GOSUB 8000
6236 IF B[1]=0 OR B[1]=1 THEN PRINT @(60,11),S0$(1,LEN(M1$)) ELSE PRINT @(60,11),B[1]:M1$,
6290 RETURN 
6300 REM "DISPLAY ONE LINE
6305 PRINT @(1,L9+A1),L1:"##0",
6310 PRINT @(6,L9+A1),B$(1,1),
6319 REM CALL "ZZDISP","A   ",B$(2,10),"A/R",X3$,"","",9,L9+A1,X4$
6328 PRINT @(9,L9+A1),B$(12,10),@(20,L9+A1),B$(40,40),@(61,L9+A1),B$(80,4),; IF B[0]<>0 THEN PRINT @(68,L9+A1),B[0]:M0$
6390 RETURN 
6400 REM "LIST OPTION
6405 L=1
6410 CALL "ZZPROM ","L3",X3$,S3,"","","V",X; ON S3 GOTO 6411,7000
6415 IF S3<0 THEN IF (X-1)*Y9+1>LEN(Y$) THEN X=LEN(Y$)/Y9-1 ELSE IF X<=0 THEN X=1
6420 IF S3<0 THEN L=X+1
6425 Z=L-1; GOSUB 6000
6430 IF L2=1 THEN GOTO 7000 ELSE L=L+L9; GOTO 6410
6460 GOTO 6410
6500 REM "RE-DO SCREEN
6510 GOSUB 6700
6520 CALL "FO2DAC",X3$,X4$,A$,X0$,X1$,Z0$,F$,E$
6525 D9$="",Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1; IF C0>4 THEN C0=C0-5
6530 GOSUB 6000; GOSUB 7280; IF D9=0 THEN GOTO 1100
6540 READ (F,IND=A5)IOL=0310
6545 GOSUB 6200
6550 RETURN 
6600 REM "ALTERNATE DATA READS FOR 1 LINE
6605 DIM F0$(402); FIND (Z[6],KEY="D          "+B$(84,4),DOM=6606)F0$
6690 RETURN 
6700 REM "WRITE CURRENT LINE
6705 IF Y+1=LEN(Y$) THEN A=-1 ELSE A=0
6710 IF A=0 THEN A=DEC(Y$(Y+Y9,Y9))
6715 IF D9$<>"*" THEN T=1; GOSUB 7200; T=0
6720 WRITE (F,IND=A5)IOL=0310; Z=A,Q=Y
6725 IF A6<>0 THEN Z0=A4-1,Z1=A4; GOSUB 5000; READ (F,IND=A5)IOL=0310
6760 IF Z<0 THEN A6=1 ELSE A6=0
6780 IF D9$="" THEN IF A7<>1 THEN GOSUB 7300
6790 RETURN 
6800 REM "SET-UP DATA FOR 1 LINE
6810 B1$=B$
6820 DIM B$(139),B[2],D$(290),D[31]
6880 GOSUB 6600
6895 RETURN 
6900 REM "SET LAST LINE TO NO LINK
6902 V9$="2203  2204  2206  2207  2208  4408  2209  1011  3311  3313  "
6905 IF Y$="" THEN A0=0; GOTO 6945 ELSE A5=DEC(Y$(LEN(Y$)-1,2)),A0=DEC(Y$(1,Y9))
6910 READ (F,IND=A5)IOL=0310
6940 A=-1; WRITE (F,IND=A5)IOL=0310
6945 RETURN 
6950 WRITE (F,IND=A5)IOL=0310
6990 RETURN 
7000 REM "END OF ENTRIES
7005 GOSUB 6900
7010 Z9=2,Z8=1
7020 GOSUB 6950
7025 PRINT @(0,10),'CL',@(15,11),'CL',
7030 IF STP(A$(150,8),3," ")="" THEN CALL "ZZPROM","80CS2DAB",X3$,S3,"","","V",X0 ELSE CALL "ZZPROM","8 CS2DAB",X3$,S3,"","","",0; GOTO 7040
7040 ON S3+1 GOTO 7100,7050,7060,5495,6400,6100
7055 IF T[0]<>0 THEN CALL "ZZPROM","L1",X3$,S3,"","","",0; ON S3 GOTO 7000,7060,7060
7060 L9=1; IF S3=1 THEN L9=2
7070 IF A9$>"" THEN GOSUB 5900
7075 IF Y$>"" THEN A0=DEC(Y$(1,Y9)) ELSE A0=0
7078 A[0]=A0
7080 RUN "FO2DAA"
7100 REM "GOTO LINE NUMBER X0
7105 IF X0<=0 THEN X0=1
7110 X[0]=X0; GOTO 1125
7200 REM "TOTAL LOGIC (T= 1 OR -1)
7280 REM "PRINT TOTAL(S) ON SCREEN STARTING HERE!
7290 RETURN 
7300 REM "Display logic
7310 Q=POS(BIN(A4,Y9)=L0$,Y9),L9=INT(Q/Y9); IF Q>0 THEN GOTO 7400
7311 L9=INT((LEN(L0$)+1)/Y9)
7312 L2$=L2$+CHR(1)+CHR(L9+A1)+CHR(3)+STR(A4:"##0")
7315 IF BIN(A4,Y9)>=L0$ THEN IF LEN(L0$)/Y9<A3 THEN L0$=L0$+BIN(A4,Y9); GOTO 7310
7320 Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1
7330 IF Y$>"" THEN GOSUB 6000
7390 IF X0>0 THEN X0=X0-0
7395 RETURN 
7400 REM "Lines section - display line a4
7410 Q=INT(Q/Y9),L9=Q*A2,L1=A4
7440 GOSUB 6300
7490 RETURN 
7550 REM "FORM SECURITY
7555 Q$=D$(311,6),S0=0; FOR X=1 TO POS("  "=Q$,2) STEP 2
7560 IF POS(Q$(X,2)=G$(51,20),2)=0 THEN EXITTO 7570 ELSE NEXT X; RETURN 
7570 CALL "ZZPROM","X1CS2DAB",X3$,0,"","","",0; S0=1; DIM D$(350); RETURN 
7600 REM "Default F/M record
7604 IF POS(" "<>B$(80,4))<>0 THEN GOTO 7645
7605 B$(40,40)=D$(42,40),B$(80,4)=D$(100,4),B[1]=D[4]
7610 IF POS(" "<>D$(238,4))<>0 THEN B$(80,4)=D$(238,4),B[1]=D[25]
7630 GOSUB 6228
7640 GOSUB 7800
7645 RETURN 
7650 REM "Default I/C record
7655 IF POS(" "<>B$(80,4))=0 THEN B$(40,40)=H$(21,40),B$(80,4)=H$(120,4),B[1]=H[14]
7660 GOSUB 7800
7680 GOSUB 6228
7695 RETURN 
7700 REM 
7705 X$=""
7710 IF T5=1 OR POS(" "<>D$(238,16))=0 THEN GOTO 7745
7720 FOR I=0 TO 3
7725 IF POS(" "<>D$(238+I*4,4))=0 THEN GOTO 7735 ELSE J$=D$(238+I*4,4)
7726 J0=D[25+I]; GOSUB 7750
7730 X$=X$+J$; IF J0<>0 AND J0<>1 THEN X$=X$+" of "+FNR$(STR(J0:M3$))+", " ELSE X$=X$+", "
7735 NEXT I
7739 J$=D$(100,4),J0=D[4]; GOSUB 7750
7740 IF X$<>"" THEN J$="Available units: "+FNS$(D$(100,4)); IF J0<>0 AND J0<>1 THEN X$=J$+" of "+FNR$(STR(J0:M3$))+", "+X$(1,LEN(X$)-2) ELSE X$=J$+", "+X$(1,LEN(X$)-2)
7745 RETURN 
7750 REM "Take u/m J$ and J0, and return J0 set to amount or 0 if fixed
7751 REM "FNS J$ also
7752 REM "If a fixed type J1 is returns M(0) amount to divde ext by, else J1=0
7754 J1=0
7755 DIM M$(21),M[2]; FIND (Z[13],KEY="U/M"+J$,DOM=7756)M$,M[0],M[1]
7760 IF M$(20,1)="Y" THEN J0=0,J1=M[0]
7765 J$=FNS$(J$)
7795 RETURN 
7800 REM "Location data
7805 DIM I[10],I$(95); I$(1,24)=A$(1,10)+B$(12,10)+A$(11,4),I9=0; IF I$(11,10)=S0$(1,10) THEN GOTO 7840
7810 FIND (Z[9],KEY=I$(1,24),DOM=7811)IOL=0390
7815 IF I[0]=0 THEN CALL "ZZPROM","4",X3$,0,"NOTE: NO AVERAGE USAGE SET FOR THIS LOCATION!","","",0; GOTO 7840 ELSE Q=NUM(G$(71,3)); IF Q=0 THEN GOTO 7840 ELSE I9=Q*I[0]/100
7840 J$=B$(80,4); GOSUB 7750
7845 RETURN 
8000 REM "Print ship from warehouse & description
8004 IF POS(" "<>B$(84,4))=0 THEN PRINT @(15,11),S0$(1,45),; GOTO 8045
8005 J$=FNS$(F0$(16,35))
8010 IF POS(" "<>F0$(111,16))=0 THEN J0$="" ELSE J0$=FNS$(F0$(111,16))
8015 IF POS(" "<>F0$(127,2))<>0 THEN IF J0$="" THEN J0$=F0$(127,2) ELSE J0$=J0$+","+F0$(127,2)
8020 IF J$="" THEN J1$=J0$ ELSE IF LEN(J$)+LEN(J0$)+1>40 THEN J1$=J$(1,39-LEN(J0$))+"-"+J0$ ELSE J1$=J$+"-"+J0$
8040 PRINT @(15,11),B$(84,4),@(20,11),J1$,
8045 RETURN 
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
8920 DEF FNB$(Z9$)=X3$(214-6*NUM(Z9$),1)
8930 DEF FNS$(Z9$)=Z9$(1,POS("  "=Z9$+"  ")-1)
8935 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9505 GOSUB 6500
9510 SETERR 9000
9520 IF Y5=68 THEN RETRY ELSE ON C9 GOTO 1140,2040
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 

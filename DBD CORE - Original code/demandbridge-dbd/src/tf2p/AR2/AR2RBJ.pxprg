0010 REM "Formatted Statement Printing <AR2RBJ> UNFORM
0035 REM "5.6 - 02/08/08 - 10.965277 - dmm - SSP# 211873
0037 REM "211873-Laser statement - would like to add the Credit Contact in   
0040 REM "Copyright 2008 DemandBridge, Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="AR2RBC",X1$="Statement Printing"
0120 DIM A$(168),A[12],B[3],D$(391),D[15],W[1],P[5]
0140 Z0$="#,###,###.00-",Z1$=Z0$,Z2$="##,###,###.00-"
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0175 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0210 T=1,T0=0,T1=7
0220 W3=83
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0300 REM "I/O lists
0305 REM "IOLIST FOR AR6 - Open Invoice Header File
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12]
0315 REM "IOLIST FOR AR7 - Invoice Detail
0320 IOLIST X3,B$,B[0],B[1]
0325 REM "IOLIST FOR AR1 - Customer Masterfile
0330 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15]
0340 IOLIST E$
0360 IOLIST P0$,P[0],P[1],P[2],P[3],P[4],P[5]
0365 IOLIST C0$
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$,W[0]
0430 IOLIST Y8$,Y8[0],Y8[1],Y8[2],Y8[3],X9$
0440 IOLIST X9[0],Y9[0],X9[1],Y9[1],X9[2],Y9[2],X9[3],Y9[3],X9[4],Y9[4],X9[5],Y9[5],X9[6],Y9[6],X9[7],Y9[7],X9[8],Y9[8],X9[9],Y9[9],X9[10],Y9[10],X9[11],Y9[11],X9[12],Y9[12],X9[13],Y9[13],X9[14],Y9[14],X9[15],Y9[15],X9[16],Y9[16],X9[17],Y9[17],X9[18],Y9[18],X9[19],Y9[19],X9[20],Y9[20],X9[21],Y9[21],X9[22],Y9[22],X9[23],Y9[23],X9[24],Y9[24],X9[25],Y9[25],X9[26],Y9[26],X9[27],Y9[27],X9[28],Y9[28],X9[29],Y9[29],X9[30],Y9[30],X9[31],Y9[31],X9[32],Y9[32],X9[33],Y9[33],X9[34],Y9[34],X9[35],Y9[35],X9[36],Y9[36],X9[37],Y9[37],X9[38],Y9[38],X9[39],Y9[39],X9[40],Y9[40],X9[41],Y9[41],X9[42],Y9[42],X9[43],Y9[43],X9[44],Y9[44],X9[45],Y9[45],X9[46],Y9[46],X9[47],Y9[47],X9[48],Y9[48],X9[49],Y9[49],X9[50],Y9[50],X9[51],Y9[51],X9[52],Y9[52],X9[53],Y9[53],X9[54],Y9[54],X9[55],Y9[55],X9[56],Y9[56],X9[57],Y9[57],X9[58],Y9[58],X9[59],Y9[59],X9[60],Y9[60],X9[61],Y9[61],X9[62],Y9[62],X9[63],Y9[63],X9[64],Y9[64],X9[65],Y9[65],X9[66],Y9[66],X9[67],Y9[67],X9[68],Y9[68],X9[69],Y9[69],X9[70],Y9[70],X9[71],Y9[71],X9[72],Y9[72],X9[73],Y9[73],X9[74],Y9[74],X9[75],Y9[75],X9[76],Y9[76],X9[77],Y9[77]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0509 REM "SLOT 12 reserved for Sort - see 8600
0510 Y$="01O AR6...  02O AR7...  03O AR1...  04O ARN...  05O AR3...  06O ZZPARM  07O FMP...  "
0520 GOSUB 9750
0600 REM "read parameters"
0610 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=9900)IOL=0360
0615 READ (Z[6],KEY="CMP"+X3$(9,3),DOM=9900)IOL=0365
0619 REM "Setup aging"
0620 GOSUB 4100
0700 REM "Open Printer
0710 GOSUB 8200
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0740 IF FID(0)<>FID(W9) THEN W0=34
0744 X$=V3$,F_CODE$="STM"+DIM(7)+V0$(60,1); CALL "EF2PRM",ERR=0746,X3$,X4$,X$,P6$,F6$,F_CODE$,FORM_PARM$; IF P6$(144,2)="UF" THEN UNFORM_MODE=2,UNFORM_DEV=W9
0746 JOB_MODIFIER$=""
0750 REM "X9=Page count, X6=line# of customer address, X7=1st line of heading, info starts 4 lines later  X8=line # of totals, headings printed one line above
0755 X6=12,X7=18,X8=W0+2
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[1]; U=10,U0=1,U[0]=0,U[1]=10,T0=1,V1=10,U0$="Y   ",T5$="                ",U5$="Customer Number"; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0920 GOSUB 8600
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0992 F9$=""; FIND (Z[7],KEY="e"+V0$(63,3),DOM=0993)F9$
0995 GOTO 7500
1000 REM "Read next record
1001 ALIGN=0
1005 U$=KEY(U1,END=5000)
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])>=V2$(U3,U[U9]) THEN GOTO 1030 ELSE EXTRACT (U1,KEY=U$(1,U2-1)+V2$(U3,U[U9]),DOM=1021)
1025 EXITTO 1000
1030 IF U$(U2,U[U9])<=V2$(U3+U[U9],U[U9]) THEN GOTO 1040 ELSE READ (U1,KEY=U$(1,U2-1)+$FF$,DOM=1032)
1035 EXITTO 1000
1040 NEXT U9
1090 IF V0$(62,1)="S" THEN U$=U$(1,10)+U$(28,8) ELSE U$=U$(1,10)+U$(18,8)
1095 READ (U1,END=1096)
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1200 REM "Read other data
1210 IF A$(1,10)=D$(1,10) THEN GOTO 1400
1220 DIM D$(LEN(D$)); J9=0; FIND (Z[3],DOM=1221,KEY=A$(1,10))IOL=0330
1225 F1$="Y"
1230 IF D$(268,1)="N" THEN GOSUB 4665
1232 IF V0$(203,2)<>"  " THEN IF D$(359,2)<>V0$(203,2) THEN GOSUB 4665; REM "WO119837, only print for certain terms code
1240 IF F9$="" THEN GOTO 1300
1250 IF F9$(35,1)="Y" AND POS(D$(220,9)=F9$(36,12*9),9)>0 THEN GOTO 1300
1260 IF F9$(35,1)<>"Y" AND POS(D$(220,9)=F9$(36,12*9),9)=0 THEN GOTO 1300
1270 GOSUB 4665
1300 REM 
1325 DIM E$(170); FIND (Z[5],KEY=D$(278,4),DOM=1326)IOL=0340
1330 REM "Check range"
1340 GOSUB 4600
1350 W8=1
1400 REM "Subtotals"
1415 GOSUB 3100
1420 ON T GOTO 1470,1430,1440,1450,1460
1490 T=0
1500 REM "Print Data
1502 IF A[3]=0 AND V0$(202,1)<>"Y" THEN GOTO 1000
1505 GOSUB 4500
1506 IF V0$(61,1)="A" AND STR(A2)<V0$(81,1) THEN GOTO 1000
1507 IF A$(11,7)="ONACCNT" THEN O=O+A[3]; GOTO 1900
1508 IF P0$(114,1)="Y" AND F1$="Y" THEN F1$=""; CALL "AR2EBJ",X3$,X4$,3,D$(1,10),F5$; IF F5$>"" THEN F5=9; GOSUB 8350; I0=I0+W3*F4,F4=0
1510 IF I0>(Y8[2]+Y8[3]-2)*W3 THEN GOSUB 7700
1515 X$=FND$(A$(20,6))
1516 F5=7,F5$=X$; GOSUB 8350
1517 F5=34,F5$=X$; GOSUB 8350
1518 F5=50,F5$=X$(1,6)+X$(9,2); GOSUB 8350; F5=57,F5$=A$(160,8); GOSUB 8350
1519 F5=59; F5$=FND$(A$(54,6)); GOSUB 8350; REM " SSP 173012
1520 CALL "ZZDISP","AX",A$(11,8),"AR6",X3$,X$,"",0,0,X4$
1521 F5=8,F5$=X$; GOSUB 8350; F5=25; GOSUB 8350
1522 F5=25,F5$=X$; GOSUB 8350
1523 F5=36,F5$=X$; GOSUB 8350
1524 IF POS(X3$(9,3)="099")>0 THEN IF POS("Finance charge"=A$(36,15))>0 THEN A$(36,15)="Service charge"
1525 CALL "ZZDISP","AX",A$(66,8),"O/P",X3$,D9$,"",0,0,X4$; IF POS(" "<>A$(36,15))=0 AND POS(" "<>A$(66,8))<>0 THEN REF$=D9$ ELSE REF$=A$(36,15) END_IF ; F5=9,F5$=REF$; GOSUB 8350; F5=33,F5$=REF$; GOSUB 8350
1526 IF A[6]-A[3]>=0 THEN F5=10,F5$=STR(A[6]:Z0$); GOSUB 8350
1527 IF A[6]<=0 AND POS("-"=V0$(59,12))=0 THEN F5=11,F5$=STR(-A[6]:Z0$); GOSUB 8350 ELSE IF A[6]<=0 AND POS("-"=V0$(59,12))<>0 THEN F5=11,F5$=STR(A[6]:Z0$); GOSUB 8350
1528 IF X9$(26,1)="B" THEN F5=26,F5$=STR(A[3]:Z0$); GOSUB 8350 ELSE F5=26,F5$=STR(A[6]:Z0$); GOSUB 8350
1529 IF X9$(37,1)="B" THEN F5=37,F5$=STR(A[3]:Z0$); GOSUB 8350 ELSE F5=37,F5$=STR(A[6]:Z0$); GOSUB 8350
1530 CALL "ZZDISP","AX",A$(66,8),"O/P",X3$,F5$,"",0,0,X4$; F5=32; GOSUB 8350
1535 F5=31; GOSUB 7850; F5=35; GOSUB 7850
1540 N9$=A$(19,1); GOSUB 3500; F5=27; GOSUB 8350; F5=28; GOSUB 8350
1585 IF X9[20]<>0 THEN F5=12,F5$=STR(A[3]:Z1$); GOSUB 8350
1590 IF Q9=1 THEN GOTO 1900
1810 IF V0$(78,1)="Y" THEN J9=T[T0,7],F5=20,F5$=STR(T[T0,7]+A[6]:Z0$); GOSUB 8350; J9=J9+A[6]; GOSUB 4700; GOSUB 2000; GOTO 1900
1815 REM "Handle case where detail is not printed"
1820 X5=A[6]-A[3]
1825 F5=20,F5$=STR(T[T0,7]+A[3]:Z0$); GOSUB 8350
1830 REM "IF X5<0 THEN F5=10,F5$=STR(A[2]-X5:Z0$); GOSUB 8350 ELSE IF X5<>0 THEN F5=11,F5$=STR(X5:Z0$); GOSUB 8350
1831 F5=11,F5$=STR(X5:Z0$); GOSUB 8350
1832 IF X5<0 THEN F5=10,F5$=STR(A[6]:Z0$); GOSUB 8350
1850 F5=12,F5$=STR(A[3]:Z1$); GOSUB 8350; F5=26; GOSUB 8350 ! SSP220627, add second printing of invoice balance, field 26
1860 IF POS(" "<>A$(26,10))=0 THEN GOTO 1900
1865 CALL "ZZDISP","AX",A$(26,10),"A/R",X3$,X$,"",0,0,X4$
1870 F5=49,F5$="Billed from: "+X$; GOSUB 8350
1900 REM "Accumulate Totals"
1905 I0=I0+F4*W3,F4=0
1907 IF Q9=1 THEN Q9=0; RETURN 
1910 T[T0,A2]=T[T0,A2]+A[3],T[T0,7]=T[T0,7]+A[3]
1990 T[T0,0]=T[T0,0]+1
1995 GOTO 1000
2000 REM "Print Lines or Detail"
2005 I0=I0+F4*W3,F4=0
2010 X3=A[1],T4=0,X5=A(6),FLAG$="",SEQ$="",B$=""; DIM B[1]
2015 GOSUB 2500
2020 IF FLAG$="END" THEN B$=""; GOSUB 2700; RETURN 
2030 CALL "AR2XAB",X3$,X4$,Z[2],A$,X3,B$,B{ALL},FLAG$,SEQ$,"R"
2035 IF FLAG$="NONE" THEN B$=""; GOSUB 2700; RETURN 
2040 REM "Read Secondary Information"
2200 REM "Print Each Line
2210 IF I0>(Y8[2]+Y8[3]-2)*W3 THEN GOSUB 7700
2215 F5=7,F5$=FND$(B$(20,6)); GOSUB 8400
2216 F5=50,F5$=F5$(1,6)+F5$(9,2); GOSUB 8400
2219 F5$=""
2220 ON POS(B$(19,1)="PACD") GOTO 2245,2225,2230,2235,2240
2225 F5$="Chk:"; GOTO 2245
2230 F5$="Adj:"; GOTO 2245
2235 F5$="CM:"; GOTO 2245
2240 F5$="DM:"
2245 F5=41; GOSUB 8400
2246 F5=42,F5$=B$(26,8); GOSUB 8400; X5=X5+B[0]
2247 F5=51,F5$=B$(26,7); GOSUB 8400
2250 IF B[0]>0 THEN F5=43,F5$=STR(B[0]:Z1$); GOSUB 8400 ELSE IF POS("-"=V0$(59,12))=0 AND B[0]<=0 THEN F5=44,F5$=STR(-B[0]:Z1$); GOSUB 8400 ELSE IF POS("-"=V0$(59,12))<>0 AND B[0]<=0 THEN F5=44,F5$=STR(B[0]:Z1$); GOSUB 8400
2255 J7=1,J8=B[0]; GOSUB 3600
2260 IF B$(19,1)="P" THEN IF B[1]<>0 THEN F5=45,F5$="Discount allowed"; GOSUB 8400; F5=54,F5$="Dsc all"; GOSUB 8400; J7=2,J8=B[1]; GOSUB 3600; IF B[1]>0 THEN F5=46,F5$=STR(B[1]:Z1$); GOSUB 8400 ELSE F5=47,F5$=STR(-B[1]:Z1$); GOSUB 8400
2270 N9$=B$(19,1); GOSUB 3500
2275 F5=52; GOSUB 8400
2400 REM "Accumulate Line Totals"
2410 I0=I0+F4*W3,F4=0
2499 GOTO 2020
2500 REM "Line Header
2690 RETURN 
2700 REM "Line Totals"
2705 IF X5=A[3] THEN GOTO 2720
2710 IF I0>(Y8[2]+Y8[3]-2)*W3 THEN GOSUB 7700
2713 F5=51,F5$="Clr Det"; GOSUB 8400
2714 F5=52,N9$="X"; GOSUB 3500; GOSUB 8400
2715 F5=41,F5$="Cleared detail"; GOSUB 8400; IF A[3]-X5>0 THEN F5=43,F5$=STR(A[3]-X5:Z1$); GOSUB 8400 ELSE F5=44,F5$=STR(X5-A[3]:Z1$); GOSUB 8400
2718 I0=I0+W3*F4,F4=0
2719 I0=I0-W3
2720 F5=48,F5$=STR(A[3]:Z1$); GOSUB 8400
2725 I0=I0+W3*F4,F4=0
2795 RETURN 
2900 REM "Send P$ to printer
2905 IF UNFORM_MODE THEN CALL "EF2UNF",X3$,X4$,P6$,"N",UNFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$ ! F_OPT$="E" ELSE IF UNFORM_MODE AND F5=40 AND UF_OPT$<>"N" THEN CALL "EF2UNF",X3$,X4$,P6$,"E",UNFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$; REM "SSP 173012
2906 ! F UNFORM_MODE AND UF_OPT$<>"E" THEN CALL "EF2UNF",X3$,X4$,P6$,"N",UNFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$; UF_OPT$="E" ELSE IF UNFORM_MODE AND F5=40 AND UF_OPT$<>"N" THEN CALL "EF2UNF",X3$,X4$,P6$,"E",UNFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$; REM "SSP 173012
2910 FOR I=0 TO INT(LEN(P$)/W3)-1
2920 Y5$=P$(I*W3+1,W3); GOSUB 7300
2930 NEXT I
2932 IF UNFORM_MODE THEN GOSUB 8060; CALL "EF2FAX",X3$,X4$,P6$,F6$,W9,FAX$,XTMP$,UNFORM_MODE,EM$ ! 241023
2935 DIM P$(Y8[0]*W3)
2940 RETURN 
3000 REM "Subtotaling Routines"
3050 REM "Add to T$ for total title, T & T5 should be set
3055 T7$=T5$(T*4-3,4)
3060 IF T7$(1,1)=" " THEN RETURN 
3070 IF T7$(1,1)<>"S" THEN CALL "ZZDISP",T7$(1,1)+"X",T6$,T7$(2,3),X3$,T6$,"",0,0,X4$
3080 IF T$="" THEN T$=T6$ ELSE T$=T$+" "+T6$
3090 RETURN 
3100 REM "High order break"
3110 IF V1=0 THEN RETURN ELSE IF U1$=U9$(1,V1) THEN GOSUB 3200; RETURN 
3120 GOSUB 3220
3130 IF U1$="" THEN GOTO 3154
3150 T=1,T$=U5$,T6$=U1$; GOSUB 3050; GOSUB 7000
3151 GOSUB 2900
3152 IF T0$="END" THEN RETURN 
3154 C$=D$
3155 IF U0$(1,1)="Y" THEN X9=0; GOSUB 6100
3156 I0=(Y8[2]-1)*W3,F4=0
3160 U1$=U9$(1,V1)
3180 RETURN 
3280 RETURN 
3380 RETURN 
3480 RETURN 
3500 REM "Fill in F5$ based on type in N9$
3505 N9=POS(N9$="IPCF")
3510 IF N9=0 THEN N9=5
3520 F5$=STR(N9:"##")
3545 RETURN 
3600 REM "Print runningbalance offset by J7 lines down, J8 is  amount, J9 will be adjusted
3605 IF X9[20]=0 THEN GOTO 3645
3610 J9=J9+J8
3614 F5$=STR(J9:Z0$)
3615 P$(I0+X9[20]+(Y9[20]+J7-1)*W3,LEN(F5$))=F5$
3645 RETURN 
4100 REM "Set up constants for ageing
4106 REM "Set a5 to limit invoice to a range of ages
4107 A5=NUM(V0$(81,1))
4110 IF P0$(47,1)="Y" THEN GOTO 4200
4115 REM "age by months"
4120 A0$=V0$(72,4),A2=NUM(A0$(3)),A0=4
4130 FOR I=1 TO 4
4135 A1$=A0$(1,2),A3=A2-I; IF A3<1 THEN A3=A3+12; IF A1$(2,1)<>"0" THEN A1$(2,1)=CHR(ASC(A1$(2,1))-1) ELSE A1$=CHR(ASC(A1$(1,1))-1)+"9"
4140 A0$=A0$+A1$+STR(A3:"00")
4145 NEXT I
4190 RETURN 
4200 REM "Set aging if aging is days"
4210 A0$="",A0=6,A1$="      "
4220 FOR I=0 TO 4
4230 CALL "ZZDATE",X3$,"",V0$(72,6),A1$,-P[I],0,0,0,0,0,0,"","",""
4240 A0$=A0$+A1$
4250 NEXT I
4290 RETURN 
4500 REM "Age invoice and set A1= xpos to print, A2= total to update"
4505 D0$=A$(20,6); IF P0$(46,1)="Y" AND POS(" "<>A$(54,6)) THEN D0$=A$(54,6)
4507 IF A$(11,7)="ONACCNT" OR (A$(19,1)="C" AND P0$(96,1)<>"Y") THEN A2=2; GOTO 4590
4510 FOR I=0 TO 4
4520 IF D0$(1,A0)>A0$(I*A0+1,A0) THEN A2=I+1; EXITTO 4550
4530 NEXT I
4539 REM "if still here then maximum age
4540 A2=6
4590 RETURN 
4600 REM "Check to balance range to print
4605 REM "zero balance"
4610 IF D[6]=0 THEN IF V0$(79,1)<>"Y" THEN GOTO 4670 ELSE GOTO 4660
4615 REM "Credit balance"
4620 IF D[6]<0 THEN IF V0$(80,1)<>"Y" THEN GOTO 4670
4625 REM "Positive balance check"
4630 IF D[6]>0 THEN IF W[0]>0 THEN IF D[6]<W[0] THEN GOTO 4670
4650 J0=0; FOR I=NUM(V0$(81,1)) TO 6; J0=J0+D[I+6]; NEXT I
4655 IF J0=0 THEN GOTO 4670
4660 RETURN 
4665 REM "Customer rejected,read ahead in file & continue"
4670 READ (U1,KEY=A$(1,10)+$FF$,DOM=4671)
4680 EXITTO 1000
4690 RETURN 
4700 REM "Print billed from customer if necessary"
4710 IF POS(" "<>A$(26,10))=0 THEN RETURN 
4740 CALL "ZZDISP","AX",A$(26,10),"A/R",X3$,X$,"",0,0,X4$
4750 F5=49,F5$="Billed from: "+X$; GOSUB 8350; GOSUB 8350
4790 RETURN 
5000 REM "End of Print
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5040 GOSUB 3120
5200 REM "
5210 IF FID(0)<>FID(W9) AND POS(X3$(9,3)="335479377",3)=0 THEN PRINTER$=FID(W9); CLOSE (W9); OPEN (W9)PRINTER$
5220 CALL "ZZPROM",".Y",X3$,Z,"Did the statements print correctly?","","",0
5290 GOTO 9900
6000 REM "Page header
6010 ESCAPE 
6090 RETURN 
6100 REM "
6104 ! F UNFORM_MODE THEN GOSUB 8060; CALL "EF2FAX",X3$,X4$,P6$,F6$,W9,FAX$,XTMP$,UNFORM_MODE,EM$
6105 DIM P$(Y8[0]*W3)
6110 I0=(Y8[2]-1)*W3,F4=0
6120 F5=56; GOSUB 6200
6125 DIM D$(LEN(D$)); FIND (Z[3],DOM=6126,KEY=A$(1,10))IOL=0330
6130 DIM E$(170); FIND (Z[5],KEY=D$(278,4),DOM=6131)IOL=0340
6135 X$=FND$(V0$(72,6)),F5$=X$(1,6)+X$(9,2),F5=53; GOSUB 8300
6136 F5=1,F5$=FND$(V0$(72,6)); GOSUB 8300
6137 F5=22,F5$=FND$(V0$(72,6)); GOSUB 8300; F5=30; GOSUB 8300
6138 F5=2; CALL "ZZDISP","AX",A$(1,10),"A/R",X3$,F5$,"",0,0,X4$; GOSUB 8300; F5=23; GOSUB 8300; CUST$=F5$
6139 F5=3; IF TEST_PATTERN THEN F5$=DIM(20,"X") ELSE F5$=E$(149,20) END_IF ; GOSUB 8300 ! WO211873
6140 X9=X9+1; F5=55,F5$=STR(X9:"#0"); GOSUB 8300; IF X9>1 THEN F5=4,F5$="PAGE: "+STR(X9:"#0"); GOSUB 8300
6142 IF POS(X3$(9,3)="520476338363364365366",3)<>0 THEN F5=6,F5$=STR(D[6]:Z2$); GOSUB 8300 ELSE F5=6,F5$=STR(D[6]:"$"+Z2$); GOSUB 8300
6145 F5=5; GOSUB 7800
6150 F5=29; GOSUB 7800
6155 DIM D$(LEN(D$)); FIND (Z[3],DOM=6156,KEY=U$(1,10))IOL=0330
6160 DIM E$(170); FIND (Z[5],KEY=D$(278,4),DOM=6161)IOL=0340
6165 F5=21; IF TEST_PATTERN THEN F5$=DIM(20,"X") ELSE F5$=C$(11,20) END_IF ; GOSUB 8300 ! WO211873
6166 DATE$=FND$(V0$(72,6))
6170 F5=58,F5$=STP("PDFFILE:"+X3$(9,3)+DLM+"ST"+DLM+X3$(40,3)+DLM+CUST$+"_"+DATE$(7,4)+DATE$(1,2)+DATE$(4,2)+STR(X9),3," "); GOSUB 8300; REM " SSP 173012
6175 F5=60,F5$=D$(298,20); GOSUB 8300 ! WO211873, Credit contact, see line 8243
6199 RETURN 
6200 REM "Print company name and address
6204 I9=I0
6205 IF X9[F5]=0 THEN GOTO 6245 ELSE I0=Y9[F5]*W3+X9[F5]
6210 FOR I=7 TO 127 STEP 40
6215 IF POS(" "<>C0$(I,40))<>0 THEN P$(I0,40)=C0$(I,40),I0=I0+W3
6220 NEXT I
6225 IF POS(" "<>C0$(167,10))=0 THEN GOTO 6245 ELSE X$=C0$(167,10)
6230 X$="("+X$(1,3)+") "+X$(4,3)+"-"+X$(7,4)
6235 P$(I0,14)=X$
6245 I0=I9; RETURN 
7000 REM "Totals logic
7001 IF O=0 THEN GOTO 7020
7002 F5=8,F5$="ONACCNT"; GOSUB 8350; F5=25; GOSUB 8350; F5=36; GOSUB 8350; F5=9,F5$="On account balance"; GOSUB 8350
7003 F5=11,F5$=STR(O:Z0$); GOSUB 8350; F5=26; GOSUB 8350; F5=37; GOSUB 8350
7004 F5=12,F5$=STR(O:Z1$); GOSUB 8350; O=0
7006 FIND (Z[1],KEY=U1$(1,10)+"ONACCNT ",DOM=7007)IOL=0310; IF V0$(78,1)="Y" THEN GOSUB 2000
7007 FIND (Z[1],KEY=U$(1,18),DOM=7008)IOL=0310
7020 F5=13,F5$=STR(T[T,1]+T[T,2]:Z2$); GOSUB 8300
7021 F5=14,F5$=STR(T[T,3]:Z2$); GOSUB 8300
7022 F5=15,F5$=STR(T[T,4]:Z2$); GOSUB 8300
7023 IF X9[17]=0 THEN F5=16,F5$=STR(T[T,5]+T[T,6]:Z2$); GOSUB 8300 ELSE F5=16,F5$=STR(T[T,5]:Z2$); GOSUB 8300; F5=17,F5$=STR(T[T,6]:Z2$); GOSUB 8300
7024 IF POS(X3$(9,3)="520476338363364365366",3)<>0 THEN F5=18,F5$=STR(T[T,7]:Z2$); GOSUB 8300 ELSE F5=18,F5$=STR(T[T,7]:"$"+Z2$); GOSUB 8300; F5=24; GOSUB 8300
7030 F5=19,F6=0,F5$=V0$(82,60); GOSUB 8450
7040 F5=19,F6=1,F5$=V0$(142,60); GOSUB 8450
7050 IF X9[38]=0 THEN GOTO 7100
7060 X=T[T,4]+T[T,5]+T[T,6]; IF X9$(38,1)="3" THEN X=X+T[T,3] ELSE IF X9$(38,1)="9" THEN X=X-T[T,4]
7070 F5=38; F5$=STR(X:Z2$); GOSUB 8300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7485 V1$="ARN..."
7490 RETURN 
7500 REM "Test pattern"
7504 DIM A$(168),A[12],B$(46),B[3],D$(391),D[15],P[5]
7505 CALL "ZZPROM","R4",X3$,Z,"","","",0
7506 IF UNFORM_MODE THEN CALL "EF2UNF",X3$,X4$,P6$,"N",UNFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$; UF_OPT$="E"; REM " SSP 173012
7510 ON Z GOTO 1000,7511,5000
7515 TEST_PATTERN=1 ! WO211873
7520 DIM D$(391,"X"),E$(170,"X"),A$(168,"X"),B$(46,"X"),C$(391,"X"),U$(168,"X")
7522 E$(167,2)=""
7525 D[6]=999999999.99,A$(20,6)="I79999",B$(20,6)="I79999",A$(54,6)="I79999"; REM " SSP 173012
7526 A$(19,1)="I"
7530 GOSUB 6100
7531 I0=(Y8[2]-1)*W3,I1=0
7535 Q9=1,A[3]=-11111.11,A[2]=-9999999.99; GOSUB 1500; F5=12,F5$=STR(9999999.99:Z0$); GOSUB 8350; F5=26; GOSUB 8350
7540 Q9=1,A[2]=9999999.99; GOSUB 1500
7544 I0=I0-W3; REM "to correct for running thru 1900's
7545 X3=0,B[0]=-99999.99,B[1]=-99999.99; GOSUB 2200
7550 T=1,T[1,2]=-99999999.99,T[1,3]=T[1,2],T[1,4]=T[1,2],T[1,5]=-55555555.55,T[1,6]=-44444444.44,T[1,7]=T[1,2]; GOSUB 7000
7560 GOSUB 2900
7565 IF V3$(2,1)<>"T" AND POS(X3$(9,3)="130335479377",3)=0 THEN PRINTER$=FID(W9); CLOSE (W9); OPEN (W9)PRINTER$
7590 TEST_PATTERN=0; GOTO 7500 ! WO211873
7700 REM "Print continued
7710 F5=40,F5$="**Continued**"; GOSUB 8300
7715 GOSUB 2900
7725 GOSUB 6100
7730 I0=(Y8[2]-1)*W3,F4=0
7740 RETURN 
7800 REM "Print customer information for field F5
7805 IF X9[F5]=0 THEN GOTO 7845 ELSE I0=Y9[F5]*W3+X9[F5]
7810 P$(I0,35)=C$(11,35),I0=I0+W3
7815 P$(I0,30)=C$(56,30),I0=I0+W3
7820 IF POS(" "<>C$(86,30))>0 THEN P$(I0,30)=C$(86,30),I0=I0+W3
7825 CALL "ZZDISP","AX",C$(134,9),"ZIP",X3$,X$,"",0,0,X4$
7830 X$=FNS$(C$(116,16))+",  "+C$(132,2)+".    "+X$
7835 P$(I0,LEN(X$))=X$
7845 RETURN 
7850 REM "Print type description I9$ at field F5
7855 ON POS(I9$=" PACD*!F") GOTO 7860,7860,7865,7870,7875,7880,7885,7890,7891,7860
7860 F5$="INV"; GOTO 7895
7865 F5$="PMT"; GOTO 7895
7870 F5$="ADJ"; GOTO 7895
7875 F5$="C/M"; GOTO 7895
7880 F5$="D/M"; GOTO 7895
7885 F5$="DUE"; GOTO 7895
7890 F5$="ONA"; GOTO 7895
7891 F5$="S/C"; GOTO 7895
7895 GOSUB 8350; RETURN 
8060 REM " Setup Fax String
8065 DIM FAX$(6*51),EM$(6*21); REM "SSP 173012
8069 CALL "ZZDISP","AX",A$(1,10),"A/R",X3$,T$,"",0,0,X4$
8070 FAX$(1)="C"+D$(143,12),FAX$(27)="C:"+T$,EM$(1)="C"+A$(1,10); REM " CUSTOMER
8090 IF ALIGN=1 THEN FOR J7=0 TO 4; FAX$(2+J7*51,25)=P6$(150,12),EM$(2+J7*21,20)="ALIGNMENTPATTERN"; NEXT J7; REM " If alignment pattern, replace with align pattern from parameters
8095 RETURN 
8200 REM "Set constants for formatting
8205 M8=77
8210 DIM X9[M8],Y9[M8],X9$(M8),Y8[3],Y8$(50)
8220 READ (Z[6],DOM=8221,KEY="FORMATST"+V0$(60,1))IOL=0430,IOL=0440; GOTO 8240
8230 CALL "ZZPROM",".4",X3$,0,"Invalid Flexible Format Code: "+V0$(60,10),"","",0; GOTO 9900
8240 W3=Y8[1]; DIM Y5$(W3),Y6$(W3)
8245 RETURN 
8300 REM "Place in page, F5 = field #, F5$=field info
8305 IF X9[F5]=0 THEN GOTO 8345
8310 P$(X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8345 RETURN 
8350 REM "F5=field#, F5$=field info. line number is used to index off of I0 set to first line in lines section - 1. line 1  on a line = first line.
8351 REM "Set F4 to highest line # printed
8355 IF X9[F5]=0 THEN GOTO 8395
8360 P$(I0+X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8365 IF Y9[F5]>F4 THEN F4=Y9[F5]
8395 RETURN 
8400 REM "Same as 8350
8405 IF X9[F5]=0 THEN GOTO 8445
8410 P$(I0+X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8415 IF Y9[F5]>F4 THEN F4=Y9[F5]
8445 RETURN 
8450 REM "Place in page,F5=field#,F5$=info,F6=line offset
8455 IF X9[F5]=0 THEN GOTO 8495
8460 P$(X9[F5]+(Y9[F5]+F6)*W3,LEN(F5$))=F5$
8495 RETURN 
8600 REM "Create Sort
8605 IF V0$(62,1)<>"S" THEN GOTO 8690
8610 Y$="Cust Stmt Printing by Bill From",K1=0
8620 CALL "ZZ2SRT",X3$,X4$,Z[6],Z[1],35,Y$,K1,"NN"
8630 Y$="12O "+Y$; GOSUB 9750; U1=Z[12]
8640 READ (Z[1],KEY="",DOM=8641)
8650 READ (Z[1],END=8690)X$,*,*,*,X
8660 X$=X$(1,10)+X$(26,10)+"B"+X$(20,6)+X$(11,8)
8670 IF X=0 THEN X$(21,1)="A"
8675 PRINT @(10,23),X$(1,10)+"-"+X$(28),
8680 WRITE (Z[12],KEY=X$); GOTO 8650
8690 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9750 REM "Open files
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
9770 RETURN 
9900 REM "End program
9910 IF POS("J"=MID(V0$,59,12))=0 THEN CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF NOT(NUL(Y4$)) THEN IF %GUI THEN CALL Y4$,ERR=*NEXT ELSE RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
56000 REM "211873-Laser statement - would like to add the Credit Contact in

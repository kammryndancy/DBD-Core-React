0010 REM "Customer Summary Bill <AR2REE>
0035 REM "5.7 - 07/29/24 - 16.636485 - crg - SSP# 307474
0037 REM "307474-DBD-441: Changes related to Cust PO for Summary Bill invoice
0040 REM "Copyright 2024 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="AR2REE",X1$="Summary Bill"
0120 DIM A$(180),A[10],C$(400),C[15],W[4],E$(247),S$(20),F$(180),F[3],F$(128),G[2],H$(128),H[2],I[2],NAME$(128),CST[1]
0140 Z0$="##,###,###.00-",Z1$="####,###.00-",Z2$="#,###,###.00-",Z3$="###,###.00-",Z4$="#####.00-",Z5$="$"+Z2$
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0185 DEF FNS$(Z9$)=Z9$(1,POS(S$=Z9$+S$)-1)
0190 DEF FNE$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+NUM(Z9$(2,1))+330*POS("  "=Z9$(1,2)):"##")
0210 T=1,T0=0,T1=3
0220 W3=131
0225 W=999
0230 DIM DASHES$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0250 DIM FILL$(37)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10]
0325 REM "IOLIST FOR AR1 - Customer Masterfile
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST AR6$,AR6[0],AR6[1],AR6[2],AR6[3],AR6[4],AR6[5],AR6[6],AR6[7],AR6[8],AR6[9],AR6[10],AR6[11],AR6[12],AR6[13],AR6[14],AR6[15]
0350 IOLIST E$
0360 IOLIST F$,F[0],F[1],F[2],F[3]
0370 IOLIST G$,G[0],G[1],G[2]
0380 IOLIST H$,H[0],H[1],H[2]
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$,W[0],W[1],W[2],W[3]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O FMY...  03O AR1...  04O AR6...  05O FM0... 13O ZZPARM "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0530 IF V0$(72,1)="S" THEN GOSUB 7550
0550 READ (Z[13],KEY="CMP"+X3$(9,3),DOM=9900)C0$
0555 EXPORT_ON$="N"; READ (Z[13],KEY=X3$(9,3)+"EXPORTAR",DOM=0556)EXPORT_PARAM$; IF EXPORT_PARAM$(12,1)="Y" THEN EXPORT_ON$="Y"
0610 IF V0$(297,1)="Y" THEN GOSUB 6900; GOSUB 6950; H$(1,10)=A$(1,10),H[0]=I[0]; WRITE (Z[7],KEY=H$(1,10)+"C"+FILL$)IOL=0380; REM "Create Monthly Detail Work File
0620 FIND (Z[13],KEY=X3$(9,3)+"A/R",DOM=9800)P0$
0640 IF X3$(56,3)="DMY" THEN Z5$(1,1)="#"
0650 REM "Check Repository parameters
0660 R6$="N"; IF V3$(2,1)<>"T" THEN CALL "ZR2DGP",ERR=0661,X3$,X4$,"SUMBIL_RPT",R6$
0665 IF R6$(1,1)="Y" THEN T9$=X3$(21,6)+X3$(178,6); CALL "ZR2DND",ERR=0666,X3$,X4$,T9$,"",R6$; REM "Signal start of new document, key is ...
0700 REM "Open Printer
0720 REM 
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[2]; U=14,U0=2,U[0]=0,U[1]=10,U[2]=4,T0=2,V1=10,V2=4,U0$="YY  ",T5$="AA/RS           ",U5$="Customer",U6$="Ship-To"; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0880 REM "IF POS(V0$(72,1)="DB")>0 THEN GOTO 08000
0895 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W8$,W9$,W0,W9,W2,W3,W4; ON W4 GOTO 0896,9920
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+F_NAME$+"  ",Z{ALL},Z[7],0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[7]
0915 IF Q5=1 THEN U1=Z[1]; REM "SECOND PASS TO CLEAR THE FILE
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0931 V9$=V2$
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0960 V2$(1,20)=V9$(1,20)
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000)
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])>=V2$(U3,U[U9]) THEN GOTO 1030 ELSE EXTRACT (U1,KEY=U$(1,U2-1)+V2$(U3,U[U9]),DOM=1021)
1025 EXITTO 1000
1030 IF U$(U2,U[U9])<=V2$(U3+U[U9],U[U9]) THEN GOTO 1040 ELSE READ (U1,KEY=U$(1,U2-1)+$FF$,DOM=1032)
1035 EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 IF Q5=1 THEN READ (Z[1],KEY=U$,DOM=1000)IOL=0310; GOTO 1155
1152 READ (Z[7],KEY=U$,DOM=1000)IOL=0360; IF U$(11,1)="C" THEN GOTO 1000 ELSE IF U$(11,1)="F" THEN GOTO 1000; REM ELSE GOTO 04000
1155 IF A$(72,1)=" " THEN A$(72,1)="I"
1156 IF V0$(292,4)<>"    " THEN IF POS(A$(72,1)=V0$(292,4))=0 THEN GOTO 1000
1157 IF ((V0$(305,6)<>"      " AND A$(23,6)<V0$(305,6)) OR (V0$(311,6)<>"      " AND A$(23,6)>V0$(311,6))) THEN GOTO 1000; REM "SSP128191, date range
1158 IF V0$(318,1)="1" OR V0$(318,1)=" " THEN GOTO *NEXT ELSE IF V0$(318,1)="2" AND NUL(A$(34,15)) THEN GOTO *NEXT ELSE IF V0$(318,1)="3" AND MSK(STP(A$(34,15),2),STP(MID(V0$,319,60),2))=1 THEN GOTO *NEXT ELSE IF V0$(318,1)="4" AND MSK(STP(A$(34,15),2),STP(MID(V0$,319,60),2))<>1 THEN GOTO *NEXT ELSE GOTO 1000 ! 307474-Filter invoices: 1=All, 2=Blank only, 3=Matches a pattern, 4=Does not match pattern
1160 IF Q5=2 THEN PRINT @(30),U$(1,10),"-",U$(11,8),"-",U$(19,3),; IF POS("I"=V0$(59,12))<>0 THEN WRITE (Z[2],KEY=A$(1,10)+A$(147,5)+A$(23,6)+"  "+A$(11,12)); GOTO 1000 ELSE WRITE (Z[2],KEY=A$(1,10)+A$(147,5)+A$(49,8)+A$(11,12)); GOTO 1000
1162 REM "IF Q5=1 AND POS("M"=V0$(59,12))<>0 THEN PRINT @(25,21),U$, ELSE GOTO 01165
1163 REM "IF U$(1,18)=C1$ THEN GOTO 01000 ELSE GOSUB 05500; GOSUB 05600; GOTO 01000
1165 IF Q5=1 THEN PRINT @(25,21),U$,; REMOVE (Z[1],KEY=U$,DOM=1000); IF U$(1,18)=C1$ THEN GOTO 1000 ELSE GOSUB 5500; GOSUB 5600; GOTO 1000
1180 REM "IF A$(29,1)<>"Y" AND V0$(73,1)<>"Y" THEN GOTO 01000
1200 REM "check range
1210 REM IF C1$<>F$(1,10) THEN GOSUB 02000
1220 REM "IF C2$<>F$(49,8) THEN GOSUB 02100
1300 REM "Read other data
1400 REM "Subtotals"
1415 GOSUB 3100
1420 ON T GOTO 1470,1430,1440,1450,1460
1430 DIM H[2],G[2]; FIND (Z[8],KEY=F$(1,10)+"F"+FILL$,DOM=1431)IOL=0380; FIND (Z[8],KEY=F$(1,10)+"C"+FILL$,DOM=1431)IOL=0370
1431 TOT_FRT=H[0],TOT_CUST=G[0]
1490 T=0
1500 REM "Lines
1510 IF W+4>W0 THEN GOSUB 6000
1520 Y5$(1)=F$(15,10)
1530 CALL "ZZDISP","AXS",F$(49,8),"O/P",X3$,Y5$,"",12,10,X4$
1540 Y5$(23,40)=F$(64,40)
1550 CALL "ZZDISP","NMXS",STR(F[0]:Z0$),"",X3$,Y5$,"",64,11,X4$
1555 CALL "ZZDISP","NFXS",STR(F[1]:Z0$),"",X3$,Y5$,"",81,12,X4$
1560 CALL "ZZDISP","NMXS",STR(F[2]:Z1$),"",X3$,Y5$,"",97,13,X4$
1565 CALL "ZZDISP","NMXS",STR(F[3]:Z1$),"",X3$,Y5$,"",112,10,X4$
1620 GOSUB 7300
1900 REM "Accumulate Totals"
1990 T[T0,0]=T[T0,0]+1
1992 T[T0,1]=T[T0,1]+F[1],T[T0,2]=T[T0,2]+F[2],T[T0,3]=T[T0,3]+F[3],CST[1]=CST[1]+F[2]
1995 GOTO 1000
2000 REM "Customer Change
2010 IF C1$="" THEN GOTO 2050
2020 T1$="END"; GOSUB 2100; T1$=""
2030 IF W+3>W0 THEN GOSUB 6000
2032 X$=V0$(73,8); IF V0$(73,8)="AUTO    " THEN GOSUB 7500
2035 REM "GOSUB 07300; LET Y5$(6)="WHEN PAYING, PLEASE REFERENCE SUMMARY BILL#: "+X$, Y5$(77)="SUMMARY BILL TOTAL:", Y5$(98)=STR(A3[0]+A3[1]+A3[2]:Z2$); GOSUB 07300
2040 IF V0$(81,1)="Y" THEN GOSUB 7600
2045 IF T0$="END" THEN RETURN 
2050 C1$=F$(1,10)
2060 DIM C$(LEN(C$)); FIND (Z[3],DOM=2061,KEY=C1$)IOL=0330
2070 W0$=FNS$(C$(11,35))
2080 GOSUB 6000; GOSUB 6300
2085 DIM A3[2]
2090 RETURN 
2100 REM "Invoice Number Change
2110 IF C2$="" THEN GOTO 2180
2130 IF A2[0]<>0 THEN Y5$(88)="Freight:",Y5$(98)=STR(A2[0]:Z2$); GOSUB 7300
2140 IF A2[1]<>0 THEN Y5$(86)="Sales Tax:",Y5$(98)=STR(A2[1]:Z2$); GOSUB 7300
2150 Y5$(82)="Invoice Total:",Y5$(98)=STR(A2[0]+A2[1]+A2[2]:Z2$); GOSUB 7300; GOSUB 7300
2152 FOR I=0 TO 2; A3[I]=A3[I]+A2[I]; NEXT I
2155 IF T0$="END" THEN RETURN 
2160 IF T1$<>"END" THEN GOSUB 6300
2180 C2$=A$(11,8); DIM A2[2]
2190 RETURN 
3000 REM "Subtotaling Routines"
3050 REM "Add to T$ for total title, T & T5 should be set
3055 T7$=T5$(T*4-3,4)
3060 IF T7$(1,1)=" " THEN RETURN 
3070 IF T7$(1,1)<>"S" THEN CALL "ZZDISP",T7$(1,1)+"X",T6$,T7$(2,3),X3$,T6$,"",0,0,X4$
3080 IF T$="" THEN T$=T6$ ELSE T$=T$+" "+T6$
3090 RETURN 
3100 REM "High order break"
3110 IF V1=0 THEN RETURN ELSE IF U1$=U9$(1,V1) THEN GOSUB 3200; RETURN 
3120 GOSUB 3220
3130 IF U1$="" THEN GOTO 3160
3150 T=1,T$=U5$,T6$=U1$; GOSUB 3050; GOSUB 7000
3155 IF U0$(1,1)="Y" THEN GOSUB 6000
3160 U1$=U9$(1,V1)
3161 GOSUB 4700; GOSUB 4750
3180 RETURN 
3200 REM "Second Order Break
3210 IF V2=0 THEN RETURN ELSE IF U2$=U9$(V5,V2) THEN GOSUB 3300; RETURN 
3220 GOSUB 3320
3230 IF U2$="" THEN GOTO 3260
3250 T=2,T$=U6$,T6$=U2$; GOSUB 3050; GOSUB 7000
3255 IF U0$(2,1)="Y" THEN GOSUB 6000
3260 U2$=U9$(V5,V2)
3265 GOSUB 4750
3280 RETURN 
3380 RETURN 
3480 RETURN 
4000 REM "Shipment Detail by Location Version
4010 REM "IF A$(73,1)="M" THEN GOTO 01000
4020 IF C1$<>F$(1,10) THEN GOSUB 4800
4030 IF C2$<>F$(1,10)+F$(104,1)+F$(11,4) THEN GOSUB 4900
4035 GOTO 1151
4700 REM "Set customer information
4705 DIM C$(LEN(C$)); FIND (Z[3],DOM=4706,KEY=F$(1,10))IOL=0330
4710 W0$=STP(C$(11,35),1)
4745 RETURN 
4750 REM "Set ship to information
4755 DIM X$(15); X$(1,1)=F$(104,1),X$(12,4)=F$(11,4); IF X$(1,1)="C" THEN X$(2,10)=F$(1,10)
4760 DIM E$(LEN(E$)); W1$=""; FIND (Z[5],DOM=4761,KEY=X$)IOL=0350
4765 IF STP(E$(16,35),3," ")="" THEN W1$="" ELSE W1$=STP(E$(214,9),1)
4795 RETURN 
4800 REM "Customer Change
4820 FIND (Z[7],KEY=F$(1,10)+"F"+FILL$,DOM=4970)IOL=0380; FIND (Z[7],KEY=F$(1,10)+"C"+FILL$,DOM=4970)IOL=0370
4825 TOT_CUST[1]=H[0]; TOT_FRT[1]=G[0]; GOSUB 4900
4830 IF W+3>W0 THEN GOSUB 6000
4835 GOSUB 7300
4840 GOSUB 7300
4845 IF T0$="END" THEN RETURN 
4850 C1$=F$(1,10)
4860 DIM C$(LEN(C$)); FIND (Z[3],DOM=4861,KEY=C1$)IOL=0330
4870 W0$=FNS$(C$(11,35))
4880 GOSUB 6000
4885 DIM A3[2]
4890 RETURN 
4900 REM "Ship-to Location Change
4910 IF C2$="" THEN GOTO 4970
4915 DIM H$(121),G$(128),H[2],G[2],FRTTOT[2],TOT_CUST[1],TOT_FRT[1]
4950 FRTTOT[1]=CST[1]/TOT_CUST[1]*TOT_FRT[1]; TOT_CUST[1]=TOT_CUST[1]-CST[1]; TOT_FRT[1]=TOT_FRT[1]-FRTTOT[1]
4960 GOSUB 7300; Y5$(111)=STR(FRTTOT[1]:Z1$); T[T0,3]=T[T0,3]+FRTTOT[1]; FRTTOT[1]=0
4970 DIM X$(15); C2$=F$(1,10)+F$(104,1)+F$(11,4),X$(1,1)=C2$(11,1),X$(12,4)=C2$(12,4); IF X$(1,1)="C" THEN X$(2,10)=C2$(1,10)
4975 DIM E$(LEN(E$)); FIND (Z[5],DOM=4976,KEY=X$)IOL=0350; GOTO 4980
4980 REM "GOSUB 06400
4990 RETURN 
5000 REM "End of Print
5005 IF Q5=2 THEN GOTO 8100
5010 IF Q5=1 THEN GOSUB 5700; GOTO 9920
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5060 REM "IF POS("M"=V0$(59,12))<>0 THEN CALL "ZZPROM",".Y",X3$,Z,"DID THE REPORT PRINT CORRECTLY?","","",0; ON Z GOTO 05061,09920 ELSE GOTO 05071
5065 REM "LET Q5=3; LET T9=1
5070 REM "PRINT @(24),"SETTING THE PRINT ARCHIVE FLAG"; GOTO 00900
5200 REM "
5210 T9=1
5290 GOTO 9900
5300 REM "Purge records
5310 CALL "ZZPROM","X0AR2RHA",X3$,Z,"","","",0; ON Z GOTO 5311,9920
5317 PRINT @(0,20),'CE',@(23,20),"Now clearing:",
5320 AR6_TOT$=""
5360 Q5=1,C1$=""; GOTO 0900
5500 REM "Flag Open Invoice Record
5505 IF A$(29,1)<>"Y" THEN GOTO 5580
5506 D$=A$(1,10)
5510 IF P0$(15,1)="Y" THEN READ (Z[3],KEY=A$(1,10))IOL=0330; IF POS(" "<>C$(46,10))<>0 THEN A$(1,10)=C$(46,10)
5515 DIM AR6[15]
5520 EXTRACT (Z[4],KEY=A$(1,18),DOM=5580)IOL=0340
5525 REM "LET Q$=V0$(73,8); IF Q$="AUTO    " THEN FIND (Z[6],KEY=D$(1,10)) *,Q$
5530 REM "LET AR6$(160,8)=Q$
5535 IF EXPORT_ON$="Y" THEN GOSUB EXPORT_LOGIC
5540 WRITE (Z[4])IOL=0340
5580 C1$=U$(1,18)
5590 RETURN 
5600 REM "If this is an R/L, need to send summary bill no to M/L
5610 IF X3$(330,1)<>"1" THEN GOTO 5695
5620 K0$="CMH"+X3$(9,3)+"  "+"|"+X$(1,18),K1$=X$(1,18)+X$(160,8)
5630 CALL "CM2AAA",X3$,0,4,K0$,K1$,0
5695 RETURN 
5700 EXPORT_LOGIC:REM "Total into AR6_TOT until customer # changes, then create pseudo ARB data to pass to export routine
5705 IF AR6_TOT$="" THEN AR6_TOT$=AR6$; DIM AR6_TOT[15]; FOR TOT_I=0 TO 15; AR6_TOT[TOT_I]=AR6[TOT_I]; NEXT TOT_I; GOTO 5795; REM "First time thru, so initialize everthing and capture 1st one.
5710 IF AR6_TOT$(1,10)=AR6$(1,10) THEN FOR TOT_I=1 TO 15; AR6_TOT[TOT_I]=AR6_TOT[TOT_I]+AR6[TOT_I]; NEXT TOT_I; GOTO 5795; REM "if on the same customer then add numerics and leave
5714 REM "If here then we are not on first one, and the customer number has changed so we need to update the old record and start on the new one.
5715 DIM ARB$(689),ARB[30]
5720 ARB$(15,10)=AR6_TOT$(1,10),ARB$(7,8)=AR6_TOT$(160,8); REM "customer number, invoice number from summary bill number
5722 ARB$(86,6)=X3$(21,6),ARB$(92,8)=AR6_TOT$(66,8); REM "invoice date from accounting date, order number from 1st invoice
5724 ARB$(100,15)=AR6_TOT$(36,15),ARB$(133,4)=AR6_TOT$(74,4); REM "Customer P/O and 1st salesperson
5726 ARB$(180,6)=AR6_TOT$(139,6); REM "Date shipped
5728 ARB[1]=AR6_TOT[9],ARB[2]=AR6_TOT[8],ARB[3]=ARB[1]+ARB[2]; REM "net sale, freight, taxable amount
5730 ARB[4]=AR6_TOT[7],ARB[9]=AR6_TOT[6],ARB[11]=AR6_TOT[9]-AR6_TOT[10]; REM "Sales tax billed, invoice total, cost (net sale - gross profit)
5735 DIM Z_FAKE[4]; Z_FAKE[4]=Z[3]; REM "used in call to access customer master
5740 CALL "AR2XIA",X3$,X4$,EXPORT_PARAM$,FILES{ALL},ARB$,ARB{ALL},Z_FAKE{ALL},UPDATE$
5745 AR6_TOT$=""; GOTO 5705; REM "Clear totals and go to start new totals
5795 EXPORT_LOGIC_END:RETURN 
6000 REM "Page header
6035 IF T0$="END" THEN W0$=""
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W9$,W3,W,W9,W8,W0,W5,W2,W8$+"R",R6$; IF T0$="END" THEN GOTO 6060 ELSE ON W5 GOTO 6041,9910
6045 ON W5 GOTO 6046,9900
6060 GOSUB 6100
6070 REM "GOSUB 07300
6090 RETURN 
6100 REM "
6103 Y5$(1)="Item Num",Y5$(12)="Order Num",Y5$(23)="Description",Y5$(69)="Unit Price",Y5$(83)="Qty Shipped",Y5$(98)="Extended Amt",Y5$(116)="Freight"; GOSUB 7300
6130 GOSUB 7300
6199 RETURN 
6200 REM "Break #1 header
6202 IF C1$<>A$(1,10) THEN GOSUB 2000
6210 IF W+4>W0 THEN GOSUB 6000
6215 GOSUB 7300
6299 RETURN 
6300 REM 
6310 GOTO 6390; REM "LET Y5$(1)="INVOICE NO.    DATE     ORDER NO    CUSTOMER P/O NO.   DATE SHIPPED   SHIPPED VIA"
6315 REM "GOSUB 07300
6320 CALL "ZZDISP","AX",A$(11,8),"AR6",X3$,X$,"",0,0,X4$
6330 Y5$(2)=X$,Y5$(13)=FND$(A$(23,6))
6340 CALL "ZZDISP","AX",A$(49,8),"O/P",X3$,X$,"",0,0,X4$
6350 Y5$(25)=X$,Y5$(37)=A$(34,15),Y5$(56)=FND$(A$(171,6)),Y5$(71)=A$(57,15)
6360 GOSUB 7300; GOSUB 7300
6390 RETURN 
6400 REM "Detail shipments
6405 X$=FNS$(E$(214,9)); IF X$>"" THEN X$=X$+" ("+C2$(12,4)+") " ELSE X$=C2$(11,1)+" "+C2$(12,4)+" "
6410 E1$="Location: "+X$
6420 CALL "ZZDISP","AX",E$(129,9),"ZIP",X3$,X$,"",0,0,X4$
6425 IF POS("S"=V0$(59,12))<>0 THEN X$=E$(51,30); GOTO 6450 ELSE H$=FNS$(E$(111,16))+", "+E$(127,2)+"   "; IF POS("G"=V0$(59,12))>0 THEN X$=H$+E$(160,20) ELSE X$=H$+X$
6430 E1$=E1$+X$; Y5$(1)=E1$
6435 GOSUB 7300
6436 Y5$(11)=E$(16,35); GOSUB 7300
6440 GOSUB 7300
6445 RETURN 
6450 REM "Location heading for Summarized Shipment detail, don't gosub 7300, that will be done after filling in the totals
6455 J5$=E1$(11); REM "Pull off location code
6460 J6$=E$(16,35)+" "+X$; REM "Desc + city,state,zip
6495 RETURN 
6900 REM "Create Temporary Work File
6910 K9$="[320]Monthly Detail File"
6912 CALL "ZZ2SRT",X3$,X4$,Z[13],Z[1],48,K9$,0,"NN"
6915 IF LEN(K9$)<8 THEN K9$=K9$+" "; GOTO 6915
6920 Y$="07O "+K9$+" 08OS"+K9$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
6925 F_NAME$=K9$
6945 RETURN 
6950 REM "Add Records to the Work File
6952 READ (Z[1],KEY=V2$(1,10),DOM=6953)
6953 U$=KEY(Z[1]); NAME$(1,10)=U$(1,10); IF U$(1,10)>V2$(11,10) THEN GOTO 6995 ELSE GOTO 6957
6956 U$=KEY(Z[1],END=6995); IF U$(1,10)>V2$(11,10) THEN GOTO 6995
6957 READ (Z[1],KEY=U$)IOL=0310; IF U$(1,10)>V2$(11,10) THEN GOTO 6995
6958 IF NAME$(1,10)<>A$(1,10) THEN GOTO 6996
6962 IF A$(148,4)="9999" THEN DIM G$(128),G[2]; G$(1,11)=A$(1,10)+"F",G[0]=A[5]; WRITE (Z[7],KEY=G$(1,11)+FILL$)IOL=0370; GOTO 6956
6963 F$(1,10)=A$(1,10),F$(11,4)=A$(148,4),F$(15,10)=A$(84,10),F$(25,4)=A$(138,4); REM "Build Key
6964 IF A[0]=0 THEN A[0]=1
6967 F$(29,10)=STR(A[0]),F$(39,10)=STR(A[2]); REM "Build Key
6968 F$(49,8)=A$(11,8),F$(64,40)=A$(94,40),F$(104,1)=A$(147,1),F[0]=A[2],F[1]=A[1],F[2]=A[3],F[3]=A[5]
6969 IF POS(X3$(9,3)="500434",3)<>0 THEN F[1]=F[1]/A[0]
6970 READ (Z[7],KEY=F$(1,48),DOM=6971)IOL=0360; GOTO 6980
6975 WRITE (Z[7],KEY=F$(1,48))IOL=0360; GOTO 6985
6980 F[1]=F[1]+A[1],F[2]=F[2]+A[3],F[3]=F[3]+A[5]; WRITE (Z[7],KEY=F$(1,48))IOL=0360
6985 I[0]=I[0]+A[3]; REM "Customer Totals
6990 GOTO 6956
6995 RETURN 
6996 H$(1,10)=A$(10),H[0]=I[0]; WRITE (Z[7],KEY=H$(1,10)+"C"+FILL$)IOL=0380; NAME$(1,10)=A$(1,10),I[0]=0; GOTO 6956
7000 REM "Totals logic
7002 IF W+3>W0 THEN GOSUB 6000
7005 Y5$(82)=DASHES$(1,12),Y5$(97)=DASHES$(1,12),Y5$(111)=DASHES$(1,12); GOSUB 7300
7006 IF T<>2 OR TOT_CUST=0 THEN SHP2_FRT=0 ELSE SHP2_FRT=TOT_FRT*T[T,2]/TOT_CUST; TOT_FRT=TOT_FRT-SHP2_FRT,TOT_CUST=TOT_CUST-T[T,2]
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7012 IF T=2 AND T$<>"" THEN Y5$(T0+2-T)="***LOCATION"+" "+E$(214,9)+"   "+STR(T[T,0]:"0"); GOTO 7016
7015 IF T$<>"" THEN Y5$(T0+2-T)=T$+" Total ("+STR(T[T,0]:"0")+"):"
7019 T[T,3]=T[T,3]+SHP2_FRT
7020 Y5$(81)=STR(T[T,1]:Z0$),Y5$(97)=STR(T[T,2]:Z1$),Y5$(112)=STR(T[T,3]:Z1$)
7035 IF T=2 THEN GOSUB 7300; GOSUB 7300; GOSUB 7300; Y5$(1)="Prorated freight: "+STR(SHP2_FRT:Z1$); GOSUB 7300
7038 IF T=2 THEN GOSUB 7300; GOSUB 7300; Y5$(1)="Total Extended Amount (Incl Freight)"; X9=T[T,2]+T[T,3]; Y5$(112)=STR(X9:Z1$); GOSUB 7300
7040 IF T=1 AND (TOT_FRT<>0 OR TOT_CUST<>0) THEN GOSUB 7300; Y5$="***** Unallocated Freight: "+STR(TOT_FRT:Z1$)+" Unallocated sales: "+STR(TOT_CUST:Z1$); GOSUB 7300
7065 IF T$="END" THEN Y5$(66)=T2$(1,14),Y5$(80)=T2$(1,12),Y5$(92)=T2$(1,12),Y5$(104)=T2$(1,14),Y5$(119)=T2$(1,14); GOSUB 7300
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)="Number of items printed: "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 IF INT(T2)>0 THEN T4$=STR(INT(T2))+" Hours " ELSE T4$=""
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+STR(T3:"##.##")+" Minutes"
7260 Y5$(1)="Elapsed time: "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7305 IF X3$(9,3)="434" THEN Y5$=UCS(Y5$)
7308 IF R6$(1,1)="Y" THEN CALL "ZR2DNL",ERR=7309,X3$,X4$,Y5$,R6$; REM "Send line to repository if needed.
7310 IF POS("V"=W8$)>0 THEN CALL "ZZVIEW",X3$,0,0,W3,W9,W,W9$,Y5$; GOTO 7390
7320 W=W+1; IF POS(" "<>Y5$)=0 THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; Y5$(1)=""
7330 REM 
7390 IF W>=W0 THEN GOSUB 6000
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7505 REM "Next invoice number
7510 EXTRACT RECORD (Z[13],KEY=X3$(9,3)+"A/R")P9$
7515 X$=P9$(89,7)
7520 P0=NUM(P9$(89,7)),P0=P0+1; IF P0>9999999 THEN P0=1
7525 P9$(89,7)=STR(P0:"0000000"); WRITE RECORD (Z[13],KEY=X3$(9,3)+"A/R")P9$
7530 WRITE (Z[6],KEY=C1$)C1$,X$,A3[0],A3[1],A3[2]
7545 RETURN 
7550 REM "CREATE TEMP FILE FOR SUMMARY BILL NUMBERS
7560 Q$="TMP"+FID(0)
7565 ERASE Q$,ERR=7566; GOTO 7565
7566 IF ERR<>12 THEN GOTO 9000
7570 DIRECT Q$,10,200,64,0,0
7575 Y$="06O "+Q$; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
7595 RETURN 
7600 REM "Print Invoice Cover Sheet
7640 CALL "AR2REZ",X3$,X4$,W9$,W,W9,W0,W2,C0$,C$,X$,V0$,A3[0],A3[1],A3[2]
7690 RETURN 
7700 REM "T type unit of measure
7710 PRECISION 5; Y5$(80)=STR(A[2]*.001:"###,###.00000"),Y5$(94)="EACH"; PRECISION 2
7740 RETURN 
7800 REM "Create M0$ unit of measure string set M0
7810 DIM M$(20); FIND (Z[13],KEY="U/M"+A$(133,4),DOM=7811)IOL=0390
7815 IF M$(20,1)="Y" THEN M0=M[0] ELSE M0=A[3]
7820 IF M0=0 THEN M0=1,M0$=""; GOTO 7840
7830 IF M$(20,1)<>"Y" THEN M0$=FNS$(A$(133,4))+"/"+FNR$(STR(M0:Z3$)) ELSE IF M[0]=0 THEN M0$=FNS$(A$(133,4)) ELSE M0$="",M0=1
7840 RETURN 
8000 REM "Sort by location
8010 Y$="MONTHLY SHIPMENT DETAIL BY LOCATION"
8020 CALL "ZZ2SRT",X3$,X4$,Z[13],Z[1],35,Y$,Z,"YY"
8025 IF Z=2 THEN GOTO 9920
8030 Y$="02O "+Y$,Y9$=Y$
8040 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
8050 IF Z=0 THEN Q5=2,C1$=""; GOTO 0900
8100 REM "Set ups for Detail Shipment version
8110 Q5=0,V0=2,V1$="TMP"+FID(0)
8120 IF POS("S"=V0$(59,12))<>0 THEN X1$="Shipment Summary by Location" ELSE X1$="Shipment Detail by Location - * indicates prorated amount"
8140 GOTO 0881
8300 REM "EOJ for Ship to detail
8310 IF V0$(72,1)<>"B" THEN GOTO 9900
8315 IF POS("V"=W8$)>0 THEN GOSUB 6000
8320 X1$="Summary Bill"
8330 Q5=0,V0=0,V1$="FMY..."
8340 T0$="",T1$="",C1$="",C2$=""
8350 DIM A2[2],A3[2]
8360 IF Y9$>"" THEN Y9$(3,1)="C"; CALL "ZZFLES",X3$,Y1$,Y0$,Y9$,Z{ALL},Z0,Z1
8365 GOSUB 7550
8390 GOTO 0900
8915 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$)+POS("         "=Z9$))
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$(1,POS(".00"=STR(Z9:Z9$)+".00")-1))
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF POS("V"=W8$)>0 THEN GOSUB 6000
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 IF V0$(72,1)="B" AND T9=1 AND V3$(2,1)<>"T" AND POS("M"=V0$(59,12))=0 THEN GOTO 5300
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9927 ERASE "TMP"+FID(0),ERR=*NEXT ! SSP#222785          
9930 IF NOT(NUL(Y4$)) THEN CALL Y4$,ERR=*NEXT ELSE RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
56001 REM "222785-Summary bill report leaves orphaned TMP files               
56002 REM "307474-DBD-441: Changes related to Cust PO for Summary Bill invoice

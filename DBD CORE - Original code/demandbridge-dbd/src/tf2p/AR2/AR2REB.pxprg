0010 REM "Customer Summary Bill <AR2REA> FPF FORMAT
0035 REM "5.7 - 09/26/13 - 15.266944 - jvv - SSP# 265203
0037 REM "265203-Summary Bill images are not there anymore.                  
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="AR2REA",X1$="Summary Bill"
0120 DIM A$(265),A[10],C$(400),C[15],W[4],E$(247)
0140 Z0$="-##,###,###.00",Z1$="####,###.00-",Z2$="#,###,###.00-",Z3$="###,###.00-",Z4$="#####.00-",Z5$="$"+Z2$
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0185 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0210 T=1,T0=0,T1=5
0220 W3=131
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10]
0325 REM "IOLIST FOR AR1 - Customer Masterfile
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0350 IOLIST E$
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$,W[0],W[1],W[2],W[3]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O FMY...  03O AR1...  04O AR6...  05O FM0...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0535 IF %HAS_IMAGE_LIB THEN GOSUB 15100 ! SSP 213924 Create temp file for Image Library entries
0620 FIND (Z[13],KEY=X3$(9,3)+"A/R",DOM=9800)P0$
0650 REM "Check Repository parameters
0660 R6$="N"; IF V3$(2,1)<>"T" THEN CALL "ZR2DGP",ERR=0661,X3$,X4$,"SUMBIL_RPT",R6$
0665 IF R6$(1,1)="Y" THEN T9$=X3$(21,6)+X3$(178,6); CALL "ZR2DND",ERR=0666,X3$,X4$,T9$,"",R6$; REM "Signal start of new document, key is ...
0700 REM "Open Printer
0720 REM 
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[2]; U=18,U0=2,U[0]=0,U[1]=10,U[2]=8,T0=1,V1=10,U0$="    ",T5$="AA/R            ",U5$="Customer"; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0880 IF POS(V0$(72,1)="DB")>0 THEN GOTO 8000
0895 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W8$,W9$,W0,W9,W2,W3,W4; ON W4 GOTO 0896,9920
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0931 V9$=V2$
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0960 V2$(1,20)=V9$(1,20)
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000)
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])>=V2$(U3,U[U9]) THEN GOTO 1030 ELSE EXTRACT (U1,KEY=U$(1,U2-1)+V2$(U3,U[U9]),DOM=1021)
1025 EXITTO 1000
1030 IF U$(U2,U[U9])<=V2$(U3+U[U9],U[U9]) THEN GOTO 1040 ELSE READ (U1,KEY=U$(1,U2-1)+$FF$,DOM=1032)
1035 EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1130 READ (U1); READ (Z[1],KEY=U$(1,10)+U$(24,12),DOM=1000)IOL=0310; GOTO 4000
1150 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1152 IF ((V0$(305,6)<>"      " AND A$(23,6)<V0$(305,6)) OR (V0$(311,6)<>"      " AND A$(23,6)>V0$(311,6))) THEN GOTO 1000; REM "SSP128181, open up date ranging for all companies, all summary bill programs, related to WO111944
1160 IF Q5=2 THEN PRINT @(30),U$(1,10),"-",U$(11,8),"-",U$(19,3),; WRITE (Z[2],KEY=A$(1,10)+A$(147,5)+A$(49,8)+A$(11,12)); GOTO 1000
1165 IF Q5=1 THEN PRINT @(25,21),U$,; REMOVE (Z[1],KEY=U$,DOM=1000); IF U$(1,18)=C1$ THEN GOTO 1000 ELSE GOSUB 5500; GOTO 1000
1170 IF A$(29,1)<>"Y" AND V0$(73,1)<>"Y" THEN GOTO 1000
1200 REM "check range
1210 IF C1$<>A$(1,10) THEN GOSUB 2000
1220 IF C2$<>A$(11,8) THEN GOSUB 2100
1300 REM "Read other data
1400 REM "Subtotals"
1415 REM GOSUB 03100
1420 ON T GOTO 1470,1430,1440,1450,1460
1450 GOSUB 6200
1490 T=0
1500 REM "Lines
1510 IF W+4>W0 THEN GOSUB 6000
1520 Q=A[1]; IF A$(73,1)<>"M" AND Q<>0 THEN CALL "FM2EXT",Z[13],2,A$(138,4),A[0],Q,0,0,0
1530 CALL "ZZDISP","AX",A$(74,20),"I/C",X3$,X$,"",0,0,X4$
1550 IF Q<>0 THEN Y5$(3)=FNQ$(Q,Z0$)
1555 IF A$(73,1)<>"M" THEN Y5$(18)=A$(147,1)+" "+A$(148,4)
1560 Y5$(29)=X$+" "+A$(94,40)
1570 IF A[2]<>0 AND A[3]<>0 THEN Y5$(80)=STR(A[2]:Z2$)
1580 Y5$(94,4)=A$(138,4)
1585 IF A$(73,1)="C" AND A$(134,1)="9" THEN Y5$(105)="(Req)"; IF A[3]<>0 THEN Y5$(98)="<*BILLED CUST OWNED*"; FLAG=1; GOTO 1592 ! SSP#234752
1590 IF A[3]<>0 THEN Y5$(98)=STR(A[3]:Z2$)
1595 IF A$(152,1)="Y" THEN Y5$(98+LEN(Z2$))="*"
1600 A2[0]=A2[0]+A[5],A2[1]=A2[1]+A[6],A2[2]=A2[2]+A[3]
1620 GOSUB 7300
1640 X$=""; IF POS(" "<>A$(153,9))>0 AND A$(73,1)<>"M" THEN X$="Starting#: "+FNR$(A$(153,9))+"  "
1650 IF POS(" "<>A$(162,9))>0 THEN X$=X$+"Ending#: "+FNR$(A$(162,9))
1660 IF POS(" "<>X$)>0 THEN Y5$(40)=X$; GOSUB 7300
1900 REM "Accumulate Totals"
1990 T[T0,0]=T[T0,0]+1
1992 T[T0,1]=T[T0,1]+A[1],T[T0,2]=T[T0,2]+A[3],T[T0,3]=T[T0,3]+A[4]
1995 GOTO 1000
2000 REM "Customer Change
2005 ITYPE$="AC" ! SSP 213924 sET I/L Type for Summary Bill
2010 IF C1$="" THEN GOTO 2050
2020 T1$="END"; GOSUB 2100; T1$=""
2030 IF W+3>W0 THEN GOSUB 6000
2035 GOSUB 7300; Y5$(6)="When paying, please reference Summary Bill#: "+V0$(73,8),Y5$(77)="SUMMARY BILL TOTAL:",Y5$(98)=STR(A3[0]+A3[1]+A3[2]:Z2$); GOSUB 7300
2045 IF T0$="END" THEN RETURN 
2050 C1$=A$(1,10),SUMM_CUST$=A$(1,10) ! SSP#258564  
2055 IF P0$(15,1)="Y" THEN READ (Z[3],KEY=A$(1,10))IOL=0330; IF POS(" "<>C$(46,10))<>0 THEN SUMM_CUST$=C$(46,10); GOTO 2060 ! SSP#258564                 
2060 DIM C$(LEN(C$)); FIND (Z[3],DOM=2061,KEY=C1$)IOL=0330
2070 W0$=FNS$(C$(11,35))
2075 GOSUB PUT_IN_IMAGE_LIBRARY ! ssp 213924
2080 GOSUB 6000; GOSUB 6300
2082 IF %HAS_IMAGE_LIB THEN MNEMONIC (%IL_PDF)'F_'="" ! SSP 213924
2085 DIM A3[2]
2090 RETURN 
2100 REM "Invoice Number Change
2110 IF C2$="" THEN GOTO 2180
2130 IF A2[0]<>0 THEN Y5$(88)="Freight:",Y5$(98)=STR(A2[0]:Z2$); GOSUB 7300
2140 IF A2[1]<>0 THEN Y5$(86)="Sales Tax:",Y5$(98)=STR(A2[1]:Z2$); GOSUB 7300
2150 Y5$(82)="Invoice Total:",Y5$(98)=STR(A2[0]+A2[1]+A2[2]:Z2$); GOSUB 7300; GOSUB 7300
2152 FOR I=0 TO 2; A3[I]=A3[I]+A2[I]; NEXT I
2155 IF T0$="END" THEN RETURN 
2160 IF T1$<>"END" THEN GOSUB 6300
2180 C2$=A$(11,8); DIM A2[2]
2190 RETURN 
3000 REM "Subtotaling Routines"
3050 REM "Add to T$ for total title, T & T5 should be set
3055 T7$=T5$(T*4-3,4)
3060 IF T7$(1,1)=" " THEN RETURN 
3070 IF T7$(1,1)<>"S" THEN CALL "ZZDISP",T7$(1,1)+"X",T6$,T7$(2,3),X3$,T6$,"",0,0,X4$
3080 IF T$="" THEN T$=T6$ ELSE T$=T$+" "+T6$
3090 RETURN 
3100 REM "High order break"
3101 RETURN 
3110 IF V1=0 THEN RETURN ELSE IF U1$=U9$(1,V1) THEN GOSUB 3200; RETURN 
3120 GOSUB 3220
3130 IF U1$="" THEN GOTO 3160
3150 T=1,T$=U5$,T6$=U1$; GOSUB 3050; GOSUB 7000
3155 IF U0$(1,1)="Y" THEN GOSUB 6000
3160 U1$=U9$(1,V1)
3180 RETURN 
3280 RETURN 
3380 RETURN 
3480 RETURN 
4000 REM "Shipment Detail by Location Version
4010 IF A$(73,1)="M" THEN GOTO 1000
4020 IF C1$<>A$(1,10) THEN GOSUB 4800
4030 IF C2$<>A$(1,10)+A$(147,5) THEN GOSUB 4900
4040 IF W+4>W0 THEN GOSUB 6000
4045 IF C3$<>A$(1,10)+A$(49,8) THEN CALL "ZZDISP","AX",A$(49,8),"O/P",X3$,X$,"",0,0,X4$; Y5$(1)=X$; C3$=A$(1,10)+A$(49,8)
4050 CALL "ZZDISP","AX",A$(11,8),"AR6",X3$,X$,"",0,0,X4$; Y5$(11)=X$
4060 Q=A[1]; IF Q<>0 THEN CALL "FM2EXT",Z[13],2,A$(138,4),A[0],Q,0,0,0
4070 IF Q<>0 THEN Y5$(21)=FNQ$(Q,Z0$)
4080 CALL "ZZDISP","AX",A$(74,20),"I/C",X3$,X$,"",0,0,X4$
4100 Y5$(35)=X$+" "+A$(94,40)
4104 REM "Req value is in A(4)
4105 IF A$(73,1)="C" AND A$(134,1)="9" THEN Y5$(109)="(Req)"; GOTO 4120
4110 IF A[2]<>0 THEN Y5$(86)=STR(A[2]:Z3$)
4115 Y5$(102)=STR(A[3]:Z3$); IF A$(152,1)="Y" THEN Y5$(113)="*"
4120 Y5$(97,4)=A$(138,4)
4140 Y5$(114)=STR(A[5]:Z4$),Y5$(123)=STR(A[6]:Z4$)
4150 IF A$(73,1)="C" AND A$(134,1)="9" AND A[3]<>0 THEN Y5$(102)="<*BILLED CUST OWNED "; FLAG=1 ! SSP#234752
4170 A2[0]=A2[0]+A[5],A2[1]=A2[1]+A[6],A2[2]=A2[2]+A[3]
4180 GOSUB 7300
4190 GOTO 1000
4800 REM "Customer Change
4805 ITYPE$="AB" ! SSP 213924 Image library type for Detail Shipment by Loc
4810 IF C1$="" THEN GOTO 4850
4820 T1$="END"; GOSUB 4900; T1$=""
4830 IF W+3>W0 THEN GOSUB 6000
4835 GOSUB 7300; Y5$(40)="Customer Totals:",Y5$(83)=STR(A3[0]+A3[1]+A3[2]:Z5$),Y5$(102)=STR(A3[2]:Z3$),Y5$(114)=STR(A3[0]:Z4$),Y5$(123)=STR(A3[1]:Z4$)
4840 GOSUB 7300
4845 IF T0$="END" THEN RETURN 
4850 C1$=A$(1,10),SUMM_CUST$=A$(1,10) ! SSP#258564 
4860 DIM C$(LEN(C$)); FIND (Z[3],DOM=4861,KEY=C1$)IOL=0330; IF P0$(15,1)="Y" AND POS(" "<>C$(46,10))<>0 THEN SUMM_CUST$=C$(46,10) ! SSP#258564           
4870 W0$=FNS$(C$(11,35))
4875 GOSUB PUT_IN_IMAGE_LIBRARY ! ssp 213924
4880 GOSUB 6000
4885 DIM A3[2]
4889 IF %HAS_IMAGE_LIB THEN MNEMONIC (%IL_PDF)'F_'="" ! SSP 213924
4890 RETURN 
4900 REM "Ship-to Location Change
4910 IF C2$="" THEN GOTO 4960
4915 GOSUB 7300; Y5$(20)="Total for "+E1$
4920 Y5$(83)=STR(A2[0]+A2[1]+A2[2]:Z5$),Y5$(102)=STR(A2[2]:Z3$),Y5$(114)=STR(A2[0]:Z4$),Y5$(123)=STR(A2[1]:Z4$)
4925 GOSUB 7300; GOSUB 7300
4930 FOR I=0 TO 2; A3[I]=A3[I]+A2[I]; NEXT I
4935 IF T0$="END" THEN RETURN 
4940 GOSUB 6000
4960 C2$=A$(1,10)+A$(147,5); DIM A2[2]
4970 DIM X$(15); X$(1,1)=C2$(11,1),X$(12,4)=C2$(12,4); IF X$(1,1)="C" THEN X$(2,10)=C2$(1,10)
4975 DIM E$(LEN(E$)); FIND (Z[5],DOM=4976,KEY=X$)IOL=0350; GOTO 4980
4976 IF POS(" "<>X$(12,4))=0 THEN E$(16,132)=C$(11,35)+C$(56)
4980 GOSUB 6400
4990 RETURN 
5000 REM "End of Print
5005 IF Q5=2 THEN GOTO 8100
5010 IF Q5=1 THEN GOSUB 5500; GOTO 9920
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5032 IF V0=2 THEN GOSUB 4800; GOTO 8300
5035 GOSUB 2000; GOTO 5200
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5210 T9=1
5290 GOTO 9900
5300 REM "Purge records
5302 IF FLAG THEN X$="Billing problem detected, no update allowed"; CALL "ZZPROM",".4",X3$,Z,X$,"","",0; GOTO 9920 ! ssp#234752
5310 CALL "ZZPROM","X0AR2RHA",X3$,Z,"","","",0; ON Z GOTO 5311,9920
5317 PRINT @(0,20),'CE',@(23,20),"Now clearing:",
5360 Q5=1,C1$=""; GOTO 0900
5500 REM "Flag Open Invoice Record
5510 IF A$(29,1)<>"Y" THEN GOTO 5580
5520 EXTRACT RECORD (Z[4],KEY=A$(1,18),DOM=5580)X$
5530 X$(160,8)=V0$(73,8)
5540 WRITE RECORD (Z[4])X$
5550 IF %HAS_IMAGE_LIB THEN IMG_INV$=X$(160,8),C1$=A$(1,10); GOSUB UPD_IL_INV_NUM ! SSP 213924 Update I/L with Summary bill ref number
5580 C1$=U$(1,18)
5590 RETURN 
6000 REM "Page header
6035 IF T0$="END" THEN W0$=""
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W9$,W3,W,W9,W8,W0,W5,W2,W8$+"R",R6$; IF T0$="END" THEN GOTO 6060 ELSE ON W5 GOTO 6041,9910
6045 ON W5 GOTO 6046,9900
6060 GOSUB 6100
6070 GOSUB 7300
6090 RETURN 
6100 REM "
6102 IF V0=2 THEN Y5$(91)="Unit",Y5$(116)="Freight",Y5$(126)="Sales"; GOSUB 7300
6105 IF V0=2 THEN Y5$(2)="Order",Y5$(11)="Invoice",Y5$(23)="Quantity",Y5$(35)="Item No.",Y5$(46)="Description",Y5$(91)="Price",Y5$(106)="Amount",Y5$(127)="Tax"; GOTO 6130
6110 Y5$(6)="QUANTITY",Y5$(18)="SHIP TO  ITEM NUMBER     DESCRIPTION",Y5$(82)="UNIT PRICE",Y5$(94)="UNIT",Y5$(104)="AMOUNT"
6130 GOSUB 7300
6199 RETURN 
6200 REM "Break #1 header
6202 IF C1$<>A$(1,10) THEN GOSUB 2000
6210 IF W+4>W0 THEN GOSUB 6000
6215 GOSUB 7300
6299 RETURN 
6300 REM 
6310 Y5$(1)="Invoice No.    Date     Order No    Customer P/O No.   Date Shipped   Shipped Via"
6315 GOSUB 7300
6320 CALL "ZZDISP","AX",A$(11,8),"AR6",X3$,X$,"",0,0,X4$
6330 Y5$(2)=X$,Y5$(13)=FND$(A$(23,6))
6340 CALL "ZZDISP","AX",A$(49,8),"O/P",X3$,X$,"",0,0,X4$
6350 Y5$(25)=X$,Y5$(37)=A$(34,15),Y5$(56)=FND$(A$(171,6)),Y5$(71)=A$(57,15)
6360 GOSUB 7300; GOSUB 7300
6390 RETURN 
6400 REM "Detail shipments
6405 Q$="",X$=FNS$(E$(214,9)); IF X$>"" THEN X$=X$+": ",Q$="("+C2$(11,1)+"-"+C2$(12,4)+")" ELSE X$=C2$(11,1)+"-"+C2$(12,4)
6410 E1$="Location: "+X$+" "
6425 E1$=E1$+FNS$(E$(16,35))+" "+Q$
6430 Y5$(1)=E1$
6435 GOSUB 7300; GOSUB 7300
6440 RETURN 
7000 REM "Totals logic
7001 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7002 IF W+3>W0 THEN GOSUB 6000
7005 Y5$(66)=T1$(1,14),Y5$(80)=T1$(1,12),Y5$(92)=T1$(1,12),Y5$(104)=T1$(1,14),Y5$(119)=T1$(1,14); GOSUB 7300
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=T$+" Total ("+STR(T[T,0]:"0")+"):"
7020 Y5$(66)=STR(T[T,1]:Z0$),Y5$(80)=STR(T[T,2]:Z1$),Y5$(92)=STR(T[T,3]:Z1$),Y5$(104)=STR(T[T,4]:Z0$),Y5$(119)=STR(T[T,5]:Z0$); GOSUB 7300
7065 IF T$="END" THEN Y5$(66)=T2$(1,14),Y5$(80)=T2$(1,12),Y5$(92)=T2$(1,12),Y5$(104)=T2$(1,14),Y5$(119)=T2$(1,14); GOSUB 7300
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)="Number of items printed: "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 IF INT(T2)>0 THEN T4$=STR(INT(T2))+" Hours " ELSE T4$=""
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+STR(T3:"##.##")+" Minutes"
7260 Y5$(1)="Elapsed time: "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7305 IF R6$(1,1)="Y" THEN CALL "ZR2DNL",ERR=7306,X3$,X4$,Y5$,R6$; REM "Send line to the repository is needed.
7310 IF POS("V"=W8$)>0 THEN CALL "ZZVIEW",X3$,0,0,W3,W9,W,W9$,Y5$; GOTO 7390
7320 W=W+1 ! SSP 213924
7325 IF %IL_PDF THEN IF POS(" "<>Y5$)=0 THEN PRINT (%IL_PDF)"" ELSE PRINT (%IL_PDF)Y5$ ! SSP 213924
7330 REM 
7340 IF POS(" "<>Y5$)=0 THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; Y5$(1)=""
7390 IF W>=W0 THEN GOSUB 6000
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"  ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7525 REM "Modified stmts:
7550 REM "Added stmts:
7575 REM "Deleted stmts:
7800 REM "Create M0$ unit of measure string set M0
7810 DIM M$(20); FIND (Z[13],KEY="U/M"+A$(133,4),DOM=7811)IOL=0390
7815 IF M$(20,1)="Y" THEN M0=M[0] ELSE M0=A[3]
7820 IF M0=0 THEN M0=1,M0$=""; GOTO 7840
7830 IF M$(20,1)<>"Y" THEN M0$=FNS$(A$(133,4))+"/"+FNR$(STR(M0:Z3$)) ELSE IF M[0]=0 THEN M0$=FNS$(A$(133,4)) ELSE M0$="",M0=1
7840 RETURN 
8000 REM "Sort by location
8010 Y$="MONTHLY SHIPMENT DETAIL BY LOCATION"
8020 CALL "ZZ2SRT",X3$,X4$,Z[13],Z[1],35,Y$,Z,"YY"
8025 IF Z=2 THEN GOTO 9920
8030 Y$="02O "+Y$
8040 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
8050 IF Z=0 THEN Q5=2,C1$=""; GOTO 0900
8100 REM "Set ups for Detail Shipment version
8110 Q5=0,V0=2,V1$="TMP"+FID(0)
8120 X1$="Shipment Detail by Location - * indicates prorated amount"
8140 GOTO 0881
8300 REM "EOJ for Ship to detail
8310 IF V0$(72,1)<>"B" THEN GOTO 9900
8315 IF POS("V"=W8$)>0 THEN GOSUB 6000
8320 X1$="Summary Bill"
8330 Q5=0,V0=0,V1$="FMY..."
8340 T0$="",T1$="",C1$="",C2$=""
8350 DIM A2[2],A3[2]
8390 GOTO 0900
8915 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$)+POS("         "=Z9$))
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$(1,POS(".00"=STR(Z9:Z9$)+".00")-1))
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF POS("V"=W8$)>0 THEN GOSUB 6000
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 IF V0$(72,1)="B" AND T9=1 AND V3$(2,1)<>"T" THEN GOTO 5300
9920 IF %HAS_IMAGE_LIB THEN GOSUB ADD_IL1 ! SSP 213924 Create Image Library entries
9925 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9927 ERASE "TMP"+FID(0),ERR=*NEXT ! SSP#222785          
9930 IF NOT(NUL(Y4$)) THEN CALL Y4$,ERR=*NEXT ELSE RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
15000 PUT_IN_IMAGE_LIBRARY:! If globals are set, then get correct directory and add to image_library, then clear the globals
15005 IF %HAS_IMAGE_LIB THEN {
15006 IMGKEY$=SUMM_CUST$+C1$ ! SSP 265203
15010 IMG_TYPE$=ITYPE$,IMG_REF$="",IMG_RPT$=IMGKEY$,IL2_CHAN=0; CALL "ILGAUD",ERR=*NEXT,X3$,X4$,IMG_TYPE$,IMG_RPT$ ! SSP 213924!SSP#258564
15015 RNAME$=%IL_FILE_NAME$,%IL_FILE_NAME$="",%PRINT_OPT$="" ! SSP 213924
15020 R1NAME$="",R2NAME$=""; FIND (Z[10],KEY=IMGKEY$,DOM=*NEXT)SUMM_CUST$,R1NAME$,R2NAME$,RINV$ ! SSP#258564 SSP265203
15025 IF ITYPE$="AB" THEN R1NAME$=RNAME$ ELSE R2NAME$=RNAME$
15040 WRITE (Z[10],KEY=IMGKEY$)SUMM_CUST$,R1NAME$,R2NAME$,RINV$ ! SSP#258564!SSP#258564  SSP 265203
15045 MNEMONIC (%IL_PDF)'F_'="Y"
15050  }
15095 RETURN 
15099 ! *************************************************************
15100 REM "CREATE TEMP FILE FOR IMAGE LIBRARY FILE NAMES BY CUSTOMER
15120 Q$="TMI"+FID(0)
15125 ERASE Q$,ERR=*NEXT; GOTO *SAME
15130 IF ERR<>12 THEN GOTO 9000
15140 DIRECT Q$,20,200,200,0,0 ! SSP 265203
15150 Y$="11O IL1...  10O "+Q$; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
15190 RETURN 
15199 ! 
15200 ADD_IL1:! ssp 213924
15210 READ (Z[10],KEY="",DOM=*NEXT)
15220 K$=KEY(Z[10],END=15280); READ (Z[10],KEY=K$)SUMM_CUST$,R1NAME$,R2NAME$,RINV$
15225 IF STP(RINV$,2)<>"" THEN TF_REF_1$="",TF_REF_2$=SUMM_CUST$+RINV$ ! SSP 265203
15240 IF R1NAME$<>"" THEN IF STP(RINV$,2)="" THEN ERASE R1NAME$,ERR=*NEXT ELSE CALL "ILGFUN;ADD_IMAGE",ERR=*NEXT,Z[11],IMG_KEY$,"AB",TF_REF_1$,TF_REF_2$,R1NAME$ ! SSP 213924
15245 IF R2NAME$<>"" THEN IF STP(RINV$,2)="" THEN ERASE R2NAME$,ERR=*NEXT ELSE CALL "ILGFUN;ADD_IMAGE",ERR=*NEXT,Z[11],IMG_KEY$,"AC",TF_REF_1$,TF_REF_2$,R2NAME$ ! SSP 213924
15260 GOTO 15220
15290 RETURN 
15299 ! 
15300 UPD_IL_INV_NUM:! SSP 213924 Update IL temp file with summary bill number
15305 IF %HAS_IMAGE_LIB THEN {
15310 SUMM_CUST$=X$(1,10),ICUST$=X$(1,10); IF STP(MID(X$,26,10),2)<>"" THEN ICUST$=X$(26,10) ! SSP 265203
15315 IKEY$=SUMM_CUST$+ICUST$
15320 FIND (Z[10],KEY=IKEY$,DOM=*NEXT)SUMM_CUST$,R1NAME$,R2NAME$,RINV$ ! 265203
15330 IF STP(IMG_INV$,2)<>"" THEN RINV$=IMG_INV$ ELSE RINV$="" ! "Pending"
15340 WRITE (Z[10],KEY=IKEY$)SUMM_CUST$,R1NAME$,R2NAME$,RINV$ ! SSP#258564 SSP265203
15350  }
15390 RETURN 
56001 REM "222785-Summary bill report leaves orphaned TMP files               
56002 REM "213924-Summary bill in Image Library - isn't automatic archive     
56014 REM "258564-Issue with Summary bill in image library if using alt        bill to
56015 REM "265203-Summary Bill images are not there anymore.                  

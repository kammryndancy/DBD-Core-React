0010 REM "G/L Interface AP Gateway <PA2XAA>
0035 REM "4.4 - 09/14/99 - 10.3 - dmm - SSP# 101028
0040 REM "Copyright 1999 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETERR 9000; SETESC 9300
0110 V0=V9
0112 V7=1
0140 W0$="-###,###.00",W1$="###,###,###.00CR",W9$=W1$; IF V7>0 THEN W9$=W1$(1,LEN(W1$)-2)+"-",W1$=W1$(1,LEN(W1$)-2)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0280 IF D9$="*" THEN GOSUB 7700; GOTO 6525
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0296 DIM Y[5]
0310 IOLIST A,V3$(1),V[0]
0330 IOLIST V4$(1,LEN(V4$))
0410 IF A0=0 AND T9$<>"" THEN CALL "GL2XAB",X3$,T9$,T{ALL},V9$,F,A0; A5=A0
0415 DIM V0$(30),S$(45); V0$(1,LEN(V0$))="* Not on file entry *"
0420 GOSUB 7700
0430 GOSUB 6800
0500 REM "SET-UP
0505 A1=18+V0,A2=1; IF V1=0 THEN A1=A1-2
0510 A3=INT((22-A1)/A2),A4=1,Y9=2,K8=LEN(A1$),Y$=""
0515 GOSUB 7280
0520 DIM X[2],Y[6]
0525 IF A0=0 THEN U1=7,U2=U1,A9$=""; GOSUB 5200; GOTO 0800
0530 IF A0=0 THEN GOTO 0800
0540 GOSUB 5100
0550 L=1; GOTO 6425
0560 X[0]=1
0580 F=Z[2]
0590 GOTO 1125
0800 REM "NEW ENTRY
0805 IF X0$="AR2EAC" AND POS(A$(337,1)="Yy")>0 THEN GOTO 7000
0810 Y$=""
0830 X[0]=1; GOTO 1125
1000 REM 
1045 V3$(1)=K9$+A1$
1100 REM "SELECT LINE
1110 GOTO 7000
1125 A6=0,A4=X[0]
1129 IF A4=0 THEN GOTO 7000
1130 A4=X[0],Y=(A4-1)*Y9+1; IF Y>LEN(Y$) THEN Y=-1,A4=LEN(Y$)/Y9+1,X[0]=A4
1132 PRINT @(5,10+V0),A4:"##0",
1135 IF Y<0 THEN GOTO 1200
1140 A5=DEC(Y$(Y,Y9))
1150 READ (F,IND=A5)IOL=0310
1160 GOSUB 6200
1165 REM "TO AVOID DISPLAY; GOTO 1400 HERE!!!
1170 IF POS(BIN(A4,Y9)=L0$,Y9)>0 THEN GOTO 1400
1175 GOSUB 7300; GOTO 1400
1200 REM "NEW LINE
1210 IF A9<=0 THEN GOSUB 5200 ELSE GOSUB 5200
1220 Y$=Y$+BIN(A9,Y9),A6=1,A5=A9,A=-1,A9=-1,C6=1
1280 GOSUB 6800; GOSUB 6200
1290 GOTO 1400
1310 C0=-C0
1400 REM "MAINTAIN ENTRY
1490 GOTO 2000
1500 REM "OPTIONS (DISPLAY)
1510 C0=ABS(C0)
1520 IF C0=1 THEN GOTO 1125 ELSE GOTO 7000
1580 GOTO 2000
1600 REM "
1800 REM "PRIOR LINE
1810 IF X[0]>1 THEN X[0]=X[0]-1
1820 GOTO 1125
1900 REM "Finished with line
1910 IF G0<0 THEN G9=2; PRINT 'RB',; GOTO 2040
1950 REM "
1955 IF T<>0 OR U=1 THEN GOSUB 6700
1965 IF C0=3.2 THEN X[0]=X[0]-2
1968 IF A7=1 THEN GOSUB 5700
1970 IF C6=1 THEN C0=0,C6=0
1972 REM 
1973 REM 
1975 IF C0=4 AND U<>1 THEN GOTO 7000 ELSE X[0]=X[0]+1; GOTO 1125
2000 REM "DATA SEQ
2010 C0=0,D9=1,G9=-1,X1=1,T=0,U=0,Q$="?"; IF Y<0 OR A7=1 THEN T=-1,G9=0
2020 X$="",C0=ABS(C0); IF C0=2 AND G9=0 THEN G9=999; GOTO 2040 ELSE IF C0=2 THEN G9=G9-1 ELSE G9=G9+1; IF C0=2 AND G9=0 THEN X[0]=X[0]-1; GOTO 1100
2025 IF C0>3 OR G9<0 THEN G9=999
2030 IF G9>0 THEN IF T=0 THEN T=-1; GOSUB 7200
2040 ON G9 GOTO 2050,2100,2150,2450,1900
2050 REM "STATUS
2055 C0=0,Q$="?",X$="MDNPLEIA"
2060 C1=1
2062 IF C1>1 THEN GOTO 5800
2070 IF T=0 THEN T=-1; GOSUB 7200
2090 GOTO 2020
2100 REM "J/E Memo
2105 IF V8=0 THEN GOTO 2020
2110 CALL "ZZENTR","SX",V{ALL},V3$,X4$,X3$,18,10+V0,38,45,C0,"","{3"+X$,"","GL2JAA00","","",""; IF ABS(C0)>4 THEN GOTO 6500
2112 IF ABS(C0)=2 THEN GOTO 2110
2115 IF Y<0 THEN IF U=0 AND C0<0 AND (ABS(C0)=2 OR ABS(C0)=4 OR INT(ABS(C0))=3) THEN C7=1; GOTO 5400
2116 REM 
2140 GOTO 2020
2150 REM "G/L Account
2158 IF V8<>0 THEN U=1
2160 CALL "ZZENTR","AX",V{ALL},V3$,X4$,X3$,5,11+V0,7,12,C0,"G/L","{3"+X$,"","GL2JAA04","GL1","GL2MAA",""; IF ABS(C0)>4 THEN GOTO 6500
2161 IF ABS(C0)=2 THEN IF V8=0 THEN GOTO 2160 ELSE GOTO 2020
2162 IF Y<0 THEN IF U=0 AND C0<0 AND (ABS(C0)=2 OR ABS(C0)=4 OR INT(ABS(C0))=3) THEN C7=1; GOTO 5400
2165 IF C0=-4 AND Y<0 THEN GOTO 5400 ELSE IF ABS(C0)=2 THEN C0=4
2170 G0=-1; FIND (V3,KEY=V3$(7+K9,12),DOM=2171)IOL=0330; G0=1
2172 IF G0<0 THEN PRINT 'RB',; GOTO 2150
2175 IF G0>0 THEN PRINT @(18,11+V0),V4$(13,35), ELSE PRINT @(18,11+V0),V0$,
2190 GOTO 2020
2450 REM "Amount
2452 U=1
2455 X=11+2*SGN(V1)
2458 IF V[0]=0 THEN V[0]=-T[0]
2460 CALL "ZZENTR","ND",V{ALL},V3$,X4$,X3$,63,X+V0,3,922,C0,W9$,"{3"+X$,"","GL2JAA16","","",""; IF ABS(C0)>4 THEN GOTO 6500
2490 GOTO 2020
4900 REM "END OF LINES
4910 Y[4]=-1; WRITE (F,IND=0)IOL=0290
4920 CALL "ZZEXPF",X3$,X4$,"X"+STR(F),"",G9; IF G9>0 THEN GOTO 7000
4925 EXTRACT (F,IND=0)IOL=0290
4930 Z=NUM(FIN(F,"MAXREC")); Y[3]=Z-1
4935 Y[4]=-2; WRITE (F,IND=0)IOL=0290
4940 GOTO 5215
4980 GOTO 7000
5000 REM "LINE LINE Z0 TO LINE Z1
5010 Q=(Z0-1)*Y9+1; IF Q>LEN(Y$) OR Q<1 THEN GOTO 5090 ELSE Z9=DEC(Y$(Q,Y9))
5012 Q=(Z1-1)*Y9+1; IF Q>LEN(Y$) OR Q<1 THEN Z8=-1 ELSE Z8=DEC(Y$(Q,Y9))
5015 READ (F,IND=Z9)IOL=0310
5020 IF Z1>LEN(Y$)/Y9 THEN Z8=-1
5030 IF A<>Z8 THEN A=Z8; WRITE (F,IND=Z9)IOL=0310
5095 RETURN 
5100 REM "BUILD INDEX STRING
5105 Y$="",Y=A0
5120 IF Y<=0 THEN GOTO 5195 ELSE Q$=BIN(Y,Y9); IF POS(Q$=Y$,Y9)=0 THEN Y$=Y$+Q$ ELSE GOTO 5195
5130 READ (F,IND=Y,END=5131)Y; GOTO 5120
5140 IF Y$>"" THEN Y$=Y$(1,LEN(Y$)-Y9)
5195 RETURN 
5200 REM "GET NEXT INDEX TO FILE IN A9
5210 EXTRACT (F,IND=0,ERR=5295)IOL=0290
5212 IF Y[4]=-2 THEN READ (F); GOTO 5270
5215 IF Y[0]>=Y[3] OR Y[2]>=Y[3] THEN GOTO 4900 ELSE Y[4]=-2
5220 WRITE (F,IND=0)IOL=0290
5230 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1 ELSE A9=Y[1]; READ (F,IND=A9)Y[1]
5240 Y[0]=Y[0]+1,Y[4]=-1
5250 WRITE (F,IND=0)IOL=0290
5255 U1=0
5260 RETURN 
5270 LOCK (F,ERR=5210); Y[4]=-1; GOTO 5215
5295 IF ERR<>0 THEN GOTO 9000 ELSE RETRY 
5300 REM "REMOVE INDEX Z
5302 IF POS(BIN(Z,Y9)=A9$,Y9)>0 THEN ESCAPE 
5305 IF U2>0 THEN A9$=BIN(Z,Y9)+A9$; GOTO 5360
5310 EXTRACT (F,IND=0)IOL=0290
5315 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5310 ELSE Y[4]=-2
5320 WRITE (F,IND=0)IOL=0290
5330 WRITE (F,IND=Z)Y[1]
5340 Y[1]=Z,Y[4]=-1,Y[0]=Y[0]-1
5350 WRITE (F,IND=0)IOL=0290
5360 Q0$=BIN(Z,Y9),Q=POS(Q0$=Y$,Y9); IF Q=0 THEN GOTO 5390
5365 Y$=Y$(1,Q-1)+Y$(Q+Y9)
5390 RETURN 
5395 ON ERR GOTO 5310,5311,9000
5400 REM "DELETE CURRENT LINE
5405 Z0=A4-1,Z1=A4+1,A5=DEC(Y$((A4-1)*Y9+1,Y9))
5415 GOSUB 5000; Z=A5
5416 IF Q$="D" THEN READ (F,IND=Z)IOL=0310
5418 IF T=0 OR Q$="D" THEN T=-1; GOSUB 7200
5420 GOSUB 5300
5430 GOSUB 6800
5435 IF ABS(C0)=3.2 THEN C0=2 ELSE IF ABS(C0)=3.1 THEN C0=4
5485 IF C7=1 THEN C7=0,C0=ABS(C0); IF C0=2 THEN X[0]=X[0]-1; D9=0; GOTO 1120 ELSE GOTO 7000
5490 IF Q$="D" THEN GOSUB 5700; GOTO 6100 ELSE GOTO 1125
5495 X[0]=999,D9=0; GOTO 1120
5500 REM "INSERT CURRENT LINE
5510 GOSUB 5200
5515 Y$=Y$(1,Y-1)+BIN(A9,Y9)+Y$(Y),A5=A9,A9=-1
5520 GOSUB 6800
5530 A6=1,X[0]=A4,A7=1
5540 WRITE (F,IND=A5)IOL=0310; Q$="I"; GOSUB 6000; A4=X[0]
5590 GOTO 1160
5600 REM "TACK ON LINE TO END
5610 Z7=A8; IF Z7=0 THEN GOTO 5635
5620 READ (F,IND=Z7)IOL=0310
5625 A=Y[A5],Z8=0
5630 WRITE (F,IND=Z7)IOL=0310
5635 Z8=0
5690 RETURN 
5700 REM "DISPLAY AFTER DELETE/INSERT
5705 IF A7=1 THEN GOSUB 7300; A7=0; GOTO 5750
5710 IF L0$>"" THEN Z=DEC(L0$(1,Y9)); GOSUB 6000
5750 RETURN 
5800 REM "LINE CONTROL
5810 IF T<>0 THEN T=1; GOSUB 7200; T=0
5820 IF C0=2 THEN GOTO 1100
5880 ON POS(Q$="?DNPLEIA") GOTO 2060,2020,5400,1900,1800,6400,7000,5500,5495
5900 REM "Reset reserved links as avail
5910 Z=DEC(A9$(1,Y9)); GOSUB 5310
5915 A9$=A9$(Y9+1); IF A9$>"" THEN GOTO 5910 ELSE RETURN 
6000 REM "DISPLAY PAGE @ LINE Z
6002 IF Z<=0 THEN Z=1
6005 Y0=(Z-1)*Y9+1,L0=0,L1=Z,L0$="",L2=0,L2$=""
6010 PRINT @(0,A1),'CE',
6020 IF Y0>LEN(Y$) THEN Z=Z-1,A4=Z,L0$=""; GOTO 7320 ELSE IF Y0<1 THEN GOTO 6090
6022 IF Q$="I" AND A4=L1 THEN PRINT @(5,L0+A1),'CL',; GOTO 6040
6025 READ (F,IND=DEC(Y$(Y0,Y9)))IOL=0310
6030 GOSUB 6600; GOSUB 6300
6032 DIM V4$(60); V4$(13,30)=V0$
6035 FIND (V3,KEY=V3$(1+K9,12),DOM=6036)IOL=0330
6040 L2$=L2$+CHR(1)+CHR(L0+A1)+CHR(3)+STR(L1:"##0")
6080 L0$=L0$+BIN(L1,Y9),L0=L0+1,L1=L1+1,Y0=Y0+Y9
6085 IF Y0>LEN(Y$) THEN L2=1 ELSE IF L0<A3 THEN GOTO 6022
6090 READ (F,IND=A5)IOL=0310
6095 RETURN 
6100 REM "SELECT LINE ROUTINE
6105 IF Y$="" THEN GOTO 7000 ELSE L1=DEC(L0$(1,Y9)),L2=DEC(L0$(LEN(L0$)-Y9+1,Y9)),X8=A4-L1
6106 C1$="004018012014001"
6110 CALL "ZZSLCT",X3$,"CX",C1$,"",L2$,"{4","",X8,X9,A4; A4=A4+L1,X[0]=A4,X0=A4,Y=(A4-1)*Y9+1; IF X9=-5 THEN Q$="D"; GOSUB 6170; ON S3 GOTO 6111,6110 ELSE IF X9=-4 THEN Q$="I" ELSE IF X9=-3 THEN X9=0 ELSE IF X9=-6 THEN X9=0
6112 IF X9<0 THEN ON -X9 GOTO 6115,6113,7000,6113,5500,5400,6120
6115 IF X9=0 THEN IF A4>=0 AND A4<=L2 THEN G9=A4; GOTO 7100
6120 IF X9<0 THEN A4=L1 ELSE Y=(A4-1)*Y9+1; IF A4>LEN(Y$)/Y9 THEN GOTO 7000
6130 G9=A4
6150 IF X9=1 AND L1=1 THEN X8=0; GOTO 6110 ELSE IF X9=1 THEN Z=DEC(L0$(1,Y9))-1 ELSE Z=LEN(L0$)-Y9+1,Z=DEC(L0$(Z,Y9))+1
6155 Z=INT(Z/A3)*A3; IF Z=0 THEN Z=1
6160 GOSUB 6000
6165 X8=A4-L1+1; GOTO 6105
6170 X$="",X8=A4-L1; CALL "ZZPROM","L2",X3$,0,X$,"","",0; X$=X$+" ( #"+STR(A4)+" )"
6175 CALL "ZZPROM","Y",X3$,S3,X$,"","",0
6180 RETURN 
6200 REM "PRINT ONE ENTRY
6205 PRINT @(5,10+V0),A4:"##0",
6210 GOSUB 6600
6220 IF V8>0 THEN PRINT @(18,10+V0),V3$(38,45),
6240 PRINT @(5,11+V0),-NUM(V3$(7+K9,M2)):W2$,@(18),V4$(13,35),@(63),V[0]:W9$,
6280 REM 
6290 RETURN 
6300 REM "DISPLAY ONE LINE
6304 L0=L0
6305 PRINT @(1,L0+A1),L1:"##0",
6310 X=6
6320 PRINT @(X,L0+A1),-NUM(V3$(1+K9,M2)):W2$,"  ",V4$(13,35),
6340 Q=63; IF V7>0 THEN IF V[0]>0 THEN Q=50
6345 IF V7>0 THEN PRINT @(50,L0+A1),'CL',
6360 PRINT @(Q,L0+A1),V[0]:W1$,
6390 RETURN 
6400 REM "LIST OPTION
6405 L=1
6410 CALL "ZZPROM","L3",X3$,S3,"","","V",X; ON S3 GOTO 6411,7000
6415 IF S3<0 THEN IF (X-1)*Y9+1>LEN(Y$) THEN X=LEN(Y$)/Y9-1 ELSE IF X<=0 THEN X=1
6420 IF S3<0 THEN L=X+1
6425 Z=L-1; GOSUB 6000
6430 IF L2=1 THEN GOTO 7000 ELSE L=L+L0; GOTO 6410
6460 GOTO 6410
6500 REM "RE-DO SCREEN
6505 D9$="*"
6510 GOSUB 6700
6520 L0=3; GOTO 7080
6525 D9$="",Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1; IF C0>4 THEN C0=C0-5
6530 GOSUB 6000; GOSUB 7280; IF D9=0 THEN GOTO 1100
6535 PRINT @(5,10+V0),A4:"##0",
6540 READ (F,IND=A5)IOL=0310
6545 GOSUB 6200
6550 ON C0 GOTO 2040,2020
6600 REM "ALTERNATE DATA READS FOR 1 LINE
6610 G0=-1; FIND (V3,ERR=6611,KEY=V3$(1+K9,12),DOM=6611)IOL=0330; G0=1
6612 G1=1,G2=1
6690 RETURN 
6700 REM "WRITE CURRENT LINE
6705 IF Y+1=LEN(Y$) THEN A=-1 ELSE A=0
6710 IF A=0 THEN A=DEC(Y$(Y+Y9,Y9))
6715 IF D9$<>"*" THEN T=1; GOSUB 7200; T=0
6720 WRITE (F,IND=A5)IOL=0310; Z=A,Q=Y
6725 IF A6<>0 THEN Z0=A4-1,Z1=A4; GOSUB 5000; READ (F,IND=A5)IOL=0310
6760 IF Z<0 THEN A6=1 ELSE A6=0
6779 REM "added to clean up lookup 05/01/87
6780 IF D9$="" THEN IF A7<>1 THEN GOSUB 7300
6790 RETURN 
6800 REM "SET-UP DATA FOR 1 LINE
6810 B1$=B$
6815 G0=-1,G1=-1,G2=-1
6820 DIM V3$(12+45*V8),V[1],V4$(52),V5$(40),V6$(50),H$(34),H[1]
6830 V3$(1,6)=X3$(15,6); IF V9$>"" THEN V3$(1,6)=V9$
6880 GOSUB 6600
6895 RETURN 
6900 REM "SET LAST LINE TO NO LINK
6905 IF Y$="" THEN A0=0; GOTO 6945 ELSE A5=DEC(Y$(LEN(Y$)-1,2)),A0=DEC(Y$(1,Y9))
6910 READ (F,IND=A5)IOL=0310
6940 A=-1; WRITE (F,IND=A5)IOL=0310
6945 RETURN 
6950 IF A5>0 THEN WRITE (F,IND=A5)IOL=0310
6955 PRINT @(5,10+V0),S$(1,3),
6960 IF V8>0 THEN PRINT @(18,10+V0),S$(1,45),
6970 PRINT @(5,11+V0),S$(1,LEN(W2$)),@(18,11+V0),S$(1,35),@(63,11+2*SGN(V1)+V0),'CL',
6990 RETURN 
7000 REM "END OF ENTRIES
7005 GOSUB 6900
7010 Z9=2,Z8=1
7020 GOSUB 6950
7025 IF X0$="AR2EAC" AND POS(A$(337,1)="Yy")>0 THEN A$(337,1)=" ",S3=0; GOTO 7040
7030 IF A$(119,1)<>"Y" THEN CALL "ZZPROM","8",X3$,S3,"","","V",G9 ELSE CALL "ZZPROM","8 PA2XAA",X3$,S3,"","","V",G9
7040 ON S3+1 GOTO 7100,7050,7160,5495,6400,6100
7055 IF T[0]<>0 THEN CALL "ZZPROM","L1",X3$,S3,"","","",0; ON S3 GOTO 7000,7060,7160
7060 L0=1
7070 IF A9$>"" THEN GOSUB 5900
7075 IF Y$>"" THEN A0=DEC(Y$(1,Y9)) ELSE A0=0
7080 RUN X0$
7100 REM "GOTO LINE NUMBER G9
7105 IF G9<=0 THEN G9=1
7110 X[0]=G9; GOTO 1125
7150 REM "Delete option
7160 L0=2; GOTO 7070
7200 REM "TOTAL LOGIC (T= 1 OR -1)
7210 T[0]=T[0]+V[0]*T
7280 REM "PRINT DISTRIBUTION BALANCE"
7282 Q=63; IF V7>0 THEN PRINT @(50,A1-3),'CL',; IF T[0]>0 THEN Q=Q-13
7285 IF T[0]<>0 THEN PRINT @(Q,A1-3),T[0]:W1$, ELSE PRINT @(61,A1-3),'CL',"  In Balance"
7290 RETURN 
7300 REM "Display logic
7310 Q=POS(BIN(A4,Y9)=L0$,Y9),L0=INT(Q/Y9); IF Q>0 THEN GOTO 7400
7311 L0=INT((LEN(L0$)+1)/Y9)
7312 L2$=L2$+CHR(1)+CHR(L0+A1)+CHR(3)+STR(A4:"##0")
7315 IF BIN(A4,Y9)>=L0$ THEN IF LEN(L0$)/Y9<A3 THEN L0$=L0$+BIN(A4,Y9); GOTO 7310
7320 Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1
7330 IF Y$>"" THEN GOSUB 6000
7390 IF X0>0 THEN X0=X0-0
7395 RETURN 
7400 REM "Lines section - display line a4
7410 Q=INT(Q/Y9),L0=Q,L1=A4
7440 GOSUB 6300
7490 RETURN 
7600 REM "CHECK DATE
7620 IF V3$(1,6)>P1$(NUM(A$(5,2))*6+9,6) AND V3$(1,6)<=P1$(NUM(A$(5,2))*6+15,6) THEN RETURN 
7640 X2$="Warning!!! Date is not within accounting period - RETURN to continue"; CALL "ZZPROM",".4",X3$,S3,X2$,"","",0
7699 RETURN 
7700 REM "BACKGROUND
7705 V0=V9
7710 PRINT @(0,10+V0),'CE','SB',
7720 PRINT @(0,10+V0),"Ln#",
7725 IF V8>0 THEN PRINT @(12,10+V0),"Memo:",
7730 PRINT @(0,11+V0),"G/L:",@(56,11+V0),"Amount:",@(0,12+V0),Z0$,
7760 X=2-SGN(V1)*2; PRINT @(42-V7*15,15+V0-X),"Distribution Balance:",@(0,16+V0-X),Z0$,@(0,17+V0-X),"Line",@(6),"G/L Account",
7770 IF V7=0 THEN PRINT @(71),"Amount" ELSE PRINT @(59),"Debit",@(71),"Credit",
7785 PRINT 'SF',
7790 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 6500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9110 GOTO 7000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9505 GOTO 6500
9510 SETERR 9000; GOSUB 6500
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 

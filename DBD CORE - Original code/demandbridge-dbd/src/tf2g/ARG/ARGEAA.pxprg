0010 ! ARGEAA - A/R Invoice Data Entry
0035 REM "5.7 - 10/24/24 - 8.436879 - crg - SSP# 307509
0037 REM "307509-DBD-474: Reset CC invoice for reprocessing                  
0040 REM "Copyright 2024 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 SETERR 0051; ENTER ORDER_NO$; ARG_1$=ORDER_NO$
0060 PROCESS "ARGEAC","../ARG/AR.EN",ARG_1$
0070 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 X0$="AR2EAA",X1$="A/R Invoice Data Entry"
0130 X0=-1,X2=-1
0140 ! 
0150 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
0160 _SV_MSGLIB$=MSG(*); MESSAGE_LIB %FLMAINT_MSG$
0163 IF %REPLACE_FLG THEN %REPLACE_FLG=0; NOAUD_FLG=1; GOSUB CLEAR_SCREEN; GOTO 0180
0165 IF NOT(NUL(X3$(174,4))) AND NOT(NUL(ARG_1$)) THEN GOTO 0175
0170 CALL "ZGBATC",X3$,X4$,X0$,X9; IF X9=1 THEN CMD_STR$="END"; EXIT 
0175 %ARGEAA$=MSG("T_ARGEAC"); IF STP(X3$(174,4))<>"" THEN %ARGEAA$+=" - Batch No: "+X3$(174,4)
0180 ! 
0185 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0187 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1) ! SSP223646 jdf
0190 DIM Z[NUM(X3$(60,3))],ARB[30],AR1[15],AR2[3],AR5[3],AR4[15],ART[48],Y[4],FM1[31],IC0[40],FMP[3],FMP2[0],FS1[13],FS2[29],ARD[4],PO3[3] ! WO 249775
0200 ! Open Files
0205 CALL "ZZ2PRP","EM",RESULT$,TF_DATE$; TP$=""; REM " CHECK TO SEE IF E/M Module is installed SSP 180448
0210 Z$="01X ARB...  02O AR3...  03O AR1...  04O PO3...  05O AR2...  06O ZZPARM  07O AR5...  08O AR4...  09O AR3...  10O FS1...  11O ARC...  12O FMN... 13O FM0...  14O FMP...  15O ASQ...  16O AS5...  17O ART...  18O FM1...  19O IC0...  20O FS2...  21O ARD...  22O GL1...  23O ARV...  24O ASO...  25O ASN...  26O FS3...  27O ICF...  28O ASD...  32O FSV...  " ! SSP211321 jdf
0215 IF RESULT$="Y" THEN Z$=Z$+"30O EM2...  31O EM1...  "; REM SSP 180488
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z0=1 THEN CMD_STR$="END"; GOTO WRAPUP
0225 DIM M6[1]; CALL "IC2PRE",%X3$,Z[6],M6$,M6{ALL},"",0,"",0 ! SSP223646 jdf
0230 ! 
0240 %ARB$=FIN(Z[1],"FILENAME")
0300 ! IOLIST
0310 IOLIST ARB$,ARB{ALL}
0320 IOLIST AR1$,AR1{ALL}
0330 IOLIST AR2$,AR2{ALL}
0340 IOLIST AR5$,AR5{ALL}
0345 IOLIST PO3$,PO3{ALL}
0350 IOLIST AR3$
0360 IOLIST AR4$,AR4{ALL}
0370 IOLIST AS5$
0380 IOLIST FM0$
0390 IOLIST ART9,ART$,ART{ALL}
0395 IOLIST ART9D,ARTD$,ARTD{ALL} ! SSP 273864
0400 IOLIST Y{ALL}
0410 IOLIST IC0$,IC0{ALL}
0420 IOLIST FM1$,FM1{ALL}
0430 IOLIST FMP$,FMP{ALL}
0440 IOLIST FMP2$,FMP{ALL}
0445 IOLIST FMP3$,FMP3{ALL} ! SSP223646 jdf
0450 IOLIST FS1$,FS1{ALL}
0460 IOLIST FS2$,FS2{ALL}
0465 IOLIST FS3$,FS3{ALL}
0467 IOLIST FSV$ ! SSP211321 jdf
0470 IOLIST ARD{ALL}
0472 IOLIST CUR$,CUR{ALL}
0474 IOLIST ASN$,ASN0,ASN1 ! SSP 191739
0475 ! 
0480 GOSUB GET_PARAM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF NOT(NUL(ARG_1$)) AND POS(SEP=ARG_1$)<>0 THEN {
0525 %NOT_NUL_ARG_1=1
0530 CR_FY$=ARG_1$(1,POS(SEP=ARG_1$)-1); ARG_1$=ARG_1$(POS(SEP=ARG_1$)+1)
0540 CR_ACCTPD$=ARG_1$(1,POS(SEP=ARG_1$)-1); ARG_1$=ARG_1$(POS(SEP=ARG_1$)+1)
0550 INV_NUMBER$=ARG_1$(1,POS(SEP=ARG_1$)-1); ARG_1$=ARG_1$(POS(SEP=ARG_1$)+1)
0560 ORDER$=ARG_1$(1,POS(SEP=ARG_1$)-1); ARG_1$=ARG_1$(POS(SEP=ARG_1$)+1)
0570 INV_DATE$=ARG_1$(1,POS(SEP=ARG_1$)-1); ARG_1$=ARG_1$(POS(SEP=ARG_1$)+1)
0580 AP_INV_NUM$=ARG_1$ }
0670 GOSUB LOAD_FY
0673 FRT_BILLED=0; FRT_AMT=0
0674 CR_FY$=CUR_FY$; GOSUB CHK_CLOSED_FY ! SSP231224 jdf
0675 IF POS(P1$(99,1)="CR")<>0 THEN NEXT_ID=CR_FY.CTL ELSE NEXT_ID=INV_NUM.CTL ! SSP231224 jdf
0680 REFRESH_FLG=1
0690 IF MID(FMM$,257,1)="Y" THEN CALL "*WINGRP;ENABLE",SUMM.GRP$ ELSE CALL "*WINGRP;DISABLE",SUMM.GRP$
0700 IF ARS$(118,1)="Y" THEN CALL "*WINGRP;SHOW",CURR.GRP$ ELSE CALL "*WINGRP;HIDE",CURR.GRP$
0705 IF RESULT$="Y" THEN CALL "*WINGRP;SHOW",TP.GRP$ ELSE CALL "*WINGRP;HIDE",TP.GRP$; REM " SSP 180448
0710 IF GB$<>"" THEN CALL "*WINGRP;SHOW",REB.GRP$ ELSE CALL "*WINGRP;HIDE",REB.GRP$
0720 IF NOAUD_FLG THEN NOAUD_FLG=0 ELSE GOSUB CHECK_AUDIT
0780 CALL "*WINGRP;ENABLE",EXIT_ONLY.GRP$
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0911 IF NOT(NUL(_SV_MSGLIB$)) THEN MESSAGE_LIB _SV_MSGLIB$
0913 IF %REPLACE_FLG THEN GOTO 0920
0915 IF REPLACEMENT_SCRN$<>"" THEN EXIT ! if replacement screen set we are just exiting the panel, not the program
0920 READ (Z[1],END=*NEXT) ! DO i/o to release lock in ARB 
0930 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0940 FS1$="" ! SSP221139 jdf
0970 RETURN 
1000 ! Find Records
1010 FIND_REC:
1015 DIM ARB$(690),B_ARB$(690),ARB[32],B_ARB[32]; A9=0,D9$="" ! A9 is link to lines
1020 P_HOLD$=" "; READ (Z[1],KEY=KEY_1$,DOM=NEW_REC_MSG)IOL=0310 ! SSP 190311
1025 CURRENCY$="",CURR_AMT=0; FIND (Z[24],KEY=CR_FY$+CR_ACCTPD$+INV_NUM$,DOM=*NEXT)IOL=0472; PRC2=PRC; PRECISION 4; CURR_AMT=CUR(0),CURRENCY$=CUR$(15,3); PRECISION PRC2 ! SSP 191739 SSP297121
1030 ORDER$=ARB$(92,8),FOB_PT$=ARB$(179,1); CUSTOMER$=ARB$(15,10); CONTRACT$=ARB$(421,20),CONTRACT_DATE$=ARB$(441,6); GOSUB GET_CUST_INFO ! SSP#258443!Moved as root tma 10/2/2012
1035 B_ARB$=ARB$; FOR ZZ=0 TO 32; B_ARB[ZZ]=ARB[ZZ]; NEXT ZZ
1037 IF MID(ARPARM3$,10,1)="Y" THEN IF NOT(NUL(ORDER$)) THEN FIND (Z[12],KEY=ORDER$,DOM=*NEXT); %FL_DIS=1; CALL "FMGNPA",ORDER$; %FL_DIS=0 ! WO259596
1040 GOSUB LOAD_INV_HEAD_INFO
1050 ORD_FLG=0; IF NUL(ORDER$) THEN {
1060 ORD_FLG=0
1070  } ELSE {
1080 ORD_FLG=1
1090 READ (Z[10],KEY=KEY_10$,DOM=1170)IOL=0450
1100 ORD_AMT=FS1[6]; ORD_COST=FS1[7]
1110  }
1170 CALL "*wingrp;Enable",FIELD_1.GRP$; CALL "*WINGRP;SHOW",BUTTONS.GRP$
1172 IF MID(OP_SEC$,65,1)<>"Y" THEN CALL "*WINGRP;ENABLE",TERMS.GRP$ ELSE CALL "*WINGRP;DISABLE",TERMS.GRP$
1175 IF P2$(7,1)="Y" THEN CALL "*WINGRP;ENABLE",COMM.GRP$ ELSE CALL "*WINGRP;DISABLE",COMM.GRP$
1180 REFRESH_FLG=1
1185 IF STP(ORDER$)<>"" THEN DISABLE CONTROL ORDER.CTL; DISABLE CONTROL ORDER.CTL+3000 ! SSP 215793
1187 IF MID(FMM$,257,1)="Y" THEN CALL "*WINGRP;ENABLE",SUMM.GRP$ ELSE CALL "*WINGRP;DISABLE",SUMM.GRP$ ! SSP 218091
1188 IF %MSLC THEN CALL "*wingrp;disable",MCOMM.GRP$ ! ssp 225300
1190 RETURN 
1500 ! Add new Invoice
1510 ADD_NEW_INV:
1515 IF NUL(CUSTOMER$) THEN RETURN 
1520 INV_DATE$=%X3_TODAY$; SHIP_DATE$=%X3_TODAY$
1530 INV_TYPE$="I"
1540 DIM AR2$(100); READ (Z[5],KEY=AR1$(359,2),DOM=*NEXT)IOL=0330 ! 198785!SSP#233762
1545 IF AR2$(57,1)="Y" THEN CALL "*WINGRP;ENABLE",CC_INV.GRP$; REFRESH_FLG=1; REM SSP 192616
1550 DIM AR5$(37); READ (Z[7],KEY=AR1$(235,10),DOM=*NEXT)IOL=0340
1560 DIM AR3$(244); FIND (Z[9],KEY=AR1$(278,4),DOM=*NEXT)IOL=0350
1570 FIND (Z[8],KEY=AR3$(219,5),DOM=*NEXT)IOL=0360
1700 GOSUB LOAD_CUST_INFO
1720 CALL "*WINGRP;ENABLE",FIELD_1.GRP$
1725 IF MID(OP_SEC$,65,1)<>"Y" THEN CALL "*WINGRP;ENABLE",TERMS.GRP$ ELSE CALL "*WINGRP;DISABLE",TERMS.GRP$; REM "SSP#206714
1730 IF P2$(7,1)="Y" THEN CALL "*WINGRP;ENABLE",COMM.GRP$ ELSE CALL "*WINGRP;DISABLE",COMM.GRP$; REM "SSP#206714
1790 RETURN 
1800 ! Check Customer A/R Balance
1810 CHECK_INV_BAL:
1815 NEXT_ID=LOC_CODE.CTL
1820 IF AR1[10]+AR1[11]+AR1[12]<=0 THEN CALL "*WINGRP;SHOW",BUTTONS.GRP$; RETURN 
1830 MSGBOX MSG("AR_BAL_60"),MSG("FYI"),"!"
1840 CALL "*wingrp;Show",BUTTON_1.GRP$; CALL "*wingrp;Disable",FIELDS.GRP$
1845 CALL "*wingrp;Disable",TERMS.GRP$; CALL "*wingrp;Disable",COMM.GRP$; REM "SSP#206714
1850 NEXT_ID=BTN_CONT.CTL
1880 REFRESH_FLG=1
1890 RETURN 
1900 ! Invoice button....
1910 INV_BUTTON:
1920 INV_NUM$="A"
1930 GOSUB INVOICE_ENTRY
1940 GOSUB FIND_REC
1950 CALL "*wingrp;enable",CUST.GRP$; CALL "*WINGRP;DISABLE",INV_BTN.GRP$; CALL "*WINGRP;ENABLE",ORD_NO.GRP$; CALL "*wingrp;Disable",EXIT_ONLY.GRP$
1980 REFRESH_FLG=1
1990 RETURN 
2000 ! Invoice Entry
2010 INVOICE_ENTRY:
2020 IF STP(INV_NUM$)="A" THEN {
2025 DIM KEY_1$(14)
2030 KEY_1$(1,6)=CR_FY$+CR_ACCTPD$,KEY_1$(7,7)="A      "
2040 GOSUB GET_NEXT_INV_NUM
2050 INV_NUM$=KEY_1$(7,7)+" ",INV_NUM.CTL'VALUE$=INV_NUM$
2060  } ELSE {
2070 INV_NUM$=PAD(INV_NUM$,8),INV_NUM.CTL'VALUE$=INV_NUM$ }
2075 INV_EXTRA$=INV_NUM$(8,1)
2080 INV_NUM=NUM(INV_NUM$(1,%AR6_LEN),ERR=*NEXT),INV_NUM$=STR(INV_NUM:DIM(%AR6_LEN,"0")); INV_NUM$+=INV_EXTRA$; KEY_1$=CR_FY$+CR_ACCTPD$+INV_NUM$; IF %AR6_SUB_LEN THEN INV_NUM$=PAD(INV_NUM$,8); REFRESH_FLG=1; RETURN 
2090 MSGBOX MSG("INVALID")+SEP+MSG("AR_INV_NUM"),MSG("ATTN"),"!"; INV_NUM$=""; NEXT_ID=INV_NUM.CTL
2190 RETURN 
2200 ! Get the next invoice Number
2210 GET_NEXT_INV_NUM:
2220 EXTRACT RECORD (Z[6],KEY=%C$+"A/R",DOM=AR_PARM_ERR)AR_PARM$
2230 KEY_1$(7,7)=AR_PARM$(89,7)
2240 IN0=NUM(AR_PARM$(89,7)),IN0+=1; IF IN0>9999999 THEN IN0=1
2250 AR_PARM$(89,7)=STR(IN0:"0000000"); WRITE RECORD (Z[6],KEY=%C$+"A/R")AR_PARM$
2260 AR_PARM$=AR_PARM$(1,POS(SEP=AR_PARM$+SEP)-1)
2265 INV_NUM.CTL'VALUE$=KEY_1$(7,7)
2270 FIND (Z[1],KEY=KEY_1$,DOM=*NEXT); GOTO 2220
2290 RETURN 
2300 ! Assign Invoice....
2310 GET_INV_NUM:
2320 IF _EOM$=$09$ OR (_EOM$=$00$ AND QRY_VAL$<>"") THEN {
2330 PERFORM "ARGEAA;INVOICE_ENTRY"
2340 PERFORM "ARGEAA;Find_rec"
2345 GOSUB TAX_CODE; REM SSP 219276
2350 CALL "*wingrp;enable",CUST.GRP$; CALL "*WINGRP;DISABLE",INV_BTN.GRP$; CALL "*WINGRP;ENABLE",ORD_NO.GRP$; CALL "*WINGRP;DISABLE",EXIT_ONLY.GRP$
2360  }
2380 REFRESH_FLG=1
2385 IF STP(ORDER$)<>"" THEN DISABLE CONTROL ORDER.CTL; DISABLE CONTROL ORDER.CTL+3000; SHOW CONTROL AUTO_BILL.CTL ! SSP 215793  ! SSP240353 jdf
2390 RETURN 
2400 CC_CHANGE:
2420 DIM AR2$(100); READ (Z[5],KEY=TERMS_CODE$,DOM=*NEXT)IOL=0330 ! 198785
2421 IF MID(AR2$,57,1)<>"Y" AND ID$<>"TERMS_CODE" THEN MSGBOX MSG("NO_CC")
2422 IF MID(AR2$,57,1)<>"Y" THEN GOTO 2499
2423 IF ORDER$="" THEN MSGBOX MSG("NO_EDD")
2425 IF ORDER$="" THEN GOTO 2499
2427 IF ARB$(420,1)="Z" THEN MSGBOX MSG("CLR_CCINV"),MSG("CONFIRM"),"?,YESNO",ANS$; IF ANS$="YES" THEN ARB$(420,1)="P"
2430 %SAVE_TERMS_CODE$=TERMS_CODE$,%SAVE_CC_INFO$=MID(AR2$,71,1) ! SSP 225020
2450 IF FN%HAS_MODULE("CV") THEN PROCESS "CVGMAD","../CVG/CV.EN",ORDER$,INV_NUM$ ELSE PROCESS "ECGMAD","../ECG/EC.EN",ORDER$,INV_NUM$ ! SSP 229993
2499 RETURN 
2900 ! AR Parm Error
2910 AR_PARM_ERR:
2920 MSGBOX MSG("AR_PRM_NF"),MSG("ATTN"),"!"
2930 CMD_STR$="END"
2990 RETURN 
3000 ! get customer information
3010 GET_CUST_INFO:
3015 IF NUL(CUSTOMER$) THEN NEXT_ID=CUSTOMER.CTL; RETURN 
3020 KEY_3$=CUSTOMER$
3024 FSV$=""; FIND (Z[32],KEY=ORDER$,DOM=*NEXT)IOL=0467 ! SSP211321 jdf!SSP#269312
3030 READ (Z[3],KEY=KEY_3$,DOM=*RETURN)IOL=0320
3040 CUST_NAME$=AR1$(11,35)
3046 TAX_EXEMPT$=AR1$(245,1); REM SSP 187780 LMS
3050 IF STP(MID(FSV$,54,87))<>"" AND MID(P2$,64,1)="Y" THEN CUST_NAME$=FSV$(19,35),CUST_ADDR_1$=FSV$(54,30); CUST_ADDR_2$=FSV$(84,30) ELSE CUST_ADDR_1$=AR1$(56,30); CUST_ADDR_2$=AR1$(86,30) ! SSP211321 jdf!SSP#269037
3060 IF STP(MID(FSV$,54,87))<>"" AND MID(P2$,64,1)="Y" THEN CUST_CITY$=FSV$(114,16); CUST_ST$=FSV$(130,2); CUST_ZIP_CODE$=FSV$(132,9) ELSE CUST_CITY$=AR1$(116,16); CUST_ST$=AR1$(132,2); CUST_ZIP_CODE$=AR1$(134,9) ! SSP211321 jdf
3070 LOC_DESC$=AR1$(11,35)
3080 LOC_ADDR_1$=AR1$(56,30); LOC_ADDR_2$=AR1$(86,30)
3090 LOC_CITY$=AR1$(116,16); LOC_ST$=AR1$(132,2); LOC_ZIP_CODE$=AR1$(134,9)
3100 CUST_CATEGORY$=AR1$(220,9)
3110 ! PRINT_INV$="Y" ! set print flag to yes for now
3130 %CUSTOMER$=CUSTOMER$; %LOC_TYPE$="C"
3150 DIM FMP_CUST$(300); CURRENCY$=DIM(3); READ (Z[14],KEY="D"+CUSTOMER$,DOM=*NEXT)FMP_CUST$; CURRENCY$=FMP_CUST$(90,3) ! SSP 191739, SSP 195783
3152 ASN0=0,CURR_AMT=0; GOSUB GET_CURR ! SSP 195783
3160 IF POS("Y"=FMP_CUST$(117,4),1)<>0 THEN SUMMARY_BILL$="Y" ELSE SUMMARY_BILL$="N" ! CALL "*wingrp;Enable",SUMM.GRP$ ELSE CALL "*wingrp;Disable",SUMM.GRP$
3170 IF %MSLC THEN SHOW CONTROL BT_COMM.CTL; ENABLE CONTROL BT_COMM.CTL; HIDE CONTROL COMM_CODE.CTL; ID=COMM_CODE.CTL; HIDE CONTROL ID+3000; HIDE CONTROL %SIC_DESC.CTL ! SP  225300
3180 REFRESH_FLG=1
3190 RETURN 
3200 ! load information...
3210 LOAD_CUST_INFO:
3220 TERMS_CODE$=AR1$(359,2)
3230 STAX_CODE$=AR1$(235,10); ST_PERCENT=AR5[0]+AR5[2]+AR5[3]
3235 LOC_TAX_CODE$=STAX_CODE$; REM SSP 187766 LMS
3240 SPER_CODE$=AR1$(278,4); COMM_AMT_1=AR1[0]
3250 SPER_CODE_2$=AR1$(282,4); COMM_AMT_2=AR1[1]
3260 SPER_CODE_3$=AR1$(286,4); COMM_AMT_3=AR1[2]
3270 SPER_CODE_4$=AR1$(290,4); COMM_AMT_4=AR1[3]
3280 SPER_CODE_5$=AR1$(294,4); COMM_AMT_5=AR1[4]
3290 IF MID(P2$,68,1)="Y" THEN COMM_CODE$=AR1$(262,5),COMM_CODE1$=AR1$(262,5) ELSE COMM_CODE$=MID(AR3$,219,5),COMM_CODE1$=COMM_CODE$ ! SSP  199976
3295 IF NUL(COMM_CODE$) THEN COMM_CODE$=AR3$(219,5),COMM_CODE1$=COMM_CODE$ ! SSP 199976
3298 IF %MSLC THEN DTC=0; GOSUB MULTI_COMM_KEY; GOSUB MULTI_COMM_SETUP; CALL "ARGSCM;DEFAULT_HEADER_SETUP",SC_TYPE$,SC_KEY1$,SC_KEY2$,SC_LINE$,MCCDE${ALL},MCSPLT{ALL},MCOMM${ALL},CUSTOMER$,INV_DATE$,X3$(174,5),X3$(21,6) ! SSP 225300   
3300 GOSUB GET_SUMM_BILL ! SUMMARY_BILL$="N" ! Change when incorporate Orders
3305 IF RESULT$="Y" THEN GOSUB GET_TP ! REM " SSP 180448
3380 REFRESH_FLG=1
3390 RETURN 
3500 ! Get the Location for the Customer
3510 GET_CUST_LOC:
3513 IF NUL(LOC_CODE$) THEN IF _EOM$<>$09$ THEN RETURN ELSE NEXT_ID=CUST_PO.CTL; RETURN 
3515 IF STP(LOC_CODE$)="M" THEN CALL "*wingrp;enable",LOC_1.GRP$; GOSUB CLEAR_LOC_FIELDS; NEXT_ID=LOC_DESC.CTL; EXIT ! SSP 220840     
3518 XX=NUM(LOC_CODE$,ERR=*NEXT),LOC_CODE$=STR(XX:"0000"); GOTO 3520 ! SSP 188176 LOC_CODE$=PAD(LOC_CODE$,4,0,"0")
3519 LOC_CODE$=PAD(LOC_CODE$,4," ") ! SSP 188176
3520 KEY_13$="C"+CUSTOMER$+LOC_CODE$
3530 FIND (Z[13],KEY=KEY_13$,DOM=NO_LOC_CODE)IOL=0380; REM SSP 219276
3540 LOC_DESC$=FM0$(16,35)
3545 LOC_EXEMPT$=FM0$(283,1); REM SSP 187704
3550 LOC_ADDR_1$=FM0$(51,30); LOC_ADDR_2$=FM0$(81,30)
3560 LOC_CITY$=FM0$(111,16); LOC_ST$=FM0$(127,2)
3570 LOC_ZIP_CODE$=FM0$(129,9)
3571 LOC_TAX_CODE$=FM0$(224,10); IF LOC_TAX_CODE$<>"" THEN STAX_CODE$=LOC_TAX_CODE$; REM " SSP 187780
3572 EXEMPT_FM0$=MID(FM0$,283,1); REM "SHIP TO TAX EXEMPT FLAG;REM TEST TEST
3573 IF EXEMPT_FM0$="Y" THEN TAXABLE_FM0$="N" ELSE TAXABLE_FM0$="Y"; REM TAXABLE FROM SHIP TO CONVERTED FROM EXEMPT
3574 REM "IF AR1$(245,1)="N" THEN TAXABLE$=TAXABLE_FM0$ ELSE IF AR1$(245,1)="Y" THEN TAXABLE$="N"; REM SSP 187780 LMS
3575 SHIP_VIA_CODE$=FM0$(305,1); %SHIP_VIA_DESC$=FM0$(306,15)
3580 REFRESH_FLG=1; NEXT_ID=CUST_PO.CTL
3582 ARB$(187,4)=LOC_CODE$,ARB$(191,30)=LOC_ADDR_1$,ARB$(221,30)=LOC_ADDR_2$,ARB$(251,16)=LOC_CITY$,ARB$(267,2)=LOC_ST$,ARB$(269,9)=LOC_ZIP_CODE$,ARB$(186,1)=SHIP_VIA_CODE$
3583 IF EXEMPT_FM0$<>" " THEN ARB$(115,1)=EXEMPT_FM0$ ELSE ARB$(115,1)=AR1$(245,1) ! SSP 187704 ! IF AR1$(245,1)="Y" THEN ARB$(115,1)="Y" ELSE ARB$(115,1)=EXEMPT_FM0$; REM SSP 187704
3584 TAX_EXEMPT$=ARB$(115,1); REM SSP 187704
3590 RETURN 
3592 NO_LOC_CODE: NEXT_ID=LOC_CODE.CTL,LOC_CODE$=""; MSGBOX "Ship to code is Invalid"; ; EXIT ; REM SSP 219276       
3600 ! GET SUMMARY FOR ORDER COMMING FROM P/O RECEIVING
3610 GET_SUMM_BILL_ORD:
3615 SUMMARY_BILL$="N"; PRINT_INV$="Y"; Z=0
3620 IF LEN(FS1$)>=197 THEN SAMP_REB$=FS1$(197,1)
3625 DIM XX$(171); FIND (Z[14],KEY="D"+CUSTOMER$,DOM=*RETURN)XX$
3630 IF FS1$(47,1)="R" THEN Z=POS("R"=XX$(113,4)); ORD_TYPE$="R"
3640 IF FS1$(47,1)="W" THEN Z=POS("W"=XX$(113,4)); ORD_TYPE$="W"
3650 IF FS1$(47,1)=" " THEN Z=POS("I"=XX$(113,4)); ORD_TYPE$="I"
3660 IF Z>0 THEN PRINT_INV$=XX$(117+Z-1,1); SUMMARY_BILL$="Y"
3690 RETURN 
3700 ! Get the Distribution Location
3710 GET_DIST_LOC:
3715 IF NUL(INV_LOC_CODE$) OR STP(INV_LOC_CODE$)="DS" THEN NEXT_ID=INV_LOC_CODE.CTL; RETURN ; REM "SSP#202185
3720 KEY_13$="D"+"          "+INV_LOC_CODE$
3730 FIND (Z[13],KEY=KEY_13$,DOM=INVALID_LOC)IOL=0380
3740 LOC_DESC2$=STP(FM0$(111,16))+", "+FM0$(127,2)
3750 NEXT_ID=QTY_ORDERED.CTL
3770 IF INV_LOC_CODE$(1,1)="9" THEN CALL "*wingrp;Disable",ZERO_C.GRP$; UNIT_SELL_PRICE=0; UNIT_COST=0; SELL_PRICE_EXT=0; COST_EXT=0
3780 REFRESH_FLG=1
3790 RETURN 
3800 ! Invalid Location Message
3810 INVALID_LOC:
3820 MSGBOX MSG("INVA_LOC"),MSG("INFO"),"!"
3830 INV_LOC_CODE$=""
3840 NEXT_ID=INV_LOC_CODE.CTL
3880 REFRESH_FLG=1
3890 RETURN 
3900 ! CHECK IF ORDER IS SUMMARY BILL
3910 GET_SUMM_BILL:
3920 DIM FMS_REC$(244); FIND (Z[14],KEY="D"+CUSTOMER$,DOM=*NEXT)FMS_REC$ ! SSP250527
3930 II1=POS("I"=FMS_REC$(113,4))
3940 IF II1=0 THEN RETURN ! II1=1
3950 SUMMARY_BILL$="Y"
3960 PRINT_INV$=MID(FMS_REC$,116+II1,1)
3970 ! IF SUMMARY_BILL$="N" THEN PRINT_INV$="Y"
3980 REFRESH_FLG=1
3990 RETURN 
4000 ! Delete Record
4010 DELETE_REC:
4013 PAID_YN=0; GOSUB CHECK_PAYMENT_STATUS; IF PAID_YN<>0 THEN MSGBOX MSG("INV_NO_DEL"),MSG("WARNING"),"!,OK"; RETURN 
4015 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YESNO",ANS$; IF ANS$="NO" THEN RETURN 
4020 KEY_1$=CR_FY$+CR_ACCTPD$+INV_NUM$,FINISH=0 ! SSP#220039
4022 REMOVE (Z(24),KEY=KEY_1$,DOM=*NEXT) ! ssp 191739
4023 GOSUB DELETE_ASD_REC
4025 GOSUB DELETE_INVOICE_STUFF
4026 IF %MSLC THEN CCKEY$="I"+KEY_1$(7)+KEY_1$(1,6)+DIM(4); CALL "ARGSCM; DELETE_ALL",CCKEY$ ! SSP 225300
4027 FS1$="" ! SSP221139 jdf
4028 FS2$="",FS3$="" ! SSP223646 jdf
4029 IF MID(AR3PARM$,13,1)="Y" THEN CALL "EFGMAQ;DELETE_EML_INVOICE",X3$,X4$,ARB$(7,18),"IN",X3$(174,4)+X3$(85,1) ! SSP 298391 Email invoices after update
4030 DIM COMM[23]; FIND (Z[8],KEY=COMM_CODE$,DOM=4035)IOL=0360 ! SSP 225300 SSP 307216
4032 IF AR4$(45,1)<>"Y" THEN GOTO 4035 ELSE AXN_IDX$="ALL"; GOSUB DELETE_STATS ! SSP 225300 307216
4036 IF NUL(KEY_1$) THEN GOTO 4170 ! MAKE SURE YOU ADD THE CLEAR FUNCTIONS...
4040 READ (Z[1],KEY=KEY_1$,DOM=4170)IOL=0310
4050 IF ARB[20]>0 THEN {
4060 READ (Z[17],IND=ARB[20])IOL=0390
4070 IF ART9>0 THEN {
4080 A99=ART9
4090 READ (Z[17],IND=A99)IOL=0390
4100 IF ART9>0 THEN A99=ART9; ART9=-1; IF A99<>0 THEN WRITE (Z[17],IND=A99)IOL=0390; GOTO 4090 }
4110  } ELSE {
4115 ART9=-1
4120 IF A99<>0 THEN WRITE (Z[17],IND=A99)IOL=0390
4130  }
4150 ART9=-1; IF ARB[20]>0 THEN WRITE (Z[17],IND=ARB[20])IOL=0390
4155 DELETE_RESET:! SSP 235752
4160 REMOVE (Z[1],KEY=KEY_1$,DOM=*NEXT)
4170 GOSUB RESET_FLAG
4180 GOSUB CLEAR_SCREEN
4183 CALL "*WINGRP;ENABLE",EXIT_ONLY.GRP$
4184 CALL "*WINGRP;ENABLE",EXIT_2.GRP$ ! SSP 226161
4185 REFRESH_FLG=1,%RETAIN_INV=0 ! SSP#270057
4190 RETURN 
4200 ! Write out Record
4210 WRITE_REC:
4215 IF ARB$=DIM(690) THEN GOTO *RETURN ! SSP 217839
4217 IF STP(KEY_1$)="" THEN KEY_1$=MID(ARB$,1,14) ! SSP238390 jdf
4218 GOSUB SET_OPER_CODE_FLDS ! WO240665
4220 WRITE (Z[1],KEY=KEY_1$)IOL=0310
4290 RETURN 
4300 ! Reset Invoincing in Progress Flag
4310 RESET_FLAG:
4320 IF NUL(ORDER$) THEN RETURN 
4330 KEY_10$=ORDER$
4340 EXTRACT (Z[10],KEY=KEY_10$,DOM=*RETURN)IOL=0450
4350 FS1$(63,1)="N"
4360 WRITE (Z[10],KEY=KEY_10$)IOL=0450
4390 RETURN 
4400 ! Change the print invoice flag according to the summary bill.
4410 SUMM_PRINT:
4420 IF SUMMARY_BILL$="N" THEN MSGBOX MSG("ARGEAA_10"),MSG("FYI"),"!"; PRINT_INV$="Y"
4440 IF SUMMARY_BILL$="Y" THEN GOSUB GET_SUMM_BILL
4490 RETURN 
4500 ! EXIT AR INVOICE ENTRY
4510 EXIT_ROUTINE:
4512 IF NOT(NUL(INV_NUM$)) THEN GOSUB CHECK_RECORD; IF CHANGE_FLG THEN CHANGE_FLG=0; MSGBOX MSG("ARGEAA_11")+SEP+MSG("ARGEAA_12"),MSG("FYI"),"!"; NEXT_ID=NEXT_1.CTL; CALL "*WINGRP;DISABLE",EXIT_1.GRP$; RETURN 
4513 ! GOSUB RESET_FLAG     SSP#292135
4515 GOSUB WRAPUP
4520 IF NUL(ORDER$) THEN CMD_STR$="END"; EXIT 
4525 IF NUL(ARG_1$) THEN CMD_STR$="END"; EXIT 
4530 MSGBOX MSG("BYPASS_AR"),MSG("VERIFY"),"?,YESNO",ANS$
4540 IF ANS$="YES" THEN CMD_STR$="END"; EXIT 
4580 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z0=1 THEN CMD_STR$="END"; GOTO WRAPUP
4590 RETURN 
4600 ! Check the ARB Header to see if any changes was made.
4610 CHECK_RECORD:
4615 GOSUB LOAD_HEADER_INFO
4620 CHANGE_FLG=0
4630 IF ARB$<>B_ARB$ THEN CHANGE_FLG=1; RETURN 
4640 FOR ZZ=0 TO 32
4650 IF ARB[ZZ]<>B_ARB[ZZ] THEN CHANGE_FLG=1
4660 NEXT ZZ
4690 RETURN 
4700 ! Continue process after User is alert of the Customer over 60
4710 CONT_PROCESS:
4720 CALL "*wingrp;hide",BUTTON_1.GRP$; CALL "*wingrp;show",BUTTONS.GRP$; CALL "*wingrp;enable",OVER.GRP$; CALL "*wingrp;enable",FIELD_1.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; CALL "*wingrp;enable",LOC_2.GRP$
4740 ! IF POS("Y"=FMP_CUST$(117,4),1)<>0 THEN CALL "*wingrp;Enable",SUMM.GRP$ ELSE CALL "*wingrp;Disable",SUMM.GRP$
4745 IF MID(OP_SEC$,65,1)<>"Y" THEN CALL "*WINGRP;ENABLE",TERMS.GRP$ ELSE CALL "*WINGRP;DISABLE",TERMS.GRP$; REM "SSP#206714
4748 IF P2$(7,1)="Y" THEN CALL "*WINGRP;ENABLE",COMM.GRP$ ELSE CALL "*WINGRP;DISABLE",COMM.GRP$; REM "SSP#206714
4749 IF MID(OP_SEC$,65,1)="Y" THEN GOTO 4752
4750 IF STP(TERMS_CODE$,2)="" THEN GOTO *NEXT ELSE FIND (Z[5],KEY=TERMS_CODE$,DOM=*NEXT)*; GOTO 4752
4751 MSGBOX (MSG("Inval_Trm")); NEXT_ID=TERMS_CODE.CTL; REFRESH_FLG=1; RETURN ! SSP 302616
4752 SPER_STR$="",SPER_TOT_COMM=0,SPER_CODE_1$=SPER_CODE$ ! SSP220240 jdf ssp 302616
4754 FOR X=1 TO 5 ! SSP220240 jdf
4756 SPER_STR$=SPER_STR$+EVS("SPER_CODE_"+STR(X)+"$") ! SSP220240 jdf
4758 SPER_TOT_COMM=SPER_TOT_COMM+EVN("COMM_AMT_"+STR(X)) ! SSP220240 jdf
4760 IF EVN("COMM_AMT_"+STR(X))<>0 AND STP(EVS("SPER_CODE_"+STR(X)+"$"))="" THEN EXITTO 4774 ! SSP220240 jdf
4762 IF EVN("COMM_AMT_"+STR(X))<0 THEN EXITTO 4774 ! SSP220240 jdf
4764 NEXT X ! SSP220240 jdf
4766 IF STP(SPER_STR$)="" OR SPER_TOT_COMM<>100 THEN GOTO 4774 ! SSP220240 jdf
4770 GOTO 4778 ! SSP220240 jdf SSP302616
4774 MSGBOX MSG("SPER_INFO"),MSG("STOP"); CALL "*wingrp;show",BUTTON_1.GRP$; NEXT_ID=SPER_CODE.CTL,REFRESH_FLG=1; RETURN ! SSP220240 jdf
4778 NEXT_ID=LOC_CODE.CTL ! SSP220240 jdf
4780 REFRESH_FLG=1
4790 RETURN 
5000 ! load Collected Header Information....
5010 LOAD_HEADER_INFO:
5018 RESTART_HEADER_INFO:
5020 ARB$(1,4)=CR_FY$; ARB$(5,2)=CR_ACCTPD$
5030 ARB$(7,8)=INV_NUM$; ARB$(15,10)=CUSTOMER$; ARB$(25,35)=CUST_NAME$
5035 ARB$(64,1)=P_HOLD$
5040 ARB$(65,2)=TERMS_CODE$; ARB$(67,10)=STAX_CODE$; STAX_CODE_2$=STAX_CODE$
5050 ARB$(77,1)=INV_TYPE$; ARB$(86,6)=INV_DATE$
5060 ARB$(92,8)=ORDER$; ARB$(100,15)=CUST_PO$
5070 ARB$(128,5)=COMM_CODE$
5080 ARB$(133,4)=SPER_CODE$; ARB$(137,4)=SPER_CODE_2$; ARB$(141,4)=SPER_CODE_3$; ARB$(145,4)=SPER_CODE_4$; ARB$(149,4)=SPER_CODE_5$
5090 ARB$(153,9)=MID(AR1$,220,9); ARB$(162,15)=%SHIP_VIA_DESC$ ! SSP223646 jdf
5100 ARB$(180,6)=SHIP_DATE$; ARB$(186,1)=SHIP_VIA_CODE$
5110 ARB$(187,4)=LOC_CODE$
5120 ARB$(191,30)=LOC_ADDR_1$; ARB$(221,30)=LOC_ADDR_2$
5130 ARB$(251,16)=LOC_CITY$; ARB$(267,2)=LOC_ST$; ARB$(269,9)=LOC_ZIP_CODE$
5132 ARB$(115,1)=TAX_EXEMPT$; REM TEST TEST 
5140 ARB$(290,35)=LOC_DESC$
5145 ARB[2]=FRT_AMT
5147 IF NOT(NUL(ORDER$)) AND ARB(1)=0 THEN ARB[1]=ORD_AMT; ARB[11]=ORD_COST; ARB[9]=ORD_AMT ! ssp 190311
5150 ARB[12]=COMM_AMT_1; ARB[13]=COMM_AMT_2; ARB[14]=COMM_AMT_3; ARB[15]=COMM_AMT_4; ARB[16]=COMM_AMT_5
5160 ARB$(344,1)=SUMMARY_BILL$; ARB$(345,1)=PRINT_INV$; ARB$(343,1)=ORD_TYPE$
5165 IF ARB$(345,1)=" " THEN ARB$(345,1)="Y" ! SSP 195621
5168 ARB$(453,15)=INV_JOB_CARD$ ! WO264703
5170 ARB$(338,3)=%C$
5172 ARB$(179,1)=FOB_PT$
5173 ARB$(421,20)=CONTRACT$,ARB$(441,6)=CONTRACT_DATE$ ! SSP239556
5175 WRITE (Z[1],KEY=KEY_1$)IOL=0310
5180 IF ARB$(64,1)="P" AND (ARB$<>B_ARB$ OR ID$="NEXT_1") THEN ARB$(64,1)=" ",P_HOLD$=" "; MSGBOX MSG("ARGEAB_08"),MSG("FYI"),"!" ! SSP 190311
5190 RETURN 
5300 ! LOAD hEAD INFORMATION TO THE SCREEN
5310 LOAD_INV_HEAD_INFO:
5330 CUSTOMER$=ARB$(15,10); CUST_NAME$=ARB$(25,35)
5335 P_HOLD$=ARB$(64,1)
5340 TERMS_CODE$=ARB$(65,2); STAX_CODE$=ARB$(67,10)
5350 INV_TYPE$=ARB$(77,1); INV_DATE$=ARB$(86,6)
5360 ORDER$=ARB$(92,8); CUST_PO$=ARB$(100,15)
5365 JOB_NUM$=ARB$(325,12),CUST_CATEGORY$=ARB$(153,9) ! SSP#280835
5370 COMM_CODE$=ARB$(128,5),COMM_CODE1$=COMM_CODE$ ! SSP 199976
5380 SPER_CODE$=ARB$(133,4); SPER_CODE_2$=ARB$(137,4); SPER_CODE_3$=ARB$(141,4); SPER_CODE_4$=ARB$(145,4); SPER_CODE_5$=ARB$(149,4)
5390 %SHIP_VIA_DESC$=ARB$(162,15)
5400 SHIP_DATE$=ARB$(180,6); SHIP_VIA_CODE$=ARB$(186,1)
5410 LOC_CODE$=ARB$(187,4)
5420 LOC_ADDR_1$=ARB$(191,30); LOC_ADDR_2$=ARB$(221,30)
5430 LOC_CITY$=ARB$(251,16); LOC_ST$=ARB$(267,2); LOC_ZIP_CODE$=ARB$(269,9)
5440 LOC_DESC$=ARB$(290,35)
5450 COMM_AMT_1=ARB[12]; COMM_AMT_2=ARB[13]; COMM_AMT_3=ARB[14]; COMM_AMT_4=ARB[15]; COMM_AMT_5=ARB[16]
5455 FRT_AMT=ARB[2]
5456 TAX_EXEMPT$=ARB$(115,1); REM SSP 264523
5460 SUMMARY_BILL$=ARB$(344,1); PRINT_INV$=ARB$(345,1); ORD_TYPE$=ARB$(343,1)
5465 INV_JOB_CARD$=ARB$(453,15) ! WO264703
5470 IF STP(PRINT_INV$)="" THEN PRINT_INV$="Y" ! SSP 195621
5480 NEXT_ID=NEXT_1.CTL; REFRESH_FLG=1
5490 RETURN 
5600 ! Requisition Entry
5610 REQ_ENTRY:
5620 %ORDER_NUMBER$=""; %INV_ENTRY=1
5630 CALL "FMGODM"
5635 %INV_ENTRY=0 ! ssp 193806
5640 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
5650 IF NOT(NUL(%ORDER_NUMBER$)) THEN {
5660 ORDER$=%ORDER_NUMBER$; %ORDER_NUMBER$=""
5670 %INV_ENTRY=0; %SPEED_BILL=1
5680 PERFORM "ARGEAA;SPEED_BILL"
5690  }
5695 REFRESH_FLG=1
5699 RETURN 
6000 ! Add a Line
6010 ADD_LINE:
6015 IF NUL(ORDER$) OR (NOT(NUL(ORDER$)) AND STP(MID(FS1$,118,8))="") THEN %LINE_T$=MSG("LINE_TYPEA"),%LINE_V$=MSG("LINE_TYPER") ELSE %LINE_T$=MSG("LINE_TYPE2"); %LINE_V$=MSG("LINE_TYPE3"); END_IF ; DROP_BOX LOAD LINE_TYPE.CTL,%LINE_T$; LINE_TYPE.CTL'TBL$=%LINE_V$ ! SSP215958 jdf ! SSP221139 jdf ! SSP221974 jdf ! SSP222354 jdf ** moved in as root, locked by tma **
6020 LINE_NUM$=STR(INV_LINE_NUM+1); STAX_CODE_2$=STAX_CODE$; COMM_CODE$=ARB$(128,5),COMM_CODE1$=COMM_CODE$ ! SSP 199976
6025 IF %MSLC THEN GOSUB MULTI_DET_SETUP ! SSP 22530
6030 NEXT_ID=LINE_TYPE.CTL
6040 CALL "*wingrp;enable",LINE.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$
6050 CALL "*WINGRP;SHOW",SAVE_1.GRP$; CALL "*WINGRP;DISABLE",ADDLINE.GRP$
6060 CALL "*wingrp;Disable",ADD_2.GRP$; CALL "*wingrp;Disable",ADD_3.GRP$
6070 CALL "*wingrp;disable",DEL_ORD.GRP$
6075 DISABLE CONTROL NEXT_2.CTL
6080 REFRESH_FLG=1
6090 RETURN 
6500 CHK_REQ_FLDS:! Checking for item code and product code ! SSP232272 jdf
6510 IF STP(ITEM_CODE$)="" AND LINE_TYPE$<>"N" THEN {! SSP232272 jdf
6520 MSGBOX MSG("ARGEAA_14") ! SSP232272 jdf
6530 ITEM_CODE$=""; NEXT_ID=ITEM_CODE.CTL; REFRESH_FLG=1; RETURN  } ! SSP232272 jdf
6540 IF STP(PROD_CODE$)="" THEN {! SSP232272 jdf
6550 MSGBOX MSG("ARGEAA_15") ! SSP232272 jdf
6560 PROD_CODE$=""; NEXT_ID=PROD_CODE.CTL; REFRESH_FLG=1; RETURN  } ! SSP232272 jdf
6570 RETURN ! SSP232272 jdf
6600 NO_BLANK_SHIP_DATE:! SSP248330 jdf
6620 DIM XXS$(171); IF NOT(NUL(CUSTOMER$)) THEN FIND (Z[14],KEY="D"+CUSTOMER$,DOM=6635)XXS$(1)
6630 IF STP(SHIP_DATE$)="" AND XXS$(24,1)="Y" THEN MSGBOX MSG("ARGEAA_16"),MSG("WARNING"),"!"; NEXT_ID=SHIP_DATE.CTL; EXIT 
6640 IF PRIOR_SHIP_DATE$<>SHIP_DATE$ THEN GOSUB FS3_SHIP_DATE
6650 RETURN 
6700 FS3_SHIP_DATE:! Change ship date in FS3... ! SSP248330 jdf
6710 IF ARB[20]=0 OR NUL(SHIP_DATE$) THEN GOTO 6770
6720 READ (Z[26],KEY=PAD(INV_NUM$,8)+PAD(ORDER$,8),DOM=*NEXT)
6730 J0$=KEY(Z[26],END=6770); EXTRACT RECORD (Z[26],KEY=J0$)FS3X$
6740 IF FS3X$(1,16)<>PAD(INV_NUM$,8)+PAD(ORDER$,8) THEN GOTO 6770
6750 FS3X$(40,6)=SHIP_DATE$,FS3X$(21,6)=INV_DATE$
6760 WRITE RECORD (Z[26])FS3X$
6765 GOTO 6730
6770 RETURN 
7000 ! Get the Foreign Currency
7010 GET_CURR:
7020 PRC2=PRC
7030 PRECISION 7
7040 DIM CUR$(36),CUR[1],XXX$(171),ASN$(45),ASN[1]
7050 CUR[0]=1
7060 READ (Z[14],KEY="D"+CUSTOMER$,DOM=*NEXT)XXX$
7070 READ (Z[24],KEY=CR_FY$+CR_ACCTPD$+INV_NUM$,DOM=*NEXT)IOL=0472; IF CUR$(15,3)=CURRENCY$ OR ID$<>"CURRENCY" THEN ASN0=CUR(0); GOTO 7100
7080 READ (Z[25],KEY=CURRENCY$,DOM=*NEXT)IOL=0474 ! SSP 191739
7081 IF CURR_AMT<>0 THEN ASN0=CURR_AMT ! SSP 191739
7090 CUR$=CR_FY$+CR_ACCTPD$+INV_NUM$+ASN$(1,3)+ASN$(39,3)+"                ",CUR[0]=ASN0 ! SSP 191739
7100 PRECISION PRC2
7110 IF CURR_AMT<>0 THEN PRC2=PRC; PRECISION 4; ASN0=CURR_AMT,CUR(0)=CURR_AMT; PRECISION PRC2 ! SSP 191739 SSP297121
7120 PRC2=PRC; PRECISION 4; CURR_AMT=ASN0; PRECISION PRC2 ! SSP 191739 SSP297121
7180 REFRESH_FLG=1
7182 IF CUR(0)=0 THEN CUR(0)=1
7185 WRITE (Z(24),KEY=CUR$(1,14))IOL=0472
7186 CURRENCY$=CUR$(15,3)
7190 RETURN 
7200 ! CHECK IF UPDATE HAS BEEN RUN
7210 CHECK_AUDIT:
7220 FIND (Z[1],KEY="",DOM=*RETURN)V0$,K0$
7230 IF %IN_WEBEC$="Y" THEN REMOVE (Z[1],KEY=""); RETURN 
7240 MSGBOX MSG("AUDIT_REPO")+" ("+V0$(22,4)+"."+V0$(26,2)+")"+SEP+MSG("WANT_MOD"),MSG("WARNING"),"?,YESNO",ANS$
7250 IF ANS$="NO" THEN CMD_STR$="END"; EXIT 
7255 REMOVE (Z[1],KEY="",DOM=*NEXT); REM "SSP#205673
7290 RETURN 
7300 GET_TP:; REM " SSP 180448
7310 READ (Z[30],KEY=CUSTOMER$,DOM=*NEXT)
7320 EM2_KEY$=KEY(Z[30],END=7399)
7330 IF EM2_KEY$(1,10)<>CUSTOMER$ THEN GOTO 7399
7340 FIND (Z[31],KEY=EM2_KEY$(11,15),DOM=7399)EM1$
7360 TP$=EM1$(16,30)
7365 REFRESH_FLG=1
7399 RETURN 
7500 SET_OPER_CODE_FLDS:! WO240665
7510 IF ARB$(447,3)=DIM(3) THEN ARB$(447,3)=X3$(40,3) ! Set operator code when first entered if it's blank
7520 ARB$(450,3)=X3$(40,3) ! Set operator code last accessed
7530 ARB$(325,12)=JOB_NUM$,ARB$(100,15)=CUST_PO$,ARB$(153,9)=CUST_CATEGORY$ ! SSP#280835
7540 RETURN 
7545 ! 
8000 ! messages
8010 NEW_REC_MSG:
8015 IF STP(INV_NUM$)="" OR STP(INV_NUM$)="0000000" THEN RETURN 
8020 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YESNO",ANS$
8030 IF ANS$="NO" THEN INV_NUM$=""; NEXT_ID=INV_NUM.CTL; RETURN 
8035 CALL "*WINGRP;DISABLE",EXIT_1.GRP$
8040 IF NOT(NUL(ORDER$)) THEN GOSUB PROCESS_ORDER; NEXT_ID=NEXT_1.CTL; RETURN 
8080 NEXT_ID=ORDER.CTL
8090 RETURN 
8100 ! Customer's Invoice Entry Message
8110 CUST_INV_MSG:
8114 IF INV_NUM$=%CUST_MSG_INV_NUM$ THEN RETURN ELSE %CUST_MSG_INV_NUM$=INV_NUM$
8115 IF NUL(CUSTOMER$) THEN RETURN 
8120 FIND (Z[16],KEY=CUSTOMER$,DOM=*RETURN)IOL=0370
8130 IF NUL(AS5$(11,180)) THEN RETURN 
8140 MSGBOX AS5$(11,60)+SEP+AS5$(71,60)+SEP+AS5$(131,60),MSG("FYI"),"!"
8190 RETURN 
8300 ! CLEAR SCREEN
8310 CLEAR_SCREEN:
8311 IF FINISH<>0 AND ARB(0)=0 AND ARB(0)<>A0 THEN ARB(0)=A0; GOSUB WRITE_REC ! ssp 204778
8312 IF SCRN_ID$="ARGEAC.4" THEN GOSUB CHECK_PRINT_INVOICE ! SSP 194559
8320 INV_NUM$=""; ORDER$=""; CUSTOMER$=""
8325 TP$=""; REM SSP 180448
8330 LOC_CODE$=""
8340 CUST_NAME$=""; CUST_ADDR_1$=""; CUST_ADDR_2$=""
8350 CUST_CITY$=""; CUST_ST$=""; CUST_ZIP_CODE$=""
8360 LOC_DESC$=""; LOC_ADDR_1$=""; LOC_ADDR_2$=""
8370 LOC_CITY$=""; LOC_ST$=""; LOC_ZIP_CODE$=""
8380 INV_DATE$=""; CUST_PO$=""; SHIP_DATE$=""; JOB_NUM$="" ! SSP#280835
8390 SHIP_VIA_CODE$=""; %SHIP_VIA_DESC$=""
8400 SUMMARY_BILL$=""
8405 CURRENCY$="",CURR_AMT=0 ! SSP 191739
8410 INV_TYPE$=""; COMM_CODE$="",COMM_CODE1$=""; TERMS_CODE$="" ! SSP 199976
8420 STAX_CODE$=""; ST_PERCENT=0
8430 SPER_CODE$=""; SPER_CODE_2$=""; SPER_CODE_3$=""; SPER_CODE_4$=""; SPER_CODE_5$=""
8440 COMM_AMT_1=0; COMM_AMT_2=0; COMM_AMT_3=0; COMM_AMT_4=0; COMM_AMT_5=0
8450 ORDER$=""; ARG_1$=""; KEY_1$=""; ORD_FLG=0
8460 CALL "*WINGRP;DISABLE",FIELDS.GRP$; CALL "*WINGRP;HIDE",BUTTONS.GRP$; CALL "*WINGRP;HIDE",BUTTON_1.GRP$; CALL "*WINGRP;DISABLE",COMM.GRP$; CALL "*WINGRP;DISABLE",TERMS.GRP$
8465 IF %MSLC THEN DISABLE CONTROL BT_COMM.CTL ! SSP 225300
8470 NEXT_ID=INV_NUM.CTL
8480 REFRESH_FLG=1
8490 RETURN 
8500 LOOKUP_ZIP:! Lookup zipcode, set city & state if found, set NEW_ZIP for later use
8510 IF NUL(LOC_ZIP_CODE$) THEN RETURN 
8520 NEW_ZIP=0
8530 CALL "ZYGMBA;CHECK_ZIP",LOC_ZIP_CODE$,ZIP_FOUND,ZIP_CITY$,ZIP_ST$,"",ZIP_AREA_CODE$,""
8540 IF CUST_PHONE$="" THEN CUST_PHONE$=DIM(14)
8550 IF ZIP_FOUND THEN LOC_CITY$=ZIP_CITY$,LOC_ST$=ZIP_ST$; REFRESH_FLG=1,NEXT_ID=CUST_PO.CTL ELSE NEW_ZIP=1
8555 GOSUB GET_VERATAX_CODE
8560 RETURN 
8565 IF %MSLC THEN DISABLE CONTROL BT_COMM.CTL ! SSP 225300
8570 ! 
8580 UPDATE_ZIP:! If new_zip then update the zip code table
8590 IF NUL(CUST_PHONE$) THEN DIM CUST_PHONE$(14)
8600 IF NEW_ZIP THEN CALL "ZYGMBA;UPDATE_ZIP",LOC_ZIP_CODE$,LOC_CITY$,LOC_ST$,"",CUST_PHONE$(1,3),CUST_CITY$ ! get area code from phone,long city from regular city
8610 NEW_ZIP=0
8620 RETURN 
8630 ! 
8700 GET_VERATAX_CODE:! Rewrote this routine for WO#254342
8705 IF ARS$(134,1)<>"Y" THEN GOTO GVC_DONE
8710 LOC_TAX_CODE$=AR1$(235,10) ! Default to customer master tax code
8715 READ (Z[7],KEY=MID(AR1$,235,10),KNO=0,DOM=*NEXT)CUST_TAX$; IF MID(CUST_TAX$,182,1)="Y" THEN GOTO SET_VERATAX_CODE
8720 READ (Z[7],KEY=MID(FM0$,224,10),KNO=0,DOM=*NEXT)SHIP_TAX$; IF MID(SHIP_TAX$,182,1)="Y" THEN GOTO SET_VERATAX_CODE
8725 ! LOC_ZIP_CODE$=MID(PO3$,124,5),LOC_ST$=MID(PO3$,122,2)
8730 IF (POS(X3$(9,3)="101118590",3)>0 OR MID(ARPARM3$,9,1)="Y") AND MID(FM0$,224,7)=LOC_ST$+MID(LOC_ZIP_CODE$,1,5) AND STP(MID(FM0$,224,7))<>"" THEN LOC_TAX_CODE$=MID(FM0$,224,10); GOTO SET_VERATAX_CODE ! SSP252208 jdf !SSP#256424
8750 CALL "TW2FUN;LOOKUP_TAX_CODE",ERR=*NEXT,X3$,X4$,LOC_ST$,MID(LOC_ZIP_CODE$,1,5),LOC_CITY$,"",T$,T{ALL}; LOC_TAX_CODE$=MID(T$,1,10) ! 245342
8755 IF POS(%X3$(9,3)="101",3)<>0 AND MID(ORDER$,1,2)="13" AND LOC_TAX_CODE$="IL"+DIM(8) THEN LOC_TAX_CODE$="ILCH"+DIM(6) ! SSP307430-DBD-306-DBSPT-149880
8785 SET_VERATAX_CODE:
8787 STAX_CODE$=LOC_TAX_CODE$; GOSUB TAX_CODE
8788 REFRESH_FLG=1
8790 GVC_DONE:
8795 RETURN 
8799 ! 
9000 ! 
9010 GET_PARAM:
9020 FIND (Z[6],KEY=X3$(9,3)+"A/R")ARS$
9022 FIND (Z[6],KEY=X3$(9,3)+"AR3")AR3PARM$ ! SSP 298391
9025 FIND (Z[6],KEY=X3$(9,3)+"AR1",DOM=*NEXT)P2$
9030 READ (Z[6],KEY=X3$(9,3)+"G/B",DOM=*NEXT)GB$; GB$="Y"
9040 FIND (Z[6],KEY=X3$(9,3)+"G/L")G0$; G8=NUM(G0$(170,2),ERR=*NEXT)
9045 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=*NEXT)P0$
9048 READ (Z[6],KEY=X3$(9,3)+"AR3",DOM=*NEXT)ARPARM3$ ! SSP 235445
9050 DIM I0$(40); FIND (Z[6],KEY=X3$(9,3)+"I/C",DOM=*NEXT)I0$
9060 DIM ASN$(45),ASN[1],CUR$(36),CUR[1]
9070 DIM OP_SEC$(255); READ (Z[6],KEY="osec"+X3$(40,3),DOM=*NEXT)OP_SEC$(1)
9080 DIM FMM$(300); READ (Z[6],KEY=X3$(9,3)+"F/M",DOM=*NEXT)FMM$
9085 CHK_SB$="N"; IF MID(FMM$,334,1)="Y" THEN CHK_SB$="Y" ! WO255959
9090 GB$=""; FIND (Z[6],KEY=X3$(9,3)+"G/B",DOM=*NEXT)GB$
9100 DIM SH_PARM$(300); FIND (Z[6],KEY=X3$(9,3)+"S/H",DOM=*NEXT)SH_PARM$
9110 %MSLC=0; IF FN%HAS_MODULE("AC")<>0 THEN IF P2$(77,1)="Y" THEN %MSLC=1 ! SSP 225300
9190 RETURN 
9200 ! Clear the Customer Location Field
9210 CLEAR_LOC_FIELDS:
9220 LOC_DESC$=""
9230 LOC_ADDR_1$=""; LOC_ADDR_2$=""
9240 LOC_CITY$=""; LOC_ST$=""
9250 LOC_ZIP_CODE$=""
9280 REFRESH_FLG=1
9290 RETURN 
9500 ! Get the Next Index
9510 GET_NEXT_INDEX:
9520 EXTRACT (Z[17],IND=0)IOL=0400
9530 IF Y[4]=-2 THEN READ (Z[17]); WAIT 0; GOTO 9520
9540 Y[4]=-2; WRITE (Z[17],IND=0)IOL=0400
9550 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1; GOTO 9570
9560 A9=Y[1]; READ (Z[17],IND=A9)Y[1]
9570 IF Y[0]<Y[3] AND Y[2]<=Y[3] THEN Y[0]=Y[0]+1,Y[4]=-1 ELSE Y[2]=Y[2]-1; GOTO 9700
9580 WRITE (Z[17],IND=0)IOL=0400
9590 RETURN 
9700 ! END OF LINES
9710 Y[4]=-1; WRITE (Z[17],IND=0)IOL=0400
9720 CALL "ZZEXPF",X3$,X4$,"X"+STR(Z[17])," ",G9; IF G9>0 THEN RETURN 
9730 EXTRACT (Z[17],IND=0)IOL=0400
9740 Z=NUM(FIN(Z[17],"MAXREC")); Y[3]=Z-1
9750 Y[4]=-2; WRITE (Z[17],IND=0)IOL=0400
9760 GOTO 9550
9790 RETURN 
9800 ! Add to the Delete Index
9810 DELETE_INDEX:
9820 EXTRACT (Z[17],IND=0)IOL=0400
9830 IF Y[4]=-2 THEN READ (Z[17]); WAIT 0; GOTO 9820 ELSE Y[4]=-2
9840 WRITE (Z[17],IND=0)IOL=0400
9850 WRITE (Z[17],IND=CURR_IDX)Y[1]
9860 Y[1]=CURR_IDX,Y[4]=-1,Y[0]=Y[0]-1
9870 WRITE (Z[17],IND=0)IOL=0400
9890 RETURN 
9900 ! Speed Bill Routine
9910 SPEED_BILL:
9920 GOSUB PROCESS_ORDER
9930 GOSUB LOAD_HEADER_INFO
9940 GOSUB WRITE_REC
9950 GOSUB BILL_NOW_INT
9955 GOSUB SAVE_ORDER_INFO
9960 REPLACEMENT_SCRN$="ARGEAC.3"
9980 REFRESH_FLG=1
9990 %SPEED_BILL=0
9995 RETURN 
9999 END 
10000 ! LINES
10010 GET_INVOICE_LINE:
10013 READ (Z[1],KEY=KEY_1$)IOL=0310
10015 GOSUB CLEAR_LINES; GOSUB CLEAR_LINE_INFO
10020 IF ARB[20]=0 OR ARB[20]=-1 THEN LINE_NUM$="1"; GOSUB GET_NEXT_INDEX; IDX_FLG=1; DIM ART$(290); STAX_CODE$=LOC_TAX_CODE$; STAX_CODE_2$=LOC_TAX_CODE$; IF TAXABLE_FM0$<>"" THEN TAXABLE$=TAXABLE_FM0$ END_IF ; COMM_CODE$=ARB$(128,5),COMM_CODE1$=COMM_CODE$; IF %MSLC THEN GOSUB MULTI_DET_SETUP END_IF ; NEXT_ID=INV_TYPE.CTL; REFRESH_FLG=1; RETURN ; REM LMS SSP 187780 199976 SSP225300
10030 READ (Z[17],IND=ARB[20])IOL=0390
10035 INV_LINE_NUM=1; INV_LINE_ARRAY[INV_LINE_NUM]=ARB[20]
10037 CALL "*wingrp;Enable",LINE.GRP$; CALL "*wingrp;Disable",FIELDS.GRP$; CALL "*wingrp;Enable",NEXT_1.GRP$; CALL "*wingrp;Hide",SAVE_1.GRP$
10038 CALL "*wingrp;hide",DEL_LINE.GRP$; CALL "*wingrp;show",DEL_ORD.GRP$
10039 IF %MSLC THEN DISABLE CONTROL BT_COMM.CTL ! SSP 225300
10040 GOSUB LOAD_LINE
10050 IF ART9>0 THEN ART_IDX=ART9; READ (Z[17],IND=ART9)IOL=0390 ELSE RETURN 
10055 INV_LINE_NUM+=1; INV_LINE_ARRAY[INV_LINE_NUM]=ART_IDX
10060 GOSUB LOAD_LINE
10070 GOTO 10050
10090 RETURN 
10100 ! clear lines
10110 CLEAR_LINES:
10115 DIM INV_LINE_ARRAY[999]
10120 FOR ZZ=1 TO 999
10130 LIST_BOX LOAD INV_LINE.CTL,1,*,ERR=10160
10140 NEXT ZZ
10150 GOTO 10170
10160 EXITTO 10170
10170 RETURN 
10175 CLEAR_ORDER_LINES:
10177 FOR ZZ=1 TO 200
10179 LIST_BOX LOAD ORDER_LINE.CTL,1,*,ERR=10185
10180 NEXT ZZ
10183 GOTO 10187
10185 EXITTO 10187
10187 RETURN 
10200 ! Load Invoice Lines
10210 LOAD_LINE:
10212 IF MID(ART$,6,1)="N" THEN BL$='SF'+'_YELLOW'; SHOW CONTROL NPOI.CTL; REFRESH_FLG=1; ELSE BL$="" ! SSP226631 jdf ! SSP224634 jdf
10213 IF MID(ART$,1,1)="M" AND MID(ART$,7,11)="Backordered" THEN QTY=FN%QTY_IN_UM(ART(1),MID(ART$,50,40),ART(6)); LIST_BOX LOAD INV_LINE.CTL,0,BL$+STR(INV_LINE_NUM)+SEP+BL$+MID(ART$,7,40)+SEP+BL$+STR(QTY:"###,###,###.00-")+SEP+BL$+""+SEP+BL$+""+SEP+BL$+MID(ART$,1,1); GOTO 10280 ! SSP 188176  ! SSP226631 jdf ! SSP224634 jdf
10215 IF MID(ART$,1,1)="M" THEN QTY=0; GOTO 10270 ! SSP224634 jdf
10217 ! UNIT$=ART$(50,4); GOSUB UM_PARAM
10220 IF ART[1]=1 THEN QTY=ART[1] ELSE QTY=FN%QTY_IN_UM(ART[1],MID(ART$,50,4),ART[6]) ! IF P4$(20,1)<>"Y" THEN QTY=ART[1]/ART[6] ELSE QTY=ART[1] ! SSP224634 jdf
10270 IF MID(ART$,1,1)="M" THEN LIST_BOX LOAD INV_LINE.CTL,0,BL$+STR(INV_LINE_NUM)+SEP+BL$+MID(ART$,7,40)+SEP+BL$+""+SEP+BL$+""+SEP+BL$+MID(ART$,50,4)+SEP+BL$+MID(ART$,1,1) ELSE IF ART[2]=0 THEN UP=ART[4] ELSE UP=ART[2] END_IF ; LIST_BOX LOAD INV_LINE.CTL,0,BL$+STR(INV_LINE_NUM)+SEP+BL$+MID(ART$,7,40)+SEP+BL$+STR(QTY:"###,###,###.00-")+SEP+BL$+STR(UP:"###,###,###.00-")+SEP+BL$+MID(ART$,50,4)+SEP+BL$+MID(ART$,1,1) ! SSP226631 jdf  ! SSP224634 jdf!SSP#254461
10280 REFRESH_FLG=1
10290 RETURN 
10300 ! Delete Invoice Line
10310 DEL_INV_LINE:
10315 MSGBOX MSG("DELETE_REC"),MSG("VERIFY"),"?,YESNO",ANS$; IF ANS$="NO" THEN GOTO 10450
10320 CURR_IDX=0; NEXT_IDX=0; PREV_IDX=0
10330 CURR_IDX=INV_LINE_ARRAY[LINE_NUM]; NEXT_IDX=INV_LINE_ARRAY[LINE_NUM+1]
10332 DIM ARTD$(290),ARTD[48]; READ (Z[17],IND=CURR_IDX,DOM=*RETURN)IOL=0395 ! SSP 273864
10333 IF STP(MID(ARTD$,135,1))="" THEN GOTO 10340 ! SSP273864
10334 MSGBOX MSG("ARGEAA_SPL"),MSG("WARNING"),"?,YESNO,STOP",ANS$ ! SSP 273864
10335 IF ANS$="YES" THEN REPLACEMENT_SCRN$="ARGEAC.1"; ORD_LINE=1; DIM ARB[30]; FRT_AMT=0; FIND (Z[10],KEY=ORDER$)*,*,*,*,*,*,*,*,*,FS18,*,FS110; FRT_AMT=FS18+FS110; GOSUB RESTART_HEADER_INFO; GOSUB DEL_FS3_LINES ELSE GOTO *NEXT ! SP#228923 ! SSP242473 jdf SSP 273864
10336 CALL "*wingrp;enable",ADDLINE.GRP$; GOTO 10460 ! SSP273864
10340 IF NEXT_IDX=0 THEN NEXT_IDX=-1
10350 IF LINE_NUM<>0 THEN PREV_IDX=INV_LINE_ARRAY[LINE_NUM-1]
10360 IF PREV_IDX<>0 THEN {
10370 READ (Z[17],IND=PREV_IDX)IOL=0390
10380 ART9=NEXT_IDX
10390 WRITE (Z[17],IND=PREV_IDX)IOL=0390
10400  } ELSE {
10410 READ (Z[1],KEY=KEY_1$)IOL=0310
10420 ARB[20]=NEXT_IDX
10430 WRITE (Z[1],KEY=KEY_1$)IOL=0310
10440  }
10450 CALL "*wingrp;hide",DEL_LINE.GRP$; CALL "*wingrp;show",DEL_ORD.GRP$; CALL "*wingrp;enable",ADDLINE.GRP$
10452 DA5=CURR_IDX; GOSUB DEL_INV_FS3 ! 273864
10453 AXN_IDX$=STR(DA5:"00000000"); GOSUB DELETE_STATS
10455 GOSUB DELETE_INDEX
10458 IF %MSLC THEN CCKEY$="I"+INV_NUM$+CR_FY$+CR_ACCTPD$+DIM(4),RNUM$=STR(LINE_NUM:"000"); CALL "ARGSCM;MODIFY_INVOICE_LINE",CCKEY$,RNUM$,"D" ! SSP 225300 SSP 273864
10460 GOSUB CLEAR_LINE_INFO
10470 GOSUB GET_INVOICE_LINE
10480 CALL "*wingrp;hide",UPDATE.GRP$
10490 REFRESH_FLG=1
10495 RETURN 
10500 ! Select A/R Invoice Line
10510 SELECT_LINE:
10520 LIST_BOX READ INV_LINE.CTL,IDX
10530 LIST_BOX FIND INV_LINE.CTL,IDX,INV_LINE$
10540 LINE_NUM$=INV_LINE$(1,POS(SEP=INV_LINE$)-1); IF POS($1B53461B4233$=LINE_NUM$)<>0 THEN LINE_NUM$=LINE_NUM$(7)
10550 LINE_NUM=NUM(LINE_NUM$)
10560 READ (Z[17],IND=INV_LINE_ARRAY[LINE_NUM])IOL=0390
10570 GOSUB LOAD_LINE_INFO
10580 CALL "*wingrp;Disable",LINE.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; CALL "*wingrp;Show",UPDATE.GRP$; CALL "*wingrp;Disable",ADDLINE.GRP$; CALL "*wingrp;Disable",NEXT_1.GRP$
10583 CALL "*wingrp;hide",DEL_ORD.GRP$; CALL "*wingrp;show",DEL_LINE.GRP$
10585 IF NOT(NUL(ART$(47,3))) THEN CALL "*WINGRP;DISABLE",ORDER.GRP$
10587 IF POS(ORD_TYPE$="RW",1)>0 THEN CALL "*wingrp;Disable",ZERO_C.GRP$
10589 LINE_TYPE$=ART$(1,1); IF NOT(NUL(ORDER$)) THEN %LINE_T$=MSG("LINE_TYPEA"); %LINE_V$=MSG("LINE_TYPER"); DROP_BOX LOAD LINE_TYPE.CTL,%LINE_T$; LINE_TYPE.CTL'TBL$=%LINE_V$ ! SSP 186958  ! SSP215958 jdf
10590 GOSUB LINE_TYPE_PROC
10591 GOSUB GET_COMM_CODE ! SSP218368 jdf
10592 GROSS_PROFIT_AMT=SELL_PRICE_EXT-COST_EXT; PRECISION 4; IF SELL_PRICE_EXT<>0 THEN GROSS_PROFIT_PER=GROSS_PROFIT_AMT/SELL_PRICE_EXT*100; PRECISION 2 ! SSP 177566
10593 GOSUB CHECK_FS2_FILE; %NO_ACCESS=0; FIND (Z[20],KEY=ORDER$+ART$(47,3),DOM=*NEXT); %NO_ACCESS=1,%LINE_T$=%B_LINE_T$,%LINE_V$=%B_LINE_V$; DROP_BOX LOAD LINE_TYPE.CTL,%LINE_T$; LINE_TYPE.CTL'TBL$=%LINE_V$ ! ssp 186958
10594 LINE_TYPE$=ART$(1,1); IF MID(P2$,68,1)="Y" AND MID(AR4$,32,1)="L" THEN CALL "*wingrp;show",SIC_BOX.GRP$; END_IF ; IF MID(P2$,68,1)<>"Y" AND MID(AR4$,32,1)="L" THEN CALL "*wingrp;show",COMM_BOX.GRP$ ! SSP 186958  ! SSP218368 jdf
10595 IF %MSLC THEN SHOW CONTROL BT_COMM.CTL; ENABLE CONTROL BT_COMM.CTL; CALL "*wingrp;hide",MCOMM_BOX.GRP$ ! HIDE CONTROL COMM_CODE1.CTL; ID=COMM_CODE1.CTL; HIDE CONTROL ID+3000; HIDE CONTROL %SIC_DESC.CTL ! SP  225300
10598 RETURN ! SSP 225300
10600 DEL_INV_FS3:! SSP 273864
10610 DIM DB$(50); READ (Z[17],IND=DA5)DA,DB$
10620 FS3_LN$=DB$(47,3)
10625 IF FS3_LN$="FRT" OR STP(FS3_LN$,2)="" THEN RETURN 
10630 FS3_LNE=NUM(FS3_LN$,ERR=*RETURN)
10640 DKEY$=INV_NUM$+ORDER$+STR(FS3_LNE:"000")
10645 READ (Z[26],KEY=DKEY$,DOM=*NEXT)
10650 NEXT_FS3:
10655 FS3_KY$=KEY(Z[26],END=DEL_FS3_EXIT)
10660 READ (Z[26],KEY=FS3_KY$)*; IF FS3_KY$(1,LEN(DKEY$))<>DKEY$ THEN GOTO DEL_FS3_EXIT
10670 REMOVE (Z[26],KEY=FS3_KY$,ERR=*NEXT)
10675 ! GOTO NEXT_FS3
10680 DEL_FS3_EXIT:
10690 RETURN 
10699 ! 
10700 ! This will load the line information
10710 LOAD_LINE_INFO:
10720 LINE_NUM$=STR(LINE_NUM)
10730 LINE_TYPE$=ART$(1,1); INV_LOC_CODE$=ART$(89,4); IF STP(ART$(89,4))<>"" THEN GOSUB GET_DIST_LOC ! ssp 187861
10740 ITEM_CODE$=ART$(65,10); TF_DESC$=ART$(7,40)
10750 PROD_CODE$=ART$(3,3)
10760 LEFT_RIGHT$=ART$(93,8); TOP_BOTTOM$=ART$(101,8); PLYS$=ART$(109,2)
10765 UNIT$=ART$(50,4)
10770 PRINT_ON_INV$=ART$(6,1)
10775 QTY=FN%QTY_IN_UM(ART[0],ART$(50,4),ART[6]); QTY_SHIP=FN%QTY_IN_UM(ART[1],ART$(50,4),ART[6]) ! IF P4$(20,1)<>"Y" THEN QTY=ART[0]/ART[6],QTY_SHIP=ART[1]/ART[6] ELSE QTY=ART[0],QTY_SHIP=ART[1]
10780 QTY_PER_UNIT=ART[6]; QTY_ORDERED=QTY; QTY_SHIPPED=QTY_SHIP
10790 UNIT_SELL_PRICE=ART[2]; UNIT_COST=ART[3]
10800 SELL_PRICE_EXT=ART[4]; COST_EXT=ART[5]
10810 COMM_CODE$=ART$(84,5),COMM_CODE1$=COMM_CODE$; SALES_DIST_CODE$=ART$(75,9) ! SSP 199976
10820 ORDER_TYPE$=ART$(111,1); STAX_CODE_2$=ART$(125,10)
10830 GP_ADJ_B4_LOAD=ART[8]; COMM_AMT=ART[7]
10840 TAXABLE$=ART$(54,1)
10850 IGNORE_PCS_STATE$=MID(ART$,146,1),IGNORE_PCS_COUNTY$=MID(ART$,147,1),IGNORE_PCS_CITY$=MID(ART$,148,1); CALL "*WINGRP;DISABLE",PCS_EXEMPT.GRP$ ! WO 249775
10860 IF MID(AR4$,32,1)<>"L" THEN CALL "*WINGRP;DISABLE",COMM.GRP$ ELSE CALL "*WINGRP;ENABLE",COMM.GRP$
10865 IF %MSLC THEN IF MID(AR4$,32,1)<>"L" THEN DISABLE CONTROL BT_COMM.CTL ELSE ENABLE CONTROL BT_COMM.CTL ! SSP 225300
10870 NEXT_ID=LINE_TYPE.CTL
10880 REFRESH_FLG=1
10890 RETURN 
11000 ! loading lines
11010 LOAD_INV_LINE_INFO:
11020 ART$(1,1)=LINE_TYPE$; ART$(89,4)=INV_LOC_CODE$
11025 ! ART$(55,10)=CUSTOMER$
11030 ART$(65,10)=ITEM_CODE$; ART$(7,40)=TF_DESC$
11040 ART$(3,3)=PROD_CODE$
11043 ! GOSUB PROD_CODE_INFO
11046 ART$(75,9)=MID(FMP2$,24,9)
11050 ART$(93,8)=LEFT_RIGHT$; ART$(101,8)=TOP_BOTTOM$; ART$(109,2)=PLYS$
11060 ART$(50,4)=UNIT$; GOSUB UM_PARAM; GOSUB UM_PARAM_SET
11062 QTY=QTY_ORDERED*PVAL ! SSP 258706
11064 QTY_SHIP=QTY_SHIPPED*PVAL ! SSP 258706
11065 ! IF MID(P4$,20,1)<>"Y" THEN QTY=QTY_ORDERED*QTY_PER_UNIT ELSE QTY=QTY_ORDERED
11067 ! F MID(P4$,20,1)<>"Y" THEN QTY_SHIP=QTY_SHIPPED*QTY_PER_UNIT ELSE QTY_SHIP=QTY_SHIPPED
11070 ART[6]=QTY_PER_UNIT; ART[0]=QTY; ART[1]=QTY_SHIP
11080 ART[2]=UNIT_SELL_PRICE; ART[3]=UNIT_COST
11090 ART[4]=SELL_PRICE_EXT; ART[5]=COST_EXT
11100 ART$(84,5)=COMM_CODE$; ART$(75,9)=SALES_DIST_CODE$
11110 ART$(111,1)=ORDER_TYPE$; ART$(125,10)=STAX_CODE_2$
11120 ART[8]=GP_ADJ_B4_LOAD; ART[7]=COMM_AMT
11130 ART$(54,1)=TAXABLE$
11140 ART$(6,1)=PRINT_ON_INV$
11190 RETURN 
11200 ! Write the Index Info
11210 WRITE_IDX_INFO:
11220 IF INV_LINE_ARRAY[LINE_NUM]<>0 THEN WRITE (Z[17],IND=INV_LINE_ARRAY[LINE_NUM])IOL=0390
11290 RETURN 
11500 DEL_FS3_LINES:! Remove FS3 lines  ! SSP242473 jdf
11510 DIM FS3$(50),FS3[9] ! SSP242473 jdf
11515 FS3_KEY_D$=INV_NUM$+ORDER$ ! SSP242473 jdf
11520 READ (Z[26],KEY="",DOM=*NEXT) ! SSP242473 jdf
11530 FS3_KEY$=KEY(Z[26],END=11600) ! SSP242473 jdf
11540 READ (Z[26],KEY=FS3_KEY$)IOL=0465 ! SSP242473 jdf
11560 IF FS3_KEY$(1,16)=FS3_KEY_D$ THEN {! SSP242473 jdf
11570 REMOVE (Z[26],KEY=FS3_KEY$,DOM=*NEXT) ! SSP242473 jdf
11580  } ! SSP242473 jdf
11590 GOTO 11530 ! SSP242473 jdf
11600 RETURN ! SSP242473 jdf
12000 ! Save Invoice Line
12010 SAVE_INV_LINE:
12020 READ (Z[1],KEY=KEY_1$)IOL=0310
12030 IF ARB[20]=0 OR ARB[20]=-1 THEN ARB[20]=A9; WRITE (Z[1],KEY=KEY_1$)IOL=0310; GOTO 12100
12040 READ (Z[17],IND=ARB[20])IOL=0390
12050 IF ART9=-1 OR ART9=0 THEN ART9=A9; IF ARB[20]<>0 THEN WRITE (Z[17],IND=ARB[20])IOL=0390; GOTO 12100
12055 NEXT_IDX=ART9
12060 READ (Z[17],IND=ART9)IOL=0390
12070 IF ART9=-1 OR ART9=0 THEN ART9=A9; IF NEXT_IDX<>0 THEN WRITE (Z[17],IND=NEXT_IDX)IOL=0390; GOTO 12100
12080 GOTO 12055
12100 ! 
12110 GOSUB LOAD_NEW_LINE
12120 ART9=(-1)
12150 IF A9<>0 THEN WRITE (Z[17],IND=A9)IOL=0390
12170 INV_LINE_ARRAY[NUM(LINE_NUM$)]=A9
12180 REFRESH_FLG=1
12190 RETURN 
12200 ! Save Order Line
12210 SAVE_ORD_LINE:
12220 READ (Z[1],KEY=KEY_1$)IOL=0310
12230 IF ARB[20]=0 OR ARB[20]=-1 THEN ARB[20]=A9; WRITE (Z[1],KEY=KEY_1$)IOL=0310; GOTO 12300
12240 READ (Z[17],IND=ARB[20])IOL=0390
12250 IF ART9=-1 OR ART9=0 THEN ART9=A9; IF ARB[20]<>0 THEN WRITE (Z[17],IND=ARB[20])IOL=0390; GOTO 12300
12255 NEXT_IDX=ART9
12260 READ (Z[17],IND=ART9)IOL=0390
12270 IF ART9=-1 OR ART9=0 THEN ART9=A9; IF NEXT_IDX<>0 THEN WRITE (Z[17],IND=NEXT_IDX)IOL=0390; GOTO 12300
12280 GOTO 12255
12300 ! 
12310 GOSUB CREATE_INV_LINE
12320 ART9=(-1)
12350 IF A9<>0 THEN WRITE (Z[17],IND=A9)IOL=0390
12380 REFRESH_FLG=1
12390 RETURN 
12500 ! QTY OREDERED...
12510 QTY_ORDER:
12520 IF POS(LINE_TYPE$="IC")=0 THEN RETURN 
12525 GOSUB UM_PARAM ! SSP257510 ! GOSUB UM_PARAM
12530 FOR ZZ9=1 TO 11 STEP 2
12535 IF IC0[ZZ9]=0 THEN GOTO 12560
12540 Q_B=FN%QTY_IN_UM(IC0[ZZ9],UNIT$,QTY_PER_UNIT) ! IF P4$(20,1)<>"Y" THEN Q_B=IC0[ZZ9]*QTY_PER_UNIT ELSE Q_B=IC0[ZZ9]
12550 IF QTY_ORDERED>=Q_B THEN UNIT_SELL_PRICE=IC0[ZZ9+1]
12560 NEXT ZZ9
12570 ! IF STP(UNIT$)="M" THEN Q_B=IC0[11]/QTY_PER_UNIT ELSE Q_B=IC0[11]
12580 ! IF IC0[11]<>0 AND QTY_ORDERED>Q_B THEN UNIT_SELL_PRICE=IC0[12]
12590 RETURN 
13000 ! load New Invoice Line
13010 LOAD_NEW_LINE:
13020 DIM ART$(290),ART[48] ! WO249775
13030 ART$(1,1)=LINE_TYPE$; ART$(89,4)=INV_LOC_CODE$
13035 IF LINE_TYPE$="S" THEN GOSUB GET_FRT_TYPE ! mark frt line SSP187907
13038 ART$(3,3)=PROD_CODE$ ! SSP 275494
13040 ART$(65,10)=ITEM_CODE$; ART$(7,40)=TF_DESC$
13045 ART$(54,1)=TAXABLE$; IF ID$="BUTTON_1" AND TAXABLE$<>"" THEN GOTO 13049 ! SSP 229711
13046 LOC_TAX$="Y"; IF LOC_EXEMPT$="Y" THEN LOC_TAX$="N"; REM SSP 187704
13047 ART$(54,1)=LOC_TAX$; TAXABLE$=ART$(54,1); REM SSP 187704
13048 IF ART$(54,1)="Y" AND ART$(2,1)="Y" THEN ART$(54,1)="F"
13049 IF MID(FMP2$,23,1)="N" THEN TAXABLE$="N",ART$(54,1)="N"
13050 ! 
13053 GOSUB PROD_CODE_INFO
13056 ART$(75,9)=MID(FMP2$,24,9)
13060 ART$(93,8)=LEFT_RIGHT$; ART$(101,8)=TOP_BOTTOM$; ART$(109,2)=PLYS$
13070 ART$(50,4)=UNIT$; GOSUB UM_PARAM; GOSUB UM_PARAM_SET
13072 QTY=QTY_ORDERED*PVAL,QTY_SHIP=QTY_SHIPPED*PVAL ! SSP 258706
13075 ! F MID(P4$,20,1)<>"Y" THEN QTY=QTY_ORDERED*QTY_PER_UNIT,QTY_SHIP=QTY_SHIPPED*QTY_PER_UNIT ELSE QTY=QTY_ORDERED,QTY_SHIP=QTY_SHIPPED
13080 ART[6]=QTY_PER_UNIT; ART[0]=QTY; ART[1]=QTY_SHIP
13090 ART[2]=UNIT_SELL_PRICE; ART[3]=UNIT_COST
13100 ART[4]=SELL_PRICE_EXT; ART[5]=COST_EXT
13110 ART$(84,5)=COMM_CODE$; ART$(75,9)=SALES_DIST_CODE$
13120 ART$(111,1)=ORDER_TYPE$; ART$(125,10)=STAX_CODE_2$
13130 ART[8]=GP_ADJ_B4_LOAD; ART[7]=COMM_AMT
13145 ART$(6,1)=PRINT_ON_INV$
13150 ! GOSUB GET_NEXT_INDEX
13190 RETURN 
13199 ! 
13200 CHECK_LOTS:! SSP223646 jdf
13205 FY_AP$=CR_FY$+CR_ACCTPD$ ! ""; IF ORDER$(1,1)="#" THEN FY_AP$=ORDER$(2,6),ORDER$=ORDER$(8) ! SSP223646 jdf SSP 265115
13210 IOLIST W$,W{ALL} ! SSP223646 jdf
13220 DIM W$(270),W[12] ! SSP223646 jdf
13230 READ (Z[20],KEY=ORDER$,DOM=*NEXT) ! SSP223646 jdf
13235 NEXT_FS2:
13240 KEY_20$=KEY(Z[20],END=13500); READ (Z[20])IOL=0460 ! SSP223646 jdf
13242 IF KEY_20$(1,8)<>ORDER$ THEN GOTO 13500 ! SSP223646 jdf!SSP#271836
13245 READ (Z[10],KEY=FS2$(147,8),DOM=*NEXT)IOL=0450 ! SSP223646 jdf
13265 GOSUB SET_UM_DIV
13270 IF FS2$(2,1)<>"Y" THEN GOTO NEXT_FS2 ! SSP223646 jdf
13290 IF FS2[0]<0 THEN GOTO NEXT_FS2 ! SSP223646 jdf
13292 DIM FS3$(50),FS3[9]
13295 FIND (Z[26],KEY=INV_NUM$+KEY_20$+" ",DOM=NEXT_FS2)IOL=0465
13300 WQ=0,WK$=FS2$(161,10)+FS2$(19,10)+FS2$(10,4),WQ1=0,WF=0,F=0 ! SSP223646 jdf!SSP#277378 tma - added as root 5/15/2015
13305 READ (Z[27],KEY=WK$,DOM=*NEXT) ! SSP223646 jdf
13310 READ (Z[27],END=13380)IOL=13210 ! SSP223646 jdf
13315 IF W$(1,LEN(WK$))<>WK$ THEN GOTO 13380 ! SSP223646 jdf
13320 IF W$(110,11)<>FS2$(147,8)+FS2$(6,3) THEN GOTO 13310 ! SSP223646 jdf
13325 IF W$(110,11)=FS2$(147,8)+FS2$(6,3) THEN WQ1=WQ1+W[0],WF=WF+W[1]; IF STP(W$(125,4))="" THEN WQ=WQ+W[4]*W[3] ELSE WQ=WQ+W[4]*W[2]*W[3] ! SSP223646 jdf
13330 GOTO 13310 ! SSP223646 jdf
13380 DIM FS1(13); READ (Z[10],KEY=FS2$(147,8),DOM=*NEXT)IOL=0450 ! SSP223646 jdf
13384 Q0=WQ ! SSP223646 jdf
13385 IF STP(FS3$)<>"" THEN IF WQ<>FS3[0] THEN GOTO 13390 ELSE C=WQ1,WQ1=WQ; GOTO 13440 ! SSP223646 jdf
13390 IF M=0 THEN M=1 ! SSP223646 jdf
13392 IF STP(FS3$)<>"" THEN WQ0=FS3[0]/M,WQ1=FS3[0] ! SSP223646 jdf
13393 WX$=WK$+FS2$(147,8)+FS2$(6,3),Q0=WQ0,C=0,F=0,S3$="",S2=0,S1$="",S3=0 ! SSP223646 jdf
13394 DIM I0$(40); FIND (Z[6],KEY=X3$(9,3)+"I/C",DOM=*NEXT)I0$; IF POS(I0$(52,1)="ABO")<>0 THEN GOSUB AUTO_LOTS; GOTO 13440 ! SSP223646 jdf
13395 GOSUB CREATE_ITEM_HEAD; AR4$="15",AR5$=STR(WX$),AR6$=STR(Q0),AR7$=STR(C),AR8$=STR(F),AR9$="",AR10$="",AR11$="",AR12$=S3$,AR13$="",S1=0,AR14$=STR(S1),AR15$=STR(S2),ARG16$=S1$,AR17$=STR(S3),%LOT_PGM$="O/E"; PROCESS "ICGTDA.3","../ICG/IC.EN",X3$,X4$," ",AR4$,AR5$,AR6$,AR7$,AR8$,AR9$,AR10$,AR11$,AR12$,AR13$,AR14$,AR15$,AR16$,AR17$; Q0=NUM(AR6$),C=NUM(AR7$),F=NUM(AR8$),S3$=AR12$,S1=NUM(AR14$),S2=NUM(AR15$),S1$=AR16$,%LOT_PGM$="" ! ,UNIT_COST$=STR(C); SSP223646 jdf
13440 IF FS2$(10,1)="9" THEN C=0,F=0 ! SSP223646 jdf
13442 IF STP(FS3$)<>"" THEN IF Q0<>FS3[0] THEN FS3[3]=FS3[3]+(FS3[0]-Q0); IF FS3[3]<0 THEN FS3[3]=0 ! SSP223646 jdf
13444 FS3[0]=Q0,WK0$=FS2$(147,8)+FS2$(6,3) ! SSP223646 jdf
13446 DIM I0$(40); FIND (Z[6],KEY=X3$(9,3)+"I/C",DOM=*NEXT)I0$ ! SSP223646 jdf
13448 IF I0$(64,1)<>"Y" OR S3$="" THEN GOTO 13470 ! SSP223646 jdf
13450 IF FNS$(S3$(9,3))="" THEN GOTO 13470 ELSE FIND (Z[14],KEY="T"+S3$(9,3),DOM=13470)IOL=0445; FS2$(29,3)=S3$(9,3) ! SSP223646 jdf
13452 IF FMP3$(22,1)="N" THEN FS2[9]=0 ! SSP223646 jdf
13454 FS2$(136,1)="Y"; IF FS1$(86,1)<>"Y" THEN FS2$(136,1)="N" ! SSP223646 jdf
13456 ON POS(FMP3$(23,1)="NC") GOTO 13462,13458,13460 ! SSP223646 jdf
13458 FS2$(136,1)="N"; GOTO 13462 ! SSP223646 jdf
13460 IF FS2$(136,1)="Y" THEN FS2$(136,1)="C" ! SSP223646 jdf
13462 DIM FMM$(300); READ (Z[6],KEY=X3$(9,3)+"F/M",DOM=*NEXT)FMM$; IF FMM$(186,1)="Y" THEN IF POS(" "<>FMP3$(38,5))>0 THEN FS2$(128,5)=FMP3$(38,5) ! SSP223646 jdf
13470 IF S3$>"" THEN IF FNS$(S3$(12,5))>"" THEN FS2$(128,5)=S3$(12,5) ! SSP223646 jdf
13471 IF %MSLC THEN GOSUB MULTI_COMM_KEY; CALL "ARGSCM;COMM_PROD_OVERRIDE",SC_KEY$,S3$; RETURN ! SSP225300
13472 CALL "FM2EXT",Z[6],1,FS2$(124,4),FS2[5],Q0,WQ9,C,M6[1] ! SSP223646 jdf
13474 FS3[6]=WQ9,FS3[4]=C ! SSP223646 jdf
13476 WQ=Q0; CALL "FM2EXT",Z[6],1,FS2$(120,4),FS2[2],WQ,WQ9,C,M6[1] ! SSP223646 jdf
13478 FS2[1]=WQ9,FS2[3]=C; IF F<>0 THEN FS2[17]=F ! SSP223646 jdf
13480 WRITE (Z[20],KEY=WK0$)IOL=0460 ! SSP223646 jdf
13482 CALL "FM2EXT",Z[6],0,FS2$(124,4),FS2[5],FS3[0],FS3[1],WQ9,M6[1]; FS3[2]=WQ9 ! SSP223646 jdf
13495 FS3$(31,6)=FY_AP$; WRITE (Z[26],KEY=INV_NUM$+KEY_20$+" ")IOL=0465 ! SSP223646 jdf
13497 GOTO NEXT_FS2
13499 ! 
13500 RETURN 
13505 ! 
13600 FS3_DEFAULT:! SSP223646 jdf
13601 DIM FS3$(50),FS3[9] ! SSP223646 jdf
13602 QQ1$=PAD(ARG_8$+ARG_9$,6)+PAD(INV_NUM$,8)+PAD(INV_DATE$,6)+PAD(ORDER$,8); CALL "ARGEAU;SET_FS3_DFLT",(X3$),(X4$),QQ1$,KEY_20$,FS3$,FS3{ALL}; RETURN 
13603 ! 
13700 AUTO_LOTS:! SSP223646 jdf
13710 WLOT_LINE=12,WLOT_TYPE$=I0$(52,1) ! SSP223646 jdf
13715 IF Q0=0 THEN WSAVE_LOT_TYPE$=WLOT_TYPE$,WLOT_TYPE$="D" ! SSP223646 jdf
13720 S1=0; CALL "IC2LCA",X3$,X4$,WLOT_TYPE$,WLOT_LINE,WX$,Q0,C,F,S1,S1$,S2,S3$,S3,S4; IF Q0=0 THEN WLOT_TYPE$=WSAVE_LOT_TYPE$,WSAVE_LOT_TYPE$="" ! SSP223646 jdf
13725 IF Q0=-1 THEN Q0=0 ELSE WBO_MSG=1 ! SSP223646 jdf
13730 IF Q0<FS2[0] THEN {! SSP223646 jdf
13735 FS2[7]=Q0,FS2[8]=FS2[0]-FS2[7] ! SSP223646 jdf
13740  } ELSE {! SSP223646 jdf
13745 FS2[8]=0,FS2[7]=Q0 ! SSP223646 jdf
13750  } ! SSP223646  jdf
13755 WBO_MSG=0 ! SSP223646 jdf
13760 RETURN ! SSP223646 jdf
13800 CREATE_ITEM_HEAD:! SSP223646 jdf
13810 WD8$=FS2$(6,3)+"   "+FNS$(FS2$(19,10))+"-"+FNS$(FS2$(50,40)) ! SSP223646 jdf
13815 IF FS2$(18,1)="Y" THEN WD7$="(Special ship)" ELSE WD7$="" ! SSP223646 jdf
13820 WD9$=FNS$(FS2$(124,4))+"/"+FNR$(STR(M0:"##,##0")) ! SSP223646 jdf
13825 IF WF2$<>"Y" THEN WD10$=STR((FS3[0]/M):"##,###,###.00-") ELSE WD10$="" ! SSP223646 jdf
13830 IF WF2$<>"Y" AND MM$(21,1)<>"Y" THEN WD11$=STR(FS3[1]:M6$) ELSE WD11$="" ! SSP223646 jdf
13835 IF FS3[2]<>0 THEN WD12$=STR(FS3[2]:"###,###.00-"); END_IF ; IF FS3[3]<>0 THEN WD13$=STR(FS3[3]:"##,###,###.00-") ! SSP223646 jdf
13837 REFRESH_FLG=1 ! SSP223646 jdf
13838 MSGBOX MSG("ARGEAA_ICF",ORDER$,FS2$(6,3),STP(STR((FS3[0]/M):"##,###,###.00-"),2," ")) ! SSP223646 jdf
13840 RETURN ! SSP223646 jdf
14000 HANDLE_DONT_INV_OVERRUNS:! WO263619, if cust parm set and order line has PO code and bill now quantity is greater than ordered quantity (overrun) then set bill now quantity to ordered quantity and recalculate bill now extension, backordered amount and unit cost in FS3 record.
14010 FS3[0]=FS2[0],FS3[3]=0 ! Bill now quantity to ordered quantity, BO amt to 0
14015 DIM SELL_UM$(21),SELL_UM[1]
14020 READ (Z[6],KEY="U/M"+FS2$(124,4),DOM=*NEXT)SELL_UM$(1),SELL_UM[0],SELL_UM[1]
14025 IF SELL_UM$(21,1)="Y" THEN FS3[1]=0,FS3[2]=FS2[6]; GOTO 14050 ! no unit entry
14035 Z2=0; CALL "FM2EXT",Z[6],0,FS2$(124,4),FS2[5],FS3[0],FS3[1],Z2,M6[1]; FS3[2]=Z2 ! bill now extension
14050 Z3=0; CALL "FM2EXT",Z[6],1,FS2$(124,4),FS2[5],FS3[0],Z3,FS3[4],M6[1]; FS3[6]=Z3 ! unit cost
14090 RETURN 
14095 ! 
14500 DELETE_STATS:! SSP 307216 
14510 FOR SLSP=0 TO 4
14521 IF ARB$(133+SLSP*4,4)=DIM(4) THEN EXITTO 14530
14522 IF MID(AR4$,32,1)="L" THEN SEQ$="001" ELSE IF MID(AR4$,32,1)="I" THEN SEQ$="000"
14524 DIM DET_IN$(146); DET_IN$(1,4)=ARB$(133+SLSP*4,4),DET_IN$(5,6)=ARB$(1,6),DET_IN$(11,1)=ARB$(77,1),DET_IN$(12,8)=ARB$(7,8),DET_IN$(20,3)=SEQ$,DET_IN$(23,5)=ARB$(128,5),DET_IN$(28,1)=%BRACKET$,DET_IN$(29,1)=" ",DET_IN$(30,10)=ARB$(15,10),DET_IN$(40,6)=ARB$(86,6),DET_IN$(46,8)=STR(ARB5:"00000000"),RWD$="W",F_YEAR$=ARB$(1,4),ACCT_PER$=ARB$(5,2)
14525 DIM STAT_IN[14],STAT_OUT[14]
14526 DIM DET_IN[7]; DET_IN[0]=ARB[1]-ARB[11]+ARB[19]*ARB[12+SLSP]/100,DET_IN[1]=ARB[SLSP+21],DET_IN[3]=ARB[1]*ARB[12+SLSP]/100,DET_IN[4]=ARB[11],DET_IN[2]=ARB[26+SLSP]
14527 RWD$="D"; REM "AMOUNT=DET_IN[0]
14528 CALL "AR2XAC",X3$,X4$,RWD$,DET_IN$,DET_IN{ALL},DET_OUT$,DET_OUT{ALL},STIN$,STAT_IN{ALL},STAT_OUT$,STAT_OUT{ALL},F_YEAR$,ACCT_PER$,TRANS_T$,AMOUNT,AXN_IDX$,UNUSED_2$,UNUSED1,UNUSED2
14529 NEXT SLSP
14530 RETURN 
14590 RETURN 
15000 ! Product Code Information
15010 PROD_CODE_INFO:
15015 IF NUL(PROD_CODE$) THEN NEXT_ID=PROD_CODE.CTL; RETURN 
15020 KEY_14$="T"+PROD_CODE$
15025 DIM FMP2$(100),FMP[4]
15030 READ (Z[14],KEY=KEY_14$,DOM=*RETURN)IOL=0440
15040 SALES_DIST_CODE$=MID(FMP2$,24,9)
15050 ! COMM_CODE$=FMP2$(38,5)
15055 IF ID$="BUTTON_1" AND TAXABLE$<>"" THEN GOTO 15066 ! SSP 229711
15060 TAXABLE$=MID(FMP2$,23,1)
15061 ART$(54,1)=TAXABLE$ ! SSP222711
15065 IF MID(FMP$,60,1)="Y" AND TAXABLE$="Y" THEN TAXABLE$="F" ! SSP
15070 ! IF MID(FMP2$,23,1)="N" THEN TAXABLE_FMP$="N" ELSE TAXABLE_FMP$="Y"; REM IF A C OR A BLANK..SET TO TAXABLE PER LORI
15080 REFRESH_FLG=1
15100 ! 
15110 S3=POS(LINE_TYPE$="FICNS"); IF S3=0 THEN RETURN 
15120 C3$="*"+LINE_TYPE$+X3$(9,3)+COMM_CODE$,CM3$=C3$ ! ssp 225300
15130 CALL "AR2COM","DEFAULT",C3$,C{ALL},Z[6],0,0
15140 COMM_CODE$=C3$,COMM_CODE1$=COMM_CODE$ ! SSP 199976
15145 IF %MSLC THEN GOSUB MULTI_COMM_KEY; CALL "AR2MCM","DEFAULT",CM3$,C{ALL},Z[6],0,0,"",SC_KEY$,0 ! SSP 225300
15150 GOSUB CALC_COMM
15180 REFRESH_FLG=1
15190 RETURN 
15300 ! UNIT OD MEASURE CALCULATION
15310 UM_PARAM:
15320 READ (Z[6],KEY="U/M"+UNIT$,DOM=*RETURN)P4$,P3,P4
15390 RETURN 
15400 UM_PARAM_SET:
15410 PP3=0,PP4=0
15420 READ (Z[6],KEY="U/M"+UNIT$,DOM=*RETURN)PP4$,PP3,PP4
15430 IF PP4$(20,1)="Y" THEN PVAL=PP4 ELSE PVAL=ART[6] ! SSP 258706
15435 IF PVAL=0 THEN PVAL=1 ! SSP 258706
15450 RETURN 
15499 ! 
15500 ! Base Price Info
15510 QTY_BREAK:
15520 CALL "*wingrp;hide",LINE.GRP$; CALL "*wingrp;show",QTY_B.GRP$
15525 FOR XX9=0 TO 12; LIST_BOX LOAD PRICE_BREAK.CTL,0,*; NEXT XX9
15530 LIST_BOX LOAD PRICE_BREAK.CTL,0,STR(IC0[0]:"###,###,###.00")+SEP+""+SEP+""
15534 ! GOSUB UM_PARAM
15540 FOR ZZ9=1 TO 11 STEP 2
15550 IF IC0[ZZ9]=0 THEN GOTO 15570
15555 IC0[ZZ9]=FN%QTY_IN_UM(IC0[ZZ9],UNIT$,QTY_PER_UNIT) ! IF P4$(20,1)<>"Y" THEN IC0[ZZ9]=IC0[ZZ9]/QTY_PER_UNIT
15560 LIST_BOX LOAD PRICE_BREAK.CTL,0,""+SEP+STR(IC0[ZZ9]:"###,###.00")+SEP+STR(IC0[ZZ9+1]:"###,###,###.00")
15570 NEXT ZZ9
15590 RETURN 
15600 ! Switch List box
15610 SWITCH_LIST_BOX:
15620 CALL "*wingrp;show",LINE.GRP$; CALL "*wingrp;hide",QTY_B.GRP$
15680 REFRESH_FLG=1
15690 RETURN 
15900 ! Calculate Commission Amount
15910 CALC_COMM:
15920 GOSUB GET_COMM_CODE ! SSP218368 jdf
15922 IF END_SLP=0 THEN RETURN ! SSP 225300
15925 FOR SLM=1 TO END_SLP ! SSP 225300
15928 KEY_8$=COMM_STR$((SLM*5)-4,5) ! SSP 225300   
15930 READ (Z[8],KEY=KEY_8$,DOM=*CONTINUE)IOL=0360 ! SSP 225300
15935 %SIC_DESC$=%COMMISSION_DESC$ ! SSP245416 jdf
15940 IF AR4$(32,1)<>"L" THEN COMM_AMT=0; CALL "*WINGRP;DISABLE",COMM.GRP$; EXITTO 15990 ELSE CALL "*WINGRP;ENABLE",COMM.GRP$ ! SSP 225300 SSP 243177 ! SSP245416 jdf
15950 IF AR4$(31,1)="T" THEN Q=0; IF POS(LINE_TYPE$="IC")>0 THEN CALL "FM2EXT",Z[6],0,UNIT$,QTY_PER_UNIT,QTY_SHIP,EE9,Q,2 ELSE Q=(COST_EXT-GP_ADJ_B4_LOAD)/.6
15960 X$="  "+ART$(112,4)+"[X3$B]"+X3$+"[X3$E]"+"[A$]"+ARB$+"[B$]"+ART$
15962 GOSUB LOAD_INV_LINE_INFO; DIM EXTRA(20) ! SSP 225300
15964 IF %MSLC THEN {
15965 CMKEY$="I"+INV_NUM$+CR_FY$+CR_ACCTPD$+DIM(4)+STR(NUM(LINE_NUM$):"000"); CALL "AR2MCM",X$,AR4$,AR4{ALL},Q,SELL_PRICE_EXT,COST_EXT-GP_ADJ_B4_LOAD,CMKEY$,SLM,EXTRA$,ARB{ALL},ART{ALL},EXTRA{ALL} ! SSP 225300"
15966  } ELSE {! SSP 225300
15968 CALL "AR2COM",X$,AR4$,AR4{ALL},Q,SELL_PRICE_EXT,COST_EXT-GP_ADJ_B4_LOAD,EXTRA$,ARB{ALL},ART{ALL},EXTRA{ALL} ! SSP 225300
15969  } ! SSP 225300
15970 COMM_AMT=Q
15975 NEXT SLM ! SSP225300
15980 REFRESH_FLG=1
15990 RETURN 
16000 ! Get the Unit of Measure Amount
16010 PROCESS_UM:
16015 IF NUL(UNIT$) THEN NEXT_ID=UNIT.CTL; RETURN 
16020 UNIT$=PAD(UNIT$,4)
16030 GOSUB UM_PARAM
16035 IF LINE_TYPE$="N" THEN QTY_PER_UNIT=P3 ! SSP215958  jdf
16040 IF STP(UNIT$)="EACH" OR STP(UNIT$)="EA" THEN QTY_PER_UNIT=1; REFRESH_FLG=1; RETURN 
16050 IF MID(P4$,20,1)="Y" THEN {
16060 IF P3>0 THEN QTY_PER_UNIT=P3 ELSE QTY_PER_UNIT=P4 END_IF ; CALL "*wingrp;lock",U_M.GRP$; NEXT_ID=QTY_ORDERED.CTL ! SSP257510, fixed qty per U/M, set from U/M record and lock qty_per_unit REM QTY_PER_UNIT=P3 ! SSP205058 jdf
16070  } ELSE {
16080 CALL "*wingrp;unlock",U_M.GRP$; NEXT_ID=QTY_PER_UNIT.CTL }
16082 IF MID(P4$,21,1)="Y" THEN CALL "*wingrp;lock",UM_SKIP_UNITS.GRP$; CALL "*wingrp;disable",UM_SKIP_UNITS.GRP$; UNIT_SELL_PRICE=0,UNIT_COST=0 ELSE CALL "*wingrp;unlock",UM_SKIP_UNITS.GRP$; CALL "*wingrp;enable",UM_SKIP_UNITS.GRP$ ! SSP257510, if U/M set to skip unit price and cost then lock UNIT_SELL_PRICE, UNIT_COST." 
16085 REFRESH_FLG=1
16090 RETURN 
16500 GET_COMM_CODE:! Find Commision Code  ! SSP218368 jdf
16505 COMM_STR$="",END_SLP=0 ! SSP 225300  SSP301135   
16510 KEY_8$=COMM_CODE$ ! SSP218368 jdf
16520 READ (Z[8],KEY=KEY_8$,DOM=*RETURN)IOL=0360 ! SSP218368 jdf
16530 IF NOT(%MSLC) THEN COMM_STR$=KEY_8$; GOTO 16566 ! SSP 235187
16540 DTC=1; DIM MCCDE$[5],MCSPLT[5]; GOSUB MULTI_COMM_KEY; COMM_STR$=""; CALL "ARGSCM;GET_INVOICE_COMM",SC_KEY$,COMM_STR$ ! SSP 225300
16566 IF STP(COMM_STR$,2)="" THEN END_SLP=0 ELSE END_SLP=LEN(COMM_STR$)/5
16590 RETURN ! SSP218368 jdf  ssp 225300
17000 ! Update an exsisting line to the listbox
17010 UPDATE_LINE:
17020 IF NUL(LINE_TYPE$) THEN RETURN 
17022 IF ABS(UNIT_SELL_PRICE)<ABS(UNIT_COST) THEN MSGBOX "Price Less than cost",MSG("WARNING"),"!" ! REMOVED GOTO SEE REF# 195573 GOTO 17050
17023 IF LINE_TYPE$="S" OR MID(P4$,21,1)="Y" THEN GOTO 17030
17024 IF MID(P4$,21,1)="Y" THEN GOTO 17030 ! SSP257510, skip unit sell and cost so they are set to 0, don't do these checks.
17026 IF UNIT_SELL_PRICE<=0 AND LINE_TYPE$<>"M" THEN MSGBOX "Price is less than or equal to zero",MSG("WARNING"),"!" ! REMOVED GOTO SEE REF# 195573 GOTO 17050! SSP252102 jdf      
17027 IF UNIT_COST<=0 AND LINE_TYPE$<>"M" THEN MSGBOX "Cost is less than or equal to zero",MSG("WARNING"),"!" ! REMOVED GOTO SEE REF# 195573 GOTO 17050 ! SSP252102 jdf
17030 GOSUB LOAD_INV_LINE_INFO
17040 GOSUB WRITE_IDX_INFO
17050 GOSUB CLEAR_LINE_INFO
17060 GOSUB GET_INVOICE_LINE
17070 CALL "*wingrp;hide",UPDATE.GRP$
17080 CALL "*wingrp;enable",ADDLINE.GRP$
17090 CALL "*wingrp;enable",DEL_ORD.GRP$
17180 REFRESH_FLG=1
17190 RETURN 
17195 ! ********************************
19000 ! Clear Line Info
19010 CLEAR_LINE_INFO:
19030 LINE_TYPE$=""; INV_LOC_CODE$="",LOC_DESC2$=""; CALL "*WINGRP;HIDE",LINE_CUST.GRP$; CALL "*WINGRP;SHOW",LINE_TYPE.GRP$ ! ssp 187861
19040 ITEM_CODE$=""; TF_DESC$=""
19050 PROD_CODE$=""
19060 LEFT_RIGHT$=""; TOP_BOTTOM$=""; PLYS$=""
19070 UNIT$=""
19080 QTY_PER_UNIT=0; QTY_ORDERED=0; QTY_SHIPPED=0
19090 UNIT_SELL_PRICE=0; UNIT_COST=0
19100 SELL_PRICE_EXT=0; COST_EXT=0
19110 COMM_CODE$="",COMM_CODE1$=""; SALES_DIST_CODE$="" ! SSP 199976
19120 ORDER_TYPE$=""; STAX_CODE_2$=""
19130 GP_ADJ_B4_LOAD=0; COMM_AMT=0
19140 TAXABLE$=""
19150 TAXABLE_FMP$="",EXEMPT_FM0$="",TAXABLE_FM0$=""; REM " GOTTA SET THEM TO NOTHING SOMEWHERE...MAY NOT BE THE RIGHT PLACE
19180 REFRESH_FLG=1
19190 RETURN 
19500 ! Calculate Extention Charges
19510 CALC_EXT:
19515 GOSUB UM_PARAM
19517 IF STP(UNIT$)="EACH" OR STP(UNIT$)="EA" THEN P3=1
19518 IF STP(UNIT$)="M" OR STP(UNIT$)="C" OR STP(UNIT$)="T" THEN QTY=QTY_ORDERED/QTY_PER_UNIT; QTY_SHIP=QTY_SHIPPED/QTY_PER_UNIT; GOTO 19525 ! SSP#280765
19521 QTY=QTY_ORDERED; QTY_SHIP=QTY_SHIPPED ! IF P4$(20,1)<>"Y" THEN QTY=QTY_ORDERED*QTY_PER_UNIT,QTY_SHIP=QTY_SHIPPED*QTY_PER_UNIT ELSE QTY=QTY_ORDERED,QTY_SHIP=QTY_SHIPPED
19525 IF POS(LINE_TYPE$="SM")<>0 THEN SELL_PRICE_EXT=QTY_SHIP*UNIT_SELL_PRICE; GOTO 19537
19527 IF P3>1 THEN P1=P3 ELSE P1=P4
19530 IF MID(P4$,20,1)<>"Y" THEN IF UNIT_SELL_PRICE*QTY_PER_UNIT=0 THEN SELL_PRICE_EXT=0 ELSE SELL_PRICE_EXT=(QTY_SHIPPED)*UNIT_SELL_PRICE END_IF ELSE IF P3=0 THEN SELL_PRICE_EXT=0 ELSE SELL_PRICE_EXT=(QTY_SHIPPED*UNIT_SELL_PRICE)/P1
19535 ! 
19537 IF POS(LINE_TYPE$="SM")<>0 THEN COST_EXT=QTY_SHIP*UNIT_COST; GOTO 19570
19540 IF MID(P4$,20,1)<>"Y" THEN IF UNIT_COST*QTY_PER_UNIT=0 THEN COST_EXT=0 ELSE COST_EXT=(QTY_SHIPPED)*UNIT_COST END_IF ELSE IF P3=0 THEN COST_EXT=0 ELSE COST_EXT=(QTY_SHIPPED*UNIT_COST)/P1
19570 GOSUB CALC_COMM
19580 REFRESH_FLG=1
19590 RETURN 
20000 ! LINE TYPE PROCESS
20010 LINE_TYPE_PROC:
20020 IF LINE_TYPE$="N" THEN CALL "*WINGRP;DISABLE",FIELDS.GRP$; CALL "*WINGRP;ENABLE",LT_N.GRP$; CALL "*WINGRP;ENABLE",LINE_DESC.GRP$
20030 IF LINE_TYPE$="C" THEN CALL "*wingrp;Hide",LINE_TYPE.GRP$; CALL "*wingrp;show",LINE_CUST.GRP$; CUSTOMER_2$=CUSTOMER$
20040 IF LINE_TYPE$="S" THEN DISABLE CONTROL INV_LOC_CODE.CTL; IF STP(MID(ART$,47,3))<>"FRT" THEN CALL "*WINGRP;ENABLE",LINE_DESC.GRP$; CALL "*WINGRP;ENABLE",ADD_3.GRP$ ! SSP221139 jdf ! SSP250672 jdf ! SSP251766 jdf
20050 IF LINE_TYPE$="M" THEN CALL "*wingrp;disable",FIELDS.GRP$; CALL "*wingrp;Enable",LINE_M.GRP$; CALL "*wingrp;ENABLE",LINE_M.GRP$
20060 IF LINE_TYPE$="I" THEN CALL "*wingrp;Enable",LINE_TYPE2.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$
20070 IF LINE_TYPE$="F" THEN CALL "*wingrp;Enable",FIELDS.GRP$; DISABLE CONTROL INV_LOC_CODE.CTL ! SSP221139 jdf
20080 CALL "*wingrp;Disable",LINE_TYPE3.GRP$ ! SSP221139 jdf
20082 IF %MSLC THEN IF POS(LINE_TYPE$="M")<>0 THEN DISABLE CONTROL BT_COMM.CTL ELSE ENABLE CONTROL BT_COMM.CTL ! 225300
20085 REFRESH_FLG=1 ! SSP221139 jdf
20190 RETURN 
20200 ! Get customer 2 information
20210 CUSTOMER2_INFO:
20220 CALL "ZZWLKU;PARSE_CUST",CUSTOMER_2$,CUST2_DIV$,CUST2_CODE$
20230 CUSTOMER_2$=CUST2_DIV$+CUST2_CODE$
20240 ! MSGBOX MSG("CORRECT"),MSG("VERIFY"),"?,YESNO",ANS$
20250 ! IF ANS$="NO" THEN CUSTOMER_2$=""; NEXT_ID=CUSTOMER_2.CTL; REFRESH_FLG=1; RETURN
20260 CALL "*WINGRP;HIDE",LINE_CUST.GRP$; CALL "*WINGRP;SHOW",LINE_TYPE.GRP$; CALL "*wingrp;Enable",LINE_TYPE2.GRP$; CALL "*WINGRP;ENABLE",FIELDS.GRP$
20270 NEXT_ID=ITEM_CODE.CTL; REFRESH_FLG=1
20290 RETURN 
20500 ! Item Query
20510 ITEM_QUERY:
20515 VAL$=""
20520 IF LINE_TYPE$="I" THEN %ITEM_CUST$="          "; PROCESS "QRY_IC0.1.4","../ICG/IC.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
20530 IF LINE_TYPE$="C" THEN %ITEM_CUST$=CUSTOMER_2$; PROCESS "QRY_IC0.1.4","../ICG/IC.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
20540 IF LINE_TYPE$="F" THEN PROCESS "QRY_FM1_ITEM","../FMG/FM.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
20550 IF LINE_TYPE$="S" THEN PROCESS "QRY_FMPX","../FMG/FM.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
20580 REFRESH_FLG=1
20590 RETURN 
21000 ! ITEM INFORMATION
21010 ITEM_INFO:
21013 IF STP(MID(ART$,47,3))<>"" THEN GOTO 21016 ! SSP250672 jdf
21015 IF NUL(ITEM_CODE$) THEN ITEM_CODE$=""; NEXT_ID=ITEM_CODE.CTL; REFRESH_FLG=1; RETURN 
21017 IF LEN(ITEM_CODE$)<10 THEN ITEM_CODE$=PAD(ITEM_CODE$,10,1," ")
21020 IF LINE_TYPE$="I" THEN {
21030 READ (Z[19],KEY="          "+ITEM_CODE$,DOM=INVALID_ITEM)IOL=0410
21040 TF_DESC$=IC0$(21,40); PROD_CODE$=IC0$(61,3)
21050 LEFT_RIGHT$=IC0$(64,8); TOP_BOTTOM$=IC0$(72,8)
21060 PLYS$=IC0$(80,2); UNIT$=IC0$(120,4)
21070 QTY_PER_UNIT=IC0[14]; UNIT_SELL_PRICE=IC0[0]
21075 IF IC0[15]=0 THEN UNIT_COST=0 ELSE UNIT_COST=IC0[18]*IC0[14]/IC0[15]
21080 IF STAX_CODE$=DIM(10) AND AR1$(235,10)<>DIM(10) THEN STAX_CODE$=AR1$(235,10); REM SSP 219276
21090 GOSUB PROD_CODE_INFO; GOSUB UM_PARAM
21095 GOSUB QTY_BREAK
21100  }
21110 IF LINE_TYPE$="C" THEN {
21120 READ (Z[19],KEY=CUSTOMER_2$+ITEM_CODE$,DOM=INVALID_ITEM)IOL=0410
21130 TF_DESC$=IC0$(21,40); PROD_CODE$=IC0$(61,3)
21140 LEFT_RIGHT$=IC0$(64,8); TOP_BOTTOM$=IC0$(72,8)
21150 PLYS$=IC0$(80,2); UNIT$=IC0$(120,4)
21160 QTY_PER_UNIT=IC0[14]; UNIT_SELL_PRICE=IC0[0]
21165 IF IC0[15]=0 THEN UNIT_COST=0 ELSE UNIT_COST=IC0[18]*IC0[14]/IC0[15]
21170 IF STAX_CODE$=DIM(10) AND AR1$(235,10)<>DIM(10) THEN STAX_CODE$=AR1$(235,10); REM SSP 219276
21175 GOSUB PROD_CODE_INFO; GOSUB UM_PARAM
21177 GOSUB QTY_BREAK
21180  }
21200 IF LINE_TYPE$="F" THEN {
21210 READ (Z[18],KEY=CUSTOMER$+ITEM_CODE$,DOM=INVALID_ITEM)IOL=0420
21220 TF_DESC$=FM1$(42,40); PROD_CODE$=FM1$(21,3)
21230 LEFT_RIGHT$=FM1$(24,8); TOP_BOTTOM$=FM1$(32,8)
21240 PLYS$=FM1$(40,2); UNIT$=FM1$(100,4)
21250 QTY_PER_UNIT=FM1[4]; UNIT_SELL_PRICE=FM1[3]; UNIT_COST=FM1[1]
21260 IF STAX_CODE$=DIM(10) AND AR1$(235,10)<>DIM(10) THEN STAX_CODE$=AR1$(235,10); REM SSP 219276
21265 GOSUB PROD_CODE_INFO; GOSUB UM_PARAM
21270  }
21300 IF LINE_TYPE$="S" THEN {
21310 READ (Z[14],KEY="X"+ITEM_CODE$,DOM=INVALID_ITEM)IOL=0430
21320 TF_DESC$=FMP$(12,40); PROD_CODE$=FMP$(52,3)
21330 UNIT$=FMP$(55,4)
21340 QTY_PER_UNIT=FMP[0]; IF MID(P4$,21,1)="Y" OR MID(FMP$,61,1)="Y" THEN SELL_PRICE_EXT=FMP[1]; COST_EXT=FMP[2]; CALL "*wingrp;Disable",EXTEN_ONLY.GRP$; NEXT_ID=SELL_PRICE_EXT.CTL ELSE UNIT_SELL_PRICE=FMP[1]; UNIT_COST=FMP[2]; CALL "*wingrp;Enable",EXTEN_ONLY.GRP$ ! SSP245405 jdf
21380 GOSUB PROD_CODE_INFO; GOSUB UM_PARAM
21385 IF MID(FMP$,60,1)="Y" AND TAXABLE$="Y" THEN TAXABLE$="F"
21387 GOSUB GET_DEF_COMM
21388 GOSUB CALC_COMM
21390  }
21680 REFRESH_FLG=1
21690 RETURN 
21800 ! Invalid Item Code Message
21810 INVALID_ITEM:
21820 MSGBOX MSG("INVA_ITEM"),MSG("INFO"),"!"
21830 ITEM_CODE$=""
21840 NEXT_ID=ITEM_CODE.CTL
21880 REFRESH_FLG=1
21890 RETURN 
25000 ! Process Invoice with Order
25010 PROCESS_ORDER:
25020 IF NUL(ORDER$) THEN RETURN 
25025 CALL "FM2ODO",ERR=*PROCEED,X3$,X4$,ORDER$,OTHER$ ! DBD-270-SSP307450"
25030 KEY_10$=ORDER$
25035 FIND (Z(12),KEY=ORDER$,DOM=*NEXT); %FL_DIS=1; CALL "FMGNPA",ORDER$; %FL_DIS=0
25040 EXTRACT (Z[10],KEY=KEY_10$,DOM=*RETURN)IOL=0450
25042 IF NOT(NUL(%DR_SYO$)) THEN GOSUB CHECK_DATA ! SSP 192979
25043 IF FS1$(63,1)="P" THEN MSGBOX MSG("FMGODM_P"),MSG("WARNING"); GOSUB CLEAR_SCREEN; NEXT_ID=ORDER.CTL,ORDER$="",REFRESH_FLG=1; READ (Z[10],ERR=*PROCEED); RETURN ! SSP197945
25044 IF POS(FS1$(54,1)="BS")>0 THEN MSGBOX MSG("ARGEAB_06")+" "+FS1$(54,1),MSG("WARNING"); GOSUB CLEAR_SCREEN; NEXT_ID=ORDER.CTL,ORDER$="",REFRESH_FLG=1; READ (Z[10],ERR=*PROCEED); RETURN ! SSP#228636
25045 IF FS1$(63,1)="Y" THEN GOSUB INV_PROG_MSG; GOSUB CLEAR_SCREEN; REFRESH_FLG=1; READ (Z[10],ERR=*PROCEED); RETURN ELSE GOSUB INV_IN_PROG
25050 CUSTOMER$=FS1$(6,10)
25052 DISABLE CONTROL ORDER.CTL; DISABLE CONTROL ORDER.CTL+3000 ! SSP 215793
25060 GOSUB GET_CUST_INFO
25070 GOSUB CUST_INV_MSG
25075 GOSUB EXISTING_INVOICE; IF EXIST_ANSWER$="NO" THEN RETURN ! SSP 235752
25080 GOSUB LOAD_ORDER_HEADER
25085 GOSUB TAX_CODE
25086 IF STP(ORDER$)<>"" THEN SHOW CONTROL AUTO_BILL.CTL; ENABLE CONTROL AUTO_BILL.CTL ! SSP240353 jdf
25087 CALL "*WINGRP;SHOW",BUTTONS.GRP$; CALL "*WINGRP;HIDE",BUTTON_1.GRP$
25088 IF MID(FMM$,257,1)="Y" THEN CALL "*WINGRP;ENABLE",SUMM.GRP$ ELSE CALL "*WINGRP;DISABLE",SUMM.GRP$ ! SSP 218091
25089 IF %MSLC THEN CALL "*wingrp;disable",MCOMM.GRP$ ! ssp 225300  Disable MCOM Entry if invoice from an existing order
25090 RETURN 
25100 ! UPDATE ORDER AS INVOICING IN PROGRESS
25110 INV_IN_PROG:
25120 FS1$(63,1)="Y"
25130 WRITE (Z[10],KEY=KEY_10$)IOL=0450
25190 RETURN 
25200 ! INVOICE IN PROGRESS MESSAGE
25210 INV_PROG_MSG:
25220 MSGBOX MSG("INVO_PROG"),MSG("FYI"),"!"
25290 RETURN 
25299 ! 
25300 ! TAX CODE UPDATE
25310 TAX_CODE: REFRESH_FLG=1; REM SSP 219276
25312 IF NUL(STAX_CODE$) THEN RETURN ; REM SSP 219276
25320 DIM AR5$(400),AR5[15]; FIND (Z[7],KNO=0,KEY=STAX_CODE$,DOM=*NEXT)IOL=0340; GOTO 25330 ! SSP 198247 SSP 219276 ADDED KNO; WO249775
25325 MSGBOX MSG("Inval_Tax"),MSG("WARNING"),"STOP,TIM=8"; NEXT_ID=STAX_CODE.CTL; RETURN ! SSP 198247
25330 PRECISION 3; ST_PERCENT=AR5[0]+AR5[2]+AR5[3]; PRECISION 2 ! SSP247844 jdf
25335 %STAX_DESC$=STP(AR5$(11,25)); REM SSP 219276
25390 RETURN 
25399 ! 
25600 ! Load Order Information in Invoice Header
25610 LOAD_ORDER_HEADER:
25620 INV_TYPE$="I"
25625 CONTRACT$=MID(FS1$,315,20),CONTRACT_DATE$=MID(FS1$,335,6) ! SSP239556
25630 COMM_CODE$=FS1$(97,5),COMM_CODE1$=COMM_CODE$; TERMS_CODE$=FS1$(87,2); STAX_CODE$=FS1$(76,10) ! SSP 199976
25640 SPER_CODE$=FS1$(93,4); SPER_CODE_2$=FS1$(102,4); SPER_CODE_3$=FS1$(106,4)
25650 SPER_CODE_4$=FS1$(110,4); SPER_CODE_5$=FS1$(114,4); TAXABLE$=FS1$(86,1)
25652 REM "IF TAXABLE_FM0$="N" AND TAXABLE_FMP$="Y" THEN TAXABLE$="N" ELSE IF TAXABLE_FM0$="Y" AND TAXABLE_FMP$="N" THEN TAXABLE$="N" ELSE TAXABLE$="Y"; REM PER MIKE IF EITHER SHIP TO OR PROD COD IS NON TAXABLE...MAKE IT NON TAXABLE
25655 REM "IF TAX_EXEMPT$<>"Y" THEN IF FS1$(86,1)="Y" THEN TAX_EXEMPT$="N" ELSE TAX_EXEMPT$="Y"; REM SSP 187780 LMS
25660 COMM_AMT_1=FS1[1]; COMM_AMT_2=FS1[2]; COMM_AMT_3=FS1[3]; COMM_AMT_4=FS1[4]; COMM_AMT_5=FS1[5],FRT_AMT=FS1[8]+FS1[10],ORD_AMT=FS1[6],ORD_COST=FS1[7]
25670 CUST_PO$=FS1$(28,15)
25680 INV_DATE$=%X3_TODAY$; SHIP_DATE$=%X3_TODAY$
25681 IF FS1$(367,6)<>DIM(6) THEN SHIP_DATE$=FS1$(367,6) ! WO247884
25685 IF %MSLC THEN DTC=0; GOSUB MULTI_COMM_KEY; GOSUB MULTI_COMM_SETUP; IC_KEY2$=FS1$(6,10),IC_KEY1$=FS1$(118,8),SC_TYPE$="O",SC_LINE$="000"; CALL "ARGSCM;DFLT_ORD_INV_SETUP",SC_TYPE$,SC_KEY1$,SC_KEY2$,SC_LINE$,MCCDE${ALL},MCSPLT{ALL},MCOMM${ALL},IC_KEY1$,IC_KEY2$,INV_DATE$,X3$(174,5),X3$(21,6) ! SSP 225300
25690 GOSUB GET_SUMM_BILL_ORD
25691 IF CHK_SB$="Y" THEN IF STP(MID(FS1$,373,1),2)<>"" THEN SUMMARY_BILL$=FS1$(373,1) ! WO 255959   
25692 IF FS1$(86,1)="Y" THEN TAX_EXEMPT$="N" ELSE TAX_EXEMPT$="Y" ! SSP 251012
25693 ! IF SUMMARY_BILL$="Y" THEN PRINT_INV$="N" ELSE PRINT_INV$="Y"
25695 DIM PO3$(300); READ (Z[4],KEY=ORDER$+"     ",DOM=*NEXT)IOL=0345; GOSUB CHECK_D_REC; GOTO 25698 ! DONT FORGET TO ADD THE GOTO TO THE CORRECT LINE ! SSP223872 jdf(added space in key and goto statement)
25697 READ (Z[4],END=25710)IOL=0345; IF PO3$(166,8)<>ORDER$ THEN GOTO 25710
25698 ! READ (Z[4],KEY=ORDER$+"     ")IOL=0345; TAXABLE$=PO3$(279,1); IF TAXABLE$="N" THEN TAX_EXEMPT$="Y" ELSE TAX_EXEMPT$="N" ! SSP 187704 ! SSP248157 jdf 251012
25700 LOC_CODE$=PO3$(12,4); LOC_ADDR_1$=PO3$(46,30); LOC_ADDR_2$=PO3$(76,30); LOC_CITY$=PO3$(106,16); LOC_ST$=PO3$(122,2); LOC_ZIP_CODE$=PO3$(124,9)
25702 SHIP_VIA_CODE$=PO3$(150,1); %SHIP_VIA_DESC$=PO3$(210,15); LOC_DESC$=PO3$(225,35); FOB_PT$=PO3$(133,1)
25704 IF NOT(NUL(PO3$(269,10))) THEN STAX_CODE$=PO3$(269,10)
25706 ! 
25710 CALL "*wingrp;Enable",FIELD_1.GRP$
25712 IF MID(OP_SEC$,65,1)<>"Y" THEN CALL "*WINGRP;ENABLE",TERMS.GRP$ ELSE CALL "*WINGRP;DISABLE",TERMS.GRP$
25713 IF P2$(7,1)="Y" THEN CALL "*WINGRP;ENABLE",COMM.GRP$ ELSE CALL "*WINGRP;DISABLE",COMM.GRP$
25715 ORD_FLG=2
25720 NEXT_ID=LOC_CODE.CTL
25790 RETURN 
25800 ! CHECKING FOR 'D' TYPE RECORD
25810 CHECK_D_REC:
25820 READ (Z[4],KEY=ORDER$+"     ",DOM=*NEXT)IOL=0345 ! SSP223872 jdf(added space in key)!ssp#225960
25830 READ (Z[4],END=25850)IOL=0345; IF PO3$(166,8)<>ORDER$ THEN GOTO 25850
25840 IF PO3$(11,1)<>"D" THEN GOTO 25830
25850 IF PO3$(11,1)<>"D" OR PO3$(166,8)<>ORDER$ THEN READ (Z[4],KEY=ORDER$+"     ")IOL=0345 ELSE PO3$(12,4)="M" ! SSP223872 jdf(added space in key)
25860 RETURN 
25900 ! DETERMINE WHICH DIRECTION HEAR NEXT WILL GO.....
25905 NEXT_OPT:
25907 REM GOSUB CHECK_LOTS ! SSP223646 jdf
25910 ORD_LINE=0
25915 IF ORD_FLG=2 THEN ORD_FLG=0; REPLACEMENT_SCRN$="ARGEAC.1"; RETURN 
25920 IF ORD_FLG THEN REPLACEMENT_SCRN$="ARGEAC.1" ELSE REPLACEMENT_SCRN$="ARGEAC.2"
25925 IF ORD_FLG THEN {
25927 READ (Z[10],KEY=ORDER$,DOM=NO_FS1)IOL=0450 ! SSP 224467 !SSP#258350  moved as root tma 10/3/2012
25930 MSGBOX MSG("ARGEAA_2"),MSG("CONFIRM"),"?,YESNO",ANS$
25935 IF ANS$="YES" THEN REPLACEMENT_SCRN$="ARGEAC.2"; %RETAIN_INV=1,FRT_AMT=ARB[2] ELSE ORD_LINE=1; DIM ARB[30]; FRT_AMT=0; FIND (Z[10],KEY=ORDER$)*,*,*,*,*,*,*,*,*,FS18,*,FS110; FRT_AMT=FS18+FS110; GOSUB RESTART_HEADER_INFO; GOSUB DEL_FS3_LINES ! SSP#228923 ! SSP242473 jdf
25940  }
25990 RETURN 
25995 NO_FS1: REPLACEMENT_SCRN$="ARGEAC.2",%RETAIN_INV=1; RETURN ! ssp 224467
25999 ! 
26000 ! LIST ORDER LINES
26010 LIST_ORDER_LINE:
26020 LOT_FRT=0
26035 GOSUB CLEAR_ORDER_LINES; SSP_FLG=0
26038 QTY_AMT=0 ! SSP221171 jdf
26040 READ (Z[20],KEY=ORDER$,DOM=*NEXT)
26050 KEY_20$=KEY(Z[20],END=26180); READ (Z[20])IOL=0460
26060 IF KEY_20$(1,8)<>ORDER$ THEN GOTO 26180
26063 BL$=""
26065 IF POS("I"=FS2$(156,5))=0 AND FS2[6]=0 THEN BL$='SF'+'_YELLOW'; SHOW CONTROL NPOI2.CTL; REFRESH_FLG=1; ELSE IF FS2$(155,1)="M" THEN BL$='F4' ELSE BL$="" ! SSP226631 jdf
26067 UNIT$=FS2$(124,4); GOSUB SET_UM_DIV
26069 BN$="NO"; DIM FS3$(50),FS3[9]; READ (Z[26],KEY=INV_NUM$+KEY_20$+" ",DOM=*NEXT)IOL=0465; BN$="YES"; LOT_FRT+=FS2[17] ! SSP232877 jdf
26070 IF STP(FS3$)="" THEN GOSUB FS3_DEFAULT ! SSP232877 jdf
26072 IF FS2$(18,1)="Y" THEN SSP$="YES",SSP_FLG=1 ELSE SSP$="NO"
26073 IF FS2$(155,1)="M" THEN ORD_2=0; GOTO 26085 ! ssp 195287
26078 ORD_2=FN%QTY_IN_UM(FS3[0],FS2$(124,4),M) ! IF P0$(20,1)<>"Y" THEN ORD_Q=QTY_AMT/FS2[5] ELSE ORD_Q=QTY_AMT
26080 BACK_ORD_QTY=FN%QTY_IN_UM(FS3[3],FS2$(124,4),FS2[5])
26085 IF FS2$(155,1)="M" THEN LIST_BOX LOAD ORDER_LINE.CTL,0,BL$+BN$+SEP+BL$+FS2$(6,3)+SEP+BL$+FS2$(19,10)+SEP+BL$+FS2$(50,40)+SEP+BL$+""+SEP+BL$+""+SEP+BL$+""+SEP+BL$+""+SEP+BL$+SSP$ ELSE LIST_BOX LOAD ORDER_LINE.CTL,0,BL$+BN$+SEP+BL$+FS2$(6,3)+SEP+BL$+FS2$(19,10)+SEP+BL$+FS2$(50,40)+SEP+BL$+STR(ORD_2:"##,###,###.00-")+SEP+BL$+STR(FS3[1]:"##,###,###.00-")+SEP+BL$+STR(FS3[2]:"###,###,###.00-")+SEP+BL$+STR(BACK_ORD_QTY:"##,###,###.00")+SEP+BL$+SSP$
26090 GOTO 26050
26180 NEXT_ID=NEXT_1.CTL
26185 %BILL_NOW$="" ! SSP232877 jdf  
26190 RETURN 
26199 ! 
26200 ! PROCESS ORDER LINES
26210 SEL_ORD_LINE:
26220 LIST_BOX READ ORDER_LINE.CTL,IDX
26230 LIST_BOX FIND ORDER_LINE.CTL,IDX,ORDER_LINES$
26235 ORDER_LINES$=SUB(ORDER_LINES$,$1B4634$,""),ORDER_LINES$=SUB(ORDER_LINES$,$1B53461B423342$,"") ! ssp 195287
26240 COMP_STAT$=ORDER_LINES$(1,POS(SEP=ORDER_LINES$)-1); ORDER_LINES$=ORDER_LINES$(POS(SEP=ORDER_LINES$)+1)
26250 ORD_LIN_NUM$=ORDER_LINES$(1,POS(SEP=ORDER_LINES$)-1)
26260 PROCESS "ARGEAC.5","../ARG/AR.EN",ORDER$,ORD_LIN_NUM$,STR(Z[20]),CUSTOMER$,INV_DATE$,STR(Z[26]),INV_NUM$,CR_FY$,CR_ACCTPD$,SHIP_DATE$,COMP_STAT$,STR(Z[10]),STR(Z[5]),STR(Z[14]),AR1$ ! SSP232877 jdf  ! SSP235249 jdf WO263619, add AR1$  
26270 ORDER_LINES$="" ! SSP223646 jdf
26290 GOSUB LIST_ORDER_LINE
26292 SR=ORDER_LINE.CTL'SORT,ORDER_LINE.CTL'SORT=SR
26295 RETURN 
26299 ! 
26310 UPDATE_ORDER_LINE:
26315 DIM FS2[29],FS1[13]; DIM FS3[9] ! SSP232877 jdf
26320 ! ORDER_NUM$=ARG_1$; ORDER_LINE$=ARG_2$; Z20=NUM(ARG_3$); COMP_STAT$=ARG_11$; INV_NUMBER$=ARG_7$; Z26=NUM(ARG_6$); Z14=NUM(ARG_14$) ! SSP235249 jdf!SSP#273324
26325 ARG_2$=SUB(ARG_2$,$1B5346$,""),ARG_2$=SUB(ARG_2$,$1B4233$,"") ! SSP 224828
26326 ORDER_NUM$=ARG_1$; ORDER_LINE$=ARG_2$; Z20=NUM(ARG_3$); COMP_STAT$=ARG_11$; INV_NUMBER$=ARG_7$; Z26=NUM(ARG_6$); Z14=NUM(ARG_14$) ! SSP235249 jdf!SSP#273324
26327 AR1$=ARG_15$ ! WO263619
26330 READ (Z20,KEY=ORDER_NUM$+MID(STP(ORDER_LINE$,3),-3),DOM=*RETURN)IOL=0460
26331 INV_NUM$=ARG_7$,KEY_20$=ARG_1$+ARG_2$,INV_DATE$=ARG_5$,Z10=NUM(ARG_12$),Z5=NUM(ARG_13$) ! SSP232877 jdf
26332 READ (Z10,KEY=ARG_1$,DOM=*NEXT)IOL=0450; REM READ (Z26,KEY=ARG_7$+ARG_1$+ARG_2$+" ",DOM=*NEXT)IOL=0465 ! SSP222053 jdf  ! SSP232877 jdf
26333 READ (Z26,KEY=ARG_7$+ARG_1$+ARG_2$+" ",DOM=*NEXT)IOL=0465 ! SSP232877 jdf
26335 DIM Z(256); Z(6)=FFN("ZZPARM"),UNIT$=FS2$(124,4); GOSUB UM_PARAM; DIM SH_PARM$(300); FIND (Z[6],KEY=%X3$(9,3)+"S/H",DOM=*NEXT)SH_PARM$; IF STP(FS3$)="" THEN X3$=%X3$,X4$=%X4$,ORDER$=ORDER_NUM$,KEY_20$=ORDER$+ORDER_LINE$; GOSUB FS3_DEFAULT ! SSP 188176 ! SSP232877 jdf
26336 IF FS2(7)=0 AND FS2(19)=0 AND MID(FS2$,155,1)<>"M" AND COMP_STAT$="NO" THEN MSGBOX "Line : "+ORDER_LINE$+" is a Direct ship that has not been received.",MSG("WARNING"),"!" ! ssp#233200 !SSP#239185
26340 CUSTOMER$=ARG_4$; INV_DATE$=ARG_5$; ORDER$=FS2$(147,8)
26350 LINE_NUMBER$=ORDER_LINE$
26355 COMP_STAT$=SUB(COMP_STAT$,$1B53461B4233$,""),BILL_NOW$=COMP_STAT$(1,1) ! SSP#273358
26358 GOSUB GET_EXT
26359 WI$=""; IF MID(FS2$,155,1)="S" THEN FIND (Z14,KEY="X"+FS2$(19,10),DOM=*NEXT)WI$
26360 TF_ITEM$=FS2$(19,10); I_DESC$=FS2$(50,40)
26365 QTY_OPEN=FN%QTY_IN_UM(QTY_AMT,FS2$(124,4),M)
26370 ORIG_QTY_AMT=QTY_AMT,PRICE_EXT=FS3[2],SELL_PRICE=FS3[1]
26371 BACK_ORD=FN%QTY_IN_UM(BACK_ORD_AMT,FS2$(124,4),M)
26372 ORIG_BACK_ORD=BACK_ORD_AMT ! Extended qty = FS3[3]
26470 IF BILL_NOW$="Y" THEN CALL "*wingrp;Enable",INT_MOD.GRP$; GOSUB ENABLE_GRPS ELSE CALL "*wingrp;Disable",INT_MOD.GRP$
26480 REFRESH_FLG=1
26482 DD$=STP(MID(FS2$,124,4))+"/ "+FNR$(STR(FS2(5):"###,###"),ERR=*NEXT) ! ssp 195287
26490 RETURN 
26499 ! 
26510 SAVE_ORD_LINE_INFO:
26520 IF BILL_NOW$="Y" THEN CALL "*wingrp;Enable",INT_MOD.GRP$; GOSUB ENABLE_GRPS ELSE CALL "*wingrp;Disable",INT_MOD.GRP$
26590 RETURN 
26592 ENABLE_GRPS:
26595 IF MID(FS2$,2,1)="Y" THEN DISABLE CONTROL QTY_OPEN.CTL
26596 IF MID(FS2$,155,1)="S" AND MID(WI$,61,1)="Y" THEN CALL "*WINGRP;DISABLE",SPEC_EXT.GRP$; CALL "*WINGRP;UNLOCK",EXT_ONLY.GRP$
26597 IF FS3_37_1$="Y" OR MID(MM$,21,1)="Y" THEN CALL "*WINGRP;DISABLE",BACK_PRICE.GRP$; CALL "*WINGRP;UNLOCK",EXT_ONLY.GRP$
26598 RETURN 
26599 ! 
26600 ! Add an Order Line
26610 ADD_ORD_LINE:
26620 PROCESS "FMGODB","../OPG/OP.EN",(ORDER$),"","","ADD" ! 224821 - removed tf2g in call
26650 PERFORM "ARGEAB;REVIEW_ORD_FROM_FS3" ! 224821 ! SSP231513 jdf
26680 GOSUB BILL_NOW_INT
26690 RETURN ! 224821
26695 ! 
26700 ! BILL AND INTERFACE RECORD
26710 BILL_NOW_INT:
26720 CALL "ZZGMSG","C",MSG("ARGEAA_01",FN%ZZDISP$(ORDER$,"O/P")),""
26722 IF AUTO_B=1 THEN U1$="" ! ssp#297252
26723 IF STP(SH_PARM$)="" THEN SH_PARM$(202,1)="Y",SH_PARM$(204,1)="Y"; WRITE (Z[6],KEY=X3$(9,3)+"S/H",DOM=*NEXT)SH_PARM$ ! SSP238742 jdf!SSP#257343
26725 Q1$="#"+PAD(%FY$+%AP$,6)+PAD(INV_NUM$,8)+PAD(INV_DATE$,6)+PAD(ORDER$,8); CALL "ARGEAU",(X3$),(X4$),"GUI",Q1$,"",""
26728 CALL "ZZGMSG","D","",""
26730 GOSUB CHECK_LOTS
26732 IF AUTO_B THEN GOTO 26795 ! SSP240353 jdf ! AUTO_B is a flag set when the user clicks on the AUTO_BILL button it will skip listing the order lines in the List Box
26735 GOSUB LIST_ORDER_LINE
26795 RETURN 
26799 ! *************************************************************
26900 ! REMOVE FS3 RECORD
26910 REMOVE_INT_REC:
26920 Z26=NUM(ARG_6$); INV_NUMBER$=ARG_7$
26930 KEY_26$=INV_NUMBER$+ORDER_NUM$+MID(STP(ORDER_LINE$,3),-3)+" "
26940 READ (Z26,KEY=KEY_26$,DOM=*RETURN)
26950 REMOVE (Z26,KEY=KEY_26$)
26990 RETURN 
26999 ! 
27000 ! CREATE AR INVOICE LINES FROM THE ORDER LINES...
27010 CREATE_INV_LINE:
27030 DIM ART$(290),ART[48] ! WO249775
27040 IF FS2$(155,1)="C" OR FS2$(14,1)="Y" THEN ART$(1,1)="F" ELSE ART$(1,1)=FS2$(155,1)
27042 ART$(3,3)=FS2$(29,3)
27043 PROD_CODE$=FS2$(29,3); GOSUB PROD_CODE_INFO
27046 ART$(75,9)=MID(FMP2$,24,9)
27050 IF FS3[2]=0 AND POS("I"=FS2$(156,5))=0 OR (FS2$(50,1)="/" AND ART$(1,1)="M") THEN ART$(6,1)="N" ELSE ART$(6,1)="Y"
27060 ART$(7,40)=FS2$(50,40); ART$(47,3)=FS2$(6,3)
27066 Z[2]=Z2_SAVE
27070 ART$(50,4)=FS2$(124,4); ART$(54,1)=FS2$(136,1)
27075 IF FS2$(155,1)="C" THEN ART$(55,20)=FS2$(161,10)+FS2$(19,10) ELSE IF FS2$(14,1)="Y" THEN ART$(55,20)=FS1$(6,10)+FS2$(19,10) ELSE ART$(55,20)=DIM(10)+FS2$(19,10)
27080 ART$(65,10)=FS2$(19,10),ART$(84,5)=FS2$(128,5)
27090 ART$(89,4)=FS2$(90,4); ART$(93,8)=FS2$(32,8)
27100 ART$(101,8)=FS2$(40,8); ART$(109,2)=FS2$(48,2)
27110 ART$(116,9)=FS2$(205,9); ART$(125,10)=STAX_CODE$
27120 ART$(135,1)=FS2$(18,1)
27130 IF FS2[8]<>0 THEN ART[0]=FS2[8] ELSE ART[0]=FS2[0]
27135 IF FS2[8]<>0 THEN ART[1]=FS3[3] ELSE ART[1]=FS3[0]
27140 ART[2]=FS3[1]; ART[3]=FS2[1]
27150 ART[4]=FS3[2]; ART[5]=FS3[4]
27155 ART[6]=FS2[5]
27160 JOB_NUM$=FS2$(171,12)
27165 IF ART[1]<>0 THEN ART$(6,1)="Y" ELSE ART$(6,1)="N"
27190 RETURN 
27200 ! CHECK IF ITEM BECAME LOTTED AFTER O/E
27210 CHECK_LOTTED:
27220 IF I0$(44,1)<>"Y" OR POS(FS2$(155,1)="IC")=0 OR FS2$(2,1)="Y" OR FS2$(9,1)<>" " THEN RETURN 
27230 FIND (Z[27],KEY=FS2$(161,10)+FS2$(19,10),DOM=*RETURN)XX$
27240 IF XX$(112,1)<>"Y" THEN RETURN 
27260 FS2$(2,1)="Y"; WRITE (Z[20],KEY=KEY_20$)IOL=0460
27290 RETURN 
27300 ! CHECK IF ORDER LINE SHOLD BE INVOICED
27310 INV_NOW_CHECK:
27320 BILL_NOW$="Y"
27325 IF FS2$(155,1)="M" THEN RETURN 
27330 IF MID(SH_PARM$,204,1)<>"Y" OR FS2$(9,1)=" " THEN RETURN 
27340 IF FS2[7]=0 AND FS2[19]=0 THEN BILL_NOW$="N"; RETURN 
27390 RETURN 
27400 ! LOAD ORDER INTERFACE FILE
27410 LOAD_INT_REC:
27420 DIM FS3$(50),FS3[9]
27430 FS3$(1)=INV_NUM$+KEY_20$+" "; FS3$(21,6)=INV_DATE$
27440 IF FS2$(155,1)="M" THEN RETURN 
27460 GOSUB SET_UM_DIV
27470 FS3$(27,4)="    "
27480 FS3$(31,4)=CR_FY$; FS3$(35,2)=CR_ACCTPD$
27490 FS3$(40,6)=SHIP_DATE$
27500 QTY_AMT=FS2[0]; IF FS2[7]<>0 THEN QTY_AMT=FS2[7] ELSE QTY_AMT=FS2[0] ! ssp 188176
27510 FS3[0]=QTY_AMT; FS3[1]=FS2[4]
27520 UNIT$=FS2$(124,4); GOSUB UM_PARAM
27530 IF P4$(20,1)<>"Y" THEN ORD_Q=QTY_AMT/FS2[5] ELSE ORD_Q=QTY_AMT ! SSP223646 jdf
27540 FS3[2]=FS2[6]; FS3[3]=FS2[8]; FS3[4]=ORD_Q*FS2[1]
27570 KEY_26$=INV_NUM$+KEY_20$+" "
27580 READ (Z[26],KEY=KEY_26$,DOM=*NEXT); RETURN 
27590 WRITE (Z[26],KEY=KEY_26$)IOL=0465
27595 RETURN 
27599 ! ***********************************************
27600 RETURN 
27800 ! SET UNIT OF MEASURE DIVIDER
27810 SET_UM_DIV:
27820 DIM MM$(21),MM[1]
27830 READ (Z[6],KEY="U/M"+FS2$(124,4),DOM=*NEXT)MM$,MM[0],MM[1]
27840 IF MM$(20,1)="Y" THEN M=MM[1] ELSE M=FS2[5]
27850 IF M=0 THEN M=1
27860 M0=M; IF MM[0]<>0 THEN M0=MM[0]
27870 D9$=FS2$(124,4)+"/"+STR(M0:"##,##0")
27880 DIM N$(21); FIND (Z[6],KEY="U/M"+FS2$(120,4),DOM=*RETURN)N$
27890 RETURN 
27900 ! Load the order info
27910 SAVE_ORDER_INFO:
27915 GOSUB SPECIAL_SHIP
27920 CALL "ZZGMSG","C",MSG("ARGEAA_02",FN%ZZDISP$(ORDER$,"O/P")),""
27928 AXN_IDX$="ALL"; GOSUB DELETE_STATS
27930 Q1$=PAD(ARB$(1,6),6)+INV_NUM$; CALL "AR2EAT",(X3$),(X4$),"GUI",Q1$,"",""
27935 READ (Z[1],KEY=KEY_1$)IOL=0310 ! Reload values here
27940 CALL "ZZGMSG","D","",""
27943 ! REPLACEMENT_SCRN$="ARGEAC.2"
27945 RETURN 
27949 ! **************************************************
28000 ! Bill Order Complete
28010 BILL_COMPLETE:
28015 CALL "ZZGMSG","C",MSG("ARGEAA_03",FN%ZZDISP$(ORDER$,"O/P")),""
28020 Q1$="#"+PAD(%FY$+%AP$,6)+PAD(INV_NUM$,8)+PAD(INV_DATE$,6)+PAD(ORDER$,8); CALL "ARGEAU",(X3$),(X4$),"GUIB",Q1$,"","" ! Add B to say bill complete
28025 CALL "ZZGMSG","D","",""
28030 GOSUB SAVE_ORDER_INFO ! Save to ART
28036 GOSUB LIST_ORDER_LINE ! SSP237252 jdf
28040 CALL "*WINGRP;HIDE",BILL_COMPLETE.GRP$ ! SSP237252 jdf
28042 NEXT_ID=NEXT_1.CTL ! SSP237252 jdf
28045 RETURN 
28049 ! ***********************************
28200 ! Change order amount in Order Interface
28205 ORD_QTY_UPDATE:
28208 QTY_OPENE=QTY_OPEN*M ! ssp 188176
28209 IF FS2$(9,1)<>DIM(1) AND QTY_OPENE>FS2[0] AND MID(AR1$,526,1)="Y" THEN QTY_OPENE=FS2[0] ! WO263619, don't invoice customer for overruns.
28210 QTY_OPEN=FN%QTY_IN_UM(QTY_OPENE,FS2$(124,4),M)
28220 GOSUB GET_PRICE_EXT ! ssp 188176
28225 IF QTY_OPENE<>ORIG_QTY_AMT THEN BACK_ORDE=ORIG_BACK_ORD+(ORIG_QTY_AMT-QTY_AMT); IF BACK_ORDE<0 THEN BACK_ORDE=0
28230 BACK_ORD=FN%QTY_IN_UM(BACK_ORDE,FS2$(124,4),M)
28285 REFRESH_FLG=1
28290 RETURN 
28299 ! 
28300 ! Sell Price Update in the Interface
28305 SELL_PRICE_UPDATE:
28307 QTY_OPEN=QTY_OPEN*M
28308 BACK_ORD=BACK_ORD*M
28310 FS2[4]=SELL_PRICE
28315 KEY_26$=INV_NUMBER$+ORDER_NUM$+MID(STP(ORDER_LINE$,3),-3)+" "
28316 IF BILL_NOW$="Y" THEN GOTO 28347
28318 GOSUB REMOVE_INT_REC; RETURN 
28347 IF CHANGE_FLG=0 THEN GOTO 28351 ! SSP 216128
28348 FS3[0]=QTY_OPEN,FS3[1]=SELL_PRICE,FS3[2]=PRICE_EXT,FS3[3]=BACK_ORD ! GOTO 28351
28350 QQ1$=PAD(ARG_8$+ARG_9$,6)+PAD(INV_NUM$,8)+PAD(INV_DATE$,6)+PAD(ORDER$,8); CALL "ARGEAU;SET_FS3_COST",(%X3$),(%X4$),QQ1$,KEY_20$,FS3$,FS3{ALL}
28357 ! IF NOT(%RETAIN_INV) AND STP(%PORDER$)<>"" THEN FS3[3]=BACK_ORD ! SSP242473 jdf
28360 WRITE (Z26,KEY=KEY_26$)IOL=0465
28362 COMP_STAT$=BILL_NOW$
28385 REFRESH_FLG=1; IF MID(P4$,20,1)<>"Y" THEN QTY_OPEN=QTY,REFRESH_FLG=1 ! SSP249812 jdf 
28390 RETURN 
28399 ! 
28400 BACK_ORD_UPDATE:! SSP 188176
28401 RETURN 
28402 GOSUB GET_PRICE_EXT; RETURN 
28405 IF MID(P4$,20,1)<>"Y" THEN BACK_ORD=BACK_ORD*FS2(5)
28406 IF MID(P4$,20,1)<>"Y" THEN BACK_ORD=FN%QTY_IN_UM(BACK_ORD,FS2$(124,4),FS2[5]) ! SSP249812 jdf
28408 IF QTY=0 THEN GOSUB ORD_QTY_UPDATE ! ssp 195294
28430 REFRESH_FLG=1
28435 RETURN 
28439 ! 
28450 UNIT_PRICE_UPDATE:
28455 IF FS2$(10,1)="9" OR EXT$="Y" OR BILL_NOW$="N" OR P4$(21,1)="Y" THEN RETURN 
28460 GOSUB GET_PRICE_EXT
28462 REFRESH_FLG=1
28490 RETURN 
28499 ! 
28500 ! CHECK FOR SPECIAL SHIPPING
28510 SPECIAL_SHIP:
28520 KEY_20$=ORDER$
28522 IDX_N=0 ! SSP237252 jdf
28530 READ (Z[20],KEY=KEY_20$,DOM=*NEXT)
28540 KEY_20$=KEY(Z[20],END=*RETURN); READ (Z[20],KEY=KEY_20$)IOL=0460
28550 IF KEY_20$(1,8)<>ORDER$ THEN RETURN 
28551 IF ID$="NEXT_1" OR ID$="AUTO_BILL" THEN { IDX_N=IDX_N+1 ! SSP237252 jdf ! SSP240353 jdf    
28552 IF ID$="AUTO_BILL" THEN COMP_STAT$=""; DIM FS3$(50),FS3[9]; READ (Z[26],KEY=INV_NUM$+KEY_20$+" ",DOM=28556)IOL=0465; COMP_STAT$="YES"; GOTO 28556 ! SSP240353 jdf
28553 LIST_BOX FIND ORDER_LINE.CTL,IDX_N,ORDER_LINES$ ! SSP237252 jdf
28554 ORDER_LINES$=SUB(ORDER_LINES$,$1B4634$,""),ORDER_LINES$=SUB(ORDER_LINES$,$1B53461B423342$,"") ! ssp 195287 ! SSP237252 jdf
28555 COMP_STAT$=ORDER_LINES$(1,POS(SEP=ORDER_LINES$)-1) ! SSP237252 jdf
28556 IF FS2$(9,1)=" " THEN GOTO 28560 ! SSP237252 jdf
28557 IF FS2(7)=0 AND FS2(19)=0 AND MID(FS2$,155,1)<>"M" AND COMP_STAT$="YES" AND FS2$(18,1)<>"Y" THEN MSGBOX "Line : "+ORDER_LINES$(4,4)+" is a Direct ship that has not been received.",MSG("WARNING"),"!" ! ssp#233200  ! SSP237252 jdf !SSP#239185    
28558 IF STP(ORDER_LINES$)<>"" THEN IF FS2$(18,1)="Y" AND COMP_STAT$<>"NO" AND FS2[7]=0 THEN MSGBOX "Line : "+ORDER_LINES$(4,4)+" this line is an item with Special Shipping that has not been received.",MSG("WARNING"),"!" ! ssp#233200  ! SSP237252 jdf ! SSP244961 jdf
28560 IF FS2$(18,1)="Y" AND COMP_STAT$<>"NO" THEN PROCESS "FMGODD","../FMG/FM.EN",X3$,X4$,"",INV_NUM$+ORDER$+FS2$(6,3)+" "+INV_DATE$+AP_INV_NUM$ ! SSP237252 jdf 
28580 GOTO 28540
28585  } ! SSP237252 jdf
28590 RETURN 
28599 ! 
29000 ! SAVE NEW LINE
29010 SAVE_ROUTINE:
29015 GOSUB CHECK_PRICE; IF PRICE_FLG THEN RETURN 
29020 GOSUB LOAD_NEW_LINE
29025 IF IDX_FLG THEN IDX_FLG=0 ELSE GOSUB GET_NEXT_INDEX
29030 GOSUB SAVE_INV_LINE
29032 GOSUB SWITCH_LIST_BOX
29035 INV_LINE_NUM=NUM(LINE_NUM$)
29040 GOSUB LOAD_LINE
29050 GOSUB CLEAR_LINE_INFO
29060 LINE_NUM=NUM(LINE_NUM$)+1; LINE_NUM$=STR(LINE_NUM)
29070 NEXT_ID=LINE_TYPE.CTL
29075 CALL "*WINGRP;ENABLE",NEXT_1.GRP$; CALL "*WINGRP;HIDE",SAVE_1.GRP$; CALL "*WINGRP;ENABLE",ADDLINE.GRP$
29080 CALL "*WINGRP;ENABLE",LINE.GRP$; CALL "*WINGRP;DISABLE",FIELDS.GRP$
29082 IF %MSLC THEN DISABLE CONTROL BT_COMM.CTL ! SSP 225300
29085 CALL "*wingrp;enable",ADDLINE.GRP$; CALL "*wingrp;enable",DEL_ORD.GRP$
29086 ENABLE CONTROL NEXT_2.CTL
29090 RETURN 
29099 ! 
29500 ! Price Check
29510 CHECK_PRICE:
29515 PRICE_FLG=0
29517 IF LINE_TYPE$="M" OR MID(INV_LOC_CODE$,1,1)="9" THEN RETURN 
29518 IF LINE_TYPE$="S" AND (MID(P4$,21,1)="Y" OR MID(FMP$,61,1)="Y") THEN RETURN ! SSP245405 jdf
29519 IF MID(P4$,21,1)="Y" THEN RETURN ! SSP257510, skip unit sell and cost so they are set to 0, don't do these checks.
29520 IF ABS(SELL_PRICE_EXT)<ABS(COST_EXT) THEN {
29530 MSGBOX MSG("PRICE_LESS")+SEP+MSG("WANT_MOD"),MSG("WARNING"),"!,YesNo",ANS$
29540 IF ANS$="YES" THEN NEXT_ID=UNIT_SELL_PRICE.CTL; PRICE_FLG=1; RETURN 
29550  }
29560 IF ABS(UNIT_SELL_PRICE)<=0 THEN {
29570 MSGBOX MSG("PRICE_ZERO")+SEP+MSG("WANT_MOD"),MSG("WARNING"),"!,YesNo",ANS$
29580 IF ANS$="YES" THEN NEXT_ID=UNIT_SELL_PRICE.CTL; PRICE_FLG=1; RETURN 
29590  }
29690 RETURN 
30000 ! Summary Page....
30005 LOAD_SUMMARY:
30015 CALL "ZZGMSG","C",MSG("ARGEAA_04",INV_NUM$),""
30020 CALL "ARGEAL.1",(X3$),(X4$),(KEY_1$),ARB$,ARB{ALL},0,Z{ALL}
30022 IF MAN_FRT$="Y" THEN MAN_FRT$="",ARB[2]=MAN_FRT ! ARGEAL.1 recalcs based upon order - overwrites man entry
30025 CALL "ZZGMSG","U",MSG("ARGEAA_05",INV_NUM$),""
30027 %FREIGHT=ARB[2] ! +LOT_FRT; ARB[2]+=LOT_FRT
30029 DIM T[100]
30030 DIM T[100]; CALL "ARGEAD",(X3$),(X4$),(KEY_1$),ARB$,ARB{ALL},0,"",T9$,T{ALL} ! 175839 ; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z0=1 THEN CMD_STR$="END"; GOTO WRAPUP
30032 IF %RETAIN_INV THEN %RETAIN_INV=0
30033 ARB$(100,15)=CUST_PO$,ARB$(153,9)=CUST_CATEGORY$; IF STP(JOB_NUM$)<>"" THEN ARB$(325,12)=JOB_NUM$ ! 
30035 GOSUB OPEN_FILES
30040 READ DATA FROM REC(IOL=0310) TO IOL=IOL(Z[1])
30050 ! CALL "ARGEAY",X3$,X4$,ARB$,ARB{ALL},S0
30060 GOSUB RECALC_FIELDS
30085 CALL "ZZGMSG","D","",""
30087 GOSUB COMM_FLD
30088 FRT_BILLED=ARB[2]
30090 REFRESH_FLG=1
30092 %GP_ADJ=0 ! SSP 307216
30095 RETURN 
30099 ! *******************************************************
30200 GET_SPECIAL_CHARGE:! SSP245405 jdf
30210 READ (Z[14],KEY="X"+ART$(65,10),DOM=*NEXT)IOL=0430 ! SSP245405 jdf
30220 RETURN ! SSP245405 jdf
30400 RECALC_FIELDS:REM "Set sales tax values, calc totals, set disc & display
30410 DIM ARB$(690),ARB[30]; READ DATA FROM REC(IOL(Z[1])) TO IOL=0310
30420 CALL "AR2EAR",X3$,X4$,4,ARB$,ARB{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9; S0=0
30425 IF ARB$(115,1)="Y" THEN ARB[9]=ARB[1]+ARB[2] ELSE ARB[9]=ARB[1]+ARB[2]+ARB[4]+ARB[6]+ARB[8]
30430 GOSUB CALC_DUE_DATE
30435 IF E$(43,1)<>" " THEN ARB[10]=(ARB[1]-ARB[17])*E[0]*.01 ELSE ARB[10]=0
30440 READ DATA FROM REC(IOL=0310) TO IOL=IOL(Z[1])
30442 GOSUB DO_CALC_FIELDS
30443 REFRESH_FLG=1
30445 RETURN 
30449 ! *************************************
30450 CALC_DUE_DATE:
30455 IF MID(E$,1,2)<>ARB$(65,2) THEN DIM E$(54),E[3]; FIND (Z[5],KEY=ARB$(65,2),DOM=30458)IOL=0330; E$=AR2$; E[0]=AR2[0]; E[1]=AR2[1]; E[2]=AR2[2]
30460 CALL "ZZDISC",X3$,E$,0,0,ARB$(86,6),Q0$,Q1$,0,0
30465 ARB$(116,6)=Q0$; IF E$(43,1)<>" " THEN ARB$(122,6)=Q1$ ELSE ARB$(122,6)=""
30470 INV_DUE_DATE$=ARB$(116,6); DISC_DUE_DAY$=ARB$(122,6)
30495 RETURN 
30499 ! ************************************
30500 DO_CALC_FIELDS:! calculate display fields from real fiedls
30520 TOTAL_STAX=ARB[4]+ARB[6]+ARB[8],INV_TOTAL=NET_SALE+TOTAL_STAX+FRT_BILLED,ARB[9]=INV_TOTAL ! SSP249531-TMA  ! SSP250919 jdf
30530 TOT_GP_ADJ=ARB[19]
30550 GROSS_PROFIT=NET_SALE-TF_COST,ADJUSTED_GP=GROSS_PROFIT+TOT_GP_ADJ; IF NET_SALE=0 THEN GP_PERCENT=0 ELSE GP_PERCENT=GROSS_PROFIT*100/NET_SALE ! ssp 217241
30560 DISC_AMT=ARB[10]
30570 TOTAL_COMM=ARB[18] ! SSP 307216
30590 REFRESH_FLG=1
30595 RETURN 
30599 ! ***************************
30600 CALC_GP_ADJ:! Calculate Total Gross Profit Adjustment
30695 RETURN 
30699 ! ************************************
30700 ! LOAD FREIGHT BILL AMOUNT
30710 SET_FREIGHT:
30730 ARB[2]=FRT_BILLED; FRT_AMT=FRT_BILLED; IF FRT_BILLED=0 THEN WRITE (Z[1],KEY=KEY_1$)IOL=0310
30732 MAN_FRT$="Y",MAN_FRT=ARB[2]
30775 GOSUB LOAD_SUMMARY
30780 FRT_BILLED=ARB[2],COSTED_FRT=ARB[17]
30785 WRITE (Z[1],KEY=KEY_1$)IOL=0310
30786 IF FRT_BILLED<>0 AND MAN_FRT$="Y" THEN GOSUB LOAD_SUMMARY ! SSP 195763
30787 FRT_BILLED=ARB[2],COSTED_FRT=ARB[17]
30790 REFRESH_FLG=1
30795 RETURN 
30799 ! **********************************
30800 ! Commission Field Access
30810 COMM_FLD:
30820 KEY_8$=COMM_CODE$
30825 NN$=PTH(Z(8)); IF POS("AR4"=NN$)=0 THEN CLOSE (Z(8)); OPEN (Z(8))"AR4"+%C$ ! 
30830 READ (Z[8],KEY=KEY_8$,DOM=*RETURN)IOL=0360
30840 IF AR4$(32,1)<>"I" THEN RETURN 
30845 ! IF NOT(%MSLC) THEN GOSUB CHECK_LOAD ! SSP 307216
30850 CALL "*wingrp;Unlock",COMM_1.GRP$
30890 RETURN 
30895 ! *********************************
30900 ! Replace Total Commission Amount
30910 COMM_TOTAL:
30930 IF TOTAL_COMM<>0 THEN ARB[18]=TOTAL_COMM
30990 RETURN 
31100 ! SHOW REPLACEMENT AFTER THE SUMMARY SCREEN
31110 SUMM_EXIT:
31120 IF AR2[1]>1 THEN {
31130 CALL "ARGEAG",X3$,X4$,"",ARB$(1,14),ARB[9],ARB[10],ARB$(116,6),ARB$(122,6),AR2$,AR2[0],AR2[1],AR2[2]
31140  } ELSE {
31150 REMOVE (Z[1],KEY=ARB$(1,14),DOM=*NEXT)
31155  }
31160 REPLACEMENT_SCRN$="ARGEAC.4"
31180 REFRESH_FLG=1
31190 RETURN 
31300 ! Load State Tax from Summary Screen if changed.
31310 LOAD_STATE_TAX:
31320 ARB[4]=ST_STAX_BILLED
31330 TOTAL_STAX=ST_STAX_BILLED+CNTY_STAX_BILLED+LCL_STAX_BILLED
31340 INV_TOTAL=NET_SALE+TOTAL_STAX+FRT_BILLED
31370 ARB[9]=INV_TOTAL
31380 WRITE (Z[1],KEY=KEY_1$)IOL=0310
31390 REFRESH_FLG=1
31395 RETURN 
31399 ! *****************************************************
31400 ! Load County Tax from Summary Screen if changed.
31410 LOAD_COUNTY_TAX:
31420 ARB[6]=CNTY_STAX_BILLED
31430 TOTAL_STAX=ST_STAX_BILLED+CNTY_STAX_BILLED+LCL_STAX_BILLED
31440 INV_TOTAL=NET_SALE+TOTAL_STAX+FRT_BILLED
31445 ARB[9]=INV_TOTAL
31450 WRITE (Z[1],KEY=KEY_1$)IOL=0310
31460 REFRESH_FLG=1
31470 RETURN 
31499 ! *****************************************
31500 ! Load Local Tax from Summary Screen if changed.
31510 LOAD_LOCAL_TAX:
31520 ARB[8]=LCL_STAX_BILLED
31530 TOTAL_STAX=ST_STAX_BILLED+CNTY_STAX_BILLED+LCL_STAX_BILLED
31540 INV_TOTAL=NET_SALE+TOTAL_STAX+FRT_BILLED
31545 ARB[9]=INV_TOTAL
31550 WRITE (Z[1],KEY=KEY_1$)IOL=0310
31560 REFRESH_FLG=1
31570 RETURN 
31580 ! *****************************************
32000 CHECK_PRINT_INVOICE:! SSP 194559
32010 IF POS(MID(P2$,65,1)="YC")=0 OR ARB$(345,1)<>"Y" OR ID$="DEL_2" THEN GOTO END_PRINT_INVOICE ! SSP#238636
32015 DIM FMS_REC$(244); FIND (Z[14],KEY="D"+CUSTOMER$,DOM=*NEXT)FMS_REC$; REM "201807   ! SSP250527
32020 IF MID(P2$,65,1)="C" THEN IF FMS_REC$(234,1)="P" THEN GOTO PRINT_INV ELSE IF FMS_REC$(234,1)<>"Y" THEN GOTO END_PRINT_INVOICE
32030 MSGBOX MSG("PRT_INV"),MSG("CONFIRMING"),"?,YESNO",OPT$
32040 IF OPT$<>"YES" THEN GOTO END_PRINT_INVOICE
32050 PRINT_INV:
32060 VAR$=ARB$(1,14)
32070 CALL "AR2EBY",%X3$,%X4$,VAR$,""
32080 VAR$=""
32090 ARB$(64,1)="P"
32100 WRITE (Z(1),KEY=ARB$(1,14))IOL=0310 ! SSP207527 jdf
32110 END_PRINT_INVOICE:
32120 RETURN 
32500 EXISTING_INVOICE:! SSP 235752
32520 _FILE_NAME$="AR6"+%C$; _AR6=HFN; OPEN (_AR6,ERR=INV_EXIST_END)_FILE_NAME$ ! SSP 235752
32525 _FILE_NAME$="AR8"+%C$; _AR8=HFN; OPEN (_AR8,ERR=INV_EXIST_END)_FILE_NAME$ ! SSP 23572
32528 EXIST_MSG$="",EXIST_ANSWER$="" ! SSP 235752
32530 FIND (_AR6,KEY=CUSTOMER$+INV_NUM$,DOM=*NEXT)*; EXIST_MSG$=MSG("INV_OPEN"); GOTO 32550
32540 FIND (_AR8,KEY=CUSTOMER$+INV_NUM$,DOM=*RETURN)*; EXIST_MSG$=MSG("INV_HIST"); GOTO 32550
32550 MSGBOX EXIST_MSG$,MSG("CONFIRM"),"?,YESNO",EXIST_ANSWER$ ! SSP 235752
32580 INV_EXIST_END:! SSP 235752
32585 IF _AR6 THEN CLOSE (_AR6,ERR=*NEXT) ! SSP 235752
32588 IF _AR8 THEN CLOSE (_AR8,ERR=*NEXT) ! SSP 235752
32590 IF EXIST_ANSWER$="YES" THEN RETURN ! SSP 23572
32600 GOSUB DELETE_RESET
32610 NEXT_ID=INV_NUM.CTL
32700 RETURN 
33000 CHECK_FS2_FILE:! SSP 186958
33010 CLOSE (Z(20),ERR=*NEXT)
33020 OPEN (Z(20))"FS2"+%C$
33030 RETURN 
33200 CHECK_LOAD:! SSP 307216 If Invoice type commission, and there is house charge, need to get the GP adjustment on total invoice
33220 ! %GP_ADJ is from accumulated ART lines GP adjustments before the load.It is calculated in ARGEAL.1 and will be cleared at the end of the invoice entry.
33230 IF POS(AR4$(33,1)="123456789")>0 THEN CALL "AR2COM",ERR=*NEXT,"HC"+A$,AR4$,AR4{ALL},Q,ARB[1],ARB[11]-%GP_ADJ,"",ARB{ALL},B{ALL},EXTRA{ALL}; ARB[19]=%GP_ADJ-Q ! SSP#229715  
33240 IF POS(AR4$(33,1)="123456789")>0 THEN GOTO 33290
33250 ARB[19]=%GP_ADJ-ARB[11]*AR4[0]/100
33260 IF AR4$(33,1)="S" THEN ARB[19]=%GP_ADJ
33280 IF AR4$(33,1)="F" THEN ARB[19]=%GP_ADJ-AR4[0]
33290 GOSUB DO_CALC_FIELDS
33295 RETURN 
34000 GET_CODE:! SSP236850 jdf
34010 IF STP(COMM_CODE$)="" THEN GOTO *RETURN ! SSP236850 jdf
34020 DIM AR3$(244); FIND (Z[9],KEY=SPER_CODE$,DOM=*RETURN)IOL=0350 ! SSP236850 jdf
34030 COMM_CODE$=AR3$(219,5) ! SSP236850 jdf
34040 REFRESH_FLG=1 ! SSP236850 jdf
34050 RETURN ! SSP236850 jdf
37000 ! Process General Ledger
37010 PROCESS_GL:
37015 ! GOSUB SETUP_ACCT
37020 L0=1,A5=0
37030 X3$(15,6)=ARB$(86,6),L0=1,F=Z[21],A0=ARB[0],V1=0,V9=-2,V3=Z[22],T[0]=NET_SALE
37035 NO_GL=1; NEG_VAL=1
37040 IF ARB[20]>0 THEN T[0]=NET_SALE
37050 CALL "ZZDISP","AX","000000000000","G/L",X3$,W2$,"",0,0,X4$
37055 M2=0; FOR X=1 TO LEN(W2$); M2=M2+POS("0"=W2$(X,1)); NEXT X
37060 IF LEN(T9$)>=12 THEN CALL "GL2XAB",X3$,T9$,T{ALL},V9$,F,A0; ARB[0]=A0
37065 PERFORM "GLGXAA"
37070 ARB[0]=A0
37090 GOSUB WRITE_REC
37095 LIST_BOX FIND LB_LINE.CTL,1,LB_LINE$,ERR=*NEXT ! ssp 191540
37096 PERFORM "GLGXAA;SEL_LB_LINE"; NEXT_ID=BUTTON_4.CTL ! ssp 191540
37190 RETURN 
37200 ! DIGIT REPLACEMENT
37210 DIGIT_REPL:
37220 G8=NUM(G0$(170,2)); DIM M$(223); M$=FM0$
37230 IF J9=1 THEN J9=0; GOTO 37330
37240 IF G8<=0 THEN GOTO 37280
37250 REM "Division subsitition - OR - Salesperson
37260 IF POS(P0$(121,1)="DN")>0 AND Q$(202,G8)=Q0$(G8,2) THEN Q0$(G8,2)="00"
37270 IF P0$(13,1)="Y" THEN Q0$(G8,2)=ARB$(15,2) ELSE IF P0$(13,1)="S" AND NUM(A$(135,2),ERR=37270)>=0 THEN Q0$(G8,2)=STR(NUM(ARB$(135,2)):"00")
37280 IF P0$(13,1)<>"S" AND P0$(110,2)>"00" AND NUM(ARB$(135,2),ERR=37290)>=0 THEN Q0$(NUM(P0$(110,2),ERR=37270),2)=STR(NUM(ARB$(135,2)):"00")
37290 IF POS(P0$(121,1)="D")>0 AND Q$(202,G8-1)=Q0$(1,G8-1) THEN Q0$(NUM(P0$(110,2),ERR=37320),2)="00"
37300 IF Q$(202,G8-1)=Q0$(1,G8-1) AND P0$(13,1)="Y" AND P0$(121,1)="D" THEN Q0$(G8,2)=ARB$(15,2); REM " SSP#
37310 IF Q$(202,G8-1)=Q0$(1,G8-1) AND P0$(121,1)="Y" THEN Q0$(NUM(P0$(110,2),ERR=*NEXT),2)=STR(NUM(ARB$(135,2)):"00"); REM " SSP#
37320 GOTO 37370
37330 REM "Warehouse substitution
37340 IF M$(1,1)<>"D" OR M$(12,4)<>ART$(89,4) THEN DIM M$(223); READ (Z[4],KEY="D"+M$(1,10)+ART$(89,4),DOM=37345)M$
37350 IF POS(" "<>M$(214,I1))=0 THEN GOTO 37370
37360 Q0$(I0,I1)=M$(214,I1)
37370 RETURN 
37380 RETURN 
37400 ! No G/L Number
37410 NO_NUMBER:
37420 DIM FS3[1]; FIND (Z[24],KEY=ARB$(7,8)+ARB$(92,8)+ART$(47,3)+" ",DOM=*RETURN)*,*,*,*,*,*,FS3[0]
37430 IF ART$(2,2)="N" THEN Q0$=Q$(190,12)
37440 Q0=-FS3[0]
37450 J9=1; GOSUB ACCUM_GL
37460 ! 
37490 RETURN 
37500 ! setup GL Account Numbers
37510 SETUP_ACCT:
37520 GOSUB REMOVE_CURR_LIST
37530 READ (Z[5],KEY=ARB$(65,2),DOM=*NEXT)IOL=0330
37550 IF ARB[20]>0 THEN GOSUB GL_INTERFACE
37560 ! 
37590 RETURN 
37600 ! G/L Interface to Detail
37610 GL_INTERFACE:
37620 IF LEN(I0$)<42 THEN DIM I$(40); FIND (Z[6],KEY=X3$(9,3)+"I/C",DOM=*NEXT)I0$
37630 T9$="",J9=0,I0=NUM(I0$(40,2)),I1=NUM(I0$(42,1)); DIM T[30],ART$(104),ART[5],M$(223)
37635 IF ARB[20]=0 THEN GOTO 37695 ELSE IF ARB[0]>0 THEN GOSUB REMOVE_CURR_LIST
37640 ART9=ARB[20]
37645 IF ART9<=0 THEN GOTO 37695
37650 READ (Z[17],IND=ART9)IOL=0390
37655 IF POS(ART$(1,1)="M")<>0 OR (ART[4]=0 AND ART[5]=0) THEN GOTO 37645
37660 DIM FS2$(228); FIND (Z[20],KEY=ARB$(92,8)+ART$(47,3),DOM=*NEXT)FS2$
37663 DIM Q$(300); FIND (Z[23],KEY=ART$(75,9),DOM=*NEXT)Q$
37665 Q=0; IF ARB$(77,1)="C" THEN Q=1
37670 Q=94+Q*36,Q0$=Q$(Q,12),Q0=-ART[4]; GOSUB ACCUM_GL
37675 IF POS(G0$(40,1)="AC")>0 AND POS(ART$(1,1)="IC")<>0 AND ART$(89,4)<>"DS  " AND ART$(89,4)<>"    " THEN Q=Q+12,Q0$=Q$(Q,12),Q0=ART[5]; GOSUB ACCUM_GL; Q=Q+12,Q0=-Q0,Q0$=Q$(Q,12),J9=1; IF AR2$(43,1)="Y" AND ART$(47,3)<>"   " THEN GOSUB NO_NUMBER ELSE GOSUB ACCUM_GL
37680 IF AR2$(43,1)="Y" AND ART$(47,1)<>" " AND ART$(1,1)="N" THEN Q=Q+12,Q0$=Q$(Q,12),Q0=ART[5]; GOSUB ACCUM_GL; GOSUB NO_NUMBER
37685 IF POS(" "<>Q$(202,12))>0 AND POS(G0$(40,1)="AC")>0 AND POS(ARB$(89,4)="    DS  ",4)>0 AND (FS2$(9,1)<>" " OR P0$(120,1)="Y") THEN Q=Q+12,Q0$=Q$(Q,12),Q0=ART[5]; GOSUB ACCUM_GL; Q0=-Q0,Q0$=Q$(202,12); IF POS(P0$(121,1)="YD")>0 THEN GOSUB ACCUM_GL ELSE GOSUB ACCUM_GL
37690 GOTO 37645
37695 DIM M$(0); RETURN 
37700 ! Accumalate G/L Numbers
37710 ACCUM_GL:
37715 IF G0$(149,1)="Y" OR (J9=1 AND I0$(39,1)="Y") THEN GOSUB DIGIT_REPL
37720 IF Q0=0 THEN RETURN 
37730 P=POS(Q0$=T9$,LEN(Q0$)); IF P=0 THEN T9$=T9$+Q0$; GOTO 37730 ELSE P=INT(P/LEN(Q0$))+1
37740 T[P]=T[P]+Q0
37790 RETURN 
37800 ! Remove the current Gl List
37810 REMOVE_CURR_LIST:
37820 F=Z[21],Z=ARB[0]
37830 IF Z<=0 THEN GOTO 37860 ELSE READ (F,IND=Z)Z9
37840 GOSUB REMOVE_INDEX
37850 Z=Z9; GOTO 37830
37860 ARB[0]=0
37870 RETURN 
37900 ! Remove Current Index
37910 REMOVE_INDEX:
37920 EXTRACT (F,IND=0)IOL=0470
37930 IF ARD[4]=-2 THEN READ (F); WAIT 0; GOTO 37920 ELSE Y[4]=-2
37940 WRITE (F,IND=0)IOL=0470
37950 WRITE (F,IND=Z)ARD[1]
37960 ARD[1]=Z,ARD[4]=-1,ARD[0]=ARD[0]-1
37970 WRITE (F,IND=0)IOL=0470
37990 RETURN 
38000 DELETE_ASD_REC:! SSP 
38010 READ (Z[28],KEY=KEY_1$,DOM=*NEXT)
38020 K_ASD$=KEY(Z[28],END=END_DEL_ASD_REC); READ (Z[28])
38030 IF K_ASD$(1,14)<>KEY_1$ THEN GOTO END_DEL_ASD_REC ! SSP#307394 DBD-249
38040 REMOVE (Z[28],KEY=K_ASD$)
38050 GOTO 38010
38060 END_DEL_ASD_REC:RETURN 
39000 CHECK_DATA:
39020 FIND (Z(3),KEY=FS1$(6,10),DOM=*RETURN)AAR1$
39030 CALL "UPDSYO;VAL_QRY_LIST",ERR=NO_QOOD,VA$,AAR1$(278,4),AAR1$(282,4),AAR1$(286,4),AAR1$(290,4),AAR1$(294,4)
39040 RETURN 
39050 NO_QOOD: MSGBOX MSG("SEC_CUST"); ORDER$="",NEXT_ID=ORDER.CTL,REFRESH_FLG=1; EXIT 
39200 MCOMM_CHANGE:! SSP 225300
39220 DTC=0; GOSUB MULTI_COMM_KEY; GOSUB MULTI_COMM_SETUP; CALL "ARGSCM;DEFAULT_HEADER_SETUP",SC_TYPE$,SC_KEY1$,SC_KEY2$,SC_LINE$,MCCDE${ALL},MCSPLT{ALL},MCOMM${ALL},CUSTOMER$,INV_DATE$,X3$(174,5),X3$(21,6) ! SSP 225300   
39250 RETURN 
39500 MULTI_COMM_KEY:! SSP 225300
39510 SC_TYPE$="I",SC_KEY1$=INV_NUM$,SC_KEY2$=CR_FY$+CR_ACCTPD$+DIM(4),SC_LINE$="000"
39512 IF DTC=1 THEN SC_LINE$=STR(NUM(LINE_NUM$):"000")
39515 SC_KEY$=SC_TYPE$+SC_KEY1$+SC_KEY2$+SC_LINE$ ! SSP 225300    
39516 RETURN 
39518 MULTI_COMM_SETUP:! SSP 225300
39520 DIM MCCDE$[5]; DIM MCSPLT[5],MCOMM$[10](5," ") ! SALESMAN CODES  SALESMAN SPLIT
39530 MCCDE$[1]=SPER_CODE$,MCCDE$[2]=SPER_CODE_2$,MCCDE$[3]=SPER_CODE_3$,MCCDE$[4]=SPER_CODE_4$,MCCDE$[5]=SPER_CODE_5$
39540 MCSPLT[1]=COMM_AMT_1,MCSPLT[2]=COMM_AMT_2,MCSPLT[3]=COMM_AMT_3,MCSPLT[4]=COMM_AMT_4,MCSPLT[5]=COMM_AMT_5
39550 FOR SLP=1 TO 5; IF STP(MCCDE$[SLP],2)<>"" AND MCSPLT[SLP]>0 THEN MCOMM$[SLP]=COMM_CODE$; END_IF ; NEXT SLP
39590 RETURN 
39600 MULTI_DET_SETUP:! SSP 225300
39620 IF %MSLC THEN DTC=1; GOSUB MULTI_COMM_KEY; SC_LINE$=STR(NUM(LINE_NUM$):"000"); CALL "ARGSCM;DEFAULT_LINE_SETUP",SC_TYPE$,SC_KEY1$,SC_KEY2$,SC_LINE$,MCCDE${ALL},MCSPLT{ALL},MCOMM${ALL} ! SSP 225300
39690 RETURN 
39700 MULTI_COMM_MAINT:
39710 GOSUB MULTI_COMM_KEY ! SSP 225300
39720 ! OSUB MULTI_COMM_SETUP
39750 CALL "ARGSCM",X3$,X4$,SC_KEY$,DF_COMM$; IF DTC=0 THEN ARB$(128,5)=DF_COMM$ ELSE IF DTC=1 THEN ART$(84,5)=DF_COMM$ ! SSP 22530
39799 RETURN 
39800 MCOMM_CHK:
39805 IF NOT(%MSLC) THEN RETURN 
39810 DISABLE CONTROL BT_COMM.CTL; HIDE CONTROL COMM_CODE.CTL; ID=COMM_CODE.CTL; HIDE CONTROL ID+3000; HIDE CONTROL %SIC_DESC.CTL ! SP  225300
39815 IF FOLDER_ID$="ARGEAC.2" THEN ID=COMM_CODE1.CTL; HIDE CONTROL COMM_CODE1.CTL; HIDE CONTROL ID+3000
39820 RETURN 
40000 LOAD_FY:
40010 ! ONLY_OPEN$="Y" means only load open FY's, TF_MODULE$ can be set to second part of key for that system parameter record, ie A/P, A/R, I/C
40020 ONLY_OPEN$="Y"
40030 CUR_FY$="",CUR_ACCTPD$=""; READ (Z[6],KEY=%C$+"A/R",DOM=*NEXT)SYS_PARMS$; CUR_FY$=SYS_PARMS$(7,4),CUR_ACCTPD$=SYS_PARMS$(11,2)
40033 IF NOT(NUL(CR_FY$)) THEN CUR_FY$=CR_FY$; CR_FY$=""
40035 IF NOT(NUL(CR_ACCTPD$)) THEN CUR_ACCTPD$=CR_ACCTPD$; CR_ACCTPD$=""
40040 DIM GL$(300); READ (Z[6],KEY=%C$+"G/L")GL$(1)
40050 DIM OSEC$(255); READ (Z[6],KEY="osec"+%X3_OP_ID$,DOM=*NEXT)OSEC$
40060 READ (Z[6],KEY=%C$+"G/LYE",DOM=*NEXT)
40070 K$=KEY(Z[6],END=LOAD_FY_DROP_BOX); READ (Z[6],KEY=K$)GLYE$
40080 IF LEN(K$)<8 OR K$(1,8)<>%C$+"G/LYE" THEN GOTO LOAD_FY_DROP_BOX
40090 IF ONLY_OPEN$="Y" AND POS(GLYE$(99,1)="CR")>0 THEN GOTO 40070
40100 IF GL$(256,1)="Y" AND MID(OSEC$,58,1)<>"Y" AND K$(9,4)<GL$(34,4) THEN GOTO 40070
40110 CR_FY$=CR_FY$+K$(9,4)+"/"
40120 GOTO 40070
40130 LOAD_FY_DROP_BOX:
40140 DROP_BOX LOAD CR_FY.CTL,CR_FY$
40150 DROP_BOX WRITE CR_FY.CTL,CUR_FY$
40160 IF CUR_FY$<>"" THEN IF GL$(256,1)="Y" AND MID(OSEC$,58,1)<>"Y" AND CUR_FY$<GL$(34,4) THEN CUR_FY$=GL$(34,4),CUR_ACCTPD$=GL$(38,2)
40170 IF CUR_ACCTPD$<>"" THEN IF GL$(256,1)="Y" AND MID(OSEC$,58,1)<>"Y" AND CUR_FY$+CUR_ACCTPD$<GL$(34,6) THEN CUR_ACCTPD$=GL$(38,2) ! Fix for 173826
40180 IF CUR_FY$<>"" THEN DROP_BOX WRITE FY.CTL,CUR_FY$
40190 CR_FY$=CUR_FY$; %FY$=CR_FY$
40200 IF CUR_FY$<>"" THEN FROM_FY$="Y",CR_FY$=CUR_FY$; GOSUB LOAD_ACCTPD
40210 LOAD_FY_END:RETURN 
40220 ! 
40230 LOAD_ACCTPD:
40240 ! FY$ should be set to a valid fiscal year
40250 CR_ACCTPD$=""; FROM_FY$="Y"
40260 IF FROM_FY$="Y" THEN GOTO 40270
40270 READ (Z[6],KEY=%C$+"G/LYE"+CR_FY$,DOM=LOAD_ACCTPD_END)GLYE$
40280 PDS=12; PDS=NUM(GLYE$(13,2),ERR=*NEXT) ! Number of periods in this FY
40290 FOR X=1 TO PDS
40300 X$=STR(X:"00"),FLAG$="NO"; CALL "ARGDTE",%X3$,%X4$,CR_FY$+X$,FLAG$; IF FLAG$<>"*" THEN CR_ACCTPD$=CR_ACCTPD$+X$+"/" ! Checks osec, only load valid periods
40310 NEXT X
40320 DROP_BOX LOAD CR_ACCTPD.CTL,CR_ACCTPD$
40330 IF FROM_FY$="Y" AND CUR_ACCTPD$<>"" THEN DROP_BOX WRITE CR_ACCTPD.CTL,CUR_ACCTPD$
40340 CR_ACCTPD$=CUR_ACCTPD$; %AP$=CR_ACCTPD$
40350 GOSUB LOAD_ENDING_DATE
40360 LOAD_ACCTPD_END:RETURN 
40370 ! 
40380 LOAD_ENDING_DATE:
40390 KE$=%C$+"G/LYE"
40400 IF LEN(CR_FY$)>4 THEN VAL$=CR_YEAR$ ELSE VAL$=CR_FY$
40410 FIND (Z[6],KEY=KE$+VAL$)Z9$; CC$=Z9$(21)
40420 IF LEN(CR_ACCTPD$)>2 THEN VAL=NUM(CR_PD$) ELSE VAL=NUM(CR_ACCTPD$)
40425 IF VAL=0 THEN VAL=1 ! SSP231224 jdf
40430 CC$=CC$(VAL*6-5,6),END_DATE$=CC$,REFRESH_FLG=1
40440 RETURN 
40500 CHK_CLOSED_FY:! Check to see if fiscal year is closed ! SSP231224 jdf  
40510 READ (Z[6],KEY=%C$+"G/LYE"+CR_FY$,DOM=40540)P1$ ! SSP231224 jdf
40520 IF POS(P1$(99,1)="CR")<>0 THEN MSGBOX MSG("ARGEAA_13"),MSG("WARNING"); CUR_ACCTPD$=""; CR_ACCTPD$=""; REFRESH_FLG=1; NEXT_ID=CR_FY.CTL ! EXIT ! SSP231224 jdf
40550 RETURN ! SSP231224 jdf
46500 DELETE_INVOICE_STUFF:! Delete the rest of the item for an invoice
46505 GOSUB OPEN_FILES
46510 CALL "AR2FIS",X3$,X4$,P2$,"DELETE",ARB$,ARB{ALL}
46511 REM CALL "AR2FRT",X3$,X4$,P2$,"DELETE",ARB$,ARB{ALL}
46525 IF NOT(NUL(ARB$(92,8))) THEN EXTRACT RECORD (Z[10],KEY=ARB$(92,8),DOM=*NEXT)O$; O$(63,1)=""; WRITE RECORD (Z[10])O$; CALL "AR2EAQ",X3$,ARB$
46535 IF P0$(118,1)="Y" THEN REMOVE (Z[24],KEY=A1$,DOM=*NEXT)
46545 IF ARS$(125,1)="Y" THEN IF ARB$(77,1)="C" THEN MSGBOX MSG("ARGEAA_09"),MSG("CONFIRM"),"?,YESNO",ANS$; IF ANS$="YES" THEN CM$=ARB$(15,10)+ARB$(7,8); CALL "AR2CMA",X3$,X4$,"DELETE",CM$ ! WO121235, credit memo information file, also SSP128566
46565 REMOVE (Z[11],KEY=A1$,DOM=*NEXT)
46595 RETURN 
46599 ! ********************************************
46600 ! Open Files
46610 OPEN_FILES:
46620 Z$="01X ARB...  02O AR3...  03O AR1...  04O PO3...  05O AR2...  06O ZZPARM  07O AR5...  08O AR4...  09O AR3...  10O FS1...  11O ARC...  12O FMN... 13O FM0...  14O FMP...  15O ASQ...  16O AS5...  17O ART...  18O FM1...  19O IC0...  20O FS2...  21O ARD...  22O GL1...  23O ARV...  24O ASO...  25O ASN...  26O FS3...  27O ICF...  "
46630 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z0=1 THEN CMD_STR$="END"; GOTO WRAPUP
46690 RETURN 
46699 ! 
47000 SET_FREIGHT_PRIOR:
47040 GOSUB LOAD_SUMMARY
47060 WRITE (Z[1],KEY=KEY_1$)IOL=0310
47070 FRT_BILLED=ARB[2],COSTED_FRT=ARB[17]
47080 REFRESH_FLG=1
47090 RETURN 
47099 ! 
47200 GET_EXT:
47201 GOSUB SET_UM_DIV
47202 BACK_ORD_AMT=FS3(3),QTY_AMT=FS3(0); ORD_EXT=FS3(2),UNIT_AMT=FS3(1) ! SSP221171 jdf, SSP 231513 
47203 RETURN 
47204 GET_EXT_DISP:
47206 EXT$="N"
47208 GOSUB SET_UM_DIV
47210 IF FS2$(155,1)<>"S" THEN GOTO CALC_ORD_EXT
47220 FIND (Z14,KEY="X"+FS2$(19,10),DOM=CALC_ORD_EXT)WI$
47225 IF WI$(61,1)="Y" THEN EXT$="Y"
47230 CALC_ORD_EXT:
47235 IF MID(P4$,21,1)="Y" OR MID(FS3$,37,1)="Y" OR EXT$="Y" THEN RETURN ! ORD_EXT=FS2[6]; RETURN ! SSP224634 jdf
47245 IF M=0 THEN ORD_EXT=0; RETURN 
47260 DIM M6[1]; CALL "IC2PRE",%X3$,Z[6],M6$,M6{ALL},"",0,"",0
47265 CALL "FM2EXT",Z[6],0,FS2$(124,4),FS2[5],QTY_AMT,UNIT_AMT,FS2Z,M6[1] ! SSP231513 jdf
47270 ORD_EXT=FS2Z
47290 RETURN 
47299 ! 
47300 GET_FRT_TYPE:
47310 READ (Z[14],KEY="X"+ITEM_CODE$,DOM=*RETURN)IOL=0430
47320 IF MID(FMP$,60,1)="Y" THEN ART$(2,1)="Y"
47390 RETURN 
47400 GET_DEF_COMM:
47405 ! SSP187599 sic code only.  need to add other options  ssp187992
47420 ! prod code
47500 ! form type 
47600 ! cic code
47610 IF MID(P2$,68,1)="Y" THEN {
47620 IF AR1$(262,5)<>DIM(5) THEN COMM_CODE$=AR1$(262,5),COMM_CODE1$=COMM_CODE$ ! ssp 187992 199976
47690  } ELSE {
47700 ! sls rep 
47705 DIM AR3$(244); FIND (Z[9],KEY=AR1$(278,4),DOM=*NEXT)IOL=0350
47710 COMM_CODE$=MID(AR3$,219,5),COMM_CODE1$=COMM_CODE$ ! ssp 199976
47980  }
47985 IF NUL(COMM_CODE$) THEN COMM_CODE$=MID(AR3$,219,5),COMM_CODE1$=COMM_CODE$ ! ssp 199976
47990 RETURN 
48069 ! 
48070 GET_PRICE_EXT:
48071 QTY_AMT=QTY_OPEN*M ! ssp 188176
48072 UNIT_AMT=SELL_PRICE
48073 ! ORD_EXT=0
48074 GOSUB GET_EXT_DISP
48075 PRICE_EXT=ORD_EXT
48090 RETURN 
48099 ! 
48200 CHECK_PAYMENT_STATUS:
48220 PAID_YN=0
48230 IF MID(ARS$,241,1)<>"Y" OR ARB$(420,1)<>"Y" THEN GOTO *RETURN
48240 CALL "UPDEDD;CHECK_IF_INV_PAID",ERR=*NEXT,0,ARB$(92,2),ARB$(94,6),ARB$(7,8),PAID_YN
48250 RETURN 
48300 CHECK_SALES_INFO:! SSP220240 jdf  Check the sales info (S.person and commison) before leaving panel
48305 IF MID(OP_SEC$,65,1)="Y" THEN GOTO 48310 ! SSP 302616
48306 IF STP(TERMS_CODE$,2)="" THEN GOTO *NEXT ELSE FIND (Z[5],KEY=TERMS_CODE$,DOM=*NEXT)*; GOTO 48310
48308 MSGBOX (MSG("Inval_Trm")); NEXT_ID=TERMS_CODE.CTL; REFRESH_FLG=1; RETURN ! SSP 302616
48310 SPER_STR$="",SPER_TOT_COMM=0 ! SSP220240 jdf
48320 SPER_CODE_1$=SPER_CODE$ ! SSP220240 jdf
48330 FOR X=1 TO 5 ! SSP220240 jdf
48340 SPER_STR$=SPER_STR$+EVS("SPER_CODE_"+STR(X)+"$") ! SSP220240 jdf
48350 SPER_TOT_COMM=SPER_TOT_COMM+EVN("COMM_AMT_"+STR(X)) ! SSP220240 jdf
48360 IF EVN("COMM_AMT_"+STR(X))<>0 AND STP(EVS("SPER_CODE_"+STR(X)+"$"))="" THEN EXITTO 48410 ! SSP220240 jdf
48370 IF EVN("COMM_AMT_"+STR(X))<0 THEN EXITTO 48410 ! SSP220240 jdf
48380 NEXT X ! SSP220240 jdf
48390 IF STP(SPER_STR$)="" OR SPER_TOT_COMM<>100 THEN GOTO 48410 ! SSP220240 jdf
48400 RETURN ! SSP220240 jdf
48410 MSGBOX MSG("SPER_INFO"),MSG("STOP"); CALL "*wingrp;show",BUTTON_1.GRP$; NEXT_ID=SPER_CODE.CTL,REFRESH_FLG=1; RETURN ! SSP220240 jdf
48420 ! ******************************************** SSP220240 jdf
56000 ! "188419-We reprinted Invoice 301333 & 301262 and it changed FOB     
56010 ! "188176-ARGEAC.5 - You do not have the ability to change the qty    
56011 ! "       billed in the Order/Invoicing Interface
56012 ! "189512-Gui  will allow you to bill the customer for a B-type order
56015 ! "175269-GUI requisition entry is not designed to cover Non-Lotted   
56016 ! "       Inventory"
56017 ! "190311-She is doing direct entry into AR invoicing. System will    
56018 ! "       not allow her to access S/B promt on AR invoice."
56019 ! "187568-If you modify an invoice in AR after it is printed, it does 
56020 ! "       not ask about invoice will be reprinted until Retain Message"
56021 ! "191540-Canot enter multiple GL Accounts when you are doing a 
56022 ! "       direct entry invoice
56023 ! "192616-On credit card orders that have been backordered, need to      
56025 ! "195621-Their direct entry invoices w/out order numbers are not     
56026 ! "       being printed."
56027 ! "195287-When you select a message line to bill, you get error 47"
56028 ! "193806-Program FMGODX Order Entry Default Display issue in qatst gui.
56029 ! "195294-ARGEAA-Filling a b/order during AR invoice entry in Order/  
56030 ! "       Invoicing interface."
56031 ! "195783-Foreign Currency Code- If you invoice a customer that uses
56032 ! "       a FCC, invoices following in the same batch will also use it"
56033 ! "195763-Commission not updating after adding freight on A/R Invoice 
56034 ! "194559-During Invoice Entry in GUI, the summary screen hangs if the
56035 ! "       A/R parameter for Immediate print is turned on."
56039 ! "186958-Invalid acces to fields in AR invoicing."
56040 ! "187861-ARGEAC.2 does not show the wshe location that inventory was
56041 ! "       pulled from"
56042 ! "198247-Invoice Entry does not recognize an invalid sales tax code
56043 ! "       in GUI.
56045 ! "199976-Message Duplicate object names encountered COMM_CODE.ctl    
56046 REM " 199591- Buried frt showing with sell
56047 REM "204668-Credit card invoice processed through Credit Card Plus and  
56048 REM "205673-Audit report printed msg in AR invoicing is not cleared in  
56049 REM "202185-Invalid Location message in GUI A/R Invoice Entry.  
56052 REM "206714-Not able to change terms code in GUI. You can in chui when  
56054 REM "207747-Cost is not coming into AR invoicing lines when they do not 
56056 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
56060 ! "204778-Zero invoice entered in GUI - when GL is added to invoice.  
56061 ! "215793-Invoice entry allows you to change the order number on      
56062 ! "216128-ARGEAC.5  This is returning a zero cost to FS3              
56064 REM "215958-When doing a credit memo (A/R Invoice) will only let you do 
56065 ! "217241-In AR Invoicing, panel ARGEAC.3 the GP% and GP adjustment   
56066 REM "212287-Voicemail from Dawn regarding sales tax defaults
56070 ! "218091-Tying to invoice in batch 5741 a summary bill customer      
56071 ! "217839-A/R batch 822 (no po receiving) has one of the blank        
56072 REM "219276-Veratax enhancements related to new taxing requirements
56073 REM "207527-When you use the Immediate print option at invoice entry, it
56074 REM "218368-In AR billing some of the commission codes that we have in  
56075 REM "222053-ARGEAC.5.  When you click on this screen, inventory costs   
56076 REM "211321-EC-S4-address override not carrying through to invoice.     
56077 REM "224183-When you change sell price in AR Invoice Entry, the cost is 
56078 REM "223872-Ship to field prints differently on invoices in GUI as      
56079 ! "224467-error during manual invoicing                               
56080 REM "223956-Extensions are not being computed correctly when you change 
56082 ! "192978-Put 191822 w/o in GUI order Entry                           
56083 ! "224634-I was just informed that we can not use LOT under GUI but   
56084 REM "234570-CSR getting error#47 when deleting inv lines that were added
56085 REM "236850-Putting a test postage order through in billing and its     
56086 REM "237252-The "Bill Complete" button does not work in AR Invoice      
56087 REM "238390-I am able to recreate the situation with the Error 36 ZZREST
56088 REM "238779-The deposit check amount in order entry is showing up as    
56089 REM "238636-AR invoicing - System should NOT ask question, do you wish  
56090 REM "235752-Add check to AR Invoice Entry, once the customer code is    
56091 REM "238742-Order lines that are not yet received are being coded as    
56092 REM "240353-AutoBill functionality for AR Invoice Entry should be added 
56094 REM "240665-Add first and last operator code fields to AR Invoice Header
56096 REM "240648-ARGEAC.1 will not display the sell price for extension only 
56098 REM "242473-Issue with different qty than what was PO received.         
56099 REM "243177-If they change the amount on an auto req charges. The comm  
56100 REM "244961-When doing AUTO invoice in invoice entry, the ship date     
56102 REM "247884-New order header field for ship date during CIG provided the
56103 REM "249775-Changes to sales tax parameters and tax calculations to     
56104 REM "251012-Wrong ship-to location is displaying in AR Invoice header   
56105 REM "251766-When adding a special charge on an invoice, system is       
56106 REM "252102-ARGEAC.2 Invoice Entry.  Message lines should not have      
56107 REM "252208-Sales tax code lookup not working correctly for Suwanee, GA 
56108 REM "252598-Changed a line on the invoice for a qty of 48 instead of 50 
56109 REM "252939-ARGEAC.5 when using DZ as a unit of measure.  If you change 
56110 REM "255959-Field in Order Header for Summary Bill Y/N which will carry 
56111 REM "257343-Item on backorder was invoiced before the item was          
56112 REM "259596-Option to display Order Notepad in GUI Invoice Entry for    
56114 REM "257510-GUI Invoice Entry; U/M with fixed num items and skip unit   
56116 ! WO264703-Invoice entry Invoice Job Card Override
56118 REM "263619-Customer default; Don't invoice customer for overruns?      
56119 ! SSP265115-Invoices not on Finders Fee Report
56120 REM "269037-Bill to Address override on buyer setup, not pulling the    
56121 REM "270057-Freight in Freight Bucket, when it should be in Net Sales if
56122 REM "271836-Doing PO recvg on order 096014.  At invoicing interface, get
56123 REM "273324-Getting error in PO Rec'g batch # 2537                      
56124 REM "273864-Line one missing from invoice - why?  May of been deleted in
56125 REM "275494-On the Salesperson Gross Profit Analysis Report, the first  
56126 REM "273358-Msg and Special line is being changed to Bill Now=N 
56127 REM "229993-PCI/PA-DSS New Credit Card Processing - Vault Module        
56128 REM "280835-Issue with the "job:" field in GUI versus CHUI.             
56129 REM "292135-Order billed 3x in batch # 9405B, Audit Control # 8130.02   
56130 REM "297121-Foreign Currency Entry & Inv Entry doesn't save as 4 digit  
56131 REM "297252-Error in invoicing. Error 001-ARGEAB-07120.                 
56132 REM "298391-Ability to send E/F emails of Invoices after SJ Update      
56133 REM "302616-GUI: Does not validate a deleted terms code in AR Invoice   
56134 REM "307216-Incorrect Commission Calculation on Invoice Total when House
56136 REM "307394 DBD-249 Invoice data entry clearing ASD tax file
56138 REM "307430-DBD-333;Add 101 to some of 288's company specfic code       
56140 REM "307450-DBD-270; Repeat Order Check - add back if needed            
56141 REM "307458-DBSPT-167751 Install missing changes                        
56142 REM "307509-DBD-474: Reset CC invoice for reprocessing                  

0010 ! FMGIAH - Order History Inquiry (="FS6"+%C$)
0035 REM "5.5 - 03/30/07 - 9.68 - jir - SSP# 206686
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 ! 
0092 ! PROCESS "FMGIAH.1","../ARG/AR.EN",%S$,%T$
0093 PNL_INVOKE: %MAX_SCREEN=1 ! SSP 206686
0094 _CUSTOMER$=%CUSTOMER$ ! GOSUB INIT; %FS1=_FS1,%ICO=_IC0,%FM1=_FM1,%FMP=_FMP,%FS9=_FS9; PROCESS "QRY_AIH","../FMG/FM.EN",VAL$; IF VAL$<>"" THEN ORDER_LINE$=VAL$; GOSUB 28150; VAL$=""; GOSUB WRAPUP;GOTO 0093 ELSE GOSUB WRAPUP; GOTO 0096
0095 PROCESS "FMGIAH","../ARG/AR.EN"
0096 %CUSTOMER$=_CUSTOMER$,%MAX_SCREEN=0 ! SSP 206686
0097 EXIT 
0100 ! 100 - Initialization
0105 INIT:
0110 IF %CUSTOMER$<>"" THEN CUSTOMER$=%CUSTOMER$
0115 _FILE_NAME$="FS6"+%C$
0120 _FIL_NO=HFN; OPEN (_FIL_NO,IOL=*,ERR=OPEN_ERR)_FILE_NAME$
0125 _FILE_NAME$="ZZPARM"; _ZZPARM=HFN; OPEN (_ZZPARM,ERR=OPEN_ERR)_FILE_NAME$
0130 _FILE_NAME$="FS8"+%C$; _FS8=HFN; OPEN (_FS8,ERR=OPEN_ERR)_FILE_NAME$
0135 _FILE_NAME$="FM1"+%C$; _FM1=HFN; OPEN (_FM1,ERR=OPEN_ERR,IOL=*)_FILE_NAME$
0140 _FILE_NAME$="AR1"+%C$; _AR1=HFN; OPEN (_AR1,ERR=OPEN_ERR,IOL=*)_FILE_NAME$
0145 _FILE_NAME$="IC0"+%C$,_IC0=HFN; OPEN (_IC0,ERR=OPEN_ERR)_FILE_NAME$
0150 _FILE_NAME$="FMP"+%C$,_FMP=HFN; OPEN (_FMP,ERR=OPEN_ERR)_FILE_NAME$
0155 _FILE_NAME$="FS9"+%C$,_FS9=HFN; OPEN (_FS9,ERR=OPEN_ERR,IOL=*)_FILE_NAME$
0160 _FILE_NAME$="FS1"+%C$,_FS1=HFN; OPEN (_FS1,ERR=OPEN_ERR)_FILE_NAME$
0181 READ (_ZZPARM,KEY=%C$+"A/R",DOM=*NEXT)P0$; GOTO 0183
0182 CMD_STR$="END"; EXIT 
0195 RETURN 
0200 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0210 CMD_STR$="END"
0220 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0515 IF P0$(15,1)<>"Y" THEN CALL "*wingrp;Hide",BILLTO.GRP$
0520 GOSUB STARTING_POINT ! SSP 200903
0535 GOSUB PROCESS_CUSTOMER
0540 RETURN 
0900 ! 900 - Wrapup
0905 WRAPUP:
0908 %MAX_SCREEN=0 ! SSP 206686
0910 IF _FIL_NO<>0 THEN CLOSE (_FIL_NO); _FIL_NO=0
0915 IF _CUR_FN<>0 THEN CLOSE (_CUR_FN); _CUR_FN=0
0920 IF _ZZPARM<>0 THEN CLOSE (_ZZPARM); _ZZPARM=0
0925 IF _FS8<>0 THEN CLOSE (_FS8); _FS8=0
0930 IF _FM1<>0 THEN CLOSE (_FM1); _FM1=0
0935 IF _AR1<>0 THEN CLOSE (_AR1); _AR1=0
0940 IF _IC0<>0 THEN CLOSE (_IC0); _IC0=0
0945 IF _FMP<>0 THEN CLOSE (_FMP); _FMP=0
0950 IF _FS9<>0 THEN CLOSE (_FS9); _FS9=0
0955 IF _FS1<>0 THEN CLOSE (_FS1); _FS1=0
0990 EXIT 
1000 ! 1000 - Process customer
1005 PROCESS_CUSTOMER:
1010 REFRESH_FLG=1
1011 IF %CUSTOMER$<>"" THEN DISABLE CONTROL CUSTOMER.CTL
1012 CUSTOMER$=%CUSTOMER$; ITEM_CODE$=%ITEM_CODE$
1015 CALL "ZZWLKU;PARSE_CUST",CUSTOMER$,CUST_DIV$,CUST_CODE$; CUSTOMER$=CUST_DIV$+CUST_CODE$
1020 READ (_AR1,KEY=CUST_DIV$+CUST_CODE$,DOM=*NEXT); BILL_TO_CUST$=BILL_TO_CUST_DIV$+BILL_TO_CUST_CODE$
1022 DIM TF_TYPE$[8]; TF_TYPE$[1]="Custom forms",TF_TYPE$[2]="Customer specific Inventory items",TF_TYPE$[3]="Inventory items",TF_TYPE$[4]="Hidden Warehouse items",TF_TYPE$[5]="Non-stock items",TF_TYPE$[6]="Stock Purchase Orders",TF_TYPE$[7]="Special charges",TF_TYPE$[8]="Message lines" ! ssp 191962
1025 GOSUB LOAD_DETAILS
1030 RETURN 
7500 GET_ITEM_DESC:
7505 ON POS(HIST_TYPE$="BDFHJM") GOTO 7590,7550,7510,7515,7600,7570,7600
7510 C0$=CUST_DIV$+CUST_CODE$; GOTO 7520
7515 DIM C0$(10)
7520 FIND (_IC0,KEY=C0$+ITEM_CODE$,DOM=7555)IC0$
7525 ITEM_DESC$=IC0$(21,40)
7545 GOTO 7590
7550 REM "Custom item case
7560 FIND (_FM1,KEY=CUST_DIV$+CUST_CODE$+ITEM_CODE$,DOM=*NEXT); GOTO 7565
7561 ITEM_DESC$=DIM(40)
7569 GOTO 7590
7570 REM "Special stuff
7580 FIND (_FMP,KEY="X"+ITEM_CODE$,DOM=*NEXT)FMP$; ITEM_DESC$=FMP$(12,40); GOTO 7582
7581 ITEM_DESC$=DIM(40)
7590 RETURN 
7600 REM "Read in non stock info from FS9 and put into E0$
7620 FIND (_FS9,KEY=ORDER_DIV$+ORDER_NUM$+ITEM_CODE$+SEQ_NUM$,DOM=*NEXT); ITEM_DESC$=TF_DESC$; GOTO 7625
7621 ITEM_DESC$=DIM(40)
7640 GOTO 7590
7690 RETURN 
21000 ! 21000 - Read and load line details
21005 LOAD_DETAILS:
21010 LIST_BOX LOAD DETAILS.CTL,""; CALL "*WINGRP;HIDE",INVO.GRP$; CALL "*Wingrp;Hide",INVO3.GRP$
21015 READ (_FIL_NO,KEY=CUST_DIV$+CUST_CODE$+SEL_TYPE$+SEL_ITEM$,DOM=*NEXT) ! SSP 191962 SSP 200903
21020 NEXT_FS8_REC: _FS6_KEY$=KEY(_FIL_NO,END=ALL_DONE); IF _FS6_KEY$(1,10)<>CUST_DIV$+CUST_CODE$ THEN LIST_BOX WRITE DETAILS.CTL,1; PRINT 'MESSAGE'('F8'+'BLACK'+"",0); RETURN ! SSP 191962
21025 READ (_FIL_NO)
21030 ! HIST_TYPE$=_FS8_KEY$(19,1),ITEM_CODE$=_FS8_KEY$(20,10),SEQ_NUM$=_FS8_KEY$(30,1),ORDER$=_FS8_KEY$(11,8) SSP 191962
21035 ! FS6_KEY$=CUST_DIV$+CUST_CODE$+HIST_TYPE$+ITEM_CODE$+ORDER$+SEQ_NUM$ SSP 191962
21040 ! READ (_FIL_NO,KEY=FS6_KEY$,DOM=NEXT_FS8_REC) ssp 191962
21041 IF NOT(NUL(INVOICE_TYPE$)) THEN IF HIST_TYPE$<>INVOICE_TYPE$ THEN GOTO NEXT_FS8_REC
21042 GOSUB GET_TYPE_DESC
21045 GOSUB GET_ITEM_DESC
21050 GOSUB LOAD_LISTBOX
21055 GOTO NEXT_FS8_REC
21060 ALL_DONE:PRINT 'MESSAGE'('F8'+'BLACK'+"",0); PRINT 'CI',; RETURN ! SSP 200707
21095 ! 
23000 ! Determine the Type
23010 INVOICE_TYPE:
23020 REPLACEMENT_SCRN$="FMGIAH_1"
23030 PERFORM "*winproc;overlay_screen"
23050 GOTO LOAD_DETAILS
23090 RETURN 
25000 ! 25000 - Load items into listbox
25005 LOAD_LISTBOX:! COLUMN SEPARATOR IS SEP
25006 ! IF B_HIST_TYPE$<>HIST_TYPE$ THEN TF_DESC$=TF_TYPE$[POS(HIST_TYPE$="BDFHPZJM")]; LIST_BOX LOAD DETAILS.CTL,0,'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+'YELLOW'+TF_DESC$+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP; B_HIST_TYPE$=HIST_TYPE$ ! ssp 191962
25007 %BL$=""; READ (_FS1,KEY=ORDER_DIV$+ORDER_NUM$,DOM=*NEXT)FS1$; IF FS1$(63,1)="Y" THEN %BL$="*** Invoice in Progress ***" ELSE %BL$="*** Open Orders ***"
25008 RETURN 
25010 CALL "ZZWDTE;DISPLAY",ORDER_DATE$
25013 MSG_1$=DIM(10); IF ORDER_TYPE$="B" THEN MSG_1$="Bill as Ship"
25015 COLUMNS$=BL$+ORDER_DATE$+SEP+BL$+ORDER_DIV$+"-"+ORDER_NUM$+SEP+BL$+CUST_PO$+SEP+BL$+ITEM_CODE$+SEP+BL$+ITEM_DESC$+SEP+BL$+STR(FN%QTY_IN_UM(SELL_QTY,SELL_UM$,QTY_PER):"##,###,###-")+SEP+BL$+STR(UNIT_PRICE:"###,###.00#")+SEP+BL$+SELL_UM$+"/"+STR(QTY_PER:"##,##0")+SEP+BL$+STR(UNIT_COST:"###,###.00#")+SEP+BL$+PROD_CODE$+SEP+BL$+HIST_TYPE$+SEP+BL$+TYPE_DESC$+SEP+BL$+MSG_1$+SEP+BL$+SEQ_NUM$ ! SSP 181457
25020 LIST_BOX LOAD DETAILS.CTL,0,COLUMNS$
25022 COUNT+=1; IF MOD(COUNT,500)=0 THEN PRINT 'MESSAGE'('_RED'+'WHITE'+"Please Wait, Records : "+STR(COUNT),0); CALL "$CTL-10;AGENT_MSG","Please Wait, Records :"+STR(COUNT),0 ! LIST_BOX WRITE DETAILS.CTL,COUNT ! SSP 
25024 WRITE (_TMPFLD,KEY=STR(COUNT:"000000"))BL$,ORDER_DATE$,FN%ZZDISP$(ORDER_DIV$+ORDER_NUM$,"O/P"),CUST_PO$,ITEM_CODE$,ITEM_DESC$,FN%QTY_IN_UM(SELL_QTY,SELL_UM$,QTY_PER),UNI_PRICE,SELL_UM$+"/"+STR(QTY_PER:"##,##0"),UNIT_COST,PROD_CODE$,HIST_TYPE$,TYPE_DESC$,MSG_1$,SEQ_NUM$
25025 RETURN 
25095 ! 
26000 GET_TYPE_DESC:
26005 TYPE_DESC$=""
26010 ON POS(HIST_TYPE$="BDFHJMZ") GOTO 26090,26020,26025,26030,26035,26040,26045,26050
26020 TYPE_DESC$=MSG("CUSTOM_ORD"); GOTO GET_TYPE_DESC_END
26025 TYPE_DESC$=MSG("CUST_INV"); GOTO GET_TYPE_DESC_END
26030 TYPE_DESC$=MSG("STOCK_INV"); GOTO GET_TYPE_DESC_END
26035 TYPE_DESC$=MSG("NONSTOCK"); GOTO GET_TYPE_DESC_END
26040 TYPE_DESC$=MSG("SPEC_CHRGS"); GOTO GET_TYPE_DESC_END
26045 TYPE_DESC$=MSG("MESS_LNS"); GOTO GET_TYPE_DESC_END
26050 TYPE_DESC$=MSG("HID_INV"); GOTO GET_TYPE_DESC_END
26090 GET_TYPE_DESC_END:RETURN 
26095 ! 
28000 ! 
28010 HIST_LINE_INFO:
28015 IF _EOM$=$01$ THEN RETURN 
28020 LIST_BOX READ DETAILS.CTL,IDX
28030 LINE_INFO$=DETAILS.CTL'VALUE$ ! LIST_BOX FIND DETAILS.CTL,IDX,LINE_INFO$
28031 IF POS($1B42348A$=LINE_INFO$) THEN RETURN ! SSP 191962
28035 XX=POS($1B53461B4236$=LINE_INFO$); IF XX<>0 THEN LINE_INFO$=LINE_INFO$(1,XX-1)+LINE_INFO$(XX+6); GOTO 28035
28037 XX=POS($1B53461B4232$=LINE_INFO$); IF XX<>0 THEN LINE_INFO$=LINE_INFO$(1,XX-1)+LINE_INFO$(XX+6); GOTO 28037
28040 ORD_DATE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28050 ORD_NUM$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28055 CUST_PO$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28060 ITEM_NUM$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28070 ITEM_DESC$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28080 ORD_QTY$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28090 PRICE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28100 U_M$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28110 TF_COST$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28120 PROD_CODE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28125 TF_TYPE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28127 TYPE_DESC$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28129 ORDER_TYPE_1$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28130 SEQ_NUM$=LINE_INFO$; SEQ_NUM$=SEQ_NUM$(1,1)
28140 ORDER_LINE$=CUSTOMER$+TF_TYPE$(1,1)+ITEM_NUM$+STP(ORD_NUM$,3,"-")+SEQ_NUM$
28150 PROCESS "FMGIAI","../FMG/FM.EN",ORDER_LINE$
28190 RETURN 
29000 STARTING_POINT:! SSP 200903
29010 PROCESS "FMGIAH.1","../ARG/AR.EN",SEL_TYPE$,SEL_ITEM$
29020 IF ID$="TYPE_2" THEN GOSUB LOAD_DETAILS
29030 RETURN 
30000 SEL_RECORD:
30010 ENTER HIST_TYPE$,ORDER_TYPE$,ITEM_CODE$,SELL_QTY,SELL_UM$,QTY_PER,ORDER_DIV$,ORDER_NUM$
30020 GOSUB GET_TYPE_DESC; %TYPE_DESC$=TYPE_DESC$
30030 %MSG_1$=DIM(10); IF ORDER_TYPE$="B" THEN %MSG_1$="Bill as Ship"
30040 CALL "ZZWLKU;PARSE_CUST",%CUSTOMER$,CUST_DIV$,CUST_CODE$
30042 IF %IC0=0 THEN %IC0=FFN("IC0"+%C$)
30050 _IC0=%IC0,_FM1=%FM1,_FS1=%FS1,_FMP=%FMP,_FS9=%FS9; GOSUB GET_ITEM_DESC; %ITEM_DESC$=ITEM_DESC$
30060 %QTY=FN%QTY_IN_UM(SELL_QTY,SELL_UM$,QTY_PER)
30070 GOSUB LOAD_LISTBOX
30100 EXIT 
56000 ! "181457-GUI, order entry. Cannot enter a negative requisition       
56001 ! 191962-Order History by item needs to display by type B=Custom form
56002 REM "194087-Changes made at Whitepaper during 2nd week of install       
56005 ! "200707-Program FMGIAH Order History by item number. Click the Exit 
56010 ! "200903-GUI Order History by item cannot enter a starting item code 
56011 ! "206118-00-TVIINC, Invoiced Order History by Date, doesn't say      
56012 ! "206686-Order history inquiry display screen has changed. Would like

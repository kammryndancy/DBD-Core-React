0010 ! "FMGPLA - Custom Item Locator by Size
0015 REM "Prog Type: I -2.5     
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 11/22/06 - 11.40 - jir
0040 REM "Copyright 1994 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "FMGPLA","../FMG/FM.EN"
0060 EXIT 
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000; SETESC 9300
0105 INIT:
0110 X0$="FM2PLA",X1$="Custom Item Locator by Size",K9$="",K9=0
0120 DIM Z0$(80,"-"),M$(21),M[1]
0135 C9=-1
0140 M0$="##,##0",M1$="###,###.00-"
0145 GOSUB 8950
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,-1,-1; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0298 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1)
0320 IOLIST B$
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4]
0390 IOLIST M$,M[0],M[1]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X FM2...  02O FMP...  03O FM1...  04O AR1...  05O AP4...  13O ZZPARM  "
0520 GOSUB 9750; ON Z0 GOTO 0521,9900
0590 READ (Z[1],KEY=K9$,DOM=0591)
0600 REM "
0680 GOSUB 6000
0900 REM "Restart after item detail lookup
0910 IF Q1$="" THEN GOTO 0990
0915 P=POS("~"=Q1$); IF P=0 THEN GOTO 0990
0920 A$=Q1$(1,P-1),K$=Q1$(P+1)
0925 GOSUB 6600; GOSUB 6460
0930 GOSUB 7500
0935 EXTRACT (Z[1],KEY=K$,DOM=0936)
0940 GOTO 1515
1000 REM "
1010 Y8=1; CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,-1,X1,X2
1030 DIM B$(60)
1035 DIM A$(32)
1060 GOSUB 6450; GOTO 1100
1070 GOSUB 6000; GOSUB 6450
1100 REM "KEY SEQ
1105 RETURN 
1110 X0=-1,C0=0,X1=0,C9=0,Z9=0
1120 SETERR 9000; C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN IF X0=0 THEN GOTO 9900 ELSE X0=X0+999
1140 ON X0 GOTO 1200,1250,1300,1350,1400,1500
1200 REM "
1205 IF LEN(A1$)>0 THEN A$(1,3)=A1$(1,3); GOTO 1220
1206 SEL_PROD_CODE:
1207 IF _EOM$=$00$ THEN RETURN 
1208 IF STP(PROD_CODE$)="" THEN EXIT 
1210 A$(1,3)=PROD_CODE$ ! CALL "ZZENTR","SZXUX",A{ALL},A$,X4$,X3$,3,4,1,3,C0,"","{1"+X$,"T","FM2PLA00","FMPP","FM2SAA",""; IF C0=6 THEN GOSUB 6400; C0=1
1212 IF INT(ABS(C0))=3 THEN C0=-ABS(C0); READ (Z[1],KEY=A$(1,3),DOM=1213)
1215 IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1216,1216,9800,6970
1220 IF V9<>-2 THEN FIND (Z[2],KEY="T"+A$(1,3),DOM=1210)IOL=0320
1225 ! PRINT @(8,4),B$(5,15),
1240 RETURN 
1250 SEL_LEFT_RIGHT:
1255 IF LEN(A1$)>3 THEN A$(4,8)=A1$(4,8); GOTO 1270
1257 Q$=A$(1,3)
1260 A$(4,8)=LEFT_RIGHT$ ! CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,23,4,4,8,C0,"","{3"+X$,Q$,"FM2PLA02","","",""; IF C0=6 THEN GOSUB 6400; C0=1
1261 IF ABS(C0)=2 AND LEN(A1$)>0 THEN A1$=A1$(1,0)
1262 READ (Z[1],KEY=A$(1,11),DOM=1263)
1290 RETURN 
1300 SEL_TOP_BOTTON:
1305 IF LEN(A1$)>11 THEN A$(12,8)=A1$(12,8); GOTO 1320
1307 Q$=A$(1,11)
1310 A$(12,8)=TOP_BUTTON$ ! CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,41,4,12,8,C0,"","{3"+X$,Q$,"FM2PLA04","","",""; IF C0=6 THEN GOSUB 6400; C0=1
1311 IF ABS(C0)=2 AND LEN(A1$)>3 THEN A1$=A1$(1,3)
1312 READ (Z[1],KEY=A$(1,19),DOM=1313)
1340 RETURN 
1350 SEL_ITEM_CODE:
1355 IF LEN(A1$)>19 THEN A$(22,10)=A1$(22,10); GOTO 1370
1357 Q$=A$(1,19)
1360 A$(22,10)=ITEM_CODE$ ! CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,54,4,22,10,C0,"","{3"+X$,Q$,"FM2PLA06","","",""; IF C0=6 THEN GOSUB 6400; C0=1
1361 IF ABS(C0)=2 AND LEN(A1$)>11 THEN A1$=A1$(1,11)
1362 READ (Z[1],KEY=A$(1,29),DOM=1363)
1390 RETURN 
1400 SEL_PLYS:
1407 Q$=A$(1,29)
1410 A$(20,2)=PLYS$ ! CALL "ZZENTR","SZUX",A{ALL},A$,X4$,X3$,70,4,20,2,C0,"","{3"+X$,Q$,"FM2PLA08","","",""; IF C0=6 THEN GOSUB 6400; C0=1
1411 IF ABS(C0)=2 AND LEN(A1$)>19 THEN A1$=A1$(1,19)
1412 READ (Z[1],KEY=A$(1,31),DOM=1413)
1500 PROCEED:
1502 IDX=0; LIST_BOX LOAD LB_LINE.CTL,""
1505 GOSUB 7500
1510 READ (Z[1],KEY=A$,DOM=1511)
1515 GOSUB 4030
1520 K$=KEY(Z[1],END=5000); PRINT 'MESSAGE'("Searching: "+K$,0),; READ (Z[1])
1525 IF K$(1,3)<>A$(1,3) THEN GOTO 5000
1530 IF K0$(1,1)<>"A" AND A$(4,8)<>K$(4,8) THEN GOTO 1520
1535 IF K0$(2,1)<>"A" AND A$(12,8)<>K$(12,8) THEN GOTO 1520
1540 IF K0$(3,1)<>"A" AND A$(22,K1)<>K$(22,K1) THEN GOTO 1520
1545 IF K0$(4,1)<>"A" AND A$(20,2)<>K$(20,2) THEN GOTO 1520
1590 GOSUB 2000
1595 GOTO 1520
2000 REM "Print a item
2005 DIM C$(120),C[4]
2010 READ (Z[3],KEY=MID(K$,32,10)+MID(K$,22,10),DOM=2090)IOL=0330
2015 DIM B1$(20); FIND (Z[2],KEY="T"+C$(21,3))B1$
2020 ! IF L>18 THEN GOSUB 4000
2022 L$=L$+K$; IF L0$="" THEN L0$=K$
2025 GOSUB 8000 ! PRINT @(0,L),L0:"0.",@(3),C$(11,10),@(15),H9$,
2030 L=L+1
2035 GOSUB 2200
2040 GOSUB 2100
2080 L=L+1,L0=L0+1
2090 RETURN 
2100 REM "Print price & customer
2105 DIM D$(100)
2110 READ (Z[4],KEY=C$(1,10),DOM=2111)D$
2115 IF M$(4,4)<>C$(100,4) THEN DIM M$(21),M[1]; FIND (Z[13],KEY="U/M"+C$(100,4),DOM=2116)IOL=0390
2120 IF M$(20,1)<>"Y" THEN PQ0=C[4] ELSE IF M[0]<>0 THEN PQ0=M[0] ELSE PQ0=M[1]
2125 CALL "ZZDISP","AX",C$(1,10),"A/R",X3$,X$,"",0,0,X4$
2126 CUSTOMER$=X$+" "+D$(11,35)
2130 ! PRINT @(3,L),"Price:",@(10),C[3]:M1$,@(23),FNS$(C$(100,4)),"/",FNR$(STR(Q0:M0$)),@(35),"Cust:",@(41),X$,
2131 IDX+=1; LIST_BOX LOAD LB_LINE.CTL,IDX,C$(11,10)+SEP+H9$+SEP+FNS$(C$(96,4))+"/"+FNR$(STR(Q0:M0$))+SEP+STR(C(1):M1$)+SEP+FNS$(C$(100,4))+"/"+FNR$(STR(PQ0:M0$))+SEP+STR(C(3):M1$)+SEP+VENDOR$+SEP+CUSTOMER$+SEP
2180 L=L+1
2190 RETURN 
2200 REM "Print cost & vendor
2205 DIM E$(100)
2210 READ (Z[5],KEY=C$(82,10),DOM=2211)E$
2215 IF M$(4,4)<>C$(96,4) THEN DIM M$(21),M[1]; FIND (Z[13],KEY="U/M"+C$(96,4),DOM=2216)IOL=0390
2220 IF M$(20,1)<>"Y" THEN Q0=C[2] ELSE IF M[0]<>0 THEN Q0=M[0] ELSE Q0=M[1]
2225 CALL "ZZDISP","AX",C$(82,10),"A/P",X3$,X$,"",0,0,X4$
2226 IF POS(" "<>C$(92,4))<>0 THEN X$=X$+"-"+C$(92,4)
2227 VENDOR$=X$+" "+E$(11,35)
2230 ! PRINT @(4,L),"Cost:",@(10),C[1]:M1$,@(23),FNS$(C$(96,4)),"/",FNR$(STR(Q0:M0$)),@(35),"Vend:",@(41),X$,
2280 L=L+1
2290 RETURN 
4000 REM "New page
4010 CALL "ZZPROM","X0FM2PLA",X3$,Z,"","","",0
4020 ON Z GOTO 4030,4022,4024,4025
4022 EXITTO 1060
4024 EXITTO 1500
4025 GOSUB 5100; GOTO 4010
4030 L=6,L0=1,L$="",L0$=""
4040 RETURN 
5000 REM "End
5005 RETURN 
5010 CALL "ZZPROM","X0FM2PLA",X3$,Z,"","","",0
5015 ON Z GOTO 5020,5025,5030,5035
5020 GOTO 1060
5025 GOTO 1060
5030 GOTO 1500
5035 GOSUB 5100
5090 GOTO 1060
5100 REM "Show order detail
5104 DIM A9$(2)
5105 PRINT @(27,22),'CE'," Line number:",; CALL "ZZENTR","ZX",A{ALL},A9$,X4$,X3$,43,22,1,2,C0,"","","","FM2PLA08","","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 5105,5106
5106 IF C0<0 THEN RETURN ELSE PRINT @(27,22),'CL',
5107 A9=NUM(A9$,ERR=5104); IF A9<1 OR A9>L0 THEN GOTO 5104
5108 L1=(A9-1)*LEN(K$)+1
5120 U1$=X0$+STR(LEN(A$)+LEN(L0$)+1:"00")+A$+"~"+L0$+U1$
5125 U1$="FM2IAZ20"+L$(L1+31,10)+L$(L1+21,10)+U1$
5150 GOTO 9700
6000 REM "BACKGROUND
6001 RETURN 
6005 PRINT (0,ERR=6016)'SB',
6060 PRINT @(3,3+V0),"Product code",@(22,3+V0),"Left-right",@(40,3+V0),"Top-bottom",@(54,3+V0),"Item code",@(69,3+V0),"Plys",@(0,5+V0),Z0$,
6070 PRINT 
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6460 ! PRINT @(3,4),A$(1,3),@(8,4),B$(5,15),@(23,4),A$(4,8),@(41,4),A$(12,8),@(54,4),A$(22,10),@(70,4),A$(20,2),
6490 RETURN 
6500 REM "DELETE
6510 REMOVE (Z[1],KEY=A1$,DOM=6511)
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6605 FIND (Z[2],KEY="T"+A$(1,3),DOM=6606)IOL=0320
6690 RETURN 
6700 REM "ADD ENTRY
6705 IF Z9=0 THEN GOTO 6790 ELSE IF V7$>"" THEN X0=POS(" "<>V7$); IF X0>0 THEN X0=X0-1; GOTO 2038
6710 WRITE (Z[1],KEY=A1$)IOL=0310
6790 GOTO 1630
7200 REM "Forced read 
7210 IF ERR<>0 THEN GOTO 9000
7220 CALL "ZZREAD",Z[1],A1$,A$,A{ALL},S8; ON S8 GOTO 7221,1630
7230 GOSUB 6200
7240 CALL "ZZPROM","E0",X3$,0,"","","",0; GOTO 7290
7250 CALL "ZZPROM","E0A",X3$,0,"","","",0; GOTO 7290
7290 GOTO 1630
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 IF X0>0 THEN X0=X0-0
7395 C0=3; RETURN 
7400 REM "EXTRACT
7410 EXTRACT (Z[1],ERR=7200,KEY=A1$,DOM=7440)IOL=0310
7420 C9=1,Z9=1; GOSUB 5800
7440 RETURN 
7450 REM "EXTRACT NEW ENTRY
7460 WRITE (Z[1],KEY=A1$,DOM=7250)IOL=0310; GOTO 7400
7490 RETURN 
7500 REM "Set flags in K0$
7510 DIM K0$(4)
7515 IF POS(" "<>A$(4,8))=0 THEN K0$(1,1)="A"
7520 IF POS(" "<>A$(12,8))=0 THEN K0$(2,1)="A"
7525 IF POS(" "<>A$(22,10))=0 THEN K0$(3,1)="A"
7530 IF POS(" "<>A$(20,2))=0 THEN K0$(4,1)="A"
7535 IF K0$(3,1)="A" THEN K1=0 ELSE K1=LEN(FNS$(A$(22,10)))
7540 RETURN 
8000 REM "Build desc from C$ 
8010 H9$=FNS$(C$(24,8)); IF H9$<>"" THEN H9$=H9$+QUO; IF POS(" "<>C$(32,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(C$(32,8)); IF H9$<>"" THEN IF POS(" "<>C$(32,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(C$(40,2))<>0 THEN H9$=H9$+C$(40,2)+" Ply "
8040 H9$=H9$+FNS$(C$(42,40))
8050 RETURN 
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
8920 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
8925 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
8950 REM "Program flow logic
8960 DIM U0$(6); U0$(1)=FID(0); U0$=U0$+"PF"
8970 CLOSE (14); OPEN (14)"ZZPARM"; FIND (14,KEY=U0$,DOM=8990)U0$,U1$
8975 IF U1$="" THEN RETURN ELSE IF U1$(1,6)<>X0$ THEN RETURN 
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9)
8990 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9705 DIM U0$(6); U0$(1)=FID(0); U0$=U0$+"PF"
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9730 RUN U1$(1,6)
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9901 END_PROG:
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
10000 SEL_LINE:
10020 ITEM_CODE$=LB_LINE$(1,POS(SEP=LB_LINE$)-1)
10030 IF LB_LINE$(LEN(LB_LINE$))=SEP THEN LB_LINE$=LB_LINE$(1,LEN(LB_LINE$)-1)
10040 XX=POS(SEP=LB_LINE$,-1),CUSTOMER$=LB_LINE$(XX+1),CUSTOMER$=SUB(CUSTOMER$,"-",""),XX=POS(" "=CUSTOMER$),CUSTOMER$=CUSTOMER$(1,XX-1)
10050 CALL "ZZWLKU;PARSE_CUST",CUSTOMER$,DIV$,CODE$
10060 %CUSTOMER$=DIV$+CODE$,%ITEM_CODE$=ITEM_CODE$
10070 PROCESS "FMGIAZ","../FMG/FM.EN"
10080 RETURN 
10100 CLEAR_REC:
10110 LIST_BOX LOAD LB_LINE.CTL,""
10120 DIM A$(32)
10130 PROD_CODE$="",LEFT_RIGHT$="",TOP_BUTTON$="",ITEM_CODE$="",PLYS$=""
10140 REFRESH_FLG=1,NEXT_ID=PROD_CODE.CTL,IDX=0
10150 RETURN 
